var JSON;JSON||(JSON={}),function(){function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g;return e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g;return e}}function quote(a){escapable.lastIndex=0;return escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return a<10?"0"+a:a}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(b&&typeof b!="function"&&(typeof b!="object"||typeof b.length!="number"))throw new Error("JSON.stringify");return str("",{"":a})}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver=="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")})}(),function(a,b){function z(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]),a(b).remove()}function y(b,c){var d=this._wrap;return a.map(a(a.isArray(d)?d.join(""):d).filter(b||"*"),function(a){return c?a.innerText||a.textContent:a.outerHTML||t(a)})}function x(b,c){var d=b.options||{};d.wrapped=c;return a.tmpl(a.template(b.tmpl),b.data,d,b.item)}function w(b,c,d){return a.tmpl(a.template(b),c,d,this)}function v(a,b,c,d){if(!a)return l.pop();l.push({_:a,tmpl:b,item:this,data:c,options:d})}function u(b){function p(b){function p(a){a=a+c,n=i[a]=i[a]||m(n,f[n.parent.key+c]||n.parent,null,!0)}var e,h=b,l,n,o;if(o=b.getAttribute(d)){while(h.parentNode&&(h=h.parentNode).nodeType===1&&!(e=h.getAttribute(d)));e!==o&&(h=h.parentNode?h.nodeType===11?0:h.getAttribute(d)||0:0,(n=f[o])||(n=g[o],n=m(n,f[h]||g[h],null,!0),n.key=++j,f[j]=n),k&&p(o)),b.removeAttribute(d)}else k&&(n=a.data(b,"tmplItem"))&&(p(n.key),f[n.key]=n,h=a.data(b.parentNode,"tmplItem"),h=h?h.key:0);if(n){l=n;while(l&&l.key!=h)l.nodes.push(b),l=l.parent;delete n._ctnt,delete n._wrap,a.data(b,"tmplItem",n)}}var c="_"+k,e,h,i={},l,n,o;for(l=0,n=b.length;l<n;l++){if((e=b[l]).nodeType!==1)continue;h=e.getElementsByTagName("*");for(o=h.length-1;o>=0;o--)p(h[o]);p(e)}}function t(a){var b=document.createElement("div");b.appendChild(a.cloneNode(!0));return b.innerHTML}function s(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function r(b,c){b._wrap=o(b,!0,a.isArray(c)?c:[e.test(c)?c:a(c).html()]).join("")}function q(b){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(b,c,d,e,f,g,h){var i=a.tmpl.tag[d],j,k,l;if(!i)throw"Template command not found: "+d;j=i._default||[],g&&!/\w$/.test(f)&&(f+=g,g=""),f?(f=s(f),h=h?","+s(h)+")":g?")":"",k=g?f.indexOf(".")>-1?f+g:"("+f+").call($item"+h:f,l=g?k:"(typeof("+f+")==='function'?("+f+").call($item):("+f+"))"):l=k=j.$1||"null",e=s(e);return"');"+i[c?"close":"open"].split("$notnull_1").join(f?"typeof("+f+")!=='undefined' && ("+f+")!=null":"true").split("$1a").join(l).split("$1").join(k).split("$2").join(e?e.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(a,b,c,d){d=d?","+d+")":c?")":"";return d?"("+b+").call($item"+d:a}):j.$2||"")+"_.push('"})+"');}return _;")}function p(b){var c=document.createElement("div");c.innerHTML=b;return a.makeArray(c.childNodes)}function o(b,c,e){var f,g=e?a.map(e,function(a){return typeof a=="string"?b.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+d+'="'+b.key+'" $2'):a:o(a,b,a._ctnt)}):b;if(c)return g;g=g.join(""),g.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(b,c,d,e){f=a(d).get(),u(f),c&&(f=p(c).concat(f)),e&&(f=f.concat(p(e)))});return f?f:p(g)}function m(b,c,d,e){var h={data:e||(c?c.data:{}),_wrap:c?c._wrap:null,tmpl:null,parent:c||null,nodes:[],calls:v,nest:w,wrap:x,html:y,update:z};b&&a.extend(h,b,{nodes:[],parent:c}),d&&(h.tmpl=d,h._ctnt=h._ctnt||h.tmpl(a,h),h.key=++j,(l.length?g:f)[j]=h);return h}var c=a.fn.domManip,d="_tmplitem",e=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,f={},g={},h,i={key:0,data:{}},j=0,k=0,l=[];a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,c){a.fn[b]=function(d){var e=[],g=a(d),i,j,l,m,n=this.length===1&&this[0].parentNode;h=f||{};if(n&&n.nodeType===11&&n.childNodes.length===1&&g.length===1)g[c](this[0]),e=this;else{for(j=0,l=g.length;j<l;j++)k=j,i=(j>0?this.clone(!0):this).get(),a.fn[c].apply(a(g[j]),i),e=e.concat(i);k=0,e=this.pushStack(e,b,g.selector)}m=h,h=null,a.tmpl.complete(m);return e}}),a.fn.extend({tmpl:function(b,c,d){return a.tmpl(this[0],b,c,d)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(b,d,e,g){if(b[0]&&b[0].nodeType){var i=a.makeArray(arguments),j=b.length,l=0,m;while(l<j&&!(m=a.data(b[l++],"tmplItem")));j>1&&(i[0]=[a.makeArray(b)]),m&&k&&(i[2]=function(b){a.tmpl.afterManip(this,b,e)}),c.apply(this,i)}else c.apply(this,arguments);k=0,h||a.tmpl.complete(f);return this}}),a.extend({tmpl:function(b,c,d,e){var h,j=!e;if(j)e=i,b=a.template[b]||a.template(null,b),g={};else if(!b){b=e.tmpl,f[e.key]=e,e.nodes=[],e.wrapped&&r(e,e.wrapped);return a(o(e,null,e.tmpl(a,e)))}if(!b)return[];typeof c=="function"&&(c=c.call(e||{})),d&&d.wrapped&&r(d,d.wrapped),h=a.isArray(c)?a.map(c,function(a){return a?m(d,e,b,a):null}):[m(d,e,b,c)];return j?a(o(e,null,h)):h},tmplItem:function(b){var c;b instanceof a&&(b=b[0]);while(b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode));return c||i},template:function(b,c){if(c){typeof c=="string"?c=q(c):c instanceof a&&(c=c[0]||{}),c.nodeType&&(c=a.data(c,"tmpl")||a.data(c,"tmpl",q(c.innerHTML)));return typeof b=="string"?a.template[b]=c:c}return b?typeof b!="string"?a.template(null,b):a.template[b]||a.template(null,e.test(b)?b:a(b)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(a){f={}},afterManip:function(b,c,d){var e=c.nodeType===11?a.makeArray(c.childNodes):c.nodeType===1?[c]:[];d.call(b,c),u(e),k++}})}(jQuery),function(a){a.alerts={verticalOffset:-75,horizontalOffset:0,repositionOnResize:!0,overlayOpacity:.01,overlayColor:"#FFF",draggable:!0,okButton:"&nbsp;OK&nbsp;",cancelButton:"&nbsp;Cancel&nbsp;",dialogClass:null,alert:function(b,c,d){c==null&&(c="Alert"),a.alerts._show(c,b,null,"alert",function(a){d&&d(a)})},confirm:function(b,c,d){c==null&&(c="Confirm"),a.alerts._show(c,b,null,"confirm",function(a){d&&d(a)})},prompt:function(b,c,d,e){d==null&&(d="Prompt"),a.alerts._show(d,b,c,"prompt",function(a){e&&e(a)})},_show:function(b,c,d,e,f){a.alerts._hide(),a.alerts._overlay("show"),a("BODY").append('<div id="popup_container"><h1 id="popup_title"></h1><div id="popup_content"><div id="popup_message"></div></div></div>'),a.alerts.dialogClass&&a("#popup_container").addClass(a.alerts.dialogClass);var g=a.browser.msie&&parseInt(a.browser.version)<=6?"absolute":"fixed";a("#popup_container").css({position:g,zIndex:99999,padding:0,margin:0}),a("#popup_title").text(b),a("#popup_content").addClass(e),a("#popup_message").text(c),a("#popup_message").html(a("#popup_message").text().replace(/\n/g,"<br />")),a("#popup_container").css({minWidth:a("#popup_container").outerWidth(),maxWidth:a("#popup_container").outerWidth()}),a.alerts._reposition(),a.alerts._maintainPosition(!0);switch(e){case"alert":a("#popup_message").after('<div id="popup_panel"><input type="button" value="'+a.alerts.okButton+'" id="popup_ok" /></div>'),a("#popup_ok").click(function(){a.alerts._hide(),f(!0)}),a("#popup_ok").focus().keypress(function(b){(b.keyCode==13||b.keyCode==27)&&a("#popup_ok").trigger("click")});break;case"confirm":a("#popup_message").after('<div id="popup_panel"><input type="button" value="'+a.alerts.okButton+'" id="popup_ok" /> <input type="button" value="'+a.alerts.cancelButton+'" id="popup_cancel" /></div>'),a("#popup_ok").click(function(){a.alerts._hide(),f&&f(!0)}),a("#popup_cancel").click(function(){a.alerts._hide(),f&&f(!1)}),a("#popup_ok").focus(),a("#popup_ok, #popup_cancel").keypress(function(b){b.keyCode==13&&a("#popup_ok").trigger("click"),b.keyCode==27&&a("#popup_cancel").trigger("click")});break;case"prompt":a("#popup_message").append('<br /><input type="text" size="30" id="popup_prompt" />').after('<div id="popup_panel"><input type="button" value="'+a.alerts.okButton+'" id="popup_ok" /> <input type="button" value="'+a.alerts.cancelButton+'" id="popup_cancel" /></div>'),a("#popup_prompt").width(a("#popup_message").width()-12),a("#popup_ok").click(function(){var b=a("#popup_prompt").val();a.alerts._hide(),f&&f(b)}),a("#popup_cancel").click(function(){a.alerts._hide(),f&&f(null)}),a("#popup_prompt, #popup_ok, #popup_cancel").keypress(function(b){b.keyCode==13&&a("#popup_ok").trigger("click"),b.keyCode==27&&a("#popup_cancel").trigger("click")}),d&&a("#popup_prompt").val(d),a("#popup_prompt").focus().select()}if(a.alerts.draggable)try{a("#popup_container").draggable({handle:a("#popup_title")}),a("#popup_title").css({cursor:"move"})}catch(h){}},_hide:function(){a("#popup_container").remove(),a.alerts._overlay("hide"),a.alerts._maintainPosition(!1)},_overlay:function(b){switch(b){case"show":a.alerts._overlay("hide"),a("BODY").append('<div id="popup_overlay"></div>'),a("#popup_overlay").css({position:"absolute",zIndex:99998,top:"0px",left:"0px",width:"100%",height:a(document).height(),background:a.alerts.overlayColor,opacity:a.alerts.overlayOpacity});break;case"hide":a("#popup_overlay").remove()}},_reposition:function(){var b=a(window).height()/2-a("#popup_container").outerHeight()/2+a.alerts.verticalOffset,c=a(window).width()/2-a("#popup_container").outerWidth()/2+a.alerts.horizontalOffset;b<0&&(b=0),c<0&&(c=0),a.browser.msie&&parseInt(a.browser.version)<=6&&(b=b+a(window).scrollTop()),a("#popup_container").css({top:b+"px",left:c+"px"}),a("#popup_overlay").height(a(document).height())},_maintainPosition:function(b){if(a.alerts.repositionOnResize)switch(b){case!0:a(window).bind("resize",a.alerts._reposition);break;case!1:a(window).unbind("resize",a.alerts._reposition)}}},jAlert=function(b,c,d){a.alerts.alert(b,c,d)},jConfirm=function(b,c,d){a.alerts.confirm(b,c,d)},jPrompt=function(b,c,d,e){a.alerts.prompt(b,c,d,e)}}(jQuery),function(a){function c(a){return typeof a=="object"?a:{top:a,left:a}}var b=a.scrollTo=function(b,c,d){a(window).scrollTo(b,c,d)};b.defaults={axis:"xy",duration:parseFloat(a.fn.jquery)>=1.3?0:1},b.window=function(b){return a(window)._scrollable()},a.fn._scrollable=function(){return this.map(function(){var b=this,c=!b.nodeName||a.inArray(b.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!c)return b;var d=(b.contentWindow||b).document||b.ownerDocument||b;return a.browser.safari||d.compatMode=="BackCompat"?d.body:d.documentElement})},a.fn.scrollTo=function(d,e,f){typeof e=="object"&&(f=e,e=0),typeof f=="function"&&(f={onAfter:f}),d=="max"&&(d=9e9),f=a.extend({},b.defaults,f),e=e||f.speed||f.duration,f.queue=f.queue&&f.axis.length>1,f.queue&&(e/=2),f.offset=c(f.offset),f.over=c(f.over);return this._scrollable().each(function(){function m(a){h.animate(k,e,f.easing,a&&function(){a.call(this,d,f)})}var g=this,h=a(g),i=d,j,k={},l=h.is("html,body");switch(typeof i){case"number":case"string":if(/^([+-]=)?\d+(\.\d+)?(px|%)?$/.test(i)){i=c(i);break}i=a(i,this);case"object":if(i.is||i.style)j=(i=a(i)).offset()}a.each(f.axis.split(""),function(a,c){var d=c=="x"?"Left":"Top",e=d.toLowerCase(),n="scroll"+d,o=g[n],p=b.max(g,c);if(j)k[n]=j[e]+(l?0:o-h.offset()[e]),f.margin&&(k[n]-=parseInt(i.css("margin"+d))||0,k[n]-=parseInt(i.css("border"+d+"Width"))||0),k[n]+=f.offset[e]||0,f.over[e]&&(k[n]+=i[c=="x"?"width":"height"]()*f.over[e]);else{var q=i[e];k[n]=q.slice&&q.slice(-1)=="%"?parseFloat(q)/100*p:q}/^\d+$/.test(k[n])&&(k[n]=k[n]<=0?0:Math.min(k[n],p)),!a&&f.queue&&(o!=k[n]&&m(f.onAfterFirst),delete k[n])}),m(f.onAfter)}).end()},b.max=function(b,c){var d=c=="x"?"Width":"Height",e="scroll"+d;if(!a(b).is("html,body"))return b[e]-a(b)[d.toLowerCase()]();var f="client"+d,g=b.ownerDocument.documentElement,h=b.ownerDocument.body;return Math.max(g[e],h[e])-Math.min(g[f],h[f])}}(jQuery),function(a,b,c){a.fn.jScrollPane=function(b){function d(b,d){function bC(){var a=bo(),c=bn();b.removeClass("jspScrollable").unbind(".jsp"),b.replaceWith(R.append(g.children())),R.scrollTop(a),R.scrollLeft(c)}function bB(){var a,b,c,d,e,g=!1;j.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(f){var h=f.originalEvent.touches[0];a=bn(),b=bo(),c=h.pageX,d=h.pageY,e=!1,g=!0}).bind("touchmove.jsp",function(h){if(!!g){var i=h.originalEvent.touches[0],j=v,k=s;f.scrollTo(a+c-i.pageX,b+d-i.pageY),e=e||Math.abs(c-i.pageX)>5||Math.abs(d-i.pageY)>5;return j==v&&k==s}}).bind("touchend.jsp",function(a){g=!1}).bind("click.jsp-touchclick",function(a){if(e){e=!1;return!1}})}function bA(){bz(),a("a[href^=#]").addClass("jspHijack").bind("click.jsp-hijack",function(){var a=this.href.split("#"),b;if(a.length>1){b=a[1];if(b.length>0&&g.find("#"+b).length>0){bm("#"+b,!0);return!1}}})}function bz(){a("a.jspHijack").unbind("click.jsp-hijack").removeClass("jspHijack")}function by(){if(location.hash&&location.hash.length>1){var b,c;try{b=a(location.hash)}catch(d){return}b.length&&g.find(location.hash)&&(j.scrollTop()===0?c=setInterval(function(){j.scrollTop()>0&&(bm(location.hash,!0),a(document).scrollTop(j.position().top),clearInterval(c))},50):(bm(location.hash,!0),a(document).scrollTop(j.position().top)))}}function bx(){b.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function bw(){function k(){var a=v,b=s;switch(c){case 40:f.scrollByY(e.keyboardSpeed,!1);break;case 38:f.scrollByY(-e.keyboardSpeed,!1);break;case 34:case 32:f.scrollByY(i*e.scrollPagePercent,!1);break;case 33:f.scrollByY(-i*e.scrollPagePercent,!1);break;case 39:f.scrollByX(e.keyboardSpeed,!1);break;case 37:f.scrollByX(-e.keyboardSpeed,!1)}d=a!=v||b!=s;return d}var c,d,h=[];p&&h.push(D[0]),o&&h.push(w[0]),g.focus(function(){b.focus()}),b.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(b){if(b.target===this||!!h.length&&!!a(b.target).closest(h).length){var e=v,f=s;switch(b.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:c=b.keyCode,k();break;case 35:bk(l-i),c=null;break;case 36:bk(0),c=null}d=b.keyCode==c&&e!=v||f!=s;return!d}}).bind("keypress.jsp",function(a){a.keyCode==c&&k();return!d}),e.hideFocus?(b.css("outline","none"),"hideFocus"in j[0]&&b.attr("hideFocus",!0)):(b.css("outline",""),"hideFocus"in j[0]&&b.attr("hideFocus",!1))}function bv(){g.find(":input,a").unbind("focus.jsp")}function bu(){g.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(a){bm(a.target,!1)})}function bt(){return!1}function bs(){j.unbind(S)}function br(){j.unbind(S).bind(S,function(a,b,c,d){var g=v,h=s;f.scrollBy(c*e.mouseWheelSpeed,-d*e.mouseWheelSpeed,!1);return g==v&&h==s})}function bq(){var a=k-h;return a>20&&a-bn()<10}function bp(){var a=l-i;return a>20&&a-bo()<10}function bo(){return-g.position().top}function bn(){return-g.position().left}function bm(b,c,d){var f,g,k,l=0,m=0,n,o,p,q,r,s;try{f=a(b)}catch(t){return}g=f.outerHeight(),k=f.outerWidth(),j.scrollTop(0),j.scrollLeft(0);while(!f.is(".jspPane")){l+=f.position().top,m+=f.position().left,f=f.offsetParent();if(/^body|html$/i.test(f[0].nodeName))return}n=bo(),p=n+i,l<n||c?r=l-e.verticalGutter:l+g>p&&(r=l-i+g+e.verticalGutter),r&&bk(r,d),o=bn(),q=o+h,m<o||c?s=m-e.horizontalGutter:m+k>q&&(s=m-h+k+e.horizontalGutter),s&&bl(s,d)}function bl(a,b){var c=a/(k-h);bg(c*u,b)}function bk(a,b){var c=a/(l-i);be(c*r,b)}function bj(a,b){e.showArrows&&(H[a?"addClass":"removeClass"]("jspDisabled"),I[b?"addClass":"removeClass"]("jspDisabled"))}function bi(a,b){e.showArrows&&(B[a?"addClass":"removeClass"]("jspDisabled"),C[b?"addClass":"removeClass"]("jspDisabled"))}function bh(a){a===c&&(a=t.position().left),j.scrollTop(0),v=a;var d=v===0,e=v==u,f=a/u,i=-f*(k-h);if(O!=d||Q!=e)O=d,Q=e,b.trigger("jsp-arrow-change",[N,P,O,Q]);bj(d,e),g.css("left",i),b.trigger("jsp-scroll-x",[-i,d,e]).trigger("scroll")}function bg(a,b){!p||(a<0?a=0:a>u&&(a=u),b===c&&(b=e.animateScroll),b?f.animate(t,"left",a,bh):(t.css("left",a),bh(a)))}function bf(a){a===c&&(a=q.position().top),j.scrollTop(0),s=a;var d=s===0,e=s==r,f=a/r,h=-f*(l-i);if(N!=d||P!=e)N=d,P=e,b.trigger("jsp-arrow-change",[N,P,O,Q]);bi(d,e),g.css("top",h),b.trigger("jsp-scroll-y",[-h,d,e]).trigger("scroll")}function be(a,b){!o||(a<0?a=0:a>r&&(a=r),b===c&&(b=e.animateScroll),b?f.animate(q,"top",a,bf):(q.css("top",a),bf(a)))}function bd(){a("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),q&&q.removeClass("jspActive"),t&&t.removeClass("jspActive")}function bc(){E&&E.unbind("mousedown.jsp"),x&&x.unbind("mousedown.jsp")}function bb(){bc(),o&&x.bind("mousedown.jsp",function(b){if(b.originalTarget===c||b.originalTarget==b.currentTarget){var d=a(this),g=d.offset(),h=b.pageY-g.top-s,j,k=!0,m=function(){var a=d.offset(),c=b.pageY-a.top-A/2,g=i*e.scrollPagePercent,o=r*g/(l-i);if(h<0)s-o>c?f.scrollByY(-g):be(c);else if(h>0)s+o<c?f.scrollByY(g):be(c);else{n();return}j=setTimeout(m,k?e.initialDelay:e.trackClickRepeatFreq),k=!1},n=function(){j&&clearTimeout(j),j=null,a(document).unbind("mouseup.jsp",n)};m(),a(document).bind("mouseup.jsp",n);return!1}}),p&&E.bind("mousedown.jsp",function(b){if(b.originalTarget===c||b.originalTarget==b.currentTarget){var d=a(this),g=d.offset(),i=b.pageX-g.left-v,j,l=!0,m=function(){var a=d.offset(),c=b.pageX-a.left-G/2,g=h*e.scrollPagePercent,o=u*g/(k-h);if(i<0)v-o>c?f.scrollByX(-g):bg(c);else if(i>0)v+o<c?f.scrollByX(g):bg(c);else{n();return}j=setTimeout(m,l?e.initialDelay:e.trackClickRepeatFreq),l=!1},n=function(){j&&clearTimeout(j),j=null,a(document).unbind("mouseup.jsp",n)};m(),a(document).bind("mouseup.jsp",n);return!1}})}function ba(b,c,d,g){d=a(d).addClass("jspActive");var h,i,j=!0,k=function(){b!==0&&f.scrollByX(b*e.arrowButtonSpeed),c!==0&&f.scrollByY(c*e.arrowButtonSpeed),i=setTimeout(k,j?e.initialDelay:e.arrowRepeatFreq),j=!1};k(),h=g?"mouseout.jsp":"mouseup.jsp",g=g||a("html"),g.bind(h,function(){d.removeClass("jspActive"),i&&clearTimeout(i),i=null,g.unbind(h)})}function _(a,b,c){return function(){ba(a,b,this,c),this.blur();return!1}}function Z(a,b,c,d){var e="before",f="after",g;b=="os"&&(b=/Mac/.test(navigator.platform)?"after":"split"),b==e?f=b:b==f&&(e=b,g=c,c=d,d=g),a[e](c)[f](d)}function Y(){if(p&&o){var b=E.outerHeight(),c=x.outerWidth();z-=b,a(D).find(">.jspCap:visible,>.jspArrow").each(function(){F+=a(this).outerWidth()}),F-=c,i-=c,h-=b,E.parent().append(a('<div class="jspCorner" />').css("width",b+"px")),V(),X()}p&&g.width(j.outerWidth()-L+"px"),l=g.outerHeight(),n=l/i,p&&(G=Math.ceil(1/m*F),G>e.horizontalDragMaxWidth?G=e.horizontalDragMaxWidth:G<e.horizontalDragMinWidth&&(G=e.horizontalDragMinWidth),t.width(G+"px"),u=F-G,bh(v)),o&&(A=Math.ceil(1/n*z),A>e.verticalDragMaxHeight?A=e.verticalDragMaxHeight:A<e.verticalDragMinHeight&&(A=e.verticalDragMinHeight),q.height(A+"px"),r=z-A,bf(s))}function X(){j.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){F-=a(this).outerWidth()}),E.width(F+"px"),v=0}function W(){p&&(j.append(a('<div class="jspHorizontalBar" />').append(a('<div class="jspCap jspCapLeft" />'),a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragLeft" />'),a('<div class="jspDragRight" />'))),a('<div class="jspCap jspCapRight" />'))),D=j.find(">.jspHorizontalBar"),E=D.find(">.jspTrack"),t=E.find(">.jspDrag"),e.showArrows&&(H=a('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",_(-1,0)).bind("click.jsp",bt),I=a('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",_(1,0)).bind("click.jsp",bt),e.arrowScrollOnHover&&(H.bind("mouseover.jsp",_(-1,0,H)),I.bind("mouseover.jsp",_(1,0,I))),Z(E,e.horizontalArrowPositions,H,I)),t.hover(function(){t.addClass("jspHover")},function(){t.removeClass("jspHover")}).bind("mousedown.jsp",function(b){a("html").bind("dragstart.jsp selectstart.jsp",bt),t.addClass("jspActive");var c=b.pageX-t.position().left;a("html").bind("mousemove.jsp",function(a){bg(a.pageX-c,!1)}).bind("mouseup.jsp mouseleave.jsp",bd);return!1}),F=j.innerWidth(),X())}function V(){x.height(z+"px"),s=0,y=e.verticalGutter+x.outerWidth(),g.width(h-y-L);try{w.position().left===0&&g.css("margin-left",y+"px")}catch(a){}}function U(){o&&(j.append(a('<div class="jspVerticalBar" />').append(a('<div class="jspCap jspCapTop" />'),a('<div class="jspTrack" />').append(a('<div class="jspDrag" />').append(a('<div class="jspDragTop" />'),a('<div class="jspDragBottom" />'))),a('<div class="jspCap jspCapBottom" />'))),w=j.find(">.jspVerticalBar"),x=w.find(">.jspTrack"),q=x.find(">.jspDrag"),e.showArrows&&(B=a('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",_(0,-1)).bind("click.jsp",bt),C=a('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",_(0,1)).bind("click.jsp",bt),e.arrowScrollOnHover&&(B.bind("mouseover.jsp",_(0,-1,B)),C.bind("mouseover.jsp",_(0,1,C))),Z(x,e.verticalArrowPositions,B,C)),z=i,j.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){z-=a(this).outerHeight()}),q.hover(function(){q.addClass("jspHover")},function(){q.removeClass("jspHover")}).bind("mousedown.jsp",function(b){a("html").bind("dragstart.jsp selectstart.jsp",bt),q.addClass("jspActive");var c=b.pageY-q.position().top;a("html").bind("mousemove.jsp",function(a){be(a.pageY-c,!1)}).bind("mouseup.jsp mouseleave.jsp",bd);return!1}),V())}function T(d){var f,q,r,t,u,w,x,y,z=!1,A=!1;e=d;if(g===c)x=b.scrollTop(),y=b.scrollLeft(),b.css({overflow:"hidden",padding:0}),h=b.innerWidth()+L,i=b.innerHeight(),b.width(h),g=a('<div class="jspPane" />').css("padding",K).append(b.children()),j=a('<div class="jspContainer" />').css({width:h+"px",height:i+"px"}).append(g).appendTo(b);else{b.css("width",""),z=e.stickToBottom&&bp(),A=e.stickToRight&&bq(),w=b.innerWidth()+L!=h||b.outerHeight()!=i,w&&(h=b.innerWidth()+L,i=b.innerHeight(),j.css({width:h+"px",height:i+"px"}));if(!w&&M==k&&g.outerHeight()==l){b.width(h);return}M=k,g.css("width",""),b.width(h),j.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}d.contentWidth?k=d.contentWidth:(f=g.clone(!1,!1).css("position","absolute"),q=a('<div style="width:1px; position: relative;" />').append(f),a("body").append(q),k=Math.max(g.outerWidth(),f.outerWidth()),q.remove()),l=g.outerHeight(),m=k/h,n=l/i,o=n>1,p=m>1,!p&&!o?(b.removeClass("jspScrollable"),g.css({top:0,width:j.width()-L}),bs(),bv(),bx(),bc(),bz()):(b.addClass("jspScrollable"),r=e.maintainPosition&&(s||v),r&&(t=bn(),u=bo()),U(),W(),Y(),r&&(bl(A?k-h:t,!1),bk(z?l-i:u,!1)),bu(),br(),bB(),e.enableKeyboardNavigation&&bw(),e.clickOnTrack&&bb(),by(),e.hijackInternalLinks&&bA()),e.autoReinitialise&&!J?J=setInterval(function(){T(e)},e.autoReinitialiseDelay):!e.autoReinitialise&&J&&clearInterval(J),x&&b.scrollTop(0)&&bk(x,!1),y&&b.scrollLeft(0)&&bl(y,!1),b.trigger("jsp-initialised",[p||o])}var e,f=this,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N=!0,O=!0,P=!1,Q=!1,R=b.clone(!1,!1).empty(),S=a.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";K=b.css("paddingTop")+" "+b.css("paddingRight")+" "+b.css("paddingBottom")+" "+b.css("paddingLeft"),L=(parseInt(b.css("paddingLeft"),10)||0)+(parseInt(b.css("paddingRight"),10)||0),a.extend(f,{reinitialise:function(b){b=a.extend({},e,b),T(b)},scrollToElement:function(a,b,c){bm(a,b,c)},scrollTo:function(a,b,c){bl(a,c),bk(b,c)},scrollToX:function(a,b){bl(a,b)},scrollToY:function(a,b){bk(a,b)},scrollToPercentX:function(a,b){bl(a*(k-h),b)},scrollToPercentY:function(a,b){bk(a*(l-i),b)},scrollBy:function(a,b,c){f.scrollByX(a,c),f.scrollByY(b,c)},scrollByX:function(a,b){var c=bn()+a,d=c/(k-h);bg(d*u,b)},scrollByY:function(a,b){var c=bo()+a,d=c/(l-i);be(d*r,b)},positionDragX:function(a,b){bg(a,b)},positionDragY:function(a,b){bg(a,b)},animate:function(a,b,c,d){var f={};f[b]=c,a.animate(f,{duration:e.animateDuration,ease:e.animateEase,queue:!1,step:d})},getContentPositionX:function(){return bn()},getContentPositionY:function(){return bo()},getContentWidth:function(){return k()},getContentHeight:function(){return l()},getPercentScrolledX:function(){return bn()/(k-h)},getPercentScrolledY:function(){return bo()/(l-i)},getIsScrollableH:function(){return p},getIsScrollableV:function(){return o},getContentPane:function(){return g},scrollToBottom:function(a){be(r,a)},hijackInternalLinks:function(){bA()},destroy:function(){bC()}}),T(d)}b=a.extend({},a.fn.jScrollPane.defaults,b),a.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){b[this]=b[this]||b.speed});var e;this.each(function(){var c=a(this),f=c.data("jsp");f?f.reinitialise(b):(f=new d(c,b),c.data("jsp",f)),e=e?e.add(c):c});return e},a.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:c,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}(jQuery,this),function(a,b,c){function l(){f=b[g](function(){d.each(function(){var b=a(this),c=b.width(),d=b.height(),e=a.data(this,i);(c!==e.w||d!==e.h)&&b.trigger(h,[e.w=c,e.h=d])}),l()},e[j])}"$:nomunge";var d=a([]),e=a.resize=a.extend(a.resize,{}),f,g="setTimeout",h="resize",i=h+"-special-event",j="delay",k="throttleWindow";e[j]=250,e[k]=!0,a.event.special[h]={setup:function(){if(!e[k]&&this[g])return!1;var b=a(this);d=d.add(b),a.data(this,i,{w:b.width(),h:b.height()}),d.length===1&&l()},teardown:function(){if(!e[k]&&this[g])return!1;var b=a(this);d=d.not(b),b.removeData(i),d.length||clearTimeout(f)},add:function(b){function f(b,e,f){var g=a(this),h=a.data(this,i);h.w=e!==c?e:g.width(),h.h=f!==c?f:g.height(),d.apply(this,arguments)}if(!e[k]&&this[g])return!1;var d;if(a.isFunction(b)){d=b;return f}d=b.handler,b.handler=f}}}(jQuery,this),function(window,document){function preprocessCode(a,b){var c=(new RegExp(/\/\*\s*@pjs\s+((?:[^\*]|\*+[^\*\/])*)\*\//g)).exec(a);if(c&&c.length===2){var d=[],e=c.splice(1,2)[0].replace(/\{([\s\S]*?)\}/g,function(){return function(a,b){d.push(b);return"{"+(d.length-1)+"}"}}()).replace("\n","").replace("\r","").split(";"),f=function(a){return a.replace(/^\s*["']?/,"").replace(/["']?\s*$/,"")};for(var g=0,h=e.length;g<h;g++){var i=e[g].split("=");if(i&&i.length===2){var j=f(i[0]),k=f(i[1]),l=[];if(j==="preload"){l=k.split(",");for(var m=0,n=l.length;m<n;m++){var o=f(l[m]);b.imageCache.add(o)}}else if(j==="transparent")b.options.isTransparent=k==="true";else if(j==="font"){l=k.split(",");for(var p=0,q=l.length;p<q;p++){var r=f(l[p]),s=/^\{(\d*?)\}$/.exec(r);b.fonts.add(s?JSON.parse("{"+d[s[1]]+"}"):r)}}else j==="crisp"?b.options.crispLines=k==="true":j==="pauseOnBlur"?b.options.pauseOnBlur=k==="true":b.options[j]=k}}}var t=a.replace(/("(?:[^"\\\n]|\\.)*")|('(?:[^'\\\n]|\\.)*')|(([\[\(=|&!\^:?]\s*)(\/(?![*\/])(?:[^\/\\\n]|\\.)*\/[gim]*)\b)|(\/\/[^\n]*\n)|(\/\*(?:(?!\*\/)(?:.|\n))*\*\/)/g,"");t.match(/\bsize\((?:.+),(?:.+),\s*(OPENGL|P3D)\s*\);/)&&(b.use3DContext=!0);return a}function parseProcessing(a){function by(a){function h(a,c){var d=c.split("."),e=a.scope,f;while(e){if(e.hasOwnProperty(d[0])){f=e[d[0]];break}e=e.scope}f===undef&&(f=b[d[0]]);for(var g=1,h=d.length;g<h&&f;++g)f=f.inScope[d[g]];return f}var b={},c,d;for(c in o)if(o.hasOwnProperty(c)){d=o[c];var e=d.scopeId,f=d.name;if(e){var g=o[e];d.scope=g,g.inScope===undef&&(g.inScope={}),g.inScope[f]=d}else b[f]=d}for(c in o)if(o.hasOwnProperty(c)){d=o[c];var i=d.body.baseClassName;i&&(d.base=h(d,i))}}function bx(a){this.statements=a}function bw(a){this.statements=a}function bv(a){var b=[];for(var c=0,d=a.length;c<d;++c){var e=a[c];e instanceof X?b=b.concat(e.getNames()):e instanceof br&&e.argument.initStatement instanceof X?b=b.concat(e.argument.initStatement.getNames()):(e instanceof bb||e instanceof bc||e instanceof bl||e instanceof bm||e instanceof bo||e instanceof N)&&b.push(e.name)}return g({},b)}function bu(a){this.label=a}function bt(a,b,c){this.name=a,this.argument=b,this.misc=c}function bs(a,b){this.argument=a,this.misc=b}function br(a,b){this.argument=a,this.misc=b}function bq(a){var b=a;b=b.replace(/\b(catch\s*"B\d+"\s*"A\d+")(\s*catch\s*"B\d+"\s*"A\d+")+/g,"$1");return b}function bp(a){var b=A.exec(a),c=A.lastIndex=0;return new bo(b[3],J(m[i(b[4])]),v(m[i(b[6])]))}function bo(a,b,c){this.name=a,this.params=b,this.body=c}function bn(a){var b=z.exec(a);z.lastIndex=0;var c=m[i(b[6])];if(b[2]==="interface")return new bl(b[3]);var d=p,e=s();p=e;var f=new bm(b[3],u(c,b[3],b[4],b[5]));t(f,e,d),p=d;return f}function bm(a,b){this.name=a,this.body=b,b.owner=this}function bl(a){this.name=a}function bk(a,b,c,d,e,f,g,h){var i,j;this.name=a,this.baseClassName=b,this.functions=c,this.methods=d,this.fields=e,this.cstrs=f,this.innerClasses=g,this.misc=h;for(i=0,j=e.length;i<j;++i)e[i].owner=this}function bj(a){var b=(new RegExp(/"B(\d+)"\s*"A(\d+)"/)).exec(a),c=J(m[b[1]]);return new bi(c,v(m[b[2]]))}function bi(a,b){this.params=a,this.body=b}function bh(a){var b=D.exec(a),c=b[1].indexOf("static")>=0,d=a.substring(b[0].length).split(/,\s*/g),e=W(b[2]);for(var f=0;f<d.length;++f)d[f]=V(d[f],e);return new bg(d,b[2],c)}function bg(a,b,c){this.definitions=a,this.fieldType=b,this.isStatic=c}function bf(a){var b=A.exec(a);A.lastIndex=0;var c=b[6]!==";"?m[i(b[6])]:"{}";return new be(b[3],J(m[i(b[4])]),v(c))}function be(a,b,c){this.name=a,this.params=b,this.body=c}function bd(a){var b=z.exec(a);z.lastIndex=0;var c=m[i(b[6])];if(b[2]==="interface")return new bb(b[3]);var d=p,e=s();p=e;var f=new bc(b[3],u(c,b[3],b[4],b[5]));t(f,e,d),p=d;return f}function bc(a,b){this.name=a,this.body=b,b.owner=this}function bb(a){this.name=a}function ba(a){var b;if(/\bin\b/.test(a)){b=a.substring(1,a.length-1).split(/\bin\b/g);return new _(Z(f(b[0])),y(b[1]))}b=a.substring(1,a.length-1).split(";");return new $(Z(f(b[0])),y(b[1]),y(b[2]))}function _(a,b){this.initStatement=a,this.container=b}function $(a,b,c){this.initStatement=a,this.condition=b,this.step=c}function Z(a){if(B.test(a)){var b=D.exec(a),c=a.substring(b[0].length).split(","),d=W(b[2]);for(var e=0;e<c.length;++e)c[e]=V(c[e],d);return new X(c,b[2])}return new Y(y(a))}function Y(a){this.expression=a}function X(a,b){this.definitions=a,this.varType=b}function W(a){return a==="int"||a==="float"?"0":a==="boolean"?"false":a==="color"?"0x00000000":"null"}function V(a,b){var c=a.indexOf("="),d,e,g;c<0?(d=a,e=b,g=!0):(d=a.substring(0,c),e=y(a.substring(c+1)),g=!1);return new U(f(d.replace(/(\s*"C\d+")+/g,"")),e,g)}function U(a,b,c){this.name=a,this.value=b,this.isDefault=c}function T(a,b){this.expr=a,this.transforms=b}function S(a){return a.replace(/(\.\s*)?(\b[A-Za-z_$][\w$]*\b)(\s*\.\s*(\b[A-Za-z_$][\w$]*\b)(\s*\()?)?/g,function(a,b,c,d,e,f){if(b)return a;var g={name:c,member:e,callSign:!!f};return n(g)+(d===undef?"":d)})}function R(a){if(a.charAt(0)==="("||a.charAt(0)==="[")return a.charAt(0)+R(a.substring(1,a.length-1))+a.charAt(a.length-1);if(a.charAt(0)==="{")return/^\{\s*(?:[A-Za-z_$][\w$]*|'\d+')\s*:/.test(a)?"{"+r(a.substring(1,a.length-1),"I")+"}":"["+R(a.substring(1,a.length-1))+"]";var b=e(a),c=K(b.middle);c=c.replace(/"[ABC](\d+)"/g,function(a,b){return R(m[b])});return b.untrim(c)}function Q(a){var b=a.split(",");for(var c=0;c<b.length;++c){var d=b[c].indexOf(":");d<0?b[c]={value:y(b[c])}:b[c]={label:f(b[c].substring(0,d)),value:y(f(b[c].substring(d+1)))}}return new P(b)}function P(a){this.members=a}function O(a){var b=(new RegExp(/\b([A-Za-z_$][\w$]*)\s*"B(\d+)"\s*"A(\d+)"/)).exec(a);return new N(b[1]!=="function"?b[1]:null,J(m[b[2]]),v(m[b[3]]))}function N(a,b,c){this.name=a,this.params=b,this.body=c}function M(a){var b=(new RegExp(/\bnew\s*(Runnable)\s*"B\d+"\s*"A(\d+)"/)).exec(a);if(b===null)return"null";var c=p,d=s();p=d;var e=new L("Runnable",u(m[b[2]],b[1]));t(e,d,c),p=c;return e}function L(a,b){this.baseInterfaceName=a,this.body=b,b.owner=this}function K(a){var b=a;b=b.replace(/\bnew\s+([A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)(?:\s*"C\d+")+\s*("A\d+")/g,function(a,b,c){return c}),b=b.replace(/\bnew\s+([A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)(?:\s*"B\d+")\s*("A\d+")/g,function(a,b,c){return r(a,"F")}),b=b.replace(E,function(a){return r(a,"H")}),b=b.replace(/\bnew\s+([A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)\s*("C\d+"(?:\s*"C\d+")*)/g,function(a,b,c){var d=c.replace(/"C(\d+)"/g,function(a,b){return m[b]}).replace(/\[\s*\]/g,"[null]").replace(/\s*\]\s*\[\s*/g,", "),e="{"+d.substring(1,d.length-1)+"}",f="('"+b+"', "+r(e,"A")+")";return"$p.createJavaArray"+r(f,"B")}),b=b.replace(/(\.\s*length)\s*"B\d+"/g,"$1"),b=b.replace(/#([0-9A-Fa-f]{6})\b/g,function(a,b){return"0xFF"+b}),b=b.replace(/"B(\d+)"(\s*(?:[\w$']|"B))/g,function(a,b,c){var d=m[b];if(!/^\(\s*[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*\s*(?:"C\d+"\s*)*\)$/.test(d))return a;if(/^\(\s*int\s*\)$/.test(d))return"(int)"+c;var e=d.split(/"C(\d+)"/g);if(e.length>1&&!/^\[\s*\]$/.test(m[e[1]]))return a;return""+c}),b=b.replace(/\(int\)([^,\]\)\}\?\:\*\+\-\/\^\|\%\&\~]+)/g,function(a,b){var c=e(b);return c.untrim("__int_cast("+c.middle+")")}),b=b.replace(/\bsuper(\s*"B\d+")/g,"$$superCstr$1").replace(/\bsuper(\s*\.)/g,"$$super$1"),b=b.replace(/\b0+((\d*)(?:\.[\d*])?(?:[eE][\-\+]?\d+)?[fF]?)\b/,function(a,b,c){if(b===c)return a;return c===""?"0"+b:b}),b=b.replace(/\b(\.?\d+\.?)[fF]\b/g,"$1"),b=b.replace(/([^\s])%([^=\s])/g,"$1 % $2"),b=b.replace(/\b(frameRate|keyPressed|mousePressed)\b(?!\s*"B)/g,"__$1"),b=b.replace(/\bpixels\s*(("C(\d+)")|\.length)?(\s*=(?!=)([^,\]\)\}\?\:]+))?/g,function(a,b,c,d,e,f){if(c){var g=m[d];return e?"pixels.setPixel"+r("("+g.substring(1,g.length-1)+","+f+")","B"):"pixels.getPixel"+r("("+g.substring(1,g.length-1)+")","B")}return b?"pixels.getLength"+r("()","B"):e?"pixels.set"+r("("+f+")","B"):"pixels.toArray"+r("()","B")}),b=b.replace(/\bthis(\s*"B\d+")/g,"$$constr$1");return b}function J(a){var b=f(a.substring(1,a.length-1)),c=[];if(b!==""){var d=b.split(",");for(var e=0;e<d.length;++e){var g=/\b([A-Za-z_$][\w$]*\b)\s*("[ABC][\d]*")?$/.exec(d[e]);c.push(new H(g[1]))}}return new I(c)}function I(a){this.params=a}function H(a){this.name=a}function G(a,b){var c=a.replace(C,function(a,c,d,e,f,g){return d!==b?a:r(a,"G")});return c}function F(a){var b=a;b=b.replace(z,function(a){return r(a,"E")}),b=b.replace(A,function(a){return r(a,"D")}),b=b.replace(E,function(a){return r(a,"H")});return b}function t(a,b,c){a.classId=b,a.scopeId=c,o[b]=a}function s(){return"class"+ ++q}function r(a,b){var c=m.length;m.push(a);return'"'+b+c+'"'}function i(a){return a.substring(2,a.length-1)}function h(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function g(a,b){for(var c=0,d=b.length;c<d;++c)a[b[c]]=null;return a}function f(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")}function e(a){var b=/^\s*/.exec(a),c;if(b[0].length===a.length)c={left:b[0],middle:"",right:""};else{var d=/\s*$/.exec(a);c={left:b[0],middle:a.substring(b[0].length,d.index),right:d[0]}}c.untrim=function(a){return this.left+a+this.right};return c}function d(a,b){return a.replace(/'(\d+)'/g,function(a,c){var d=b[c];return d.charAt(0)==="/"?d:/^'((?:[^'\\\n])|(?:\\.[0-9A-Fa-f]*))'$/.test(d)?"(new $p.Character("+d+"))":d})}function c(a){var b=[],c=a.split(/([\{\[\(\)\]\}])/),d=c[0],e=[];for(var f=1;f<c.length;f+=2){var g=c[f];if(g==="["||g==="{"||g==="(")e.push(d),d=g;else if(g==="]"||g==="}"||g===")"){var h=g==="}"?"A":g===")"?"B":"C",i=b.length;b.push(d+g),d=e.pop()+'"'+h+(i+1)+'"'}d+=c[f+1]}b.unshift(d);return b}var b=getGlobalMembers(),j=a.replace(/\r\n?|\n\r/g,"\n"),k=[],l=j.replace(/("(?:[^"\\\n]|\\.)*")|('(?:[^'\\\n]|\\.)*')|(([\[\(=|&!\^:?]\s*)(\/(?![*\/])(?:[^\/\\\n]|\\.)*\/[gim]*)\b)|(\/\/[^\n]*\n)|(\/\*(?:(?!\*\/)(?:.|\n))*\*\/)/g,function(a,b,c,d,e,f,g,h){var i;if(b||c){i=k.length,k.push(a);return"'"+i+"'"}if(d){i=k.length,k.push(f);return e+"'"+i+"'"}return h!==""?" ":"\n"}),m=c(l),n,o={},p,q=0,u,v,w,x,y,z=/\b((?:(?:public|private|final|protected|static|abstract)\s+)*)(class|interface)\s+([A-Za-z_$][\w$]*\b)(\s+extends\s+[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*\b)?(\s+implements\s+[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*,\s*[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*\b)*)?\s*("A\d+")/g,A=/\b((?:(?:public|private|final|protected|static|abstract|synchronized)\s+)*)((?!(?:else|new|return|throw|function|public|private|protected)\b)[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*"C\d+")*)\s*([A-Za-z_$][\w$]*\b)\s*("B\d+")(\s*throws\s+[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*,\s*[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)*)?\s*("A\d+"|;)/g,B=/^((?:(?:public|private|final|protected|static)\s+)*)((?!(?:else|new|return|throw)\b)[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*"C\d+")*)\s*([A-Za-z_$][\w$]*\b)\s*(?:"C\d+"\s*)*([=,]|$)/,C=/\b((?:(?:public|private|final|protected|static|abstract)\s+)*)((?!(?:new|return|throw)\b)[A-Za-z_$][\w$]*\b)\s*("B\d+")(\s*throws\s+[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*,\s*[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*)*)?\s*("A\d+")/g,D=/^((?:(?:public|private|final|protected|static)\s+)*)((?!(?:new|return|throw)\b)[A-Za-z_$][\w$]*\b(?:\s*\.\s*[A-Za-z_$][\w$]*\b)*(?:\s*"C\d+")*)\s*/,E=/\bfunction(?:\s+([A-Za-z_$][\w$]*))?\s*("B\d+")\s*("A\d+")/g;H.prototype.toString=function(){return this.name},I.prototype.getNames=function(){var a=[];for(var b=0,c=this.params.length;b<c;++b)a.push(this.params[b].name);return a},I.prototype.toString=function(){if(this.params.length===0)return"()";var a="(";for(var b=0,c=this.params.length;b<c;++b)a+=this.params[b]+", ";return a.substring(0,a.length-2)+")"},L.prototype.toString=function(){return"new (function() {\n"+this.body+"})"},N.prototype.toString=function(){var a=n,b=g({"this":null},this.params.getNames());n=function(c){return b.hasOwnProperty(c.name)?c.name:a(c)};var c="function";this.name&&(c+=" "+this.name),c+=this.params+" "+this.body,n=a;return c},P.prototype.toString=function(){var a=n;n=function(b){return b.name==="this"?"this":a(b)};var b="";for(var c=0,d=this.members.length;c<d;++c)this.members[c].label&&(b+=this.members[c].label+": "),b+=this.members[c].value.toString()+", ";n=a;return b.substring(0,b.length-2)},T.prototype.toString=function(){var a=this.transforms,b=S(this.expr);return b.replace(/"!(\d+)"/g,function(b,c){return a[c].toString()})},y=function(a){var b=[],c=R(a);c=c.replace(/"H(\d+)"/g,function(a,c){b.push(O(m[c]));return'"!'+(b.length-1)+'"'}),c=c.replace(/"F(\d+)"/g,function(a,c){b.push(M(m[c]));return'"!'+(b.length-1)+'"'}),c=c.replace(/"I(\d+)"/g,function(a,c){b.push(Q(m[c]));return'"!'+(b.length-1)+'"'});return new T(c,b)},U.prototype.toString=function(){return this.name+" = "+this.value},X.prototype.getNames=function(){var a=[];for(var b=0,c=this.definitions.length;b<c;++b)a.push(this.definitions[b].name);return a},X.prototype.toString=function(){return"var "+this.definitions.join(",")},Y.prototype.toString=function(){return this.expression.toString()},$.prototype.toString=function(){return"("+this.initStatement+"; "+this.condition+"; "+this.step+")"},_.prototype.toString=function(){var a=this.initStatement.toString();a.indexOf("=")>=0&&(a=a.substring(0,a.indexOf("=")));return"("+a+" in "+this.container+")"},bb.prototype.toString=function(){return"this."+this.name+" = function "+this.name+"() { "+"throw 'This is an interface'; };"},bc.prototype.toString=function(){return"this."+this.name+" = function "+this.name+"() {\n"+this.body+"};"},be.prototype.toString=function(){var a=n({name:"this"}),b=g({},this.params.getNames()),c=n;n=function(a){return b.hasOwnProperty(a.name)?a.name:c(a)};var d="$p.addMethod("+a+", '"+this.name+"', function "+this.params+" "+this.body+");";n=c;return d},bg.prototype.getNames=function(){var a=[];for(var b=0,c=this.definitions.length;b<c;++b)a.push(this.definitions[b].name);return a},bg.prototype.toString=function(){var a=n({name:"this"});if(this.isStatic){var b=this.owner.name,c=[];for(var d=0,e=this.definitions.length;d<e;++d){var f=this.definitions[d],g=f.name,h=b+"."+g,i="if("+h+" === void(0)) {\n"+" "+h+" = "+f.value+"; }\n"+"$p.defineProperty("+a+", "+"'"+g+"', { get: function(){return "+h+";}, "+"set: function(val){"+h+" = val;} });\n";c.push(i)}return c.join("")}return a+"."+this.definitions.join("; "+a+".")},bi.prototype.toString=function(){var a=g({},this.params.getNames()),b=n;n=function(c){return a.hasOwnProperty(c.name)?c.name:b(c)};var c="function $constr_"+this.params.params.length+this.params.toString(),d=this.body.toString();/\$(superCstr|constr)\b/.test(d)||(d="{\n$superCstr();\n"+d.substring(1)),n=b;return c+d+"\n"},bk.prototype.getMembers=function(){var a;this.owner.base?a=this.owner.base.body.getMembers():a={fields:[],methods:[],innerClasses:[]};var b,c,d,e;for(b=0,d=this.fields.length;b<d;++b)a.fields=a.fields.concat(this.fields[b].getNames());for(b=0,d=this.methods.length;b<d;++b){var f=this.methods[b];a.methods.push(f.name)}for(b=0,d=this.innerClasses.length;b<d;++b){var g=this.innerClasses[b];a.innerClasses.push(g.name)}return a},bk.prototype.toString=function(){function a(a){var b=0;while(a)++b,a=a.scope;return b}var b=a(this.owner),c="$this_"+b,d="var "+c+" = this;\n",e=this.getMembers(),f=g({},e.fields),h=g({},e.methods),i=g({},e.innerClasses),j=n;n=function(a){var b=a.name;if(b==="this")return a.callSign?c+".$self":c;if(f.hasOwnProperty(b)||i.hasOwnProperty(b))return c+"."+b;if(h.hasOwnProperty(b))return c+".$self."+b;return j(a)},this.baseClassName?(d+="var $super = { $upcast: "+c+" };\n",d+="function $superCstr(){"+this.baseClassName+".apply($super,arguments)}\n"):d+="function $superCstr(){$p.extendClassChain("+c+")}\n",d+=this.functions.join("\n")+"\n",d+=this.innerClasses.join("\n"),d+=this.fields.join(";\n")+";\n",d+=this.methods.join("\n")+"\n",d+=this.misc.tail,d+=this.cstrs.join("\n")+"\n",d+="function $constr() {\n";var k=[];for(var l=0,m=this.cstrs.length;l<m;++l){var o=this.cstrs[l].params.params.length;k.push("if(arguments.length === "+o+") { "+"$constr_"+o+".apply("+c+", arguments); }")}k.length>0&&(d+=k.join(" else ")+" else "),d+="$superCstr(); }\n",d+="$constr.apply(null, arguments);\n",n=j;return d},u=function(a,b,c,d){var f=a.substring(1,a.length-1);f=F(f),f=G(f,b);var g=[],h=[],i=[],j=[];f=f.replace(/"([DEGH])(\d+)"/g,function(a,b,c){b==="D"?g.push(c):b==="E"?h.push(c):b==="H"?j.push(c):i.push(c);return""});var k=f.split(/;(?:\s*;)*/g),l,n;c!==undef&&(l=c.replace(/^\s*extends\s+([A-Za-z_$][\w$]*)\s*$/g,"$1"));for(n=0;n<j.length;++n)j[n]=O(m[j[n]]);for(n=0;n<g.length;++n)g[n]=bf(m[g[n]]);for(n=0;n<k.length-1;++n){var o=e(k[n]);k[n]=bh(o.middle)}var p=k.pop();for(n=0;n<i.length;++n)i[n]=bj(m[i[n]]);for(n=0;n<h.length;++n)h[n]=bd(m[h[n]]);return new bk(b,l,j,g,k,i,h,{tail:p})},bl.prototype.toString=function(){return"function "+this.name+"() {  throw 'This is an interface'; }\n"+"$p."+this.name+" = "+this.name+";"},bm.prototype.toString=function(){var a="";for(var b=0,c=this.body.fields.length;b<c;b++)if(this.body.fields[b].isStatic)for(var d=0,e=this.body.fields[b].definitions.length;d<e;d++)a+="var "+this.body.fields[b].definitions[d].name+" = "+this.body.name+"."+this.body.fields[b].definitions[d]+";";return"function "+this.name+"() {\n"+this.body+"}\n"+a+"\n"+"$p."+this.name+" = "+this.name+";"},bo.prototype.toString=function(){var a=g({},this.params.getNames()),b=n;n=function(c){return a.hasOwnProperty(c.name)?c.name:b(c)};var c="function "+this.name+this.params+" "+this.body+"\n"+"$p."+this.name+" = "+this.name+";";n=b;return c},br.prototype.toString=function(){return this.misc.prefix+this.argument.toString()},bs.prototype.toString=function(){return this.misc.prefix+this.argument.toString()},bt.prototype.toString=function(){var a=this.misc.prefix;this.argument!==undef&&(a+=this.argument.toString());return a},bu.prototype.toString=function(){return this.label},w=function(a,b,c){var d=new RegExp(/\b(catch|for|if|switch|while|with)\s*"B(\d+)"|\b(do|else|finally|return|throw|try|break|continue)\b|("[ADEH](\d+)")|\b((?:case\s[^:]+|[A-Za-z_$][\w$]*\s*):)|(;)/g),g=[];a=bq(a);var h=0,i,j;while((i=d.exec(a))!==null){if(i[1]!==undef){var k=a.lastIndexOf('"B',d.lastIndex),l=a.substring(h,k);i[1]==="for"?g.push(new br(ba(m[i[2]]),{prefix:l})):i[1]==="catch"?g.push(new bs(J(m[i[2]]),{prefix:l})):g.push(new bt(i[1],y(m[i[2]]),{prefix:l}))}else if(i[3]!==undef)g.push(new bt(i[3],undef,{prefix:a.substring(h,d.lastIndex)}));else if(i[4]!==undef){j=a.substring(h,d.lastIndex-i[4].length);if(f(j).length!==0)continue;g.push(j);var n=i[4].charAt(1),o=i[5];n==="D"?g.push(b(m[o])):n==="E"?g.push(c(m[o])):n==="H"?g.push(O(m[o])):g.push(v(m[o]))}else if(i[6]!==undef){j=a.substring(h,d.lastIndex-i[6].length);if(f(j).length!==0)continue;g.push(new bu(a.substring(h,d.lastIndex)))}else{var p=e(a.substring(h,d.lastIndex-1));g.push(p.left),g.push(Z(p.middle)),g.push(p.right+";")}h=d.lastIndex}var q=e(a.substring(h));g.push(q.left),q.middle!==""&&(g.push(Z(q.middle)),g.push(";"+q.right));return g},bw.prototype.toString=function(){var a=bv(this.statements),b=n;h(a)||(n=function(c){return a.hasOwnProperty(c.name)?c.name:b(c)});var c="{\n"+this.statements.join("")+"\n}";n=b;return c},v=function(a){var b=e(a.substring(1,a.length-1));return new bw(w(b.middle))},bx.prototype.toString=function(){var a=bv(this.statements);n=function(c){var d=c.name;if(a.hasOwnProperty(d))return d;if(b.hasOwnProperty(d)||PConstants.hasOwnProperty(d)||defaultScope.hasOwnProperty(d))return"$p."+d;return d};var c="// this code was autogenerated from PJS\n(function($p) {\n"+this.statements.join("")+"\n})";n=null;return c},x=function(){var a=F(m[0]);a=a.replace(/\bimport\s+[^;]+;/g,"");return new bx(w(a,bp,bn))};var bz=x();by(bz);var bA=bz.toString();bA=bA.replace(/\s*\n(?:[\t ]*\n)+/g,"\n\n");return d(bA,k)}function getGlobalMembers(){var a=["abs","acos","alpha","ambient","ambientLight","append","applyMatrix","arc","arrayCopy","asin","atan","atan2","background","beginCamera","beginDraw","beginShape","bezier","bezierDetail","bezierPoint","bezierTangent","bezierVertex","binary","blend","blendColor","blit_resize","blue","boolean","box","breakShape","brightness","byte","camera","ceil","char","Character","clear","color","colorMode","concat","console","constrain","copy","cos","createFont","createGraphics","createImage","cursor","curve","curveDetail","curvePoint","curveTangent","curveTightness","curveVertex","day","defaultColor","degrees","directionalLight","disableContextMenu","dist","draw","ellipse","ellipseMode","emissive","enableContextMenu","endCamera","endDraw","endShape","exit","exp","expand","externals","fill","filter","filter_bilinear","filter_new_scanline","float","floor","focused","frameCount","frameRate","frustum","get","glyphLook","glyphTable","green","height","hex","hint","hour","hue","image","imageMode","Import","int","intersect","join","key","keyCode","keyPressed","keyReleased","keyTyped","lerp","lerpColor","lightFalloff","lights","lightSpecular","line","link","loadBytes","loadFont","loadGlyphs","loadImage","loadPixels","loadShape","loadStrings","log","loop","mag","map","match","matchAll","max","millis","min","minute","mix","modelX","modelY","modelZ","modes","month","mouseButton","mouseClicked","mouseDragged","mouseMoved","mousePressed","mouseReleased","mouseScroll","mouseScrolled","mouseX","mouseY","name","nf","nfc","nfp","nfs","noCursor","noFill","noise","noiseDetail","noiseSeed","noLights","noLoop","norm","normal","noSmooth","noStroke","noTint","ortho","peg","perspective","PFont","PImage","pixels","PMatrix2D","PMatrix3D","PMatrixStack","pmouseX","pmouseY","point","pointLight","popMatrix","popStyle","pow","print","printCamera","println","printMatrix","printProjection","PShape","PShapeSVG","pushMatrix","pushStyle","quad","radians","random","Random","randomSeed","rect","rectMode","red","redraw","requestImage","resetMatrix","reverse","rotate","rotateX","rotateY","rotateZ","round","saturation","save","saveFrame","saveStrings","scale","screenX","screenY","screenZ","second","set","setup","shape","shapeMode","shared","shininess","shorten","sin","size","smooth","sort","specular","sphere","sphereDetail","splice","split","splitTokens","spotLight","sq","sqrt","status","str","stroke","strokeCap","strokeJoin","strokeWeight","subset","tan","text","textAlign","textAscent","textDescent","textFont","textLeading","textMode","textSize","texture","textureMode","textWidth","tint","translate","triangle","trim","unbinary","unhex","updatePixels","use3DContext","vertex","width","XMLElement","year","__frameRate","__keyPressed","__mousePressed","__int_cast"],b={},c,d;for(c=0,d=a.length;c<d;++c)b[a[c]]=null;for(var e in Processing.lib)if(Processing.lib.hasOwnProperty(e)&&Processing.lib[e].exports){var f=Processing.lib[e].exports;for(c=0,d=f.length;c<d;++c)b[f[c]]=null}return b}function DefaultScope(){}function setupTypedArray(a,b){typeof this[a]!="function"&&typeof this[a]!="object"&&(typeof this[b]=="function"?this[a]=this[b]:this[a]=function(a){if(a instanceof Array)return a;if(typeof a=="number")return Array(a)})}function fixMatchByRegExp(){var a=/t/g;if("t".match(a)===null||!a.exec("t")){var b=String.prototype.match;String.prototype.match=function(a){var c=b.apply(this,arguments);a instanceof RegExp&&a.global&&(a.lastIndex=0);return c}}}function fixReplaceByRegExp(){var a=/t/g;if("t".replace(a,"")===null||!a.exec("t")){var b=String.prototype.replace;String.prototype.replace=function(a,c){var d=b.apply(this,arguments);a instanceof RegExp&&a.global&&(a.lastIndex=0);return d}}}var undef,ajax=function ajax(a){var b=new XMLHttpRequest;b.open("GET",a,!1),b.setRequestHeader("If-Modified-Since","Fri, 01 Jan 1960 00:00:00 GMT"),b.send(null);if(b.status!==200&&b.status!==0)throw"XMLHttpRequest failed, status code "+b.status;return b.responseText};fixReplaceByRegExp(),fixMatchByRegExp(),function(){try{"createImageData"in CanvasRenderingContext2D.prototype||(CanvasRenderingContext2D.prototype.createImageData=function(a,b){return new ImageData(a,b)})}catch(a){}}();var PConstants={X:0,Y:1,Z:2,R:3,G:4,B:5,A:6,U:7,V:8,NX:9,NY:10,NZ:11,EDGE:12,SR:13,SG:14,SB:15,SA:16,SW:17,TX:18,TY:19,TZ:20,VX:21,VY:22,VZ:23,VW:24,AR:25,AG:26,AB:27,DR:3,DG:4,DB:5,DA:6,SPR:28,SPG:29,SPB:30,SHINE:31,ER:32,EG:33,EB:34,BEEN_LIT:35,VERTEX_FIELD_COUNT:36,P2D:1,JAVA2D:1,WEBGL:2,P3D:2,OPENGL:2,PDF:0,DXF:0,OTHER:0,WINDOWS:1,MAXOSX:2,LINUX:3,EPSILON:1e-4,MAX_FLOAT:3.4028235e+38,MIN_FLOAT:-3.4028235e+38,MAX_INT:2147483647,MIN_INT:-2147483648,PI:Math.PI,TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,THIRD_PI:Math.PI/3,QUARTER_PI:Math.PI/4,DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,WHITESPACE:" \t\n\r\f ",RGB:1,ARGB:2,HSB:3,ALPHA:4,CMYK:5,TIFF:0,TARGA:1,JPEG:2,GIF:3,BLUR:11,GRAY:12,INVERT:13,OPAQUE:14,POSTERIZE:15,THRESHOLD:16,ERODE:17,DILATE:18,REPLACE:0,BLEND:1,ADD:2,SUBTRACT:4,LIGHTEST:8,DARKEST:16,DIFFERENCE:32,EXCLUSION:64,MULTIPLY:128,SCREEN:256,OVERLAY:512,HARD_LIGHT:1024,SOFT_LIGHT:2048,DODGE:4096,BURN:8192,ALPHA_MASK:4278190080,RED_MASK:16711680,GREEN_MASK:65280,BLUE_MASK:255,CUSTOM:0,ORTHOGRAPHIC:2,PERSPECTIVE:3,POINT:2,POINTS:2,LINE:4,LINES:4,TRIANGLE:8,TRIANGLES:9,TRIANGLE_STRIP:10,TRIANGLE_FAN:11,QUAD:16,QUADS:16,QUAD_STRIP:17,POLYGON:20,PATH:21,RECT:30,ELLIPSE:31,ARC:32,SPHERE:40,BOX:41,GROUP:0,PRIMITIVE:1,GEOMETRY:3,VERTEX:0,BEZIER_VERTEX:1,CURVE_VERTEX:2,BREAK:3,CLOSESHAPE:4,OPEN:1,CLOSE:2,CORNER:0,CORNERS:1,RADIUS:2,CENTER_RADIUS:2,CENTER:3,DIAMETER:3,CENTER_DIAMETER:3,BASELINE:0,TOP:101,BOTTOM:102,NORMAL:1,NORMALIZED:1,IMAGE:2,MODEL:4,SHAPE:5,SQUARE:"butt",ROUND:"round",PROJECT:"square",MITER:"miter",BEVEL:"bevel",AMBIENT:0,DIRECTIONAL:1,SPOT:3,BACKSPACE:8,TAB:9,ENTER:10,RETURN:13,ESC:27,DELETE:127,CODED:65535,SHIFT:16,CONTROL:17,ALT:18,CAPSLK:20,PGUP:33,PGDN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INS:45,DEL:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLK:144,ARROW:"default",CROSS:"crosshair",HAND:"pointer",MOVE:"move",TEXT:"text",WAIT:"wait",NOCURSOR:"url('data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=='), auto",DISABLE_OPENGL_2X_SMOOTH:1,ENABLE_OPENGL_2X_SMOOTH:-1,ENABLE_OPENGL_4X_SMOOTH:2,ENABLE_NATIVE_FONTS:3,DISABLE_DEPTH_TEST:4,ENABLE_DEPTH_TEST:-4,ENABLE_DEPTH_SORT:5,DISABLE_DEPTH_SORT:-5,DISABLE_OPENGL_ERROR_REPORT:6,ENABLE_OPENGL_ERROR_REPORT:-6,ENABLE_ACCURATE_TEXTURES:7,DISABLE_ACCURATE_TEXTURES:-7,HINT_COUNT:10,SINCOS_LENGTH:parseInt(720,10),PRECISIONB:15,PRECISIONF:32768,PREC_MAXVAL:32767,PREC_ALPHA_SHIFT:9,PREC_RED_SHIFT:1,NORMAL_MODE_AUTO:0,NORMAL_MODE_SHAPE:1,NORMAL_MODE_VERTEX:2,MAX_LIGHTS:8};setupTypedArray("Float32Array","WebGLFloatArray"),setupTypedArray("Int32Array","WebGLIntArray"),setupTypedArray("Uint16Array","WebGLUnsignedShortArray"),setupTypedArray("Uint8Array","WebGLUnsignedByteArray");var ArrayList=function(){function b(){var c=arguments.length===0?[]:typeof arguments[0]=="number"?Array(0|arguments[0]):arguments[0];this.get=function(a){return c[a]},this.contains=function(a){return c.indexOf(a)!==-1},this.add=function(){if(arguments.length===1)c.push(arguments[0]);else{if(arguments.length!==2)throw"Please use the proper number of parameters.";var a=arguments[0];if(typeof a!="number")throw typeof a+" is not a number";if(a>=0&&a<=c.length)c.splice(a,0,arguments[1]);else throw a+" is not a valid index"}},this.set=function(){if(arguments.length!==2)throw"Please use the proper number of parameters.";var a=arguments[0];if(typeof a!="number")throw typeof a+" is not a number";if(a>=0&&a<c.length)c.splice(a,1,arguments[1]);else throw a+" is not a valid index."},this.size=function(){return c.length},this.clear=function(){c.length=0},this.remove=function(a){return c.splice(a,1)[0]},this.isEmpty=function(){return!c.length},this.clone=function(){return new b(c.slice(0))},this.toArray=function(){return c.slice(0)},this.iterator=function(){return new a(c)}}function a(a){var b=0;this.hasNext=function(){return b<a.length},this.next=function(){return a[b++]},this.remove=function(){a.splice(b,1)}}return b}(),HashMap=function(){function c(){function l(c){this._isIn=function(a){return a===h&&c.removed===undef},this.equals=function(a){return b(c.key,a.getKey())},this.getKey=function(){return c.key},this.getValue=function(){return c.value},this.hashCode=function(b){return a(c.key)},this.setValue=function(a){var b=c.value;c.value=a;return b}}function k(a,b,c){this.clear=function(){h.clear()},this.contains=function(a){return b(a)},this.containsAll=function(a){var b=a.iterator();while(b.hasNext())if(!this.contains(b.next()))return!1;return!0},this.isEmpty=function(){return h.isEmpty()},this.iterator=function(){return new j(a,c)},this.remove=function(a){if(this.contains(a)){c(a);return!0}return!1},this.removeAll=function(a){var b=a.iterator(),d=!1;while(b.hasNext()){var e=b.next();this.contains(e)&&(c(e),d=!0)}return!0},this.retainAll=function(a){var b=this.iterator(),d=[];while(b.hasNext()){var e=b.next();a.contains(e)||d.push(e)}for(var f=0;f<d.length;++f)c(d[f]);return d.length>0},this.size=function(){return h.size()},this.toArray=function(){var a=new ArrayList(0),b=this.iterator();while(b.hasNext())a.push(b.next());return a}}function j(a,b){function g(){while(!e){++d;if(c>=f.length)e=!0;else if(f[c]===undef||d>=f[c].length)d=-1,++c;else return}}var c=0,d=-1,e=!1;this.hasNext=function(){return!e},this.next=function(){var b=a(f[c][d]);g();return b},this.remove=function(){b(this.next()),--d},g()}function i(){if(!(g<=e*f.length)){var b=[];for(var c=0;c<f.length;++c)f[c]!==undef&&(b=b.concat(f[c]));f=Array(f.length*2);for(var d=0;d<b.length;++d){var h=a(b[d].key)%f.length,i=f[h];i===undef&&(f[h]=i=[]),i.push(b[d])}}}if(arguments.length===1&&arguments[0].constructor===c)return arguments[0].clone();var d=arguments.length>0?arguments[0]:16,e=arguments.length>1?arguments[1]:.75,f=Array(d),g=0,h=this;this.clear=function(){g=0,f=Array(d)},this.clone=function(){var a=new c;a.putAll(this);return a},this.containsKey=function(c){var d=a(c)%f.length,e=f[d];if(e===undef)return!1;for(var g=0;g<e.length;++g)if(b(e[g].key,c))return!0;return!1},this.containsValue=function(a){for(var c=0;c<f.length;++c){var d=f[c];if(d===undef)continue;for(var e=0;e<d.length;++e)if(b(d[e].value,a))return!0}return!1},this.entrySet=function(){return new k(function(a){return new l(a)},function(a){return a.constructor===l&&a._isIn(h)},function(a){return h.remove(a.getKey())})},this.get=function(c){var d=a(c)%f.length,e=f[d];if(e===undef)return null;for(var g=0;g<e.length;++g)if(b(e[g].key,c))return e[g].value;return null},this.isEmpty=function(){return g===0},this.keySet=function(){return new k(function(a){return a.key},function(a){return h.containsKey(a)},function(a){return h.remove(a)})},this.put=function(c,d){var e=a(c)%f.length,h=f[e];if(h===undef){++g,f[e]=[{key:c,value:d}],i();return null}for(var j=0;j<h.length;++j)if(b(h[j].key,c)){var k=h[j].value;h[j].value=d;return k}++g,h.push({key:c,value:d}),i();return null},this.putAll=function(a){var b=a.entrySet().iterator();while(b.hasNext()){var c=b.next();this.put(c.getKey(),c.getValue())}},this.remove=function(c){var d=a(c)%f.length,e=f[d];if(e===undef)return null;for(var h=0;h<e.length;++h)if(b(e[h].key,c)){--g;var i=e[h].value;e[h].removed=!0,e.length>1?e.splice(h,1):f[d]=undef;return i}return null},this.size=function(){return g},this.values=function(){var a=new ArrayList(0),b=this.entrySet().iterator();while(b.hasNext()){var c=b.next();a.push(c.getValue())}return a}}function b(a,b){return a===null||b===null?a===null&&b===null:a.constructor===String?a===b:typeof a!="object"?a===b:"equals"in a?a.equals.call(a,b):a===b}function a(a){if(a.constructor===String){var b=0;for(var c=0;c<a.length;++c)b=b*31+a.charCodeAt(c)&4294967295;return b}if(typeof a!="object")return a&4294967295;if("hashCode"in a)return a.hashCode.call(a);a.$id===undef&&(a.$id=Math.floor(Math.random()*65536)-32768<<16|Math.floor(Math.random()*65536));return a.$id}return c}(),PVector=function(){function c(a){return function(b,c){return b[a](c)}}function b(a){return function(b,c){var d=b.get();d[a](c);return d}}function a(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0}var d="dist dot cross".split(" "),e=d.length;a.angleBetween=function(a,b){return Math.acos(a.dot(b)/(a.mag()*b.mag()))},a.prototype={set:function(a,b,c){arguments.length===1?this.set(a.x||a[0],a.y||a[1],a.z||a[2]):(this.x=a,this.y=b,this.z=c)},get:function(){return new a(this.x,this.y,this.z)},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},add:function(a,b,c){arguments.length===3?(this.x+=a,this.y+=b,this.z+=c):arguments.length===1&&(this.x+=a.x,this.y+=a.y,this.z+=a.z)},sub:function(a,b,c){arguments.length===3?(this.x-=a,this.y-=b,this.z-=c):arguments.length===1&&(this.x-=a.x,this.y-=a.y,this.z-=a.z)},mult:function(a){typeof a=="number"?(this.x*=a,this.y*=a,this.z*=a):typeof a=="object"&&(this.x*=a.x,this.y*=a.y,this.z*=a.z)},div:function(a){typeof a=="number"?(this.x/=a,this.y/=a,this.z/=a):typeof a=="object"&&(this.x/=a.x,this.y/=a.y,this.z/=a.z)},dist:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return Math.sqrt(b*b+c*c+d*d)},dot:function(a,b,c){if(arguments.length===3)return this.x*a+this.y*b+this.z*c;if(arguments.length===1)return this.x*a.x+this.y*a.y+this.z*a.z},cross:function(b){return new a(this.y*b.z-b.y*this.z,this.z*b.x-b.z*this.x,this.x*b.y-b.x*this.y)},normalize:function(){var a=this.mag();a>0&&this.div(a)},limit:function(a){this.mag()>a&&(this.normalize(),this.mult(a))},heading2D:function(){return-Math.atan2(-this.y,this.x)},toString:function(){return"["+this.x+", "+this.y+", "+this.z+"]"},array:function(){return[this.x,this.y,this.z]}};while(e--)a[d[e]]=c(d[e]);for(e in a.prototype)a.prototype.hasOwnProperty(e)&&!a.hasOwnProperty(e)&&(a[e]=b(e));return a}();DefaultScope.prototype=PConstants;var defaultScope=new DefaultScope;defaultScope.ArrayList=ArrayList,defaultScope.HashMap=HashMap,defaultScope.PVector=PVector;var Processing=this.Processing=function Processing(curElement,aCode){function keyFunc(a,b){var c;p.key=keyCodeMap(a.keyCode,a.shiftKey),b==="keypress"&&a.keyCode===a.charCode&&(p.keyCode=-1);switch(p.keyCode){case 19:case 33:case 34:case 35:case 36:case 37:case 38:case 39:case 40:case 45:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:case 123:case 145:case 155:case 224:case 225:case 226:case 227:b==="keydown"?gRefire?(p.keyReleased(),p.keyPressed()):(p.keyPressed(),gRefire=!0):b==="keypress"?firstCodedDown?firstCodedDown=!1:(p.keyReleased(),p.keyPressed()):b==="keyup"&&(p.keyReleased(),firstCodedDown===!1&&(firstCodedDown=!0),gRefire&&(gRefire=!1));break;case 16:case 17:case 18:case 20:case 144:b==="keydown"?p.keyPressed():b==="keyup"&&p.keyReleased();break;case 46:case 13:b==="keydown"?firstEDGKeyDown===!0?(firstEDGKeyDown=!1,normalKeyDown()):refireKeyDown():b==="keypress"?firstEDMKeyDown===!0?firstEDMKeyDown=!1:refireKeyDown():b==="keyup"&&(p.keyCode=a.keyCode,p.keyReleased(),firstEDGKeyDown===!1&&(firstEDGKeyDown=!0),firstEDMKeyDown===!1&&(firstEDMKeyDown=!0));break;default:p.keyCode===-1&&(p.keyCode=a.keyCode),a.keyCode===0?(p.key=charCodeMap(a.charCode,a.shiftKey),b==="keypress"?firstMKeyDown===!0?firstMKeyDown=!1:refireKeyDown():b==="keyup"&&(p.keyCode=a.keyCode,p.keyReleased(),firstMKeyDown===!1&&(firstMKeyDown=!0))):(p.key=charCodeMap(a.keyCode,a.shiftKey),b==="keydown"?firstGKeyDown===!0?(firstGKeyDown=!1,normalKeyDown()):refireKeyDown():b==="keyup"&&(p.keyCode=a.keyCode,p.keyReleased(),firstMKeyDown===!1&&(firstMKeyDown=!0),firstGKeyDown===!1&&(firstGKeyDown=!0)))}}function refireKeyDown(){var a;p.keyPressed(),a=p.keyCode,p.keyCode=0,p.keyTyped(),p.keyCode=a}function normalKeyDown(){var a;p.keyPressed(),a=p.keyCode,p.keyCode=0,p.keyTyped(),p.keyCode=a}function charCodeMap(a,b){if(a>=65&&a<=90)return b?a:a+32;if(a>=48&&a<=57){if(b)switch(a){case 49:return 33;case 50:return 64;case 51:return 35;case 52:return 36;case 53:return 37;case 54:return 94;case 55:return 38;case 56:return 42;case 57:return 40;case 48:return 41}}else if(b)switch(a){case 107:return 43;case 219:return 123;case 221:return 125;case 222:return 34}else switch(a){case 188:return 44;case 109:return 45;case 190:return 46;case 191:return 47;case 192:return 96;case 219:return 91;case 220:return 92;case 221:return 93;case 222:return 39}return a}function keyCodeMap(a){if(codedKeys.indexOf(a)>=0){p.keyCode=a,a===p.INS&&(p.keyCode=155);return PConstants.CODED}switch(a){case 13:return 10;case 46:return 127}return a}function attach(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c),eventHandlers.push([a,b,c])}function extendClass(a,b){function c(c){p.defineProperty(a,c,{get:function(){return b[c]},set:function(a){b[c]=a},enumerable:!0})}var d=[];for(var e in b)e in a||(typeof b[e]=="function"?a[e]=b[e]:e!=="$upcast"&&d.push(e));while(d.length>0)c(d.shift())}function text$6(a,b,c,d,e,f){if(a.length!==0){if(curTextSize>e)return;curContext.font=curTextSize+"px "+curTextFont.name;var g=null,h=0,i=0,j=0,k=a.split("\n");for(var l=0;l<k.length;l++){for(var m=0;m<k[l].length;m++)"fillText"in curContext?j=curContext.measureText(k[l][m]).width:"mozDrawText"in curContext&&(j=curContext.mozMeasureText(k[l][m])),i+=j,k[l][m]===" "&&(g=m),i>=d&&k[l][m]!==" "&&(g===null&&(g=m),k.splice(l,1,k[l].substring(0,g+1),k[l].substring(g+1)),g=null);i=j=0}var n=p.use3DContext?text$line$3d:text$line,o=0;horizontalTextAlignment===PConstants.CENTER?o=d/2:horizontalTextAlignment===PConstants.RIGHT&&(o=d);var q=(1-baselineOffset)*curTextSize,r=0;verticalTextAlignment===PConstants.BOTTOM?r=e-k.length*curTextLeading:verticalTextAlignment===PConstants.CENTER&&(r=(e-k.length*curTextLeading)/2);for(var s=0,t=k.length;s<t;++s,h+=curTextLeading){if(h+r<0)continue;if(h+r+curTextLeading>e)break;n(k[s],b+o,c+h+q+r,f,horizontalTextAlignment)}}}function text$4(a,b,c,d){var e=p.use3DContext?text$line$3d:text$line,f,g;a.indexOf("\n")<0?(f=[a],g=1):(f=a.split(/\r?\n/g),g=f.length);var h;verticalTextAlignment===PConstants.TOP?h=(1-baselineOffset)*curTextLeading:verticalTextAlignment===PConstants.CENTER?h=(1-baselineOffset-g/2)*curTextLeading:verticalTextAlignment===PConstants.BOTTOM?h=(1-baselineOffset-g)*curTextLeading:h=0;for(var i=0;i<g;++i){var j=f[i];e(j,b,c+h,d,horizontalTextAlignment),h+=curTextLeading}}function text$line$3d(a,b,c,d,e){textcanvas===undef&&(textcanvas=document.createElement("canvas"));var f=curContext;curContext=textcanvas.getContext("2d"),curContext.font=curContext.mozTextStyle=curTextSize+"px "+curTextFont.name;var g=0;"fillText"in curContext?g=curContext.measureText(a).width:"mozDrawText"in curContext&&(g=curContext.mozMeasureText(a)),textcanvas.width=g,textcanvas.height=curTextSize,curContext=textcanvas.getContext("2d"),curContext.font=curContext.mozTextStyle=curTextSize+"px "+curTextFont.name,curContext.textBaseline="top",text$line(a,0,0,0,PConstants.LEFT);var h=textcanvas.width/textcanvas.height;curContext=f,curContext.bindTexture(curContext.TEXTURE_2D,textTex),executeTexImage2D(textcanvas),curContext.texParameteri(curContext.TEXTURE_2D,curContext.TEXTURE_MAG_FILTER,curContext.LINEAR),curContext.texParameteri(curContext.TEXTURE_2D,curContext.TEXTURE_MIN_FILTER,curContext.LINEAR),curContext.texParameteri(curContext.TEXTURE_2D,curContext.TEXTURE_WRAP_T,curContext.CLAMP_TO_EDGE),curContext.texParameteri(curContext.TEXTURE_2D,curContext.TEXTURE_WRAP_S,curContext.CLAMP_TO_EDGE);var i=0;e===PConstants.RIGHT?i=-g:e===PConstants.CENTER&&(i=-g/2);var j=new PMatrix3D,k=curTextSize*.5;j.translate(b+i-k/2,c-k,d),j.scale(-h*k,-k,k),j.translate(-1,-1,-1),j.transpose();var l=new PMatrix3D;l.scale(1,-1,1),l.apply(modelView.array()),l.transpose();var m=new PMatrix3D;m.set(projection),m.transpose(),curContext.useProgram(programObject2D),vertexAttribPointer("vertex2d",programObject2D,"Vertex",3,textBuffer),vertexAttribPointer("aTextureCoord2d",programObject2D,"aTextureCoord",2,textureBuffer),uniformi("uSampler2d",programObject2D,"uSampler",[0]),uniformi("picktype2d",programObject2D,"picktype",1),uniformMatrix("model2d",programObject2D,"model",!1,j.array()),uniformMatrix("view2d",programObject2D,"view",!1,l.array()),uniformMatrix("projection2d",programObject2D,"projection",!1,m.array()),uniformf("color2d",programObject2D,"color",fillStyle),curContext.bindBuffer(curContext.ELEMENT_ARRAY_BUFFER,indexBuffer),curContext.drawElements(curContext.TRIANGLES,6,curContext.UNSIGNED_SHORT,0)}function text$line(a,b,c,d,e){var f=0,g=0;if(!curTextFont.glyph){if(a&&("fillText"in curContext||"mozDrawText"in curContext)){isFillDirty&&(curContext.fillStyle=p.color.toString(currentFillColor),isFillDirty=!1);if(e===PConstants.RIGHT||e===PConstants.CENTER)"fillText"in curContext?f=curContext.measureText(a).width:"mozDrawText"in curContext&&(f=curContext.mozMeasureText(a)),e===PConstants.RIGHT?g=-f:g=-f/2;"fillText"in curContext?curContext.fillText(a,b+g,c):"mozDrawText"in curContext&&(saveContext(),curContext.translate(b+g,c),curContext.mozDrawText(a),restoreContext())}}else{var h=p.glyphTable[curTextFont.name];saveContext(),curContext.translate(b,c+curTextSize);if(e===PConstants.RIGHT||e===PConstants.CENTER)f=h.width(a),e===PConstants.RIGHT?g=-f:g=-f/2;var i=h.units_per_em,j=1/i*curTextSize;curContext.scale(j,j);for(var k=0,l=a.length;k<l;k++)try{p.glyphLook(h,a[k]).draw()}catch(m){Processing.debug(m)}restoreContext()}}function toP5String(a){return a instanceof String?a:typeof a=="number"?a===(0|a)?a.toString():p.nf(a,0,3):a===null||a===undef?"":a.toString()}function PFont(a){this.name="sans-serif";if(a!==undef)switch(a){case"sans-serif":case"serif":case"monospace":case"fantasy":case"cursive":this.name=a;break;default:this.name='"'+a+'", sans-serif'}this.origName=a}function set$4(a,b,c,d){if(d.isRemote)throw"Image is loaded remotely. Cannot set x,y.";var e=p.color.toArray(c),f=b*d.width*4+a*4,g=d.imageData.data;g[f]=e[0],g[f+1]=e[1],g[f+2]=e[2],g[f+3]=e[3]}function set$3(a,b,c){a<p.width&&a>=0&&b>=0&&b<p.height&&(replaceContext(),p.pixels.setPixel((0|a)+p.width*(0|b),c),++setPixelsCached>maxPixelsCached&&resetContext())}function replaceContext(){isContextReplaced||(p.loadPixels(),proxyContext===null&&(originalContext=curContext,proxyContext=new SetPixelContextWrapper),isContextReplaced=!0,curContext=proxyContext,setPixelsCached=0)}function SetPixelContextWrapper(){function b(a,b){function d(a){resetContext(),curContext[b]=a}function c(){resetContext();return curContext[b]}p.defineProperty(a,b,{get:c,set:d})}function a(a,b){function c(){resetContext(),curContext[b].apply(curContext,arguments)}a[b]=c}for(var c in curContext)typeof curContext[c]=="function"?a(this,c):b(this,c)}function resetContext(){isContextReplaced&&(curContext=originalContext,isContextReplaced=!1,p.updatePixels())}function get$5(a,b,c,d,e){if(e.isRemote)throw"Image is loaded remotely. Cannot get x,y,w,h.";var f=new PImage(c,d,PConstants.RGB),g=f.imageData.data,h=e.width,i=e.height,j=e.imageData.data,k=Math.max(0,-b),l=Math.max(0,-a),m=Math.min(d,i-b),n=Math.min(c,h-a);for(var o=k;o<m;++o){var p=((b+o)*h+(a+l))*4,q=(o*c+l)*4;for(var r=l;r<n;++r)g[q++]=j[p++],g[q++]=j[p++],g[q++]=j[p++],g[q++]=j[p++]}return f}function get$4(a,b,c,d){var e=new PImage(c,d,PConstants.RGB);e.fromImageData(curContext.getImageData(a,b,c,d));return e}function get$3(a,b,c){if(c.isRemote)throw"Image is loaded remotely. Cannot get x,y.";var d=b*c.width*4+a*4;return p.color.toInt(c.imageData.data[d],c.imageData.data[d+1],c.imageData.data[d+2],c.imageData.data[d+3])}function get$2(a,b){var c;if(a<p.width&&a>=0&&b>=0&&b<p.height){if(isContextReplaced){var d=((0|a)+p.width*(0|b))*4;c=p.imageData.data;return p.color.toInt(c[d],c[d+1],c[d+2],c[d+3])}c=curContext.getImageData(0|a,0|b,1,1).data;return p.color.toInt(c[0],c[1],c[2],c[3])}return 0}function get$0(){var a=new PImage(p.width,p.height,PConstants.RGB);a.fromImageData(curContext.getImageData(0,0,p.width,p.height));return a}function getCanvasData(a,b,c){var d=canvasDataCache.shift();d===undef&&(d={},d.canvas=document.createElement("canvas"),d.context=d.canvas.getContext("2d")),canvasDataCache.push(d);var e=d.canvas,f=d.context,g=b||a.width,h=c||a.height;e.width=g,e.height=h,a?"data"in a?f.putImageData(a,0,0):(f.clearRect(0,0,g,h),f.drawImage(a,0,0,g,h)):f.clearRect(0,0,g,h);return d}function colorBlendWithAlpha(a,b,c){var d=0|c*((b&PConstants.ALPHA_MASK)>>>24);return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+d,255)<<24|p.mix(a&PConstants.RED_MASK,b&PConstants.RED_MASK,d)&PConstants.RED_MASK|p.mix(a&PConstants.GREEN_MASK,b&PConstants.GREEN_MASK,d)&PConstants.GREEN_MASK|p.mix(a&PConstants.BLUE_MASK,b&PConstants.BLUE_MASK,d)}function executeContextStroke(){doStroke&&(isStrokeDirty&&(curContext.strokeStyle=p.color.toString(currentStrokeColor),isStrokeDirty=!1),curContext.stroke())}function executeContextFill(){doFill&&(isFillDirty&&(curContext.fillStyle=p.color.toString(currentFillColor),isFillDirty=!1),curContext.fill())}function PerlinNoise(a){function j(a,b,c){return b+a*(c-b)}function i(a,b){return(a&1)===0?-b:b}function h(a,b,c){var d=(a&1)===0?b:c;return(a&2)===0?-d:d}function g(a,b,c,d){var e=a&15,f=e<8?b:c,g=e<4?c:e===12||e===14?b:d;return((e&1)===0?f:-f)+((e&2)===0?g:-g)}var b=a!==undef?new Marsaglia(a):Marsaglia.createRandomized(),c,d,e=Array(512);for(c=0;c<256;++c)e[c]=c;for(c=0;c<256;++c){var f=e[d=b.nextInt()&255];e[d]=e[c],e[c]=f}for(c=0;c<256;++c)e[c+256]=e[c];this.noise3d=function(a,b,c){var d=Math.floor(a)&255,f=Math.floor(b)&255,h=Math.floor(c)&255;a-=Math.floor(a),b-=Math.floor(b),c-=Math.floor(c);var i=(3-2*a)*a*a,k=(3-2*b)*b*b,l=(3-2*c)*c*c,m=e[d]+f,n=e[m]+h,o=e[m+1]+h,p=e[d+1]+f,q=e[p]+h,r=e[p+1]+h;return j(l,j(k,j(i,g(e[n],a,b,c),g(e[q],a-1,b,c)),j(i,g(e[o],a,b-1,c),g(e[r],a-1,b-1,c))),j(k,j(i,g(e[n+1],a,b,c-1),g(e[q+1],a-1,b,c-1)),j(i,g(e[o+1],a,b-1,c-1),g(e[r+1],a-1,b-1,c-1))))},this.noise2d=function(a,b){var c=Math.floor(a)&255,d=Math.floor(b)&255;a-=Math.floor(a),b-=Math.floor(b);var f=(3-2*a)*a*a,g=(3-2*b)*b*b,i=e[c]+d,k=e[c+1]+d;return j(g,j(f,h(e[i],a,b),h(e[k],a-1,b)),j(f,h(e[i+1],a,b-1),h(e[k+1],a-1,b-1)))},this.noise1d=function(a){var b=Math.floor(a)&255;a-=Math.floor(a);var c=(3-2*a)*a*a;return j(c,i(e[b],a),i(e[b+1],a-1))}}function Marsaglia(a,b){var c=a||362436069,d=b||521288629,e=function(){c=36969*(c&65535)+(c>>>16)&4294967295,d=18e3*(d&65535)+(d>>>16)&4294967295;return((c&65535)<<16|d&65535)&4294967295};this.nextDouble=function(){var a=e()/4294967296;return a<0?1+a:a},this.nextInt=e}function intScalar(a){if(typeof a=="number")return a&4294967295;if(typeof a=="boolean")return a?1:0;if(typeof a=="string"){var b=parseInt(a,10);return b&4294967295}if(a instanceof Char)return a.code}function floatScalar(a){if(typeof a=="number")return a;if(typeof a=="boolean")return a?1:0;if(typeof a=="string")return parseFloat(a);if(a instanceof Char)return a.code}function booleanScalar(a){if(typeof a=="number")return a!==0;if(typeof a=="boolean")return a;if(typeof a=="string")return a.toLowerCase()==="true";if(a instanceof Char)return a.code===49||a.code===84||a.code===116}function unhexScalar(a){var b=parseInt("0x"+a,16);b>2147483647&&(b-=4294967296);return b}function nfCore(a,b,c,d,e,f){if(a instanceof Array){var g=[];for(var h=0,i=a.length;h<i;h++)g.push(nfCoreScalar(a[h],b,c,d,e,f));return g}return nfCoreScalar(a,b,c,d,e,f)}function nfCoreScalar(a,b,c,d,e,f){var g=a<0?c:b,h=e===0,i=e===undef||e<0?0:e,j=Math.abs(a);if(h){i=1,j*=10;while(Math.abs(Math.round(j)-j)>1e-6&&i<7)++i,j*=10}else i!==0&&(j*=Math.pow(10,i));var k,l=j*2;if(Math.floor(j)===j)k=j;else if(Math.floor(l)===l){var m=Math.floor(j);k=m+m%2}else k=Math.round(j);var n="",o=d+i;while(o>0||k>0)o--,n=""+k%10+n,k=Math.floor(k/10);if(f!==undef){var p=n.length-3-i;while(p>0)n=n.substring(0,p)+f+n.substring(p),p-=3}return i>0?g+n.substring(0,n.length-i)+"."+n.substring(n.length-i,n.length):g+n}function decToBin(a,b){var c=1;c=c<<b-1;var d="";for(var e=0;e<b;e++)d+=c&a?"1":"0",c=c>>>1;return d}function restoreContext(){curContext.restore(),isStrokeDirty=!0,isFillDirty=!0}function saveContext(){curContext.save()}function color$1(a){if(a<=colorModeX&&a>=0){if(curColorMode===PConstants.RGB)return color$4(a,a,a,colorModeA);if(curColorMode===PConstants.HSB)return color$4(0,0,a/colorModeX*colorModeZ,colorModeA)}else if(a)return a}function color$2(a,b){var c;if(a&PConstants.ALPHA_MASK){c=Math.round(255*(b/colorModeA)),c=c>255?255:c;return a-(a&PConstants.ALPHA_MASK)+(c<<24&PConstants.ALPHA_MASK)}if(curColorMode===PConstants.RGB)return color$4(a,a,a,b);if(curColorMode===PConstants.HSB)return color$4(0,0,a/colorModeX*colorModeZ,b)}function color$4(a,b,c,d){var e,f,g,h;if(curColorMode===PConstants.HSB){var i=p.color.toRGB(a,b,c);e=i[0],f=i[1],g=i[2]}else e=Math.round(255*(a/colorModeX)),f=Math.round(255*(b/colorModeY)),g=Math.round(255*(c/colorModeZ));h=Math.round(255*(d/colorModeA)),e=e>255?255:e,f=f>255?255:f,g=g>255?255:g,h=h>255?255:h;return h<<24&PConstants.ALPHA_MASK|e<<16&PConstants.RED_MASK|f<<8&PConstants.GREEN_MASK|g&PConstants.BLUE_MASK}function uniformMatrix(a,b,c,d,e){var f=curContextCache.locations[a];f===undef&&(f=curContext.getUniformLocation(b,c),curContextCache.locations[a]=f),f!==-1&&(e.length===16?curContext.uniformMatrix4fv(f,d,e):e.length===9?curContext.uniformMatrix3fv(f,d,e):curContext.uniformMatrix2fv(f,d,e))}function disableVertexAttribPointer(a,b,c){var d=curContextCache.attributes[a];d===undef&&(d=curContext.getAttribLocation(b,c),curContextCache.attributes[a]=d),d!==-1&&curContext.disableVertexAttribArray(d)}function vertexAttribPointer(a,b,c,d,e){var f=curContextCache.attributes[a];f===undef&&(f=curContext.getAttribLocation(b,c),curContextCache.attributes[a]=f),f!==-1&&(curContext.bindBuffer(curContext.ARRAY_BUFFER,e),curContext.vertexAttribPointer(f,d,curContext.FLOAT,!1,0,0),curContext.enableVertexAttribArray(f))}function uniformi(a,b,c,d){var e=curContextCache.locations[a];e===undef&&(e=curContext.getUniformLocation(b,c),curContextCache.locations[a]=e),e!==-1&&(d.length===4?curContext.uniform4iv(e,d):d.length===3?curContext.uniform3iv(e,d):d.length===2?curContext.uniform2iv(e,d):curContext.uniform1i(e,d))}function uniformf(a,b,c,d){var e=curContextCache.locations[a];e===undef&&(e=curContext.getUniformLocation(b,c),curContextCache.locations[a]=e),e!==-1&&(d.length===4?curContext.uniform4fv(e,d):d.length===3?curContext.uniform3fv(e,d):d.length===2?curContext.uniform2fv(e,d):curContext.uniform1f(e,d))}if(!(this instanceof Processing))throw"called Processing constructor as if it were a function: missing 'new'.";var p=this;p.externals={canvas:curElement,context:undef,sketch:undef,onblur:function(){},onfocus:function(){}},p.name="Processing.js Instance",p.use3DContext=!1,p.focused=!0,p.breakShape=!1,p.glyphTable={},p.pmouseX=0,p.pmouseY=0,p.mouseX=0,p.mouseY=0,p.mouseButton=0,p.mouseScroll=0,p.mouseClicked=undef,p.mouseDragged=undef,p.mouseMoved=undef,p.mousePressed=undef,p.mouseReleased=undef,p.mouseScrolled=undef,p.key=undef,p.keyCode=undef,p.keyPressed=function(){},p.keyReleased=function(){},p.keyTyped=function(){},p.draw=undef,p.setup=undef,p.__mousePressed=!1,p.__keyPressed=!1,p.__frameRate=0,p.frameCount=0,p.width=curElement.width-0,p.height=curElement.height-0,p.defineProperty=function(a,b,c){"defineProperty"in Object?Object.defineProperty(a,b,c):(c.hasOwnProperty("get")&&a.__defineGetter__(b,c.get),c.hasOwnProperty("set")&&a.__defineSetter__(b,c.set))};var curContext,curSketch,online=!0,doFill=!0,fillStyle=[1,1,1,1],currentFillColor=4294967295,isFillDirty=!0,doStroke=!0,strokeStyle=[.8,.8,.8,1],currentStrokeColor=4294835709,isStrokeDirty=!0,lineWidth=1,loopStarted=!1,doLoop=!0,looping=0,curRectMode=PConstants.CORNER,curEllipseMode=PConstants.CENTER,normalX=0,normalY=0,normalZ=0,normalMode=PConstants.NORMAL_MODE_AUTO,inDraw=!1,curFrameRate=60,curCursor=PConstants.ARROW,oldCursor=curElement.style.cursor,curMsPerFrame=1,curShape=PConstants.POLYGON,curShapeCount=0,curvePoints=[],curTightness=0,curveDet=20,curveInited=!1,bezDetail=20,colorModeA=255,colorModeX=255,colorModeY=255,colorModeZ=255,pathOpen=!1,mouseDragging=!1,curColorMode=PConstants.RGB,curTint=null,curTextSize=12,curTextFont="Arial",curTextLeading=14,getLoaded=!1,start=(new Date).getTime(),timeSinceLastFPS=start,framesSinceLastFPS=0,textcanvas,curveBasisMatrix,curveToBezierMatrix,curveDrawMatrix,bezierDrawMatrix,bezierBasisInverse,bezierBasisMatrix,firstCodedDown=!0,firstEDGKeyDown=!0,firstEDMKeyDown=!0,firstMKeyDown=!0,firstGKeyDown=!0,gRefire=!1,curContextCache={attributes:{},locations:{}},programObject3D,programObject2D,programObjectUnlitShape,boxBuffer,boxNormBuffer,boxOutlineBuffer,rectBuffer,rectNormBuffer,sphereBuffer,lineBuffer,fillBuffer,fillColorBuffer,strokeColorBuffer,pointBuffer,shapeTexVBO,canTex,textTex,curTexture={width:0,height:0},curTextureMode=PConstants.IMAGE,usingTexture=!1,textBuffer,textureBuffer,indexBuffer,horizontalTextAlignment=PConstants.LEFT,verticalTextAlignment=PConstants.BASELINE,baselineOffset=.2,tMode=PConstants.MODEL,originalContext,proxyContext=null,isContextReplaced=!1,setPixelsCached,maxPixelsCached=1e3,codedKeys=[PConstants.SHIFT,PConstants.CONTROL,PConstants.ALT,PConstants.CAPSLK,PConstants.PGUP,PConstants.PGDN,PConstants.END,PConstants.HOME,PConstants.LEFT,PConstants.UP,PConstants.RIGHT,PConstants.DOWN,PConstants.NUMLK,PConstants.INS,PConstants.F1,PConstants.F2,PConstants.F3,PConstants.F4,PConstants.F5,PConstants.F6,PConstants.F7,PConstants.F8,PConstants.F9,PConstants.F10,PConstants.F11,PConstants.F12],stylePaddingLeft,stylePaddingTop,styleBorderLeft,styleBorderTop;document.defaultView&&document.defaultView.getComputedStyle&&(stylePaddingLeft=parseInt(document.defaultView.getComputedStyle(curElement,null).paddingLeft,10)||0,stylePaddingTop=parseInt(document.defaultView.getComputedStyle(curElement,null).paddingTop,10)||0,styleBorderLeft=parseInt(document.defaultView.getComputedStyle(curElement,null).borderLeftWidth,10)||0,styleBorderTop=parseInt(document.defaultView.getComputedStyle(curElement,null).borderTopWidth,10)||0);var lightCount=0,sphereDetailV=0,sphereDetailU=0,sphereX=[],sphereY=[],sphereZ=[],sinLUT=Array(PConstants.SINCOS_LENGTH),cosLUT=Array(PConstants.SINCOS_LENGTH),sphereVerts,sphereNorms,cam,cameraInv,forwardTransform,reverseTransform,modelView,modelViewInv,userMatrixStack,inverseCopy,projection,manipulatingCamera=!1,frustumMode=!1,cameraFOV=60*(Math.PI/180),cameraX=curElement.width/2,cameraY=curElement.height/2,cameraZ=cameraY/Math.tan(cameraFOV/2),cameraNear=cameraZ/10,cameraFar=cameraZ*10,cameraAspect=curElement.width/curElement.height,vertArray=[],curveVertArray=[],curveVertCount=0,isCurve=!1,isBezier=!1,firstVert=!0,curShapeMode=PConstants.CORNER,colors={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},styleArray=Array(0),boxVerts=new Float32Array([.5,.5,-0.5,.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,.5,-0.5,.5,.5,-0.5,.5,.5,.5,-0.5,.5,.5,-0.5,-0.5,.5,-0.5,-0.5,.5,.5,-0.5,.5,.5,.5,.5,.5,.5,-0.5,.5,.5,.5,.5,-0.5,.5,.5,-0.5,.5,.5,-0.5,-0.5,.5,.5,-0.5,.5,-0.5,-0.5,.5,-0.5,.5,-0.5,-0.5,.5,-0.5,-0.5,.5,-0.5,-0.5,-0.5,.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,.5,-0.5,.5,.5,-0.5,.5,.5,-0.5,.5,-0.5,-0.5,-0.5,-0.5,.5,.5,.5,.5,.5,-0.5,-0.5,.5,-0.5,-0.5,.5,-0.5,-0.5,.5,.5,.5,.5,.5]),boxOutlineVerts=new Float32Array([.5,.5,.5,.5,-0.5,.5,.5,.5,-0.5,.5,-0.5,-0.5,-0.5,.5,-0.5,-0.5,-0.5,-0.5,-0.5,.5,.5,-0.5,-0.5,.5,.5,.5,.5,.5,.5,-0.5,.5,.5,-0.5,-0.5,.5,-0.5,-0.5,.5,-0.5,-0.5,.5,.5,-0.5,.5,.5,.5,.5,.5,.5,-0.5,.5,.5,-0.5,-0.5,.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,-0.5,.5,-0.5,-0.5,.5,.5,-0.5,.5]),boxNorms=new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0]),rectVerts=new Float32Array([0,0,0,0,1,0,1,1,0,1,0,0]),rectNorms=new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,-1]),vShaderSrcUnlitShape="varying vec4 frontColor;attribute vec3 aVertex;attribute vec4 aColor;uniform mat4 uView;uniform mat4 uProjection;void main(void) {  frontColor = aColor;  gl_Position = uProjection * uView * vec4(aVertex, 1.0);}",fShaderSrcUnlitShape="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 frontColor;void main(void){  gl_FragColor = frontColor;}",vertexShaderSource2D="varying vec4 frontColor;attribute vec3 Vertex;attribute vec2 aTextureCoord;uniform vec4 color;uniform mat4 model;uniform mat4 view;uniform mat4 projection;uniform float pointSize;varying vec2 vTextureCoord;void main(void) {  gl_PointSize = pointSize;  frontColor = color;  gl_Position = projection * view * model * vec4(Vertex, 1.0);  vTextureCoord = aTextureCoord;}",fragmentShaderSource2D="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 frontColor;varying vec2 vTextureCoord;uniform sampler2D uSampler;uniform int picktype;void main(void){  if(picktype == 0){    gl_FragColor = frontColor;  }  else if(picktype == 1){    float alpha = texture2D(uSampler, vTextureCoord).a;    gl_FragColor = vec4(frontColor.rgb*alpha, alpha);\n  }}",vertexShaderSource3D="varying vec4 frontColor;attribute vec3 Vertex;attribute vec3 Normal;attribute vec4 aColor;attribute vec2 aTexture;varying   vec2 vTexture;uniform vec4 color;uniform bool usingMat;uniform vec3 specular;uniform vec3 mat_emissive;uniform vec3 mat_ambient;uniform vec3 mat_specular;uniform float shininess;uniform mat4 model;uniform mat4 view;uniform mat4 projection;uniform mat4 normalTransform;uniform int lightCount;uniform vec3 falloff;struct Light {  bool dummy;  int type;  vec3 color;  vec3 position;  vec3 direction;  float angle;  vec3 halfVector;  float concentration;};uniform Light lights[8];void AmbientLight( inout vec3 totalAmbient, in vec3 ecPos, in Light light ) {  float d = length( light.position - ecPos );  float attenuation = 1.0 / ( falloff[0] + ( falloff[1] * d ) + ( falloff[2] * d * d ));  totalAmbient += light.color * attenuation;}void DirectionalLight( inout vec3 col, in vec3 ecPos, inout vec3 spec, in vec3 vertNormal, in Light light ) {  float powerfactor = 0.0;  float nDotVP = max(0.0, dot( vertNormal, light.position ));  float nDotVH = max(0.0, dot( vertNormal, normalize( light.position-ecPos )));  if( nDotVP != 0.0 ){    powerfactor = pow( nDotVH, shininess );  }  col += light.color * nDotVP;  spec += specular * powerfactor;}void PointLight( inout vec3 col, inout vec3 spec, in vec3 vertNormal, in vec3 ecPos, in vec3 eye, in Light light ) {  float powerfactor;   vec3 VP = light.position - ecPos;  float d = length( VP );   VP = normalize( VP );  float attenuation = 1.0 / ( falloff[0] + ( falloff[1] * d ) + ( falloff[2] * d * d ));  float nDotVP = max( 0.0, dot( vertNormal, VP ));  vec3 halfVector = normalize( VP + eye );  float nDotHV = max( 0.0, dot( vertNormal, halfVector ));  if( nDotVP == 0.0) {    powerfactor = 0.0;  }  else{    powerfactor = pow( nDotHV, shininess );  }  spec += specular * powerfactor * attenuation;  col += light.color * nDotVP * attenuation;}void SpotLight( inout vec3 col, inout vec3 spec, in vec3 vertNormal, in vec3 ecPos, in vec3 eye, in Light light ) {  float spotAttenuation;  float powerfactor;  vec3 VP = light.position - ecPos;   vec3 ldir = normalize( light.direction );  float d = length( VP );  VP = normalize( VP );  float attenuation = 1.0 / ( falloff[0] + ( falloff[1] * d ) + ( falloff[2] * d * d ) );  float spotDot = dot( VP, ldir );  if( spotDot < cos( light.angle ) ) {    spotAttenuation = pow( spotDot, light.concentration );  }  else{    spotAttenuation = 1.0;  }  attenuation *= spotAttenuation;  float nDotVP = max( 0.0, dot( vertNormal, VP ));  vec3 halfVector = normalize( VP + eye );  float nDotHV = max( 0.0, dot( vertNormal, halfVector ));  if( nDotVP == 0.0 ) {    powerfactor = 0.0;  }  else {    powerfactor = pow( nDotHV, shininess );  }  spec += specular * powerfactor * attenuation;  col += light.color * nDotVP * attenuation;}void main(void) {  vec3 finalAmbient = vec3( 0.0, 0.0, 0.0 );  vec3 finalDiffuse = vec3( 0.0, 0.0, 0.0 );  vec3 finalSpecular = vec3( 0.0, 0.0, 0.0 );  vec4 col = color;  if(color[0] == -1.0){    col = aColor;  }  vec3 norm = vec3( normalTransform * vec4( Normal, 0.0 ) );  vec4 ecPos4 = view * model * vec4(Vertex,1.0);  vec3 ecPos = (vec3(ecPos4))/ecPos4.w;  vec3 eye = vec3( 0.0, 0.0, 1.0 );  if( lightCount == 0 ) {    frontColor = col + vec4(mat_specular,1.0);  }  else {    for( int i = 0; i < lightCount; i++ ) {      if( lights[i].type == 0 ) {        AmbientLight( finalAmbient, ecPos, lights[i] );      }      else if( lights[i].type == 1 ) {        DirectionalLight( finalDiffuse,ecPos, finalSpecular, norm, lights[i] );      }      else if( lights[i].type == 2 ) {        PointLight( finalDiffuse, finalSpecular, norm, ecPos, eye, lights[i] );      }      else if( lights[i].type == 3 ) {        SpotLight( finalDiffuse, finalSpecular, norm, ecPos, eye, lights[i] );      }    }   if( usingMat == false ) {    frontColor = vec4(        vec3(col) * finalAmbient +      vec3(col) * finalDiffuse +      vec3(col) * finalSpecular,      col[3] );   }   else{     frontColor = vec4(        mat_emissive +        (vec3(col) * mat_ambient * finalAmbient) +        (vec3(col) * finalDiffuse) +        (mat_specular * finalSpecular),        col[3] );    }  }  vTexture.xy = aTexture.xy;  gl_Position = projection * view * model * vec4( Vertex, 1.0 );}",fragmentShaderSource3D="#ifdef GL_ES\nprecision highp float;\n#endif\nvarying vec4 frontColor;uniform sampler2D sampler;uniform bool usingTexture;varying vec2 vTexture;void main(void){  if(usingTexture){    gl_FragColor =  vec4(texture2D(sampler, vTexture.xy));  }  else{    gl_FragColor = frontColor;  }}",imageModeCorner=function imageModeCorner(a,b,c,d,e){return{x:a,y:b,w:c,h:d}},imageModeConvert=imageModeCorner,imageModeCorners=function imageModeCorners(a,b,c,d,e){return{x:a,y:b,w:e?c:c-a,h:e?d:d-b}},imageModeCenter=function imageModeCenter(a,b,c,d,e){return{x:a-c/2,y:b-d/2,w:c,h:d}},createProgramObject=function(a,b,c){var d=a.createShader(a.VERTEX_SHADER);a.shaderSource(d,b),a.compileShader(d);if(!a.getShaderParameter(d,a.COMPILE_STATUS))throw a.getShaderInfoLog(d);var e=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(e,c),a.compileShader(e);if(!a.getShaderParameter(e,a.COMPILE_STATUS))throw a.getShaderInfoLog(e);var f=a.createProgram();a.attachShader(f,d),a.attachShader(f,e),a.linkProgram(f);if(!a.getProgramParameter(f,a.LINK_STATUS))throw"Error linking shaders.";return f},charMap={},Char=p.Character=function Char(a){typeof a=="string"&&a.length===1?this.code=a.charCodeAt(0):this.code=NaN;return charMap[this.code]===undef?charMap[this.code]=this:charMap[this.code]};Char.prototype.toString=function(){return String.fromCharCode(this.code)},Char.prototype.valueOf=function(){return this.code};var PShape=p.PShape=function(a){this.family=a||PConstants.GROUP,this.visible=!0,this.style=!0,this.children=[],this.nameTable=[],this.params=[],this.name="",this.image=null,this.matrix=null,this.kind=null,this.close=null,this.width=null,this.height=null,this.parent=null,this.isVisible=function(){return this.visible},this.setVisible=function(a){this.visible=a},this.disableStyle=function(){this.style=!1;for(var a=0;a<this.children.length;a++)this.children[a].disableStyle()},this.enableStyle=function(){this.style=!0;for(var a=0;a<this.children.length;a++)this.children[a].enableStyle()},this.getFamily=function(){return this.family},this.getWidth=function(){return this.width},this.getHeight=function(){return this.height},this.setName=function(a){this.name=a},this.getName=function(){return this.name},this.draw=function(){this.visible&&(this.pre(),this.drawImpl(),this.post())},this.drawImpl=function(){this.family===PConstants.GROUP?this.drawGroup():this.family===PConstants.PRIMITIVE?this.drawPrimitive():this.family===PConstants.GEOMETRY?this.drawGeometry():this.family===PConstants.PATH&&this.drawPath()},this.drawPath=function(){if(this.vertices.length!==0){p.beginShape();var a;if(this.vertexCodes.length===0)if(this.vertices[0].length===2)for(a=0;a<this.vertices.length;a++)p.vertex(this.vertices[a][0],this.vertices[a][1]);else for(a=0;a<this.vertices.length;a++)p.vertex(this.vertices[a][0],this.vertices[a][1],this.vertices[a][2]);else{var b=0,c;if(this.vertices[0].length===2)for(c=0;c<this.vertexCodes.length;c++)switch(this.vertexCodes[c]){case PConstants.VERTEX:p.vertex(this.vertices[b][0],this.vertices[b][1]),this.vertices[b].moveTo===!0?vertArray[vertArray.length-1].moveTo=!0:this.vertices[b].moveTo===!1&&(vertArray[vertArray.length-1].moveTo=!1),p.breakShape=!1,b++;break;case PConstants.BEZIER_VERTEX:p.bezierVertex(this.vertices[b+0][0],this.vertices[b+0][1],this.vertices[b+1][0],this.vertices[b+1][1],this.vertices[b+2][0],this.vertices[b+2][1]),b+=3;break;case PConstants.CURVE_VERTEX:p.curveVertex(this.vertices[b][0],this.vertices[b][1]),b++;break;case PConstants.BREAK:p.breakShape=!0}else for(c=0;c<this.vertexCodes.length;c++)switch(this.vertexCodes[c]){case PConstants.VERTEX:p.vertex(this.vertices[b][0],this.vertices[b][1],this.vertices[b][2]),this.vertices[b].moveTo===!0?vertArray[vertArray.length-1].moveTo=!0:this.vertices[b].moveTo===!1&&(vertArray[vertArray.length-1].moveTo=!1),p.breakShape=!1;break;case PConstants.BEZIER_VERTEX:p.bezierVertex(this.vertices[b+0][0],this.vertices[b+0][1],this.vertices[b+0][2],this.vertices[b+1][0],this.vertices[b+1][1],this.vertices[b+1][2],this.vertices[b+2][0],this.vertices[b+2][1],this.vertices[b+2][2]),b+=3;break;case PConstants.CURVE_VERTEX:p.curveVertex(this.vertices[b][0],this.vertices[b][1],this.vertices[b][2]),b++;break;case PConstants.BREAK:p.breakShape=!0}}p.endShape(this.close?PConstants.CLOSE:PConstants.OPEN)}},this.drawGeometry=function(){p.beginShape(this.kind);var a;if(this.style)for(a=0;a<this.vertices.length;a++)p.vertex(this.vertices[a]);else for(a=0;a<this.vertices.length;a++){var b=this.vertices[a];b[2]===0?p.vertex(b[0],b[1]):p.vertex(b[0],b[1],b[2])}p.endShape()},this.drawGroup=function(){for(var a=0;a<this.children.length;a++)this.children[a].draw()},this.drawPrimitive=function(){switch(this.kind){case PConstants.POINT:p.point(this.params[0],this.params[1]);break;case PConstants.LINE:this.params.length===4?p.line(this.params[0],this.params[1],this.params[2],this.params[3]):p.line(this.params[0],this.params[1],this.params[2],this.params[3],this.params[4],this.params[5]);break;case PConstants.TRIANGLE:p.triangle(this.params[0],this.params[1],this.params[2],this.params[3],this.params[4],this.params[5]);break;case PConstants.QUAD:p.quad(this.params[0],this.params[1],this.params[2],this.params[3],this.params[4],this.params[5],this.params[6],this.params[7]);break;case PConstants.RECT:this.image!==null?(p.imageMode(PConstants.CORNER),p.image(this.image,this.params[0],this.params[1],this.params[2],this.params[3])):(p.rectMode(PConstants.CORNER),p.rect(this.params[0],this.params[1],this.params[2],this.params[3]));break;case PConstants.ELLIPSE:p.ellipseMode(PConstants.CORNER),p.ellipse(this.params[0],this.params[1],this.params[2],this.params[3]);break;case PConstants.ARC:p.ellipseMode(PConstants.CORNER),p.arc(this.params[0],this.params[1],this.params[2],this.params[3],this.params[4],this.params[5]);break;case PConstants.BOX:this.params.length===1?p.box(this.params[0]):p.box(this.params[0],this.params[1],this.params[2]);break;case PConstants.SPHERE:p.sphere(this.params[0])}},this.pre=function(){this.matrix&&(p.pushMatrix(),curContext.transform(this.matrix.elements[0],this.matrix.elements[3],this.matrix.elements[1],this.matrix.elements[4],this.matrix.elements[2],this.matrix.elements[5])),this.style&&(p.pushStyle(),this.styles())},this.post=function(){this.matrix&&p.popMatrix(),this.style&&p.popStyle()},this.styles=function(){this.stroke?(p.stroke(this.strokeColor),p.strokeWeight(this.strokeWeight),p.strokeCap(this.strokeCap),p.strokeJoin(this.strokeJoin)):p.noStroke(),this.fill?p.fill(this.fillColor):p.noFill()},this.getChild=function(){if(typeof arguments[0]=="number")return this.children[arguments[0]];var a,b;if(arguments[0]===""||this.name===arguments[0])return this;if(this.nameTable.length>0){for(b=0;b<this.nameTable.length||a;b++)this.nameTable[b].getName===arguments[0]&&(a=this.nameTable[b]);if(a)return a}for(b=0;b<this.children.lenth;b++){a=this.children[b].getChild(arguments[0]);if(a)return a}return null},this.getChildCount=function(){return this.children.length},this.addChild=function(a){this.children.push(a),a.parent=this,a.getName()!==null&&this.addName(a.getName(),a)},this.addName=function(a,b){this.parent!==null?this.parent.addName(a,b):this.nameTable.push([a,b])},this.translate=function(){arguments.length===2?(this.checkMatrix(2),this.matrix.translate(arguments[0],arguments[1])):(this.checkMatrix(3),this.matrix.translate(arguments[0],arguments[1],0))},this.checkMatrix=function(a){this.matrix===null?a===2?this.matrix=new p.PMatrix2D:this.matrix=new p.PMatrix3D:a===3&&this.matrix instanceof p.PMatrix2D&&(this.matrix=new p.PMatrix3D)},this.rotateX=function(a){this.rotate(a,1,0,0)},this.rotateY=function(a){this.rotate(a,0,1,0)},this.rotateZ=function(a){this.rotate(a,0,0,1)},this.rotate=function(){arguments.length===1?(this.checkMatrix(2),this.matrix.rotate(arguments[0])):(this.checkMatrix(3),this.matrix.rotate(arguments[0],arguments[1],arguments[2],arguments[3]))},this.scale=function(){arguments.length===2?(this.checkMatrix(2),this.matrix.scale(arguments[0],arguments[1])):arguments.length===3?(this.checkMatrix(2),this.matrix.scale(arguments[0],arguments[1],arguments[2])):(this.checkMatrix(2),this.matrix.scale(arguments[0]))},this.resetMatrix=function(){this.checkMatrix(2),this.matrix.reset()},this.applyMatrix=function(a){arguments.length===1?this.applyMatrix(a.elements[0],a.elements[1],0,a.elements[2],a.elements[3],a.elements[4],0,a.elements[5],0,0,1,0,0,0,0,1):arguments.length===6?(this.checkMatrix(2),this.matrix.apply(arguments[0],arguments[1],arguments[2],0,arguments[3],arguments[4],arguments[5],0,0,0,1,0,0,0,0,1)):arguments.length===16&&(this.checkMatrix(3),this.matrix.apply(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11],arguments[12],arguments[13],arguments[14],arguments[15]))}},PShapeSVG=p.PShapeSVG=function(){p.PShape.call(this);if(arguments.length===1){this.element=arguments[0],this.vertexCodes=[],this.vertices=[],this.opacity=1,this.stroke=!1,this.strokeColor=PConstants.ALPHA_MASK,this.strokeWeight=1,this.strokeCap=PConstants.SQUARE,this.strokeJoin=PConstants.MITER,this.strokeGradient=null,this.strokeGradientPaint=null,this.strokeName=null,this.strokeOpacity=1,this.fill=!0,this.fillColor=PConstants.ALPHA_MASK,this.fillGradient=null,this.fillGradientPaint=null,this.fillName=null,this.fillOpacity=1;if(this.element.getName()!=="svg")throw"root is not <svg>, it's <"+this.element.getName()+">"}else arguments.length===2&&(typeof arguments[1]=="string"?arguments[1].indexOf(".svg")>-1&&(this.element=new p.XMLElement(null,arguments[1]),this.vertexCodes=[],this.vertices=[],this.opacity=1,this.stroke=!1,this.strokeColor=PConstants.ALPHA_MASK,this.strokeWeight=1,this.strokeCap=PConstants.SQUARE,this.strokeJoin=PConstants.MITER,this.strokeGradient="",this.strokeGradientPaint="",this.strokeName="",this.strokeOpacity=1,this.fill=!0,this.fillColor=PConstants.ALPHA_MASK,this.fillGradient=null,this.fillGradientPaint=null,this.fillOpacity=1):arguments[0]&&(this.element=arguments[1],this.vertexCodes=arguments[0].vertexCodes.slice(),this.vertices=arguments[0].vertices.slice(),this.stroke=arguments[0].stroke,this.strokeColor=arguments[0].strokeColor,this.strokeWeight=arguments[0].strokeWeight,this.strokeCap=arguments[0].strokeCap,this.strokeJoin=arguments[0].strokeJoin,this.strokeGradient=arguments[0].strokeGradient,this.strokeGradientPaint=arguments[0].strokeGradientPaint,this.strokeName=arguments[0].strokeName,this.fill=arguments[0].fill,this.fillColor=arguments[0].fillColor,this.fillGradient=arguments[0].fillGradient,this.fillGradientPaint=arguments[0].fillGradientPaint,this.fillName=arguments[0].fillName,this.strokeOpacity=arguments[0].strokeOpacity,this.fillOpacity=arguments[0].fillOpacity,this.opacity=arguments[0].opacity));this.name=this.element.getStringAttribute("id");var a=this.element.getStringAttribute("display","inline");this.visible=a!=="none";var b=this.element.getAttribute("transform");b&&(this.matrix=this.parseMatrix(b));var c=this.element.getStringAttribute("viewBox");if(c!==null){var d=c.split(" ");this.width=d[2],this.height=d[3]}var e=this.element.getStringAttribute("width"),f=this.element.getStringAttribute("height");if(e!==null)this.width=this.parseUnitSize(e),this.height=this.parseUnitSize(f);else if(this.width===0||this.height===0){this.width=1,this.height=1;throw"The width and/or height is not readable in the <svg> tag of this file."}this.parseColors(this.element),this.parseChildren(this.element)};PShapeSVG.prototype={parseMatrix:function(a){this.checkMatrix(2);var b=[];a.replace(/\s*(\w+)\((.*?)\)/g,function(a){b.push(p.trim(a))});if(b.length===0){p.println("Transformation:"+a+" is empty");return null}for(var c=0;c<b.length;c++){var d=[];b[c].replace(/\((.*?)\)/,function(){return function(a,b){d=b.replace(/,+/g," ").split(/\s+/)}}());if(b[c].indexOf("matrix")!==-1)this.matrix.set(d[0],d[2],d[4],d[1],d[3],d[5]);else if(b[c].indexOf("translate")!==-1){var e=d[0],f=d.length===2?d[1]:0;this.matrix.translate(e,f)}else if(b[c].indexOf("scale")!==-1){var g=d[0],h=d.length===2?d[1]:d[0];this.matrix.scale(g,h)}else if(b[c].indexOf("rotate")!==-1){var i=d[0];d.length===1?this.matrix.rotate(p.radians(i)):d.length===3&&(this.matrix.translate(d[1],d[2]),this.matrix.rotate(p.radians(d[0])),this.matrix.translate(-d[1],-d[2]))}else b[c].indexOf("skewX")!==-1?this.matrix.skewX(parseFloat(d[0])):b[c].indexOf("skewY")!==-1&&this.matrix.skewY(d[0])}return this.matrix},parseChildren:function(a){var b=a.getChildren(),c=new p.PShape;for(var d=0;d<b.length;d++){var e=this.parseChild(b[d]);e&&c.addChild(e)}this.children.push(c)},getName:function(){return this.name},parseChild:function(a){var b=a.getName(),c;switch(b){case"g":c=new PShapeSVG(this,a);break;case"defs":c=new PShapeSVG(this,a);break;case"line":c=new PShapeSVG(this,a),c.parseLine();break;case"circle":c=new PShapeSVG(this,a),c.parseEllipse(!0);break;case"ellipse":c=new PShapeSVG(this,a),c.parseEllipse(!1);break;case"rect":c=new PShapeSVG(this,a),c.parseRect();break;case"polygon":c=new PShapeSVG(this,a),c.parsePoly(!0);break;case"polyline":c=new PShapeSVG(this,a),c.parsePoly(!1);break;case"path":c=new PShapeSVG(this,a),c.parsePath();break;case"radialGradient":break;case"linearGradient":break;case"text":p.println("Text in SVG files is not currently supported, convert text to outlines instead.");break;case"filter":p.println("Filters are not supported.");break;case"mask":p.println("Masks are not supported.");break;default:p.println("Ignoring  <"+b+"> tag.")}return c},parsePath:function(){this.family=PConstants.PATH,this.kind=0;var a=[],b,c=p.trim(this.element.getStringAttribute("d").replace(/[\s,]+/g," "));if(c!==null){c=c.toCharArray();var d=0,e=0,f=0,g=0,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,q=0,r=0,s=0,t=0,u=0,v="",w=[],x=!1,y,z;while(s<c.length){u=c[s].valueOf();if(u>=65&&u<=90||u>=97&&u<=122){t=s,s++;if(s<c.length){w=[],u=c[s].valueOf();while(!(u>=65&&u<=90||u>=97&&u<=100||u>=102&&u<=122)&&x===!1)u===32?(v!==""&&(w.push(parseFloat(v)),v=""),s++):u===45?c[s-1].valueOf()===101?(v+=c[s].toString(),s++):(v!==""&&w.push(parseFloat(v)),v=c[s].toString(),s++):(v+=c[s].toString(),s++),s===c.length?x=!0:u=c[s].valueOf()}v!==""&&(w.push(parseFloat(v)),v=""),z=c[t];switch(z.valueOf()){case 77:if(w.length>=2&&w.length%2===0){d=w[0],e=w[1],this.parsePathMoveto(d,e);if(w.length>2)for(t=2;t<w.length;t+=2)d=w[t],e=w[t+1],this.parsePathLineto(d,e)}break;case 109:if(w.length>=2&&w.length%2===0){d+=w[0],e+=w[1],this.parsePathMoveto(d,e);if(w.length>2)for(t=2;t<w.length;t+=2)d+=w[t],e+=w[t+1],this.parsePathLineto(d,e)}break;case 76:if(w.length>=2&&w.length%2===0)for(t=0;t<w.length;t+=2)d=w[t],e=w[t+1],this.parsePathLineto(d,e);break;case 108:if(w.length>=2&&w.length%2===0)for(t=0;t<w.length;t+=2)d+=w[t],e+=w[t+1],this.parsePathLineto(d,e);break;case 72:for(t=0;t<w.length;t++)d=w[t],this.parsePathLineto(d,e);break;case 104:for(t=0;t<w.length;t++)d+=w[t],this.parsePathLineto(d,e);break;case 86:for(t=0;t<w.length;t++)e=w[t],this.parsePathLineto(d,e);break;case 118:for(t=0;t<w.length;t++)e+=w[t],this.parsePathLineto(d,e);break;case 67:if(w.length>=6&&w.length%6===0)for(t=0;t<w.length;t+=6)h=w[t],j=w[t+1],i=w[t+2],k=w[t+3],l=w[t+4],m=w[t+5],this.parsePathCurveto(h,j,i,k,l,m),d=l,e=m;break;case 99:if(w.length>=6&&w.length%6===0)for(t=0;t<w.length;t+=6)h=d+w[t],j=e+w[t+1],i=d+w[t+2],k=e+w[t+3],l=d+w[t+4],m=e+w[t+5],this.parsePathCurveto(h,j,i,k,l,m),d=l,e=m;break;case 83:if(w.length>=4&&w.length%4===0)for(t=0;t<w.length;t+=4)y.toLowerCase()==="c"||y.toLowerCase()==="s"?(n=this.vertices[this.vertices.length-2][0],o=this.vertices[this.vertices.length-2][1],q=this.vertices[this.vertices.length-1][0],r=this.vertices[this.vertices.length-1][1],h=q+(q-n),j=r+(r-o)):(h=this.vertices[this.vertices.length-1][0],j=this.vertices[this.vertices.length-1][1]),i=w[t],k=w[t+1],l=w[t+2],m=w[t+3],this.parsePathCurveto(h,j,i,k,l,m),d=l,e=m;break;case 115:if(w.length>=4&&w.length%4===0)for(t=0;t<w.length;t+=4)y.toLowerCase()==="c"||y.toLowerCase()==="s"?(n=this.vertices[this.vertices.length-2][0],o=this.vertices[this.vertices.length-2][1],q=this.vertices[this.vertices.length-1][0],r=this.vertices[this.vertices.length-1][1],h=q+(q-n),j=r+(r-o)):(h=this.vertices[this.vertices.length-1][0],j=this.vertices[this.vertices.length-1][1]),i=d+w[t],k=e+w[t+1],l=d+w[t+2],m=e+w[t+3],this.parsePathCurveto(h,j,i,k,l,m),d=l,e=m;break;case 81:if(w.length>=4&&w.length%4===0)for(t=0;t<w.length;t+=4)f=w[t],g=w[t+1],l=w[t+2],m=w[t+3],this.parsePathQuadto(d,e,f,g,l,m),d=l,e=m;break;case 113:if(w.length>=4&&w.length%4===0)for(t=0;t<w.length;t+=4)f=d+w[t],g=e+w[t+1],l=d+w[t+2],m=e+w[t+3],this.parsePathQuadto(d,e,f,g,l,m),d=l,e=m;break;case 84:if(w.length>=2&&w.length%2===0)for(t=0;t<w.length;t+=2)y.toLowerCase()==="q"||y.toLowerCase()==="t"?(n=this.vertices[this.vertices.length-2][0],o=this.vertices[this.vertices.length-2][1],q=this.vertices[this.vertices.length-1][0],r=this.vertices[this.vertices.length-1][1],f=q+(q-n),g=r+(r-o)):(f=d,g=e),l=w[t],m=w[t+1],this.parsePathQuadto(d,e,f,g,l,m),d=l,e=m;break;case 116:if(w.length>=2&&w.length%2===0)for(t=0;t<w.length;t+=2)y.toLowerCase()==="q"||y.toLowerCase()==="t"?(n=this.vertices[this.vertices.length-2][0],o=this.vertices[this.vertices.length-2][1],q=this.vertices[this.vertices.length-1][0],r=this.vertices[this.vertices.length-1][1],f=q+(q-n),g=r+(r-o)):(f=d,g=e),l=d+w[t],m=e+w[t+1],this.parsePathQuadto(d,e,f,g,l,m),d=l,e=m;break;case 90:case 122:this.close=!0}y=z.toString()}else s++}}},parsePathQuadto:function(a,b,c,d,e,f){if(this.vertices.length>0)this.parsePathCode(PConstants.BEZIER_VERTEX),this.parsePathVertex(a+(c-a)*2/3,b+(d-b)*2/3),this.parsePathVertex(e+(c-e)*2/3,f+(d-f)*2/3),this.parsePathVertex(e,f);else throw"Path must start with M/m"},parsePathCurveto:function(a,b,c,d,e,f){if(this.vertices.length>0)this.parsePathCode(PConstants.BEZIER_VERTEX),this.parsePathVertex(a,b),this.parsePathVertex(c,d),this.parsePathVertex(e,f);else throw"Path must start with M/m"},parsePathLineto:function(a,b){if(this.vertices.length>0)this.parsePathCode(PConstants.VERTEX),this.parsePathVertex(a,b),this.vertices[this.vertices.length-1].moveTo=!1;else throw"Path must start with M/m"},parsePathMoveto:function(a,b){this.vertices.length>0&&this.parsePathCode(PConstants.BREAK),this.parsePathCode(PConstants.VERTEX),this.parsePathVertex(a,b),this.vertices[this.vertices.length-1].moveTo=!0},parsePathVertex:function(a,b){var c=[];c[0]=a,c[1]=b,this.vertices.push(c)},parsePathCode:function(a){this.vertexCodes.push(a)},parsePoly:function(a){this.family=PConstants.PATH,this.close=a;var b=p.trim(this.element.getStringAttribute("points").replace(/[,\s]+/g," "));if(b!==null){var c=b.split(" ");if(c.length%2===0)for(var d=0;d<c.length;d++){var e=[];e[0]=c[d],e[1]=c[++d],this.vertices.push(e)}else p.println("Error parsing polygon points: odd number of coordinates provided")}},parseRect:function(){this.kind=PConstants.RECT,this.family=PConstants.PRIMITIVE,this.params=[],this.params[0]=this.element.getFloatAttribute("x"),this.params[1]=this.element.getFloatAttribute("y"),this.params[2]=this.element.getFloatAttribute("width"),this.params[3]=this.element.getFloatAttribute("height");if(this.params[2]<0||this.params[3]<0)throw"svg error: negative width or height found while parsing <rect>"},parseEllipse:function(a){this.kind=PConstants.ELLIPSE,this.family=PConstants.PRIMITIVE,this.params=[],this.params[0]=this.element.getFloatAttribute("cx")|0,this.params[1]=this.element.getFloatAttribute("cy")|0;var b,c;if(a){b=c=this.element.getFloatAttribute("r");if(b<0)throw"svg error: negative radius found while parsing <circle>"}else{b=this.element.getFloatAttribute("rx"),c=this.element.getFloatAttribute("ry");if(b<0||c<0)throw"svg error: negative x-axis radius or y-axis radius found while parsing <ellipse>"}this.params[0]-=b,this.params[1]-=c,this.params[2]=b*2,this.params[3]=c*2},parseLine:function(){this.kind=PConstants.LINE,this.family=PConstants.PRIMITIVE,this.params=[],this.params[0]=this.element.getFloatAttribute("x1"),this.params[1]=this.element.getFloatAttribute("y1"),this.params[2]=this.element.getFloatAttribute("x2"),this.params[3]=this.element.getFloatAttribute("y2")},parseColors:function(a){a.hasAttribute("opacity")&&this.setOpacity(a.getAttribute("opacity")),a.hasAttribute("stroke")&&this.setStroke(a.getAttribute("stroke")),a.hasAttribute("stroke-width")&&this.setStrokeWeight(a.getAttribute("stroke-width")),a.hasAttribute("stroke-linejoin")&&this.setStrokeJoin(a.getAttribute("stroke-linejoin")),a.hasAttribute("stroke-linecap")&&this.setStrokeCap(a.getStringAttribute("stroke-linecap")),a.hasAttribute("fill")&&this.setFill(a.getStringAttribute("fill"));if(a.hasAttribute("style")){var b=a.getStringAttribute("style"),c=b.toString().split(";");for(var d=0;d<c.length;d++){var e=p.trim(c[d].split(":"));switch(e[0]){case"fill":this.setFill(e[1]);break;case"fill-opacity":this.setFillOpacity(e[1]);break;case"stroke":this.setStroke(e[1]);break;case"stroke-width":this.setStrokeWeight(e[1]);break;case"stroke-linecap":this.setStrokeCap(e[1]);break;case"stroke-linejoin":this.setStrokeJoin(e[1]);break;case"stroke-opacity":this.setStrokeOpacity(e[1]);break;case"opacity":this.setOpacity(e[1])}}}},setFillOpacity:function(a){this.fillOpacity=parseFloat(a),this.fillColor=this.fillOpacity*255<<24|this.fillColor&16777215},setFill:function(a){var b=this.fillColor&4278190080;a==="none"?this.fill=!1:a.indexOf("#")===0?(this.fill=!0,a.length===4&&(a=a.replace(/#(.)(.)(.)/,"#$1$1$2$2$3$3")),this.fillColor=b|parseInt(a.substring(1),16)&16777215):a.indexOf("rgb")===0?(this.fill=!0,this.fillColor=b|this.parseRGB(a)):a.indexOf("url(#")===0?this.fillName=a.substring(5,a.length-1):colors[a]&&(this.fill=!0,this.fillColor=b|parseInt(colors[a].substring(1),16)&16777215)},setOpacity:function(a){this.strokeColor=parseFloat(a)*255<<24|this.strokeColor&16777215,this.fillColor=parseFloat(a)*255<<24|this.fillColor&16777215},setStroke:function(a){var b=this.strokeColor&4278190080;a==="none"?this.stroke=!1:a.charAt(0)==="#"?(this.stroke=!0,a.length===4&&(a=a.replace(/#(.)(.)(.)/,"#$1$1$2$2$3$3")),this.strokeColor=b|parseInt(a.substring(1),16)&16777215):a.indexOf("rgb")===0?(this.stroke=!0,this.strokeColor=b|this.parseRGB(a)):a.indexOf("url(#")===0?this.strokeName=a.substring(5,a.length-1):colors[a]&&(this.stroke=!0,this.strokeColor=b|parseInt(colors[a].substring(1),16)&16777215)},setStrokeWeight:function(a){this.strokeWeight=this.parseUnitSize(a)},setStrokeJoin:function(a){a==="miter"?this.strokeJoin=PConstants.MITER:a==="round"?this.strokeJoin=PConstants.ROUND:a==="bevel"&&(this.strokeJoin=PConstants.BEVEL)},setStrokeCap:function(a){a==="butt"?this.strokeCap=PConstants.SQUARE:a==="round"?this.strokeCap=PConstants.ROUND:a==="square"&&(this.strokeCap=PConstants.PROJECT)},setStrokeOpacity:function(a){this.strokeOpacity=parseFloat(a),this.strokeColor=this.strokeOpacity*255<<24|this.strokeColor&16777215},parseRGB:function(a){var b=a.substring(a.indexOf("(")+1,a.indexOf(")")),c=b.split(", ");return c[0]<<16|c[1]<<8|c[2]},parseUnitSize:function(a){var b=a.length-2;if(b<0)return a;return a.indexOf("pt")===b?parseFloat(a.substring(0,b))*1.25:a.indexOf("pc")===b?parseFloat(a.substring(0,b))*15:a.indexOf("mm")===b?parseFloat(a.substring(0,b))*3.543307:a.indexOf("cm")===b?parseFloat(a.substring(0,b))*35.43307:a.indexOf("in")===b?parseFloat(a.substring(0,b))*90:a.indexOf("px")===b?parseFloat(a.substring(0,b)):parseFloat(a)}},p.shape=function(a,b,c,d,e){arguments.length>=1&&arguments[0]!==null&&a.isVisible()&&(p.pushMatrix(),curShapeMode===PConstants.CENTER?arguments.length===5?(p.translate(b-d/2,c-e/2),p.scale(d/a.getWidth(),e/a.getHeight())):arguments.length===3?p.translate(b-a.getWidth()/2,-a.getHeight()/2):p.translate(-a.getWidth()/2,-a.getHeight()/2):curShapeMode===PConstants.CORNER?arguments.length===5?(p.translate(b,c),p.scale(d/a.getWidth(),e/a.getHeight())):arguments.length===3&&p.translate(b,c):curShapeMode===PConstants.CORNERS&&(arguments.length===5?(d-=b,e-=c,p.translate(b,c),p.scale(d/a.getWidth(),e/a.getHeight())):arguments.length===3&&p.translate(b,c)),a.draw(),(arguments.length===1&&curShapeMode===PConstants.CENTER||arguments.length>1)&&p.popMatrix())},p.shapeMode=function(a){curShapeMode=a},p.loadShape=function(a){if(arguments.length===1&&a.indexOf(".svg")>-1)return new PShapeSVG(null,a);return null};var XMLAttribute=function(a,b,c,d,e){this.fullName=a||"",this.name=b||"",this.namespace=c||"",this.value=d,this.type=e};XMLAttribute.prototype={getName:function(){return this.name},getFullName:function(){return this.fullName},getNamespace:function(){return this.namespace},getValue:function(){return this.value},getType:function(){return this.type},setValue:function(a){this.value=a}};var XMLElement=p.XMLElement=function(){if(arguments.length===4){this.attributes=[],this.children=[],this.fullName=arguments[0]||"";if(arguments[1])this.name=arguments[1];else{var a=this.fullName.indexOf(":");a>=0?this.name=this.fullName.substring(a+1):this.name=this.fullName}this.namespace=arguments[1],this.content="",this.lineNr=arguments[3],this.systemID=arguments[2],this.parent=null}else arguments.length===2&&arguments[1].indexOf(".")>-1?(this.attributes=[],this.children=[],this.fullName="",this.name="",this.namespace="",this.content="",this.systemID="",this.lineNr="",this.parent=null,this.parse(arguments[arguments.length-1])):arguments.length===1&&typeof arguments[0]=="string"?(this.attributes=[],this.children=[],this.fullName="",this.name="",this.namespace="",this.content="",this.systemID="",this.lineNr="",this.parent=null,this.parse(arguments[0])):(this.attributes=[],this.children=[],this.fullName="",this.name="",this.namespace="",this.content="",this.systemID="",this.lineNr="",this.parent=null);return this};XMLElement.prototype={parse:function(a){var b;try{if(a.indexOf(".xml")>-1||a.indexOf(".svg")>-1)a=ajax(a);b=(new DOMParser).parseFromString(a,"text/xml");var c=b.documentElement;if(c)this.parseChildrenRecursive(null,c);else throw"Error loading document";return this}catch(d){throw d}},createElement:function(){return arguments.length===2?new XMLElement(arguments[0],arguments[1],null,null):new XMLElement(arguments[0],arguments[1],arguments[2],arguments[3])},hasAttribute:function(){if(arguments.length===1)return this.getAttribute(arguments[0])!==null;if(arguments.length===2)return this.getAttribute(arguments[0],arguments[1])!==null},createPCDataElement:function(){return new XMLElement},equals:function(a){if(typeof a=="Object")return this.equalsXMLElement(a)},equalsXMLElement:function(a){if(a instanceof XMLElement){if(this.name!==a.getLocalName())return!1;if(this.attributes.length!==a.getAttributeCount())return!1;for(var b=0;b<this.attributes.length;b++){if(!a.hasAttribute(this.attributes[b].getName(),this.attributes[b].getNamespace()))return!1;if(this.attributes[b].getValue()!==a.attributes[b].getValue())return!1;if(this.attributes[b].getType()!==a.attributes[b].getType())return!1}if(this.children.length!==a.getChildCount())return!1;var c,d;for(b=0;b<this.children.length;b++){c=this.getChildAtIndex(b),d=a.getChildAtIndex(b);if(!c.equalsXMLElement(d))return!1}return!0}},getContent:function(){return this.content},getAttribute:function(){var a;if(arguments.length===2){a=this.findAttribute(arguments[0]);return a?a.getValue():arguments[1]}if(arguments.length===1){a=this.findAttribute(arguments[0]);return a?a.getValue():null}if(arguments.length===3){a=this.findAttribute(arguments[0],arguments[1]);return a?a.getValue():arguments[2]}},getStringAttribute:function(){return arguments.length===1?this.getAttribute(arguments[0]):arguments.length===2?this.getAttribute(arguments[0],arguments[1]):this.getAttribute(arguments[0],arguments[1],arguments[2])},getFloatAttribute:function(){return arguments.length===1?parseFloat(this.getAttribute(arguments[0],0)):arguments.length===2?this.getAttribute(arguments[0],arguments[1]):this.getAttribute(arguments[0],arguments[1],arguments[2])},getIntAttribute:function(){return arguments.length===1?this.getAttribute(arguments[0],0):arguments.length===2?this.getAttribute(arguments[0],arguments[1]):this.getAttribute(arguments[0],arguments[1],arguments[2])},hasChildren:function(){return this.children.length>0},addChild:function(a){a!==null&&(a.parent=this,this.children.push(a))},insertChild:function(a,b){if(a){if(a.getLocalName()===null&&!this.hasChildren()){var c=this.children[this.children.length-1];if(c.getLocalName()===null){c.setContent(c.getContent()+a.getContent());return}}a.parent=this,this.children.splice(b,0,a)}},getChild:function(){if(typeof arguments[0]=="number")return this.children[arguments[0]];if(arguments[0].indexOf("/")!==-1)this.getChildRecursive(arguments[0].split("/"),0);else{var a,b;for(var c=0;c<this.getChildCount();c++){a=this.getChild(c),b=a.getName();if(b!==null&&b===arguments[0])return a}return null}},getChildren:function(){if(arguments.length===1){if(typeof arguments[0]=="number")return this.getChild(arguments[0]);if(arguments[0].indexOf("/")!==-1)return this.getChildrenRecursive(arguments[0].split("/"),0);var a=[],b,c;for(var d=0;d<this.getChildCount();d++)b=this.getChild(d),c=b.getName(),c!==null&&c===arguments[0]&&a.push(b);return a}return this.children},getChildCount:function(){return this.children.length},getChildRecursive:function(a,b){var c,d;for(var e=0;e<this.getChildCount();e++){c=this.getChild(e),d=c.getName();if(d!==null&&d===a[b]){if(b===a.length-1)return c;b+=1;return c.getChildRecursive(a,b)}}return null},getChildrenRecursive:function(a,b){if(b===a.length-1)return this.getChildren(a[b]);var c=this.getChildren(a[b]),d;for(var e=0;e<c.length;e++)d=c[e].getChildrenRecursive(a,b+1);return d},parseChildrenRecursive:function(a,b){var c,d,e;a?(c=new XMLElement(b.localName,b.nodeName,"",""),c.content=b.textContent||"",c.parent=a):(this.fullName=b.localName,this.name=b.nodeName,this.content=b.textContent||"",c=this);for(var f=0;f<b.attributes.length;f++)e=b.attributes[f],d=new XMLAttribute(e.getname,e.nodeName,e.namespaceURI,e.nodeValue,e.nodeType),c.attributes.push(d);for(var g in b.childNodes)b.childNodes[g].nodeType===1&&c.children.push(c.parseChildrenRecursive(c,b.childNodes[g]));return c},isLeaf:function(){return!this.hasChildren()},listChildren:function(){var a=[];for(var b=0;b<this.children.length;b++)a.push(this.getChild(b).getName());return a},removeAttribute:function(a,b){this.namespace=b||"";for(var c=0;c<this.attributes.length;c++)this.attributes[c].getName()===a&&this.attributes[c].getNamespace()===this.namespace&&this.attributes.splice(c,1)},removeChild:function(a){if(a)for(var b=0;b<this.children.length;b++)this.children[b].equalsXMLElement(a)&&this.children.splice(b,1)},removeChildAtIndex:function(a){this.children.length>a&&this.children.splice(a,1)},findAttribute:function(a,b){this.namespace=b||"";for(var c=0;c<this.attributes.length;c++)if(this.attributes[c].getName()===a&&this.attributes[c].getNamespace()===this.namespace)return this.attributes[c]},setAttribute:function(){var a;if(arguments.length===3){var b=arguments[0].indexOf(":"),c=arguments[0].substring(b+1);a=this.findAttribute(c,arguments[1]),a?a.setValue(arguments[2]):(a=new XMLAttribute(arguments[0],c,arguments[1],arguments[2],"CDATA"),this.attributes.push(a))}else a=this.findAttribute(arguments[0]),a?a.setValue(arguments[1]):(a=new XMLAttribute(arguments[0],arguments[0],null,arguments[1],"CDATA"),this.attributes.push(a))},setContent:function(a){this.content=a},setName:function(){if(arguments.length===1)this.name=arguments[0],this.fullName=arguments[0],this.namespace=null;else{var a=arguments[0].indexOf(":");arguments[1]===null||a<0?this.name=arguments[0]:this.name=arguments[0].substring(a+1),this.fullName=arguments[0],this.namespace=arguments[1]}},getName:function(){return this.fullName},getLocalName:function(){return this.name},getAttributeCount:function(){return this.attributes.length}};var printMatrixHelper=function printMatrixHelper(a){var b=0;for(var c=0;c<a.length;c++)c!==0?b=Math.max(b,Math.abs(a[c])):b=Math.abs(a[c]);var d=(b+"").indexOf(".");d===0?d=1:d===-1&&(d=(b+"").length);return d},PMatrix2D=p.PMatrix2D=function(){arguments.length===0?this.reset():arguments.length===1&&arguments[0]instanceof PMatrix2D?this.set(arguments[0].array()):arguments.length===6&&this.set(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])};PMatrix2D.prototype={set:function(){if(arguments.length===6){var a=arguments;this.set([a[0],a[1],a[2],a[3],a[4],a[5]])}else arguments.length===1&&arguments[0]instanceof PMatrix2D?this.elements=arguments[0].array():arguments.length===1&&arguments[0]instanceof Array&&(this.elements=arguments[0].slice())},get:function(){var a=new PMatrix2D;a.set(this.elements);return a},reset:function(){this.set([1,0,0,0,1,0])},array:function(){return this.elements.slice()},translate:function(a,b){this.elements[2]=a*this.elements[0]+b*this.elements[1]+this.elements[2],this.elements[5]=a*this.elements[3]+b*this.elements[4]+this.elements[5]},transpose:function(){},mult:function(a,b){var c,d;a instanceof PVector?(c=a.x,d=a.y,b||(b=new PVector)):a instanceof Array&&(c=a[0],d=a[1],b||(b=[])),b instanceof Array?(b[0]=this.elements[0]*c+this.elements[1]*d+this.elements[2],b[1]=this.elements[3]*c+this.elements[4]*d+this.elements[5]):b instanceof PVector&&(b.x=this.elements[0]*c+this.elements[1]*d+this.elements[2],b.y=this.elements[3]*c+this.elements[4]*d+this.elements[5],b.z=0);return b},multX:function(a,b){return a*this.elements[0]+b*this.elements[1]+this.elements[2]},multY:function(a,b){return a*this.elements[3]+b*this.elements[4]+this.elements[5]},skewX:function(a){this.apply(1,0,1,a,0,0)},skewY:function(a){this.apply(1,0,1,0,a,0)},determinant:function(){return this.elements[0]*this.elements[4]-this.elements[1]*this.elements[3]},invert:function(){var a=this.determinant();if(Math.abs(a)>PConstants.MIN_INT){var b=this.elements[0],c=this.elements[1],d=this.elements[2],e=this.elements[3],f=this.elements[4],g=this.elements[5];this.elements[0]=f/a,this.elements[3]=-e/a,this.elements[1]=-c/a,this.elements[4]=b/a,this.elements[2]=(c*g-f*d)/a,this.elements[5]=(e*d-b*g)/a;return!0}return!1},scale:function(a,b){a&&!b&&(b=a),a&&b&&(this.elements[0]*=a,this.elements[1]*=b,this.elements[3]*=a,this.elements[4]*=b)},apply:function(){var a;arguments.length===1&&arguments[0]instanceof PMatrix2D?a=arguments[0].array():arguments.length===6?a=Array.prototype.slice.call(arguments):arguments.length===1&&arguments[0]instanceof Array&&(a=arguments[0]);var b=[0,0,this.elements[2],0,0,this.elements[5]],c=0;for(var d=0;d<2;d++)for(var e=0;e<3;e++,c++)b[c]+=this.elements[d*3+0]*a[e+0]+this.elements[d*3+1]*a[e+3];this.elements=b.slice()},preApply:function(){var a;arguments.length===1&&arguments[0]instanceof PMatrix2D?a=arguments[0].array():arguments.length===6?a=Array.prototype.slice.call(arguments):arguments.length===1&&arguments[0]instanceof Array&&(a=arguments[0]);var b=[0,0,a[2],0,0,a[5]];b[2]=a[2]+this.elements[2]*a[0]+this.elements[5]*a[1],b[5]=a[5]+this.elements[2]*a[3]+this.elements[5]*a[4],b[0]=this.elements[0]*a[0]+this.elements[3]*a[1],b[3]=this.elements[0]*a[3]+this.elements[3]*a[4],b[1]=this.elements[1]*a[0]+this.elements[4]*a[1],b[4]=this.elements[1]*a[3]+this.elements[4]*a[4],this.elements=b.slice()},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=this.elements[0],e=this.elements[1];this.elements[0]=b*d+c*e,this.elements[1]=-c*d+b*e,d=this.elements[3],e=this.elements[4],this.elements[3]=b*d+c*e,this.elements[4]=-c*d+b*e},rotateZ:function(a){this.rotate(a)},print:function(){var a=printMatrixHelper(this.elements),b=""+p.nfs(this.elements[0],a,4)+" "+p.nfs(this.elements[1],a,4)+" "+p.nfs(this.elements[2],a,4)+"\n"+p.nfs(this.elements[3],a,4)+" "+p.nfs(this.elements[4],a,4)+" "+p.nfs(this.elements[5],a,4)+"\n\n";p.println(b)}};var PMatrix3D=p.PMatrix3D=function PMatrix3D(){this.reset()};PMatrix3D.prototype={set:function(){arguments.length===16?this.elements=Array.prototype.slice.call(arguments):arguments.length===1&&arguments[0]instanceof PMatrix3D?this.elements=arguments[0].array():arguments.length===1&&arguments[0]instanceof Array&&(this.elements=arguments[0].slice())},get:function(){var a=new PMatrix3D;a.set(this.elements);return a},reset:function(){this.set([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},array:function(){return this.elements.slice()},translate:function(a,b,c){c===undef&&(c=0),this.elements[3]+=a*this.elements[0]+b*this.elements[1]+c*this.elements[2],this.elements[7]+=a*this.elements[4]+b*this.elements[5]+c*this.elements[6],this.elements[11]+=a*this.elements[8]+b*this.elements[9]+c*this.elements[10],this.elements[15]+=a*this.elements[12]+b*this.elements[13]+c*this.elements[14]},transpose:function(){var a=this.elements.slice();this.elements[0]=a[0],this.elements[1]=a[4],this.elements[2]=a[8],this.elements[3]=a[12],this.elements[4]=a[1],this.elements[5]=a[5],this.elements[6]=a[9],this.elements[7]=a[13],this.elements[8]=a[2],this.elements[9]=a[6],this.elements[10]=a[10],this.elements[11]=a[14],this.elements[12]=a[3],this.elements[13]=a[7],this.elements[14]=a[11],this.elements[15]=a[15]},mult:function(a,b){var c,d,e,f;if(a instanceof PVector)c=a.x,d=a.y,e=a.z,f=1,b||(b=new PVector);else if(a instanceof Array){c=a[0],d=a[1],e=a[2],f=a[3]||1;if(!b||b.length!==3&&b.length!==4)b=[0,0,0]}b instanceof Array&&(b.length===3?(b[0]=this.elements[0]*c+this.elements[1]*d+this.elements[2]*e+this.elements[3],b[1]=this.elements[4]*c+this.elements[5]*d+this.elements[6]*e+this.elements[7],b[2]=this.elements[8]*c+this.elements[9]*d+this.elements[10]*e+this.elements[11]):b.length===4&&(b[0]=this.elements[0]*c+this.elements[1]*d+this.elements[2]*e+this.elements[3]*f,b[1]=this.elements[4]*c+this.elements[5]*d+this.elements[6]*e+this.elements[7]*f,b[2]=this.elements[8]*c+this.elements[9]*d+this.elements[10]*e+this.elements[11]*f,b[3]=this.elements[12]*c+this.elements[13]*d+this.elements[14]*e+this.elements[15]*f)),b instanceof PVector&&(b.x=this.elements[0]*c+this.elements[1]*d+this.elements[2]*e+this.elements[3],b.y=this.elements[4]*c+this.elements[5]*d+this.elements[6]*e+this.elements[7],b.z=this.elements[8]*c+this.elements[9]*d+this.elements[10]*e+this.elements[11]);return b},preApply:function(){var a;arguments.length===1&&arguments[0]instanceof PMatrix3D?a=arguments[0].array():arguments.length===16?a=Array.prototype.slice.call(arguments):arguments.length===1&&arguments[0]instanceof Array&&(a=arguments[0]);var b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=0;for(var d=0;d<4;d++)for(var e=0;e<4;e++,c++)b[c]+=this.elements[e+0]*a[d*4+0]+this.elements[e+4]*a[d*4+1]+this.elements[e+8]*a[d*4+2]+this.elements[e+12]*a[d*4+3];this.elements=b.slice()},apply:function(){var a;arguments.length===1&&arguments[0]instanceof PMatrix3D?a=arguments[0].array():arguments.length===16?a=Array.prototype.slice.call(arguments):arguments.length===1&&arguments[0]instanceof Array&&(a=arguments[0]);var b=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c=0;for(var d=0;d<4;d++)for(var e=0;e<4;e++,c++)b[c]+=this.elements[d*4+0]*a[e+0]+this.elements[d*4+1]*a[e+4]+this.elements[d*4+2]*a[e+8]+this.elements[d*4+3]*a[e+12];this.elements=b.slice()},rotate:function(a,b,c,d){if(!c)this.rotateZ(a);else{var e=p.cos(a),f=p.sin(a),g=1-e;this.apply(g*b*b+e,g*b*c-f*d,g*b*d+f*c,0,g*b*c+f*d,g*c*c+e,g*c*d-f*b,0,g*b*d-f*c,g*c*d+f*b,g*d*d+e,0,0,0,0,1)}},invApply:function(){inverseCopy===undef&&(inverseCopy=new PMatrix3D);var a=arguments;inverseCopy.set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]);if(!inverseCopy.invert())return!1;this.preApply(inverseCopy);return!0},rotateX:function(a){var b=p.cos(a),c=p.sin(a);this.apply([1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1])},rotateY:function(a){var b=p.cos(a),c=p.sin(a);this.apply([b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1])},rotateZ:function(a){var b=Math.cos(a),c=Math.sin(a);this.apply([b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1])},scale:function(a,b,c){a&&!b&&!c?b=c=a:a&&b&&!c&&(c=1),a&&b&&c&&(this.elements[0]*=a,this.elements[1]*=b,this.elements[2]*=c,this.elements[4]*=a,this.elements[5]*=b,this.elements[6]*=c,this.elements[8]*=a,this.elements[9]*=b,this.elements[10]*=c,this.elements[12]*=a,this.elements[13]*=b,this.elements[14]*=c)},skewX:function(a){var b=Math.tan(a);this.apply(1,b,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},skewY:function(a){var b=Math.tan(a);this.apply(1,0,0,0,b,1,0,0,0,0,1,0,0,0,0,1)},multX:function(a,b,c,d){return c?d?this.elements[0]*a+this.elements[1]*b+this.elements[2]*c+this.elements[3]*d:this.elements[0]*a+this.elements[1]*b+this.elements[2]*c+this.elements[3]:this.elements[0]*a+this.elements[1]*b+this.elements[3]},multY:function(a,b,c,d){return c?d?this.elements[4]*a+this.elements[5]*b+this.elements[6]*c+this.elements[7]*d:this.elements[4]*a+this.elements[5]*b+this.elements[6]*c+this.elements[7]:this.elements[4]*a+this.elements[5]*b+this.elements[7]},multZ:function(a,b,c,d){return d?this.elements[8]*a+this.elements[9]*b+this.elements[10]*c+this.elements[11]*d:this.elements[8]*a+this.elements[9]*b+this.elements[10]*c+this.elements[11]},multW:function(a,b,c,d){return d?this.elements[12]*a+this.elements[13]*b+this.elements[14]*c+this.elements[15]*d:this.elements[12]*a+this.elements[13]*b+this.elements[14]*c+this.elements[15]},invert:function(){var a=this.elements[0]*this.elements[5]-this.elements[1]*this.elements[4],b=this.elements[0]*this.elements[6]-this.elements[2]*this.elements[4],c=this.elements[0]*this.elements[7]-this.elements[3]*this.elements[4],d=this.elements[1]*this.elements[6]-this.elements[2]*this.elements[5],e=this.elements[1]*this.elements[7]-this.elements[3]*this.elements[5],f=this.elements[2]*this.elements[7]-this.elements[3]*this.elements[6],g=this.elements[8]*this.elements[13]-this.elements[9]*this.elements[12],h=this.elements[8]*this.elements[14]-this.elements[10]*this.elements[12],i=this.elements[8]*this.elements[15]-this.elements[11]*this.elements[12],j=this.elements[9]*this.elements[14]-this.elements[10]*this.elements[13],k=this.elements[9]*this.elements[15]-this.elements[11]*this.elements[13],l=this.elements[10]*this.elements[15]-this.elements[11]*this.elements[14],m=a*l-b*k+c*j+d*i-e*h+f*g;if(Math.abs(m)<=1e-9)return!1;var n=[];n[0]=+this.elements[5]*l-this.elements[6]*k+this.elements[7]*j,n[4]=-this.elements[4]*l+this.elements[6]*i-this.elements[7]*h,n[8]=+this.elements[4]*k-this.elements[5]*i+this.elements[7]*g,n[12]=-this.elements[4]*j+this.elements[5]*h-this.elements[6]*g,n[1]=-this.elements[1]*l+this.elements[2]*k-this.elements[3]*j,n[5]=+this.elements[0]*l-this.elements[2]*i+this.elements[3]*h,n[9]=-this.elements[0]*k+this.elements[1]*i-this.elements[3]*g,n[13]=+this.elements[0]*j-this.elements[1]*h+this.elements[2]*g,n[2]=+this.elements[13]*f-this.elements[14]*e+this.elements[15]*d,n[6]=-this.elements[12]*f+this.elements[14]*c-this.elements[15]*b,n[10]=+this.elements[12]*e-this.elements[13]*c+this.elements[15]*a,n[14]=-this.elements[12]*d+this.elements[13]*b-this.elements[14]*a,n[3]=-this.elements[9]*f+this.elements[10]*e-this.elements[11]*d,n[7]=+this.elements[8]*f-this.elements[10]*c+this.elements[11]*b,n[11]=-this.elements[8]*e+this.elements[9]*c-this.elements[11]*a,n[15]=+this.elements[8]*d-this.elements[9]*b+this.elements[10]*a;var o=1/m;n[0]*=o,n[1]*=o,n[2]*=o,n[3]*=o,n[4]*=o,n[5]*=o,n[6]*=o,n[7]*=o,n[8]*=o,n[9]*=o,n[10]*=o,n[11]*=o,n[12]*=o,n[13]*=o,n[14]*=o,n[15]*=o,this.elements=n.slice();return!0},toString:function(){var a="";for(var b=0;b<15;b++)a+=this.elements[b]+", ";a+=this.elements[15];return a},print:function(){var a=printMatrixHelper(this.elements),b=""+p.nfs(this.elements[0],a,4)+" "+p.nfs(this.elements[1],a,4)+" "+p.nfs(this.elements[2],a,4)+" "+p.nfs(this.elements[3],a,4)+"\n"+p.nfs(this.elements[4],a,4)+" "+p.nfs(this.elements[5],a,4)+" "+p.nfs(this.elements[6],a,4)+" "+p.nfs(this.elements[7],a,4)+"\n"+p.nfs(this.elements[8],a,4)+" "+p.nfs(this.elements[9],a,4)+" "+p.nfs(this.elements[10],a,4)+" "+p.nfs(this.elements[11],a,4)+"\n"+p.nfs(this.elements[12],a,4)+" "+p.nfs(this.elements[13],a,4)+" "+p.nfs(this.elements[14],a,4)+" "+p.nfs(this.elements[15],a,4)+"\n\n";p.println(b)},invTranslate:function(a,b,c){this.preApply(1,0,0,-a,0,1,0,-b,0,0,1,-c,0,0,0,1)},invRotateX:function(a){var b=Math.cos(-a),c=Math.sin(-a);this.preApply([1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1])},invRotateY:function(a){var b=Math.cos(-a),c=Math.sin(-a);this.preApply([b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1])},invRotateZ:function(a){var b=Math.cos(-a),c=Math.sin(-a);this.preApply([b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1])},invScale:function(a,b,c){this.preApply([1/a,0,0,0,0,1/b,0,0,0,0,1/c,0,0,0,0,1])}};var PMatrixStack=p.PMatrixStack=function PMatrixStack(){this.matrixStack=[]};PMatrixStack.prototype.load=function(){var a;p.use3DContext?a=new PMatrix3D:a=new PMatrix2D,arguments.length===1?a.set(arguments[0]):a.set(arguments),this.matrixStack.push(a)},PMatrixStack.prototype.push=function(){this.matrixStack.push(this.peek())},PMatrixStack.prototype.pop=function(){return this.matrixStack.pop()},PMatrixStack.prototype.peek=function(){var a;p.use3DContext?a=new PMatrix3D:a=new PMatrix2D,a.set(this.matrixStack[this.matrixStack.length-1]);return a},PMatrixStack.prototype.mult=function(a){this.matrixStack[this.matrixStack.length-1].apply(a)},p.split=function(a,b){return a.split(b)},p.splitTokens=function(a,b){arguments.length===1&&(b="\n\t\r\f "),b="["+b+"]";var c=[],d=0,e=a.search(b);while(e>=0)e===0?a=a.substring(1):(c[d]=a.substring(0,e),d++,a=a.substring(e)),e=a.search(b);a.length>0&&(c[d]=a),c.length===0&&(c=undef);return c},p.append=function(a,b){a[a.length]=b;return a},p.concat=function(a,b){return a.concat(b)},p.sort=function(a,b){var c=[];if(a.length>0){var d=b>0?b:a.length;for(var e=0;e<d;e++)c.push(a[e]);typeof a[0]=="string"?c.sort():c.sort(function(a,b){return a-b});if(b>0)for(var f=c.length;f<a.length;f++)c.push(a[f])}return c},p.splice=function(a,b,c){if(b.length===0)return a;if(b instanceof Array)for(var d=0,e=c;d<b.length;e++,d++)a.splice(e,0,b[d]);else a.splice(c,0,b);return a},p.subset=function(a,b,c){if(arguments.length===2)return a.slice(b,a.length-b);if(arguments.length===3)return a.slice(b,b+c)},p.join=function(a,b){return a.join(b)},p.shorten=function(a){var b=[],c=a.length;for(var d=0;d<c;d++)b[d]=a[d];b.pop();return b},p.expand=function(a,b){var c=a.slice(0);if(arguments.length===1){c.length=a.length*2;return c}if(arguments.length===2){c.length=b;return c}},p.arrayCopy=function(){var a,b=0,c,d=0,e;arguments.length===2?(a=arguments[0],c=arguments[1],e=a.length):arguments.length===3?(a=arguments[0],c=arguments[1],e=arguments[2]):arguments.length===5&&(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],e=arguments[4]);for(var f=b,g=d;f<e+b;f++,g++)if(c[g]!==undef)c[g]=a[f];else throw"array index out of bounds exception"},p.reverse=function(a){return a.reverse()},p.mix=function(a,b,c){return a+((b-a)*c>>8)},p.peg=function(a){return a<0?0:a>255?255:a},p.modes={replace:function(a,b){return b},blend:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24;return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.mix(a&PConstants.RED_MASK,b&PConstants.RED_MASK,c)&PConstants.RED_MASK|p.mix(a&PConstants.GREEN_MASK,b&PConstants.GREEN_MASK,c)&PConstants.GREEN_MASK|p.mix(a&PConstants.BLUE_MASK,b&PConstants.BLUE_MASK,c)},add:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24;return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|Math.min((a&PConstants.RED_MASK)+((b&PConstants.RED_MASK)>>8)*c,PConstants.RED_MASK)&PConstants.RED_MASK|Math.min((a&PConstants.GREEN_MASK)+((b&PConstants.GREEN_MASK)>>8)*c,PConstants.GREEN_MASK)&PConstants.GREEN_MASK|Math.min((a&PConstants.BLUE_MASK)+((b&PConstants.BLUE_MASK)*c>>8),PConstants.BLUE_MASK)},subtract:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24;return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|Math.max((a&PConstants.RED_MASK)-((b&PConstants.RED_MASK)>>8)*c,PConstants.GREEN_MASK)&PConstants.RED_MASK|Math.max((a&PConstants.GREEN_MASK)-((b&PConstants.GREEN_MASK)>>8)*c,PConstants.BLUE_MASK)&PConstants.GREEN_MASK|Math.max((a&PConstants.BLUE_MASK)-((b&PConstants.BLUE_MASK)*c>>8),0)},lightest:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24;return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|Math.max(a&PConstants.RED_MASK,((b&PConstants.RED_MASK)>>8)*c)&PConstants.RED_MASK|Math.max(a&PConstants.GREEN_MASK,((b&PConstants.GREEN_MASK)>>8)*c)&PConstants.GREEN_MASK|Math.max(a&PConstants.BLUE_MASK,(b&PConstants.BLUE_MASK)*c>>8)},darkest:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24;return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.mix(a&PConstants.RED_MASK,Math.min(a&PConstants.RED_MASK,((b&PConstants.RED_MASK)>>8)*c),c)&PConstants.RED_MASK|p.mix(a&PConstants.GREEN_MASK,Math.min(a&PConstants.GREEN_MASK,((b&PConstants.GREEN_MASK)>>8)*c),c)&PConstants.GREEN_MASK|p.mix(a&PConstants.BLUE_MASK,Math.min(a&PConstants.BLUE_MASK,(b&PConstants.BLUE_MASK)*c>>8),c)},difference:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24,d=(a&PConstants.RED_MASK)>>16,e=(a&PConstants.GREEN_MASK)>>8,f=a&PConstants.BLUE_MASK,g=(b&PConstants.RED_MASK)>>16,h=(b&PConstants.GREEN_MASK)>>8,i=b&PConstants.BLUE_MASK,j=d>g?d-g:g-d,k=e>h?e-h:h-e,l=f>i?f-i:i-f;return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.peg(d+((j-d)*c>>8))<<16|p.peg(e+((k-e)*c>>8))<<8|p.peg(f+((l-f)*c>>8))},exclusion:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24,d=(a&PConstants.RED_MASK)>>16,e=(a&PConstants.GREEN_MASK)>>8,f=a&PConstants.BLUE_MASK,g=(b&PConstants.RED_MASK)>>16,h=(b&PConstants.GREEN_MASK)>>8,i=b&PConstants.BLUE_MASK,j=d+g-(d*g>>7),k=e+h-(e*h>>7),l=f+i-(f*i>>7);return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.peg(d+((j-d)*c>>8))<<16|p.peg(e+((k-e)*c>>8))<<8|p.peg(f+((l-f)*c>>8))},multiply:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24,d=(a&PConstants.RED_MASK)>>16,e=(a&PConstants.GREEN_MASK)>>8,f=a&PConstants.BLUE_MASK,g=(b&PConstants.RED_MASK)>>16,h=(b&PConstants.GREEN_MASK)>>8,i=b&PConstants.BLUE_MASK,j=d*g>>8,k=e*h>>8,l=f*i>>8;return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.peg(d+((j-d)*c>>8))<<16|p.peg(e+((k-e)*c>>8))<<8|p.peg(f+((l-f)*c>>8))},screen:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24,d=(a&PConstants.RED_MASK)>>16,e=(a&PConstants.GREEN_MASK)>>8,f=a&PConstants.BLUE_MASK,g=(b&PConstants.RED_MASK)>>16,h=(b&PConstants.GREEN_MASK)>>8,i=b&PConstants.BLUE_MASK,j=255-((255-d)*(255-g)>>8),k=255-((255-e)*(255-h)>>8),l=255-((255-f)*(255-i)>>8);return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.peg(d+((j-d)*c>>8))<<16|p.peg(e+((k-e)*c>>8))<<8|p.peg(f+((l-f)*c>>8))},hard_light:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24,d=(a&PConstants.RED_MASK)>>16,e=(a&PConstants.GREEN_MASK)>>8,f=a&PConstants.BLUE_MASK,g=(b&PConstants.RED_MASK)>>16,h=(b&PConstants.GREEN_MASK)>>8,i=b&PConstants.BLUE_MASK,j=g<128?d*g>>7:255-((255-d)*(255-g)>>7),k=h<128?e*h>>7:255-((255-e)*(255-h)>>7),l=i<128?f*i>>7:255-((255-f)*(255-i)>>7);return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.peg(d+((j-d)*c>>8))<<16|p.peg(e+((k-e)*c>>8))<<8|p.peg(f+((l-f)*c>>8))},soft_light:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24,d=(a&PConstants.RED_MASK)>>16,e=(a&PConstants.GREEN_MASK)>>8,f=a&PConstants.BLUE_MASK,g=(b&PConstants.RED_MASK)>>16,h=(b&PConstants.GREEN_MASK)>>8,i=b&PConstants.BLUE_MASK,j=(d*g>>7)+(d*d>>8)-(d*d*g>>15),k=(e*h>>7)+(e*e>>8)-(e*e*h>>15),l=(f*i>>7)+(f*f>>8)-(f*f*i>>15);return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.peg(d+((j-d)*c>>8))<<16|p.peg(e+((k-e)*c>>8))<<8|p.peg(f+((l-f)*c>>8))},overlay:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24,d=(a&PConstants.RED_MASK)>>16,e=(a&PConstants.GREEN_MASK)>>8,f=a&PConstants.BLUE_MASK,g=(b&PConstants.RED_MASK)>>16,h=(b&PConstants.GREEN_MASK)>>8,i=b&PConstants.BLUE_MASK,j=d<128?d*g>>7:255-((255-d)*(255-g)>>7),k=e<128?e*h>>7:255-((255-e)*(255-h)>>7),l=f<128?f*i>>7:255-((255-f)*(255-i)>>7);return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.peg(d+((j-d)*c>>8))<<16|p.peg(e+((k-e)*c>>8))<<8|p.peg(f+((l-f)*c>>8))},dodge:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24,d=(a&PConstants.RED_MASK)>>16,e=(a&PConstants.GREEN_MASK)>>8,f=a&PConstants.BLUE_MASK,g=(b&PConstants.RED_MASK)>>16,h=(b&PConstants.GREEN_MASK)>>8,i=b&PConstants.BLUE_MASK,j=g===255?255:p.peg((d<<8)/(255-g)),k=h===255?255:p.peg((e<<8)/(255-h)),l=i===255?255:p.peg((f<<8)/(255-i));return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.peg(d+((j-d)*c>>8))<<16|p.peg(e+((k-e)*c>>8))<<8|p.peg(f+((l-f)*c>>8))},burn:function(a,b){var c=(b&PConstants.ALPHA_MASK)>>>24,d=(a&PConstants.RED_MASK)>>16,e=(a&PConstants.GREEN_MASK)>>8,f=a&PConstants.BLUE_MASK,g=(b&PConstants.RED_MASK)>>16,h=(b&PConstants.GREEN_MASK)>>8,i=b&PConstants.BLUE_MASK,j=g===0?0:255-p.peg((255-d<<8)/g),k=h===0?0:255-p.peg((255-e<<8)/h),l=i===0?0:255-p.peg((255-f<<8)/i);return Math.min(((a&PConstants.ALPHA_MASK)>>>24)+c,255)<<24|p.peg(d+((j-d)*c>>8))<<16|p.peg(e+((k-e)*c>>8))<<8|p.peg(f+((l-f)*c>>8))}},p.color=function(a,b,c,d){return a!==undef&&b!==undef&&c!==undef&&d!==undef?color$4(a,b,c,d):a!==undef&&b!==undef&&c!==undef?color$4(a,b,c,colorModeA):a!==undef&&b!==undef?color$2(a,b):typeof a=="number"?color$1(a):color$4(colorModeX,colorModeY,colorModeZ,colorModeA)},p.color.toString=function(a){return"rgba("+((a&PConstants.RED_MASK)>>>16)+","+((a&PConstants.GREEN_MASK)>>>8)+","+(a&PConstants.BLUE_MASK)+","+((a&PConstants.ALPHA_MASK)>>>24)/255+")"},p.color.toInt=function(a,b,c,d){return d<<24&PConstants.ALPHA_MASK|a<<16&PConstants.RED_MASK|b<<8&PConstants.GREEN_MASK|c&PConstants.BLUE_MASK},p.color.toArray=function(a){return[(a&PConstants.RED_MASK)>>>16,(a&PConstants.GREEN_MASK)>>>8,a&PConstants.BLUE_MASK,(a&PConstants.ALPHA_MASK)>>>24]},p.color.toGLArray=function(a){return[((a&PConstants.RED_MASK)>>>16)/255,((a&PConstants.GREEN_MASK)>>>8)/255,(a&PConstants.BLUE_MASK)/255,((a&PConstants.ALPHA_MASK)>>>24)/255]},p.color.toRGB=function(a,b,c){a=a>colorModeX?colorModeX:a,b=b>colorModeY?colorModeY:b,c=c>colorModeZ?colorModeZ:c,a=a<0?0:a,b=b<0?0:b,c=c<0?0:c,a=a/colorModeX*360,b=b/colorModeY*100,c=c/colorModeZ*100;var d=Math.round(c/100*255);if(b===0)return[d,d,d];var e=a%360,f=e%60,g=Math.round(c*(100-b)/1e4*255),h=Math.round(c*(6e3-b*f)/6e5*255),i=Math.round(c*(6e3-b*(60-f))/6e5*255);switch(Math.floor(e/60)){case 0:return[d,i,g];case 1:return[h,d,g];case 2:return[g,d,i];case 3:return[g,h,d];case 4:return[i,g,d];case 5:return[d,g,h]}},p.color.toHSB=function(a){var b,c,d;b=((a&PConstants.RED_MASK)>>>16)/255,c=((a&PConstants.GREEN_MASK)>>>8)/255,d=(a&PConstants.BLUE_MASK)/255;var e=p.max(p.max(b,c),d),f=p.min(p.min(b,c),d),g,h;if(f===e)return[0,0,e];h=(e-f)/e,b===e?g=(c-d)/(e-f):c===e?g=2+(d-b)/(e-f):g=4+(b-c)/(e-f),g/=6,g<0?g+=1:g>1&&(g-=1);return[g*colorModeX,h*colorModeY,e*colorModeZ]},p.brightness=function(a){return p.color.toHSB(a)[2]},p.saturation=function(a){return p.color.toHSB(a)[1]},p.hue=function(a){return p.color.toHSB(a)[0]};var verifyChannel=function(a){return a.constructor===Array?a:p.color(a)};p.red=function(a){return((a&PConstants.RED_MASK)>>>16)/255*colorModeX},p.green=function(a){return((a&PConstants.GREEN_MASK)>>>8)/255*colorModeY},p.blue=function(a){return(a&PConstants.BLUE_MASK)/255*colorModeZ},p.alpha=function(a){return((a&PConstants.ALPHA_MASK)>>>24)/255*colorModeA},p.lerpColor=function(a,b,c){var d=p.color(a),e=(d&PConstants.RED_MASK)>>>16,f=(d&PConstants.GREEN_MASK)>>>8,g=d&PConstants.BLUE_MASK,h=((d&PConstants.ALPHA_MASK)>>>24)/colorModeA,i=p.color(b),j=(i&PConstants.RED_MASK)>>>16,k=(i&PConstants.GREEN_MASK)>>>8,l=i&PConstants.BLUE_MASK,m=((i&PConstants.ALPHA_MASK)>>>24)/colorModeA,n=parseInt(p.lerp(e,j,c),10),o=parseInt(p.lerp(f,k,c),10),q=parseInt(p.lerp(g,l,c),10),r=parseFloat(p.lerp(h,m,c)*colorModeA);return p.color.toInt(n,o,q,r)},p.defaultColor=function(a,b,c){var d=curColorMode;curColorMode=PConstants.RGB;var e=p.color(a/255*colorModeX,b/255*colorModeY,c/255*colorModeZ);curColorMode=d;return e},p.colorMode=function(){curColorMode=arguments[0],arguments.length>1&&(colorModeX=arguments[1],colorModeY=arguments[2]||arguments[1],colorModeZ=arguments[3]||arguments[1],colorModeA=arguments[4]||arguments[1])},p.blendColor=function(a,b,c){var d=0;switch(c){case PConstants.REPLACE:d=p.modes.replace(a,b);break;case PConstants.BLEND:d=p.modes.blend(a,b);break;case PConstants.ADD:d=p.modes.add(a,b);break;case PConstants.SUBTRACT:d=p.modes.subtract(a,b);break;case PConstants.LIGHTEST:d=p.modes.lightest(a,b);break;case PConstants.DARKEST:d=p.modes.darkest(a,b);break;case PConstants.DIFFERENCE:d=p.modes.difference(a,b);break;case PConstants.EXCLUSION:d=p.modes.exclusion(a,b);break;case PConstants.MULTIPLY:d=p.modes.multiply(a,b);break;case PConstants.SCREEN:d=p.modes.screen(a,b);break;case PConstants.HARD_LIGHT:d=p.modes.hard_light(a,b);break;case PConstants.SOFT_LIGHT:d=p.modes.soft_light(a,b);break;case PConstants.OVERLAY:d=p.modes.overlay(a,b);break;case PConstants.DODGE:d=p.modes.dodge(a,b);break;case PConstants.BURN:d=p.modes.burn(a,b)}return d},p.printMatrix=function(){modelView.print()},p.translate=function(a,b,c){p.use3DContext?(forwardTransform.translate(a,b,c),reverseTransform.invTranslate(a,b,c)):curContext.translate(a,b)},p.scale=function(a,b,c){p.use3DContext?(forwardTransform.scale(a,b,c),reverseTransform.invScale(a,b,c)):curContext.scale(a,b||a)},p.pushMatrix=function(){p.use3DContext?userMatrixStack.load(modelView):saveContext()},p.popMatrix=function(){p.use3DContext?modelView.set(userMatrixStack.pop()):restoreContext()},p.resetMatrix=function(){p.use3DContext?(forwardTransform.reset(),reverseTransform.reset()):curContext.setTransform(1,0,0,1,0,0)},p.applyMatrix=function(){var a=arguments;if(!p.use3DContext){for(var b=a.length;b<16;b++)a[b]=0;a[10]=a[15]=1}forwardTransform.apply(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]),reverseTransform.invApply(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])},p.rotateX=function(a){forwardTransform.rotateX(a),reverseTransform.invRotateX(a)},p.rotateZ=function(a){forwardTransform.rotateZ(a),reverseTransform.invRotateZ(a)},p.rotateY=function(a){forwardTransform.rotateY(a),reverseTransform.invRotateY(a)},p.rotate=function(a){p.use3DContext?(forwardTransform.rotateZ(a),reverseTransform.invRotateZ(a)):curContext.rotate(a)},p.pushStyle=function(){saveContext(),p.pushMatrix();var a={doFill:doFill,currentFillColor:currentFillColor,doStroke:doStroke,currentStrokeColor:currentStrokeColor,curTint:curTint,curRectMode:curRectMode,curColorMode:curColorMode,colorModeX:colorModeX,colorModeZ:colorModeZ,colorModeY:colorModeY,colorModeA:colorModeA,curTextFont:curTextFont,curTextSize:curTextSize};styleArray.push(a)},p.popStyle=function(){var a=styleArray.pop();if(a)restoreContext(),p.popMatrix(),doFill=a.doFill,currentFillColor=a.currentFillColor,doStroke=a.doStroke,currentStrokeColor=a.currentStrokeColor,curTint=a.curTint,curRectMode=a.curRectmode,curColorMode=a.curColorMode,colorModeX=a.colorModeX,colorModeZ=a.colorModeZ,colorModeY=a.colorModeY,colorModeA=a.colorModeA,curTextFont=a.curTextFont,curTextSize=a.curTextSize;else throw"Too many popStyle() without enough pushStyle()"},p.year=function(){return(new Date).getFullYear()},p.month=function(){return(new Date).getMonth()+1},p.day=function(){return(new Date).getDate()},p.hour=function(){return(new Date).getHours()},p.minute=function(){return(new Date).getMinutes()},p.second=function(){return(new Date).getSeconds()},p.millis=function(){return(new Date).getTime()-start},p.redraw=function(){var a=((new Date).getTime()-timeSinceLastFPS)/1e3;framesSinceLastFPS++;var b=framesSinceLastFPS/a;a>.5&&(timeSinceLastFPS=(new Date).getTime(),framesSinceLastFPS=0,p.__frameRate=b),p.frameCount++,inDraw=!0,p.use3DContext?(curContext.clear(curContext.DEPTH_BUFFER_BIT),curContextCache={attributes:{},locations:{}},p.noLights(),p.lightFalloff(1,0,0),p.shininess(1),p.ambient(255,255,255),p.specular(0,0,0),p.camera(),p.draw()):(saveContext(),p.draw(),restoreContext()),inDraw=!1},p.noLoop=function(){doLoop=!1,loopStarted=!1,clearInterval(looping)},p.loop=function(){loopStarted||(looping=window.setInterval(function(){try{document.hasFocus instanceof Function&&(p.focused=document.hasFocus()),p.redraw()}catch(a){window.clearInterval(looping);throw a}},curMsPerFrame),doLoop=!0,loopStarted=!0)},p.frameRate=function(a){curFrameRate=a,curMsPerFrame=1e3/curFrameRate,doLoop&&(p.noLoop(),p.loop())};var eventHandlers=[];p.exit=function(){window.clearInterval(looping),Processing.removeInstance(p.externals.canvas.id);for(var a in Processing.lib)Processing.lib.hasOwnProperty(a)&&Processing.lib[a].hasOwnProperty("detach")&&Processing.lib[a].detach(p);for(var b=0,c=eventHandlers.length;b<c;b++){var d=eventHandlers[b][0],e=eventHandlers[b][1],f=eventHandlers[b][2];d.removeEventListener?d.removeEventListener(e,f,!1):d.detachEvent&&d.detachEvent("on"+e,f)}},p.cursor=function(){if(arguments.length>1||arguments.length===1&&arguments[0]instanceof p.PImage){var a=arguments[0],b,c;if(arguments.length>=3){b=arguments[1],c=arguments[2];if(b<0||c<0||c>=a.height||b>=a.width)throw"x and y must be non-negative and less than the dimensions of the image"}else b=a.width>>>1,c=a.height>>>1;var d=a.toDataURL(),e='url("'+d+'") '+b+" "+c+", default";curCursor=curElement.style.cursor=e}else if(arguments.length===1){var f=arguments[0];curCursor=curElement.style.cursor=f}else curCursor=curElement.style.cursor=oldCursor},p.noCursor=function(){curCursor=curElement.style.cursor=PConstants.NOCURSOR},p.link=function(a,b){b!==undef?window.open(a,b):window.location=a},p.beginDraw=function(){},p.endDraw=function(){},p.Import=function(a){};var contextMenu=function(a){a.preventDefault(),a.stopPropagation()};p.disableContextMenu=function(){curElement.addEventListener("contextmenu",contextMenu,!1)},p.enableContextMenu=function(){curElement.removeEventListener("contextmenu",contextMenu,!1)},p.status=function(a){window.status=a},p.binary=function(a,b){var c=32;if(typeof a=="number"){b&&(c=b);return decToBin(a,c)}a instanceof Char&&(a=a.toString().charCodeAt(0),b?c=32:c=16);var d=decToBin(a,c);b&&(d=d.substr(-b));return d},p.unbinary=function(a){var b=new RegExp("^[0|1]{8}$"),c=0,d;if(a instanceof Array){var e=[];for(d=0;d<a.length;d++)e[d]=p.unbinary(a[d]);return e}if(isNaN(a))throw"NaN_Err";if(arguments.length===1||a.length===8){if(b.test(a)){for(d=0;d<8;d++)c+=Math.pow(2,d)*parseInt(a.charAt(7-d),10);return c+""}throw"notBinary: the value passed into unbinary was not an 8 bit binary number"}throw"longErr"},p.nf=function(a,b,c){return nfCore(a,"","-",b,c)},p.nfs=function(a,b,c){return nfCore(a," ","-",b,c)},p.nfp=function(a,b,c){return nfCore(a,"+","-",b,c)},p.nfc=function(a,b,c){return nfCore(a,"","-",b,c,",")};var decimalToHex=function decimalToHex(a,b){b=b===undef||b===null?b=8:b,a<0&&(a=4294967295+a+1);var c=Number(a).toString(16).toUpperCase();while(c.length<b)c="0"+c;c.length>=b&&(c=c.substring(c.length-b,c.length));return c};p.hex=function(a,b){arguments.length===1&&(a instanceof Char?b=4:b=8);return decimalToHex(a,b)},p.unhex=function(a){if(a instanceof Array){var b=[];for(var c=0;c<a.length;c++)b.push(unhexScalar(a[c]));return b}return unhexScalar(a)},p.loadStrings=function(a){if(localStorage[a])return localStorage[a].split("\n");var b=ajax(a);if(typeof b!="string"||b==="")return[];b=b.replace(/(\r\n?)/g,"\n").replace(/\n$/,"");return b.split("\n")},p.saveStrings=function(a,b){localStorage[a]=b.join("\n")},p.loadBytes=function(a,b){var c=ajax(a),d=[];for(var e=0;e<c.length;e++)d.push(c.charCodeAt(e));return d},p.matchAll=function(a,b){var c=[],d,e=new RegExp(b,"g");while((d=e.exec(a))!==null)c.push(d),d[0].length===0&&++e.lastIndex;return c.length>0?c:null},String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"g"),b)},String.prototype.equals=function(a){return this.valueOf()===a.valueOf()},String.prototype.toCharArray=function(){var a=this.split("");for(var b=a.length-1;b>=0;b--)a[b]=new Char(a[b]);return a},p.match=function(a,b){return a.match(b)};var logBuffer=[];p.console=window.console||Processing.logger,p.println=function(a){var b=logBuffer.length;b&&(Processing.logger.log(logBuffer.join("")),logBuffer.length=0),arguments.length===0&&b===0?Processing.logger.log(""):arguments.length!==0&&Processing.logger.log(a)},p.print=function(a){logBuffer.push(a)},p.str=function(a){if(a instanceof Array){var b=[];for(var c=0;c<a.length;c++)b.push(a[c]+"");return b}return a+""},p.trim=function(a){if(a instanceof Array){var b=[];for(var c=0;c<a.length;c++)b.push(a[c].replace(/^\s*/,"").replace(/\s*$/,"").replace(/\r*$/,""));return b}return a.replace(/^\s*/,"").replace(/\s*$/,"").replace(/\r*$/,"")},p["boolean"]=function(a){if(a instanceof Array){var b=[];for(var c=0;c<a.length;c++)b.push(booleanScalar(a[c]));return b}return booleanScalar(a)},p["byte"]=function(a){if(a instanceof Array){var b=[];for(var c=0;c<a.length;c++)b.push(0-(a[c]&128)|a[c]&127);return b}return 0-(a&128)|a&127},p["char"]=function(a){if(typeof a=="number")return new Char(String.fromCharCode(a&65535));if(a instanceof Array){var b=[];for(var c=0;c<a.length;c++)b.push(new Char(String.fromCharCode(a[c]&65535)));return b}throw"char() may receive only one argument of type int, byte, int[], or byte[]."},p["float"]=function(a){if(a instanceof Array){var b=[];for(var c=0;c<a.length;c++)b.push(floatScalar(a[c]));return b}return floatScalar(a)},p["int"]=function(a){if(a instanceof Array){var b=[];for(var c=0;c<a.length;c++)typeof a[c]=="string"&&!/^\s*[+\-]?\d+\s*$/.test(a[c])?b.push(0):b.push(intScalar(a[c]));return b}return intScalar(a)},p.__int_cast=function(a){return 0|a},p.abs=Math.abs,p.ceil=Math.ceil,p.constrain=function(a,b,c){return a>c?c:a<b?b:a},p.dist=function(){var a,b,c;if(arguments.length===4){a=arguments[0]-arguments[2],b=arguments[1]-arguments[3];return Math.sqrt(a*a+b*b)}if(arguments.length===6){a=arguments[0]-arguments[3],b=arguments[1]-arguments[4],c=arguments[2]-arguments[5];return Math.sqrt(a*a+b*b+c*c)}},p.exp=Math.exp,p.floor=Math.floor,p.lerp=function(a,b,c){return(b-a)*c+a},p.log=Math.log,p.mag=function(a,b,c){if(arguments.length===2)return Math.sqrt(a*a+b*b);if(arguments.length===3)return Math.sqrt(a*a+b*b+c*c)},p.map=function(a,b,c,d,e){return d+(e-d)*((a-b)/(c-b))},p.max=function(){if(arguments.length===2)return arguments[0]<arguments[1]?arguments[1]:arguments[0];var a=arguments.length===1?arguments[0]:arguments;if(!("length"in a&&a.length>0))throw"Non-empty array is expected";var b=a[0],c=a.length;for(var d=1;d<c;++d)b<a[d]&&(b=a[d]);return b},p.min=function(){if(arguments.length===2)return arguments[0]<arguments[1]?arguments[0]:arguments[1];var a=arguments.length===1?arguments[0]:arguments;if(!("length"in a&&a.length>0))throw"Non-empty array is expected";var b=a[0],c=a.length;for(var d=1;d<c;++d)b>a[d]&&(b=a[d]);return b},p.norm=function(a,b,c){return(a-b)/(c-b)},p.pow=Math.pow,p.round=Math.round,p.sq=function(a){return a*a},p.sqrt=Math.sqrt,p.acos=Math.acos,p.asin=Math.asin,p.atan=Math.atan,p.atan2=Math.atan2,p.cos=Math.cos,p.degrees=function(a){return a*180/Math.PI},p.radians=function(a){return a/180*Math.PI},p.sin=Math.sin,p.tan=Math.tan;var currentRandom=Math.random;p.random=function(){if(arguments.length===0)return currentRandom();if(arguments.length===1)return currentRandom()*arguments[0];var a=arguments[0],b=arguments[1];return currentRandom()*(b-a)+a},Marsaglia.createRandomized=function(){var a=new Date;return new Marsaglia(a/6e4&4294967295,a&4294967295)},p.randomSeed=function(a){currentRandom=(new Marsaglia(a)).nextDouble},p.Random=function(a){var b=!1,c,d;this.nextGaussian=function(){if(b){b=!1;return c}var a,e,f;do a=2*d()-1,e=2*d()-1,f=a*a+e*e;while(f>=1||f===0);var g=Math.sqrt(-2*Math.log(f)/f);c=e*g,b=!0;return a*g},d=a===undef?Math.random:(new Marsaglia(a)).nextDouble};var noiseProfile={generator:undef,octaves:4,fallout:.5,seed:undef};p.noise=function(a,b,c){noiseProfile.generator===undef&&(noiseProfile.generator=new PerlinNoise(noiseProfile.seed));var d=noiseProfile.generator,e=1,f=1,g=0;for(var h=0;h<noiseProfile.octaves;++h){e*=noiseProfile.fallout;switch(arguments.length){case 1:g+=e*(1+d.noise1d(f*a))/2;break;case 2:g+=e*(1+d.noise2d(f*a,f*b))/2;break;case 3:g+=e*(1+d.noise3d(f*a,f*b,f*c))/2}f*=2}return g},p.noiseDetail=function(a,b){noiseProfile.octaves=a,b!==undef&&(noiseProfile.fallout=b)},p.noiseSeed=function(a){noiseProfile.seed=a,noiseProfile.generator=undef};var refreshBackground=function(){curSketch.options.isTransparent||(p.use3DContext?(curContext.clearColor(.8,.8,.8,1),curContext.clear(curContext.COLOR_BUFFER_BIT|curContext.DEPTH_BUFFER_BIT)):(curContext.fillStyle="rgb(204, 204, 204)",curContext.fillRect(0,0,p.width,p.height),isFillDirty=!0))};p.size=function(a,b,c){if(c&&c===PConstants.WEBGL){try{if(curElement.width!==a||curElement.height!==b)curElement.setAttribute("width",a),curElement.setAttribute("height",b);curContext=curElement.getContext("experimental-webgl"),p.use3DContext=!0,canTex=curContext.createTexture(),textTex=curContext.createTexture()}catch(d){Processing.debug(d)}if(!curContext)throw"WebGL context is not supported on this browser.";for(var e=0;e<PConstants.SINCOS_LENGTH;e++)sinLUT[e]=p.sin(e*(PConstants.PI/180)*.5),cosLUT[e]=p.cos(e*(PConstants.PI/180)*.5);curContext.viewport(0,0,curElement.width,curElement.height),curContext.enable(curContext.DEPTH_TEST),curContext.enable(curContext.BLEND),curContext.blendFunc(curContext.SRC_ALPHA,curContext.ONE_MINUS_SRC_ALPHA),refreshBackground(),programObject2D=createProgramObject(curContext,vertexShaderSource2D,fragmentShaderSource2D),curContext.useProgram(programObject2D),p.strokeWeight(1),programObject3D=createProgramObject(curContext,vertexShaderSource3D,fragmentShaderSource3D),programObjectUnlitShape=createProgramObject(curContext,vShaderSrcUnlitShape,fShaderSrcUnlitShape),curContext.useProgram(programObject3D),uniformi("usingTexture3d",programObject3D,"usingTexture",usingTexture),p.lightFalloff(1,0,0),p.shininess(1),p.ambient(255,255,255),p.specular(0,0,0),boxBuffer=curContext.createBuffer(),curContext.bindBuffer(curContext.ARRAY_BUFFER,boxBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,boxVerts,curContext.STATIC_DRAW),boxNormBuffer=curContext.createBuffer(),curContext.bindBuffer(curContext.ARRAY_BUFFER,boxNormBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,boxNorms,curContext.STATIC_DRAW),boxOutlineBuffer=curContext.createBuffer(),curContext.bindBuffer(curContext.ARRAY_BUFFER,boxOutlineBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,boxOutlineVerts,curContext.STATIC_DRAW),rectBuffer=curContext.createBuffer(),curContext.bindBuffer(curContext.ARRAY_BUFFER,rectBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,rectVerts,curContext.STATIC_DRAW),rectNormBuffer=curContext.createBuffer(),curContext.bindBuffer(curContext.ARRAY_BUFFER,rectNormBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,rectNorms,curContext.STATIC_DRAW),sphereBuffer=curContext.createBuffer(),lineBuffer=curContext.createBuffer(),fillBuffer=curContext.createBuffer(),fillColorBuffer=curContext.createBuffer(),strokeColorBuffer=curContext.createBuffer(),shapeTexVBO=curContext.createBuffer(),pointBuffer=curContext.createBuffer(),curContext.bindBuffer(curContext.ARRAY_BUFFER,pointBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array([0,0,0]),curContext.STATIC_DRAW),textBuffer=curContext.createBuffer(),curContext.bindBuffer(curContext.ARRAY_BUFFER,textBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),curContext.STATIC_DRAW),textureBuffer=curContext.createBuffer(),curContext.bindBuffer(curContext.ARRAY_BUFFER,textureBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1]),curContext.STATIC_DRAW),indexBuffer=curContext.createBuffer(),curContext.bindBuffer(curContext.ELEMENT_ARRAY_BUFFER,indexBuffer),curContext.bufferData(curContext.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,2,3,0]),curContext.STATIC_DRAW),cam=new PMatrix3D,cameraInv=new PMatrix3D,forwardTransform=new PMatrix3D,reverseTransform=new PMatrix3D,modelView=new PMatrix3D,modelViewInv=new PMatrix3D,projection=new PMatrix3D,p.camera(),p.perspective(),forwardTransform=modelView,reverseTransform=modelViewInv,userMatrixStack=new PMatrixStack,curveBasisMatrix=new PMatrix3D,curveToBezierMatrix=new PMatrix3D,curveDrawMatrix=new PMatrix3D,bezierDrawMatrix=new PMatrix3D,bezierBasisInverse=new PMatrix3D,bezierBasisMatrix=new PMatrix3D,bezierBasisMatrix.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0),p.stroke(0),p.fill(255)}else curContext===undef&&(curContext=curElement.getContext("2d"),p.use3DContext=!1,userMatrixStack=new PMatrixStack,modelView=new PMatrix2D);var f={fillStyle:curContext.fillStyle,strokeStyle:curContext.strokeStyle,lineCap:curContext.lineCap,lineJoin:curContext.lineJoin};curElement.style.length>0&&(curElement.style.removeProperty("width"),curElement.style.removeProperty("height")),curElement.width=p.width=a||100,curElement.height=p.height=b||100;for(var g in f)f&&(curContext[g]=f[g]);refreshBackground(),maxPixelsCached=Math.max(1e3,a*b*.05),p.externals.context=curContext,p.toImageData=function(){if(!p.use3DContext)return curContext.getImageData(0,0,this.width,this.height);var a=document.createElement("canvas"),b=a.getContext("2d"),c=b.createImageData(this.width,this.height),d=new Uint8Array(this.width*this.height*4);curContext.readPixels(0,0,this.width,this.height,curContext.RGBA,curContext.UNSIGNED_BYTE,d);for(var e=0;e<d.length;e++)c.data[e]=d[(this.height-1-Math.floor(e/4/this.width))*this.width*4+e%(this.width*4)];return c}},p.ambientLight=function(a,b,c,d,e,f){if(p.use3DContext){if(lightCount===PConstants.MAX_LIGHTS)throw"can only create "+PConstants.MAX_LIGHTS+" lights";var g=new PVector(d,e,f),h=new PMatrix3D;h.scale(1,-1,1),h.apply(modelView.array()),h.mult(g,g),curContext.useProgram(programObject3D),uniformf("lights.color.3d."+lightCount,programObject3D,"lights["+lightCount+"].color",[a/255,b/255,c/255]),uniformf("lights.position.3d."+lightCount,programObject3D,"lights["+lightCount+"].position",g.array()),uniformi("lights.type.3d."+lightCount,programObject3D,"lights["+lightCount+"].type",0),uniformi("lightCount3d",programObject3D,"lightCount",++lightCount)}},p.directionalLight=function(a,b,c,d,e,f){if(p.use3DContext){if(lightCount===PConstants.MAX_LIGHTS)throw"can only create "+PConstants.MAX_LIGHTS+" lights";curContext.useProgram(programObject3D);var g=[d,e,f,1e-7],h=new PMatrix3D;h.scale(1,-1,1),h.apply(modelView.array()),h.mult(g,g),uniformf("lights.color.3d."+lightCount,programObject3D,"lights["+lightCount+"].color",[a/255,b/255,c/255]),uniformf("lights.position.3d."+lightCount,programObject3D,"lights["+lightCount+"].position",[-g[0],-g[1],-g[2]]),uniformi("lights.type.3d."+lightCount,programObject3D,"lights["+lightCount+"].type",1),uniformi("lightCount3d",programObject3D,"lightCount",++lightCount)}},p.lightFalloff=function(a,b,c){p.use3DContext&&(curContext.useProgram(programObject3D),uniformf("falloff3d",programObject3D,"falloff",[a,b,c]))},p.lightSpecular=function(a,b,c){p.use3DContext&&(curContext.useProgram(programObject3D),uniformf("specular3d",programObject3D,"specular",[a/255,b/255,c/255]))},p.lights=function(){p.ambientLight(128,128,128),p.directionalLight(128,128,128,0,0,-1),p.lightFalloff(1,0,0),p.lightSpecular(0,0,0)},p.pointLight=function(a,b,c,d,e,f){if(p.use3DContext){if(lightCount===PConstants.MAX_LIGHTS)throw"can only create "+PConstants.MAX_LIGHTS+" lights";var g=new PVector(d,e,f),h=new PMatrix3D;h.scale(1,-1,1),h.apply(modelView.array()),h.mult(g,g),curContext.useProgram(programObject3D),uniformf("lights.color.3d."+lightCount,programObject3D,"lights["+lightCount+"].color",[a/255,b/255,c/255]),uniformf("lights.position.3d."+lightCount,programObject3D,"lights["+lightCount+"].position",g.array()),uniformi("lights.type.3d."+lightCount,programObject3D,"lights["+lightCount+"].type",2),uniformi("lightCount3d",programObject3D,"lightCount",++lightCount)}},p.noLights=function(){p.use3DContext&&(lightCount=0,curContext.useProgram(programObject3D),uniformi("lightCount3d",programObject3D,"lightCount",lightCount))},p.spotLight=function(a,b,c,d,e,f,g,h,i,j,k){if(p.use3DContext){if(lightCount===PConstants.MAX_LIGHTS)throw"can only create "+PConstants.MAX_LIGHTS+" lights";curContext.useProgram(programObject3D);var l=new PVector(d,e,f),m=new PMatrix3D;m.scale(1,-1,1),m.apply(modelView.array()),m.mult(l,l);var n=[g,h,i,1e-7];m=new PMatrix3D,m.scale(1,-1,1),m.apply(modelView.array()),m.mult(n,n),uniformf("lights.color.3d."+lightCount,programObject3D,"lights["+lightCount+"].color",[a/255,b/255,c/255]),uniformf("lights.position.3d."+lightCount,programObject3D,"lights["+lightCount+"].position",l.array()),uniformf("lights.direction.3d."+lightCount,programObject3D,"lights["+lightCount+"].direction",[n[0],n[1],n[2]]),uniformf("lights.concentration.3d."+lightCount,programObject3D,"lights["+lightCount+"].concentration",k),uniformf("lights.angle.3d."+lightCount,programObject3D,"lights["+lightCount+"].angle",j),uniformi("lights.type.3d."+lightCount,programObject3D,"lights["+lightCount+"].type",3),uniformi("lightCount3d",programObject3D,"lightCount",++lightCount)}},p.beginCamera=function(){if(manipulatingCamera)throw"You cannot call beginCamera() again before calling endCamera()";manipulatingCamera=!0,forwardTransform=cameraInv,reverseTransform=cam},p.endCamera=function(){if(!manipulatingCamera)throw"You cannot call endCamera() before calling beginCamera()";modelView.set(cam),modelViewInv.set(cameraInv),forwardTransform=modelView,reverseTransform=modelViewInv,manipulatingCamera=!1},p.camera=function(a,b,c,d,e,f,g,h,i){arguments.length===0&&(cameraX=curElement.width/2,cameraY=curElement.height/2,cameraZ=cameraY/Math.tan(cameraFOV/2),a=cameraX,b=cameraY,c=cameraZ,d=cameraX,e=cameraY,f=0,g=0,h=1,i=0);var j=new PVector(a-d,b-e,c-f),k=new PVector(g,h,i),l,m,n;j.normalize();var o=PVector.cross(k,j);k=PVector.cross(j,o),o.normalize(),k.normalize(),cam.set(o.x,o.y,o.z,0,k.x,k.y,k.z,0,j.x,j.y,j.z,0,0,0,0,1),cam.translate(-a,-b,-c),cameraInv.reset(),cameraInv.invApply(o.x,o.y,o.z,0,k.x,k.y,k.z,0,j.x,j.y,j.z,0,0,0,0,1),cameraInv.translate(a,b,c),modelView.set(cam),modelViewInv.set(cameraInv)},p.perspective=function(a,b,c,d){arguments.length===0&&(cameraY=curElement.height/2,cameraZ=cameraY/Math.tan(cameraFOV/2),cameraNear=cameraZ/10,cameraFar=cameraZ*10,cameraAspect=curElement.width/curElement.height,a=cameraFOV,b=cameraAspect,c=cameraNear,d=cameraFar);var e,f,g,h;e=c*Math.tan(a/2),f=-e,g=e*b,h=f*b,p.frustum(h,g,f,e,c,d)},p.frustum=function(a,b,c,d,e,f){frustumMode=!0,projection=new PMatrix3D,projection.set(2*e/(b-a),0,(b+a)/(b-a),0,0,2*e/(d-c),(d+c)/(d-c),0,0,0,-(f+e)/(f-e),-(2*f*e)/(f-e),0,0,-1,0)},p.ortho=function(a,b,c,d,e,f){arguments.length===0&&(a=0,b=p.width,c=0,d=p.height,e=-10,f=10);var g=2/(b-a),h=2/(d-c),i=-2/(f-e),j=-(b+a)/(b-a),k=-(d+c)/(d-c),l=-(f+e)/(f-e);projection=new PMatrix3D,projection.set(g,0,0,j,0,h,0,k,0,0,i,l,0,0,0,1),frustumMode=!1},p.printProjection=function(){projection.print()},p.printCamera=function(){cam.print()},p.box=function(a,b,c){if(p.use3DContext){if(!b||!c)b=c=a;var d=new PMatrix3D;d.scale(a,b,c);var e=new PMatrix3D;e.scale(1,-1,1),e.apply(modelView.array()),e.transpose();var f=new PMatrix3D;f.set(projection),f.transpose();if(doFill===!0){curContext.useProgram(programObject3D),disableVertexAttribPointer("aTexture3d",programObject3D,"aTexture"),uniformMatrix("model3d",programObject3D,"model",!1,d.array()),uniformMatrix("view3d",programObject3D,"view",!1,e.array()),uniformMatrix("projection3d",programObject3D,"projection",!1,f.array()),curContext.enable(curContext.POLYGON_OFFSET_FILL),curContext.polygonOffset(1,1),uniformf("color3d",programObject3D,"color",fillStyle);var g=new PMatrix3D;g.set(e);var h=new PMatrix3D;h.set(d),g.mult(h);var i=new PMatrix3D;i.set(g),i.invert(),i.transpose(),uniformMatrix("normalTransform3d",programObject3D,"normalTransform",!1,i.array()),vertexAttribPointer("vertex3d",programObject3D,"Vertex",3,boxBuffer),vertexAttribPointer("normal3d",programObject3D,"Normal",3,boxNormBuffer),vertexAttribPointer("aColor3d",programObject3D,"aColor",3,boxNormBuffer),curContext.drawArrays(curContext.TRIANGLES,0,boxVerts.length/3),curContext.disable(curContext.POLYGON_OFFSET_FILL)}lineWidth>0&&doStroke&&(curContext.useProgram(programObject2D),uniformMatrix("model2d",programObject2D,"model",!1,d.array()),uniformMatrix("view2d",programObject2D,"view",!1,e.array()),uniformMatrix("projection2d",programObject2D,"projection",!1,f.array()),uniformf("color2d",programObject2D,"color",strokeStyle),uniformi("picktype2d",programObject2D,"picktype",0),vertexAttribPointer("vertex2d",programObject2D,"Vertex",3,boxOutlineBuffer),disableVertexAttribPointer("aTextureCoord2d",programObject2D,"aTextureCoord"),curContext.lineWidth(lineWidth),curContext.drawArrays(curContext.LINES,0,boxOutlineVerts.length/3))}};var initSphere=function(){var a;sphereVerts=[];for(a=0;a<sphereDetailU;a++)sphereVerts.push(0),sphereVerts.push(-1),sphereVerts.push(0),sphereVerts.push(sphereX[a]),sphereVerts.push(sphereY[a]),sphereVerts.push(sphereZ[a]);sphereVerts.push(0),sphereVerts.push(-1),sphereVerts.push(0),sphereVerts.push(sphereX[0]),sphereVerts.push(sphereY[0]),sphereVerts.push(sphereZ[0]);var b,c,d,e=0;for(a=2;a<sphereDetailV;a++){b=c=e,e+=sphereDetailU,d=e;for(var f=0;f<sphereDetailU;f++)sphereVerts.push(parseFloat(sphereX[b])),sphereVerts.push(parseFloat(sphereY[b])),sphereVerts.push(parseFloat(sphereZ[b++])),sphereVerts.push(parseFloat(sphereX[d])),sphereVerts.push(parseFloat(sphereY[d])),sphereVerts.push(parseFloat(sphereZ[d++]));b=c,d=e,sphereVerts.push(parseFloat(sphereX[b])),sphereVerts.push(parseFloat(sphereY[b])),sphereVerts.push(parseFloat(sphereZ[b])),sphereVerts.push(parseFloat(sphereX[d])),sphereVerts.push(parseFloat(sphereY[d])),sphereVerts.push(parseFloat(sphereZ[d]))}for(a=0;a<sphereDetailU;a++)d=e+a,sphereVerts.push(parseFloat(sphereX[d])),sphereVerts.push(parseFloat(sphereY[d])),sphereVerts.push(parseFloat(sphereZ[d])),sphereVerts.push(0),sphereVerts.push(1),sphereVerts.push(0);sphereVerts.push(parseFloat(sphereX[e])),sphereVerts.push(parseFloat(sphereY[e])),sphereVerts.push(parseFloat(sphereZ[e])),sphereVerts.push(0),sphereVerts.push(1),sphereVerts.push(0),curContext.bindBuffer(curContext.ARRAY_BUFFER,sphereBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array(sphereVerts),curContext.STATIC_DRAW)};p.sphereDetail=function(a,b){var c;arguments.length===1&&(a=b=arguments[0]),a<3&&(a=3),b<2&&(b=2);if(a!==sphereDetailU||b!==sphereDetailV){var d=PConstants.SINCOS_LENGTH/a,e=Array(a),f=Array(a);for(c=0;c<a;c++)e[c]=cosLUT[parseInt(c*d%PConstants.SINCOS_LENGTH,10)],f[c]=sinLUT[parseInt(c*d%PConstants.SINCOS_LENGTH,10)];var g=a*(b-1)+2,h=0;sphereX=Array(g),sphereY=Array(g),sphereZ=Array(g);var i=PConstants.SINCOS_LENGTH*.5/b,j=i;for(c=1;c<b;c++){var k=sinLUT[parseInt(j%PConstants.SINCOS_LENGTH,10)],l=-cosLUT[parseInt(j%PConstants.SINCOS_LENGTH,10)];for(var m=0;m<a;m++)sphereX[h]=e[m]*k,sphereY[h]=l,sphereZ[h++]=f[m]*k;j+=i}sphereDetailU=a,sphereDetailV=b,initSphere()}},p.sphere=function(){if(p.use3DContext){var a=arguments[0],b;(sphereDetailU<3||sphereDetailV<2)&&p.sphereDetail(30);var c=new PMatrix3D;c.scale(a,a,a);var d=new PMatrix3D;d.scale(1,-1,1),d.apply(modelView.array()),d.transpose();var e=new PMatrix3D;e.set(projection),e.transpose();if(doFill===!0){var f=new PMatrix3D;f.set(d);var g=new PMatrix3D;g.set(c),f.mult(g);var h=new PMatrix3D;h.set(f),h.invert(),h.transpose(),curContext.useProgram(programObject3D),disableVertexAttribPointer("aTexture3d",programObject3D,"aTexture"),uniformMatrix("model3d",programObject3D,"model",!1,c.array()),uniformMatrix("view3d",programObject3D,"view",!1,d.array()),uniformMatrix("projection3d",programObject3D,"projection",!1,e.array()),uniformMatrix("normalTransform3d",programObject3D,"normalTransform",!1,h.array()),vertexAttribPointer("vertex3d",programObject3D,"Vertex",3,sphereBuffer),vertexAttribPointer("normal3d",programObject3D,"Normal",3,sphereBuffer),vertexAttribPointer("aColor3d",programObject3D,"aColor",3,sphereBuffer),curContext.enable(curContext.POLYGON_OFFSET_FILL),curContext.polygonOffset(1,1),uniformf("color3d",programObject3D,"color",fillStyle),curContext.drawArrays(curContext.TRIANGLE_STRIP,0,sphereVerts.length/3),curContext.disable(curContext.POLYGON_OFFSET_FILL)}lineWidth>0&&doStroke&&(curContext.useProgram(programObject2D),uniformMatrix("model2d",programObject2D,"model",!1,c.array()),uniformMatrix("view2d",programObject2D,"view",!1,d.array()),uniformMatrix("projection2d",programObject2D,"projection",!1,e.array()),vertexAttribPointer("vertex2d",programObject2D,"Vertex",3,sphereBuffer),disableVertexAttribPointer("aTextureCoord2d",programObject2D,"aTextureCoord"),uniformf("color2d",programObject2D,"color",strokeStyle),uniformi("picktype2d",programObject2D,"picktype",0),curContext.lineWidth(lineWidth),curContext.drawArrays(curContext.LINE_STRIP,0,sphereVerts.length/3))}},p.modelX=function(a,b,c){var d=modelView.array(),e=cameraInv.array(),f=d[0]*a+d[1]*b+d[2]*c+d[3],g=d[4]*a+d[5]*b+d[6]*c+d[7],h=d[8]*a+d[9]*b+d[10]*c+d[11],i=d[12]*a+d[13]*b+d[14]*c+d[15],j=e[0]*f+e[1]*g+e[2]*h+e[3]*i,k=e[12]*f+e[13]*g+e[14]*h+e[15]*i;return k!==0?j/k:j},p.modelY=function(a,b,c){var d=modelView.array(),e=cameraInv.array(),f=d[0]*a+d[1]*b+d[2]*c+d[3],g=d[4]*a+d[5]*b+d[6]*c+d[7],h=d[8]*a+d[9]*b+d[10]*c+d[11],i=d[12]*a+d[13]*b+d[14]*c+d[15],j=e[4]*f+e[5]*g+e[6]*h+e[7]*i,k=e[12]*f+e[13]*g+e[14]*h+e[15]*i;return k!==0?j/k:j},p.modelZ=function(a,b,c){var d=modelView.array(),e=cameraInv.array(),f=d[0]*a+d[1]*b+d[2]*c+d[3],g=d[4]*a+d[5]*b+d[6]*c+d[7],h=d[8]*a+d[9]*b+d[10]*c+d[11],i=d[12]*a+d[13]*b+d[14]*c+d[15],j=e[8]*f+e[9]*g+e[10]*h+e[11]*i,k=e[12]*f+e[13]*g+e[14]*h+e[15]*i;return k!==0?j/k:j},p.ambient=function(){var a=arguments;if(p.use3DContext){curContext.useProgram(programObject3D),uniformi("usingMat3d",programObject3D,"usingMat",!0);if(a.length===1)if(typeof a[0]=="string"){var b=a[0].slice(5,-1).split(",");uniformf("mat_ambient3d",programObject3D,"mat_ambient",[b[0]/255,b[1]/255,b[2]/255])}else uniformf("mat_ambient3d",programObject3D,"mat_ambient",[a[0]/255,a[0]/255,a[0]/255]);else uniformf("mat_ambient3d",programObject3D,"mat_ambient",[a[0]/255,a[1]/255,a[2]/255])}},p.emissive=function(){var a=arguments;if(p.use3DContext){curContext.useProgram(programObject3D),uniformi("usingMat3d",programObject3D,"usingMat",!0);if(a.length===1)if(typeof a[0]=="string"){var b=a[0].slice(5,-1).split(",");uniformf("mat_emissive3d",programObject3D,"mat_emissive",[b[0]/255,b[1]/255,b[2]/255])}else uniformf("mat_emissive3d",programObject3D,"mat_emissive",[a[0]/255,a[0]/255,a[0]/255]);else uniformf("mat_emissive3d",programObject3D,"mat_emissive",[a[0]/255,a[1]/255,a[2]/255])}},p.shininess=function(a){p.use3DContext&&(curContext.useProgram(programObject3D),uniformi("usingMat3d",programObject3D,"usingMat",!0),uniformf("shininess3d",programObject3D,"shininess",a))},p.specular=function(){var a=p.color.apply(this,arguments);p.use3DContext&&(curContext.useProgram(programObject3D),uniformi("usingMat3d",programObject3D,"usingMat",!0),uniformf("mat_specular3d",programObject3D,"mat_specular",p.color.toGLArray(a).slice(0,3)))},p.screenX=function(a,b,c){var d=modelView.array(),e=projection.array(),f=d[0]*a+d[1]*b+d[2]*c+d[3],g=d[4]*a+d[5]*b+d[6]*c+d[7],h=d[8]*a+d[9]*b+d[10]*c+d[11],i=d[12]*a+d[13]*b+d[14]*c+d[15],j=e[0]*f+e[1]*g+e[2]*h+e[3]*i,k=e[12]*f+e[13]*g+e[14]*h+e[15]*i;k!==0&&(j/=k);return p.width*(1+j)/2},p.screenY=function(a,b,c){var d=modelView.array(),e=projection.array(),f=d[0]*a+d[1]*b+d[2]*c+d[3],g=d[4]*a+d[5]*b+d[6]*c+d[7],h=d[8]*a+d[9]*b+d[10]*c+d[11],i=d[12]*a+d[13]*b+d[14]*c+d[15],j=e[4]*f+e[5]*g+e[6]*h+e[7]*i,k=e[12]*f+e[13]*g+e[14]*h+e[15]*i;k!==0&&(j/=k);return p.height*(1+j)/2},p.screenZ=function(a,b,c){var d=modelView.array(),e=projection.array(),f=d[0]*a+d[1]*b+d[2]*c+d[3],g=d[4]*a+d[5]*b+d[6]*c+d[7],h=d[8]*a+d[9]*b+d[10]*c+d[11],i=d[12]*a+d[13]*b+d[14]*c+d[15],j=e[8]*f+e[9]*g+e[10]*h+e[11]*i,k=e[12]*f+e[13]*g+e[14]*h+e[15]*i;k!==0&&(j/=k);return(j+1)/2},p.fill=function(){var a=p.color(arguments[0],arguments[1],arguments[2],arguments[3]);if(a!==currentFillColor||!doFill)doFill=!0,currentFillColor=a,p.use3DContext?fillStyle=p.color.toGLArray(a):isFillDirty=!0},p.noFill=function(){doFill=!1},p.stroke=function(){var a=p.color(arguments[0],arguments[1],arguments[2],arguments[3]);if(a!==currentStrokeColor||!doStroke)doStroke=!0,currentStrokeColor=a,p.use3DContext?strokeStyle=p.color.toGLArray(a):isStrokeDirty=!0},p.noStroke=function(){doStroke=!1},p.strokeWeight=function(a){lineWidth=a,p.use3DContext?(curContext.useProgram(programObject2D),uniformf("pointSize2d",programObject2D,"pointSize",a)):curContext.lineWidth=a},p.strokeCap=function(a){curContext.lineCap=a},p.strokeJoin=function(a){curContext.lineJoin=a},p.smooth=function(){curElement.style.setProperty("image-rendering","optimizeQuality","important"),!p.use3DContext&&"mozImageSmoothingEnabled"in curContext&&(curContext.mozImageSmoothingEnabled=!0)},p.noSmooth=function(){curElement.style.setProperty("image-rendering","optimizeSpeed","important"),!p.use3DContext&&"mozImageSmoothingEnabled"in curContext&&(curContext.mozImageSmoothingEnabled=!1)},p.point=function(a,b,c){if(p.use3DContext){var d=new PMatrix3D;d.translate(a,b,c||0),d.transpose();var e=new PMatrix3D;e.scale(1,-1,1),e.apply(modelView.array()),e.transpose();var f=new PMatrix3D;f.set(projection),f.transpose(),curContext.useProgram(programObject2D),uniformMatrix("model2d",programObject2D,"model",!1,d.array()),uniformMatrix("view2d",programObject2D,"view",!1,e.array()),uniformMatrix("projection2d",programObject2D,"projection",!1,f.array()),lineWidth>0&&doStroke&&(uniformf("color2d",programObject2D,"color",strokeStyle),uniformi("picktype2d",programObject2D,"picktype",0),vertexAttribPointer("vertex2d",programObject2D,"Vertex",3,pointBuffer),disableVertexAttribPointer("aTextureCoord2d",programObject2D,"aTextureCoord"),curContext.drawArrays(curContext.POINTS,0,1))}else if(doStroke)if(curSketch.options.crispLines){var g=Math.PI/4,h=p.get(a,b);p.set(a,b,colorBlendWithAlpha(h,currentStrokeColor,g))}else lineWidth>1?(curContext.fillStyle=p.color.toString(currentStrokeColor),isFillDirty=!0,curContext.beginPath(),curContext.arc(a,b,lineWidth/2,0,PConstants.TWO_PI,!1),curContext.fill(),curContext.closePath()):(curContext.fillStyle=p.color.toString(currentStrokeColor),curContext.fillRect(Math.round(a),Math.round(b),1,1),isFillDirty=!0)},p.beginShape=function(a){curShape=a,curvePoints=[],vertArray=[]},p.vertex=function(){var a=[];firstVert&&(firstVert=!1),arguments.length===4?(a[0]=arguments[0],a[1]=arguments[1],a[2]=0,a[3]=arguments[2],a[4]=arguments[3]):(a[0]=arguments[0],a[1]=arguments[1],a[2]=arguments[2]||0,a[3]=arguments[3]||0,a[4]=arguments[4]||0),a.isVert=!0,p.use3DContext?(a[5]=fillStyle[0],a[6]=fillStyle[1],a[7]=fillStyle[2],a[8]=fillStyle[3],a[9]=strokeStyle[0],a[10]=strokeStyle[1],a[11]=strokeStyle[2],a[12]=strokeStyle[3],a[13]=normalX,a[14]=normalY,a[15]=normalZ):(a[5]=currentFillColor,a[6]=currentStrokeColor),vertArray.push(a)};var point3D=function point3D(a,b){var c=new PMatrix3D;c.scale(1,-1,1),c.apply(modelView.array()),c.transpose();var d=new PMatrix3D;d.set(projection),d.transpose(),curContext.useProgram(programObjectUnlitShape),uniformMatrix("uViewUS",programObjectUnlitShape,"uView",!1,c.array()),uniformMatrix("uProjectionUS",programObjectUnlitShape,"uProjection",!1,d.array()),vertexAttribPointer("aVertexUS",programObjectUnlitShape,"aVertex",3,pointBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array(a),curContext.STREAM_DRAW),vertexAttribPointer("aColorUS",programObjectUnlitShape,"aColor",4,fillColorBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array(b),curContext.STREAM_DRAW),curContext.drawArrays(curContext.POINTS,0,a.length/3)},line3D=function line3D(a,b,c){var d;b==="LINES"?d=curContext.LINES:b==="LINE_LOOP"?d=curContext.LINE_LOOP:d=curContext.LINE_STRIP;var e=new PMatrix3D;e.scale(1,-1,1),e.apply(modelView.array()),e.transpose();var f=new PMatrix3D;f.set(projection),f.transpose(),curContext.useProgram(programObjectUnlitShape),uniformMatrix("uViewUS",programObjectUnlitShape,"uView",!1,e.array()),uniformMatrix("uProjectionUS",programObjectUnlitShape,"uProjection",!1,f.array()),vertexAttribPointer("aVertexUS",programObjectUnlitShape,"aVertex",3,lineBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array(a),curContext.STREAM_DRAW),vertexAttribPointer("aColorUS",programObjectUnlitShape,"aColor",4,strokeColorBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array(c),curContext.STREAM_DRAW),curContext.lineWidth(lineWidth),curContext.drawArrays(d,0,a.length/3)},fill3D=function fill3D(a,b,c,d){var e;b==="TRIANGLES"?e=curContext.TRIANGLES:b==="TRIANGLE_FAN"?e=curContext.TRIANGLE_FAN:e=curContext.TRIANGLE_STRIP;var f=new PMatrix3D;f.scale(1,-1,1),f.apply(modelView.array()),f.transpose();var g=new PMatrix3D;g.set(projection),g.transpose(),curContext.useProgram(programObject3D),uniformMatrix("model3d",programObject3D,"model",!1,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),uniformMatrix("view3d",programObject3D,"view",!1,f.array()),uniformMatrix("projection3d",programObject3D,"projection",!1,g.array()),curContext.enable(curContext.POLYGON_OFFSET_FILL),curContext.polygonOffset(1,1),uniformf("color3d",programObject3D,"color",[-1,0,0,0]),vertexAttribPointer("vertex3d",programObject3D,"Vertex",3,fillBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array(a),curContext.STREAM_DRAW),vertexAttribPointer("aColor3d",programObject3D,"aColor",4,fillColorBuffer),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array(c),curContext.STREAM_DRAW),disableVertexAttribPointer("normal3d",programObject3D,"Normal");var h;if(usingTexture){if(curTextureMode===PConstants.IMAGE)for(h=0;h<d.length;h+=2)d[h]=d[h]/curTexture.width,d[h+1]/=curTexture.height;for(h=0;h<d.length;h+=2)d[h+0]>1&&(d[h+0]-=d[h+0]-1),d[h+1]>1&&(d[h+1]-=d[h+1]-1);uniformi("usingTexture3d",programObject3D,"usingTexture",usingTexture),vertexAttribPointer("aTexture3d",programObject3D,"aTexture",2,shapeTexVBO),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array(d),curContext.STREAM_DRAW)}curContext.drawArrays(e,0,a.length/3),curContext.disable(curContext.POLYGON_OFFSET_FILL)};p.endShape=function(a){var b=a===PConstants.CLOSE,c=[],d=[],e=[],f=[],g=[];firstVert=!0;var h,i,j,k=vertArray.length-1;for(h=0;h<vertArray.length;h++)for(i=0;i<3;i++)d.push(vertArray[h][i]);for(h=0;h<vertArray.length;h++)for(i=5;i<9;i++)e.push(vertArray[h][i]);for(h=0;h<vertArray.length;h++)for(i=9;i<13;i++)f.push(vertArray[h][i]);for(h=0;h<vertArray.length;h++)g.push(vertArray[h][3]),g.push(vertArray[h][4]);if(b){d.push(vertArray[0][0]),d.push(vertArray[0][1]),d.push(vertArray[0][2]);for(h=5;h<9;h++)e.push(vertArray[0][h]);for(h=9;h<13;h++)f.push(vertArray[0][h]);g.push(vertArray[0][3]),g.push(vertArray[0][4])}if(isCurve&&curShape===PConstants.POLYGON||isCurve&&curShape===undef){if(p.use3DContext)c=d,doStroke&&line3D(c,null,f),doFill&&fill3D(d,null,e);else if(vertArray.length>3){var l=[],m=1-curTightness;curContext.beginPath(),curContext.moveTo(vertArray[1][0],vertArray[1][1]);for(h=1;h+2<vertArray.length;h++)l[0]=[vertArray[h][0],vertArray[h][1]],l[1]=[vertArray[h][0]+(m*vertArray[h+1][0]-m*vertArray[h-1][0])/6,vertArray[h][1]+(m*vertArray[h+1][1]-m*vertArray[h-1][1])/6],l[2]=[vertArray[h+1][0]+(m*vertArray[h][0]-m*vertArray[h+2][0])/6,vertArray[h+1][1]+(m*vertArray[h][1]-m*vertArray[h+2][1])/6],l[3]=[vertArray[h+1][0],vertArray[h+1][1]],curContext.bezierCurveTo(l[1][0],l[1][1],l[2][0],l[2][1],l[3][0],l[3][1]);b&&curContext.lineTo(vertArray[0][0],vertArray[0][1]),executeContextFill(),executeContextStroke(),curContext.closePath()}}else if(isBezier&&curShape===PConstants.POLYGON||isBezier&&curShape===undef)if(p.use3DContext)c=d,c.splice(c.length-3),f.splice(f.length-4),doStroke&&line3D(c,null,f),doFill&&fill3D(d,"TRIANGLES",e);else{curContext.beginPath();for(h=0;h<vertArray.length;h++)vertArray[h].isVert===!0?vertArray[h].moveTo===!0?curContext.moveTo(vertArray[h][0],vertArray[h][1]):vertArray[h].moveTo===!1?curContext.lineTo(vertArray[h][0],vertArray[h][1]):curContext.moveTo(vertArray[h][0],vertArray[h][1]):curContext.bezierCurveTo(vertArray[h][0],vertArray[h][1],vertArray[h][2],vertArray[h][3],vertArray[h][4],vertArray[h][5]);b&&curContext.lineTo(vertArray[0][0],vertArray[0][1]),executeContextFill(),executeContextStroke(),curContext.closePath()}else if(p.use3DContext){if(curShape===PConstants.POINTS){for(h=0;h<vertArray.length;h++)for(i=0;i<3;i++)c.push(vertArray[h][i]);point3D(c,f)}else if(curShape===PConstants.LINES){for(h=0;h<vertArray.length;h++)for(i=0;i<3;i++)c.push(vertArray[h][i]);for(h=0;h<vertArray.length;h++)for(i=5;i<9;i++)e.push(vertArray[h][i]);line3D(c,"LINES",f)}else if(curShape===PConstants.TRIANGLES){if(vertArray.length>2)for(h=0;h+2<vertArray.length;h+=3){d=[],g=[],c=[],e=[],f=[];for(i=0;i<3;i++)for(j=0;j<3;j++)c.push(vertArray[h+i][j]),d.push(vertArray[h+i][j]);for(i=0;i<3;i++)for(j=3;j<5;j++)g.push(vertArray[h+i][j]);for(i=0;i<3;i++)for(j=5;j<9;j++)e.push(vertArray[h+i][j]),f.push(vertArray[h+i][j+4]);doStroke&&line3D(c,"LINE_LOOP",f),(doFill||usingTexture)&&fill3D(d,"TRIANGLES",e,g)}}else if(curShape===PConstants.TRIANGLE_STRIP){if(vertArray.length>2)for(h=0;h+2<vertArray.length;h++){c=[],d=[],f=[],e=[],g=[];for(i=0;i<3;i++)for(j=0;j<3;j++)c.push(vertArray[h+i][j]),d.push(vertArray[h+i][j]);for(i=0;i<3;i++)for(j=3;j<5;j++)g.push(vertArray[h+i][j]);for(i=0;i<3;i++)for(j=5;j<9;j++)f.push(vertArray[h+i][j+4]),e.push(vertArray[h+i][j]);(doFill||usingTexture)&&fill3D(d,"TRIANGLE_STRIP",e,g),doStroke&&line3D(c,"LINE_LOOP",f)}}else if(curShape===PConstants.TRIANGLE_FAN){if(vertArray.length>2){for(h=0;h<3;h++)for(i=0;i<3;i++)c.push(vertArray[h][i]);for(h=0;h<3;h++)for(i=9;i<13;i++)f.push(vertArray[h][i]);doStroke&&line3D(c,"LINE_LOOP",f);for(h=2;h+1<vertArray.length;h++){c=[],f=[],c.push(vertArray[0][0]),c.push(vertArray[0][1]),c.push(vertArray[0][2]),f.push(vertArray[0][9]),f.push(vertArray[0][10]),f.push(vertArray[0][11]),f.push(vertArray[0][12]);for(i=0;i<2;i++)for(j=0;j<3;j++)c.push(vertArray[h+i][j]);for(i=0;i<2;i++)for(j=9;j<13;j++)f.push(vertArray[h+i][j]);doStroke&&line3D(c,"LINE_STRIP",f)}(doFill||usingTexture)&&fill3D(d,"TRIANGLE_FAN",e,g)}}else if(curShape===PConstants.QUADS)for(h=0;h+3<vertArray.length;h+=4){c=[];for(i=0;i<4;i++)for(j=0;j<3;j++)c.push(vertArray[h+i][j]);doStroke&&line3D(c,"LINE_LOOP",f);if(doFill){d=[],e=[],g=[];for(i=0;i<3;i++)d.push(vertArray[h][i]);for(i=5;i<9;i++)e.push(vertArray[h][i]);for(i=0;i<3;i++)d.push(vertArray[h+1][i]);for(i=5;i<9;i++)e.push(vertArray[h+1][i]);for(i=0;i<3;i++)d.push(vertArray[h+3][i]);for(i=5;i<9;i++)e.push(vertArray[h+3][i]);for(i=0;i<3;i++)d.push(vertArray[h+2][i]);for(i=5;i<9;i++)e.push(vertArray[h+2][i]);usingTexture&&(g.push(vertArray[h+0][3]),g.push(vertArray[h+0][4]),g.push(vertArray[h+1][3]),g.push(vertArray[h+1][4]),g.push(vertArray[h+3][3]),g.push(vertArray[h+3][4]),g.push(vertArray[h+2][3]),g.push(vertArray[h+2][4])),fill3D(d,"TRIANGLE_STRIP",e,g)}}else if(curShape===PConstants.QUAD_STRIP){var n=[];if(vertArray.length>3){for(h=0;h<2;h++)for(i=0;i<3;i++)c.push(vertArray[h][i]);for(h=0;h<2;h++)for(i=9;i<13;i++)f.push(vertArray[h][i]);line3D(c,"LINE_STRIP",f),vertArray.length>4&&vertArray.length%2>0&&(n=d.splice(d.length-3),vertArray.pop());for(h=0;h+3<vertArray.length;h+=2){c=[],f=[];for(i=0;i<3;i++)c.push(vertArray[h+1][i]);for(i=0;i<3;i++)c.push(vertArray[h+3][i]);for(i=0;i<3;i++)c.push(vertArray[h+2][i]);for(i=0;i<3;i++)c.push(vertArray[h+0][i]);for(i=9;i<13;i++)f.push(vertArray[h+1][i]);for(i=9;i<13;i++)f.push(vertArray[h+3][i]);for(i=9;i<13;i++)f.push(vertArray[h+2][i]);for(i=9;i<13;i++)f.push(vertArray[h+0][i]);doStroke&&line3D(c,"LINE_STRIP",f)}(doFill||usingTexture)&&fill3D(d,"TRIANGLE_LIST",e,g)}}else if(vertArray.length===1){for(i=0;i<3;i++)c.push(vertArray[0][i]);for(i=9;i<13;i++)f.push(vertArray[0][i]);point3D(c,f)}else{for(h=0;h<vertArray.length;h++){for(i=0;i<3;i++)c.push(vertArray[h][i]);for(i=5;i<9;i++)f.push(vertArray[h][i])}b?line3D(c,"LINE_LOOP",f):line3D(c,"LINE_STRIP",f),(doFill||usingTexture)&&fill3D(d,"TRIANGLE_FAN",e,g)}usingTexture=!1,curContext.useProgram(programObject3D),uniformi("usingTexture3d",programObject3D,"usingTexture",usingTexture)}else if(curShape===PConstants.POINTS)for(h=0;h<vertArray.length;h++)doStroke&&p.stroke(vertArray[h][6]),p.point(vertArray[h][0],vertArray[h][1]);else if(curShape===PConstants.LINES)for(h=0;h+1<vertArray.length;h+=2)doStroke&&p.stroke(vertArray[h+1][6]),p.line(vertArray[h][0],vertArray[h][1],vertArray[h+1][0],vertArray[h+1][1]);else if(curShape===PConstants.TRIANGLES)for(h=0;h+2<vertArray.length;h+=3)curContext.beginPath(),curContext.moveTo(vertArray[h][0],vertArray[h][1]),curContext.lineTo(vertArray[h+1][0],vertArray[h+1][1]),curContext.lineTo(vertArray[h+2][0],vertArray[h+2][1]),curContext.lineTo(vertArray[h][0],vertArray[h][1]),doFill&&(p.fill(vertArray[h+2][5]),executeContextFill()),doStroke&&(p.stroke(vertArray[h+2][6]),executeContextStroke()),curContext.closePath();else if(curShape===PConstants.TRIANGLE_STRIP)for(h=0;h+1<vertArray.length;h++)curContext.beginPath(),curContext.moveTo(vertArray[h+1][0],vertArray[h+1][1]),curContext.lineTo(vertArray[h][0],vertArray[h][1]),doStroke&&p.stroke(vertArray[h+1][6]),doFill&&p.fill(vertArray[h+1][5]),h+2<vertArray.length&&(curContext.lineTo(vertArray[h+2][0],vertArray[h+2][1]),doStroke&&p.stroke(vertArray[h+2][6]),doFill&&p.fill(vertArray[h+2][5])),executeContextFill(),executeContextStroke(),curContext.closePath();else if(curShape===PConstants.TRIANGLE_FAN){if(vertArray.length>2){curContext.beginPath(),curContext.moveTo(vertArray[0][0],vertArray[0][1]),curContext.lineTo(vertArray[1][0],vertArray[1][1]),curContext.lineTo(vertArray[2][0],vertArray[2][1]),doFill&&(p.fill(vertArray[2][5]),executeContextFill()),doStroke&&(p.stroke(vertArray[2][6]),executeContextStroke()),curContext.closePath();for(h=3;h<vertArray.length;h++)curContext.beginPath(),curContext.moveTo(vertArray[0][0],vertArray[0][1]),curContext.lineTo(vertArray[h-1][0],vertArray[h-1][1]),curContext.lineTo(vertArray[h][0],vertArray[h][1]),doFill&&(p.fill(vertArray[h][5]),executeContextFill()),doStroke&&(p.stroke(vertArray[h][6]),executeContextStroke()),curContext.closePath()}}else if(curShape===PConstants.QUADS)for(h=0;h+3<vertArray.length;h+=4){curContext.beginPath(),curContext.moveTo(vertArray[h][0],vertArray[h][1]);for(i=1;i<4;i++)curContext.lineTo(vertArray[h+i][0],vertArray[h+i][1]);curContext.lineTo(vertArray[h][0],vertArray[h][1]),doFill&&(p.fill(vertArray[h+3][5]),executeContextFill()),doStroke&&(p.stroke(vertArray[h+3][6]),executeContextStroke()),curContext.closePath()}else if(curShape===PConstants.QUAD_STRIP){if(vertArray.length>3)for(h=0;h+1<vertArray.length;h+=2)curContext.beginPath(),h+3<vertArray.length?(curContext.moveTo(vertArray[h+2][0],vertArray[h+2][1]),curContext.lineTo(vertArray[h][0],vertArray[h][1]),curContext.lineTo(vertArray[h+1][0],vertArray[h+1][1]),curContext.lineTo(vertArray[h+3][0],vertArray[h+3][1]),doFill&&p.fill(vertArray[h+3][5]),doStroke&&p.stroke(vertArray[h+3][6])):(curContext.moveTo(vertArray[h][0],vertArray[h][1]),curContext.lineTo(vertArray[h+1][0],vertArray[h+1][1])),executeContextFill(),executeContextStroke(),curContext.closePath()}else{curContext.beginPath(),curContext.moveTo(vertArray[0][0],vertArray[0][1]);for(h=1;h<vertArray.length;h++)vertArray[h].isVert===!0&&(vertArray[h].moveTo===!0?curContext.moveTo(vertArray[h][0],vertArray[h][1]):vertArray[h].moveTo===!1?curContext.lineTo(vertArray[h][0],vertArray[h][1]):curContext.lineTo(vertArray[h][0],vertArray[h][1]));b&&curContext.lineTo(vertArray[0][0],vertArray[0][1]),executeContextFill(),executeContextStroke(),curContext.closePath()}isCurve=!1,isBezier=!1,curveVertArray=[],curveVertCount=0};var splineForward=function(a,b){var c=1/a,d=c*c,e=d*c;b.set(0,0,0,1,e,d,c,0,6*e,2*d,0,0,6*e,0,0,0)},curveInit=function(){curveDrawMatrix||(curveBasisMatrix=new PMatrix3D,curveDrawMatrix=new PMatrix3D,curveInited=!0);var a=curTightness;curveBasisMatrix.set((a-1)/2,(a+3)/2,(-3-a)/2,(1-a)/2,1-a,(-5-a)/2,a+2,(a-1)/2,(a-1)/2,0,(1-a)/2,0,0,1,0,0),splineForward(curveDet,curveDrawMatrix),bezierBasisInverse||(curveToBezierMatrix=new PMatrix3D),curveToBezierMatrix.set(curveBasisMatrix),curveToBezierMatrix.preApply(bezierBasisInverse),curveDrawMatrix.apply(curveBasisMatrix)};p.bezierVertex=function(){isBezier=!0;var a=[];if(firstVert)throw"vertex() must be used at least once before calling bezierVertex()";if(arguments.length===9){if(p.use3DContext){bezierDrawMatrix===undef&&(bezierDrawMatrix=new PMatrix3D);var b=vertArray.length-1;splineForward(bezDetail,bezierDrawMatrix),bezierDrawMatrix.apply(bezierBasisMatrix);var c=bezierDrawMatrix.array(),d=vertArray[b][0],e=vertArray[b][1],f=vertArray[b][2],g=c[4]*d+c[5]*arguments[0]+c[6]*arguments[3]+c[7]*arguments[6],h=c[8]*d+c[9]*arguments[0]+c[10]*arguments[3]+c[11]*arguments[6],i=c[12]*d+c[13]*arguments[0]+c[14]*arguments[3]+c[15]*arguments[6],j=c[4]*e+c[5]*arguments[1]+c[6]*arguments[4]+c[7]*arguments[7],k=c[8]*e+c[9]*arguments[1]+c[10]*arguments[4]+c[11]*arguments[7],l=c[12]*e+c[13]*arguments[1]+c[14]*arguments[4]+c[15]*arguments[7],m=c[4]*f+c[5]*arguments[2]+c[6]*arguments[5]+c[7]*arguments[8],n=c[8]*f+c[9]*arguments[2]+c[10]*arguments[5]+c[11]*arguments[8],o=c[12]*f+c[13]*arguments[2]+c[14]*arguments[5]+c[15]*arguments[8];for(var q=0;q<bezDetail;q++)d+=g,g+=h,h+=i,e+=j,j+=k,k+=l,f+=m,m+=n,n+=o,p.vertex(d,e,f);p.vertex(arguments[6],arguments[7],arguments[8])}}else{for(var r=0;r<arguments.length;r++)a[r]=arguments[r];vertArray.push(a),vertArray[vertArray.length-1].isVert=!1}};var executeTexImage2D=function(){var a=document.createElement("canvas");try{curContext.texImage2D(curContext.TEXTURE_2D,0,curContext.RGBA,curContext.RGBA,curContext.UNSIGNED_BYTE,a),executeTexImage2D=function(a){curContext.texImage2D(curContext.TEXTURE_2D,0,curContext.RGBA,curContext.RGBA,curContext.UNSIGNED_BYTE,a)}}catch(b){executeTexImage2D=function(a){curContext.texImage2D(curContext.TEXTURE_2D,0,a,!1)}}executeTexImage2D.apply(this,arguments)};p.texture=function(a){if(a.localName==="canvas")curContext.bindTexture(curContext.TEXTURE_2D,canTex),executeTexImage2D(a),curContext.texParameteri(curContext.TEXTURE_2D,curContext.TEXTURE_MAG_FILTER,curContext.LINEAR),curContext.texParameteri(curContext.TEXTURE_2D,curContext.TEXTURE_MIN_FILTER,curContext.LINEAR),curContext.generateMipmap(curContext.TEXTURE_2D);else if(!a.__texture){var b=curContext.createTexture();a.__texture=b;var c=document.createElement("canvas"),d;if(a.width&a.width-1===0)c.width=a.width;else{d=1;while(d<a.width)d*=2;c.width=d}if(a.height&a.height-1===0)c.height=a.height;else{d=1;while(d<a.height)d*=2;c.height=d}var e=c.getContext("2d"),f=e.createImageData(c.width,c.height),g=a.toImageData();for(var h=0;h<c.width;h+=1)for(var i=0;i<c.height;i+=1){var j=(i*c.width+h)*4;f.data[j+0]=g.data[j+0],f.data[j+1]=g.data[j+1],f.data[j+2]=g.data[j+2],f.data[j+3]=255}e.putImageData(f,0,0),a.__cvs=c,curContext.bindTexture(curContext.TEXTURE_2D,a.__texture),curContext.texParameteri(curContext.TEXTURE_2D,curContext.TEXTURE_MIN_FILTER,curContext.LINEAR_MIPMAP_LINEAR),curContext.texParameteri(curContext.TEXTURE_2D,curContext.TEXTURE_MAG_FILTER,curContext.LINEAR),curContext.texParameteri(curContext.TEXTURE_2D,curContext.TEXTURE_WRAP_T,curContext.CLAMP_TO_EDGE),curContext.texParameteri(curContext.TEXTURE_2D,curContext.TEXTURE_WRAP_S,curContext.CLAMP_TO_EDGE),executeTexImage2D(a.__cvs),curContext.generateMipmap(curContext.TEXTURE_2D)}else curContext.bindTexture(curContext.TEXTURE_2D,a.__texture);curTexture.width=a.width,curTexture.height=a.height,usingTexture=!0,curContext.useProgram(programObject3D),uniformi("usingTexture3d",programObject3D,"usingTexture",usingTexture)},p.textureMode=function(a){curTextureMode=a};var curveVertexSegment=function(a,b,c,d,e,f,g,h,i,j,k,l){var m=d,n=e,o=f,q=curveDrawMatrix.array(),r=q[4]*a+q[5]*d+q[6]*g+q[7]*j,s=q[8]*a+q[9]*d+q[10]*g+q[11]*j,t=q[12]*a+q[13]*d+q[14]*g+q[15]*j,u=q[4]*b+q[5]*e+q[6]*h+q[7]*k,v=q[8]*b+q[9]*e+q[10]*h+q[11]*k,w=q[12]*b+q[13]*e+q[14]*h+q[15]*k,x=q[4]*c+q[5]*f+q[6]*i+q[7]*l,y=q[8]*c+q[9]*f+q[10]*i+q[11]*l,z=q[12]*c+q[13]*f+q[14]*i+q[15]*l;p.vertex(m,n,o);for(var A=0;A<curveDet;A++)m+=r,r+=s,s+=t,n+=u,u+=v,v+=w,o+=x,x+=y,y+=z,p.vertex(m,n,o)};p.curveVertex=function(a,b,c){isCurve=!0;if(p.use3DContext){curveInited||curveInit();var d=[];d[0]=a,d[1]=b,d[2]=c,curveVertArray.push(d),curveVertCount++,curveVertCount>3&&curveVertexSegment(curveVertArray[curveVertCount-4][0],curveVertArray[curveVertCount-4][1],curveVertArray[curveVertCount-4][2],curveVertArray[curveVertCount-3][0],curveVertArray[curveVertCount-3][1],curveVertArray[curveVertCount-3][2],curveVertArray[curveVertCount-2][0],curveVertArray[curveVertCount-2][1],curveVertArray[curveVertCount-2][2],curveVertArray[curveVertCount-1][0],curveVertArray[curveVertCount-1][1],curveVertArray[curveVertCount-1][2])}else p.vertex(a,b,c)},p.curve=function(){arguments.length===8?(p.beginShape(),p.curveVertex(arguments[0],arguments[1]),p.curveVertex(arguments[2],arguments[3]),p.curveVertex(arguments[4],arguments[5]),p.curveVertex(arguments[6],arguments[7]),p.endShape()):p.use3DContext&&(p.beginShape(),p.curveVertex(arguments[0],arguments[1],arguments[2]),p.curveVertex(arguments[3],arguments[4],arguments[5]),p.curveVertex(arguments[6],arguments[7],arguments[8]),p.curveVertex(arguments[9],arguments[10],arguments[11]),p.endShape())},p.curveTightness=function(a){curTightness=a},p.curveDetail=function(a){curveDet=a,curveInit()},p.rectMode=function(a){curRectMode=a},p.imageMode=function(a){switch(a){case PConstants.CORNER:imageModeConvert=imageModeCorner;break;case PConstants.CORNERS:imageModeConvert=imageModeCorners;break;case PConstants.CENTER:imageModeConvert=imageModeCenter;break;default:throw"Invalid imageMode"}},p.ellipseMode=function(a){curEllipseMode=a},p.arc=function(a,b,c,d,e,f){if(!(c<=0||f<e)){curEllipseMode===PConstants.CORNERS?(c=c-a,d=d-b):curEllipseMode===PConstants.RADIUS?(a=a-c,b=b-d,c=c*2,d=d*2):curEllipseMode===PConstants.CENTER&&(a=a-c/2,b=b-d/2);while(e<0)e+=PConstants.TWO_PI,f+=PConstants.TWO_PI;f-e>PConstants.TWO_PI&&(e=0,f=PConstants.TWO_PI);var g=c/2,h=d/2,i=a+g,j=b+h,k,l,m,n;if(doFill){var o=doStroke;doStroke=!1,m=.5+e/PConstants.TWO_PI*PConstants.SINCOS_LENGTH,n=.5+f/PConstants.TWO_PI*PConstants.SINCOS_LENGTH,p.beginShape(),p.vertex(i,j);for(k=m;k<n;k++)l=k%PConstants.SINCOS_LENGTH,l<0&&(l+=PConstants.SINCOS_LENGTH),p.vertex(i+parseFloat(Math.cos(l*PConstants.DEG_TO_RAD*.5))*g,j+parseFloat(Math.sin(l*PConstants.DEG_TO_RAD*.5))*h);p.endShape(PConstants.CLOSE),doStroke=o}if(doStroke){var q=doFill;doFill=!1,m=.5+e/PConstants.TWO_PI*PConstants.SINCOS_LENGTH,n=.5+f/PConstants.TWO_PI*PConstants.SINCOS_LENGTH,p.beginShape();for(k=m;k<n;k++)l=k%PConstants.SINCOS_LENGTH,l<0&&(l+=PConstants.SINCOS_LENGTH),p.vertex(i+parseFloat(Math.cos(l*PConstants.DEG_TO_RAD*.5))*g,j+parseFloat(Math.sin(l*PConstants.DEG_TO_RAD*.5))*h);p.endShape(),doFill=q}}},p.line=function(){var a,b,c,d,e,f;if(p.use3DContext){arguments.length===6?(a=arguments[0],b=arguments[1],c=arguments[2],d=arguments[3],e=arguments[4],f=arguments[5]):arguments.length===4&&(a=arguments[0],b=arguments[1],c=0,d=arguments[2],e=arguments[3],f=0);var g=[a,b,c,d,e,f],h=new PMatrix3D;h.scale(1,-1,1),h.apply(modelView.array()),h.transpose();var i=new PMatrix3D;i.set(projection),i.transpose(),lineWidth>0&&doStroke&&(curContext.useProgram(programObject2D),uniformMatrix("model2d",programObject2D,"model",!1,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),uniformMatrix("view2d",programObject2D,"view",!1,h.array()),uniformMatrix("projection2d",programObject2D,"projection",!1,i.array()),uniformf("color2d",programObject2D,"color",strokeStyle),uniformi("picktype2d",programObject2D,"picktype",0),curContext.lineWidth(lineWidth),vertexAttribPointer("vertex2d",programObject2D,"Vertex",3,lineBuffer),disableVertexAttribPointer("aTextureCoord2d",programObject2D,"aTextureCoord"),curContext.bufferData(curContext.ARRAY_BUFFER,new Float32Array(g),curContext.STREAM_DRAW),curContext.drawArrays(curContext.LINES,0,2))}else{a=arguments[0],b=arguments[1],d=arguments[2],e=arguments[3];if((a===d||b===e)&&lineWidth<=1&&doStroke&&curSketch.options.crispLines){var j;if(a===d){b>e&&(j=b,b=e,e=j);for(var k=b;k<=e;++k)p.set(a,k,currentStrokeColor)}else{a>d&&(j=a,a=d,d=j);for(var l=a;l<=d;++l)p.set(l,b,currentStrokeColor)}return}doStroke&&(curContext.beginPath(),curContext.moveTo(a||0,b||0),curContext.lineTo(d||0,e||0),executeContextStroke(),curContext.closePath())}},p.bezier=function(){if(arguments.length===8&&!p.use3DContext)p.beginShape(),p.vertex(arguments[0],arguments[1]),p.bezierVertex(arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7]),p.endShape();else if(arguments.length===12&&p.use3DContext)p.beginShape(),p.vertex(arguments[0],arguments[1],arguments[2]),p.bezierVertex(arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8],arguments[9],arguments[10],arguments[11]),p.endShape();else throw"Please use the proper parameters!"},p.bezierDetail=function(a){bezDetail=a},p.bezierPoint=function(a,b,c,d,e){return(1-e)*(1-e)*(1-e)*a+3*(1-e)*(1-e)*e*b+3*(1-e)*e*e*c+e*e*e*d},p.bezierTangent=function(a,b,c,d,e){return 3*e*e*(-a+3*b-3*c+d)+6*e*(a-2*b+c)+3*(-a+b)},p.curvePoint=function(a,b,c,d,e){return.5*(2*b+(-a+c)*e+(2*a-5*b+4*c-d)*e*e+(-a+3*b-3*c+d)*e*e*e)},p.curveTangent=function(a,b,c,d,e){return.5*(-a+c+2*(2*a-5*b+4*c-d)*e+3*(-a+3*b-3*c+d)*e*e)},p.triangle=function(a,b,c,d,e,f){p.beginShape(PConstants.TRIANGLES),p.vertex(a,b,0),p.vertex(c,d,0),p.vertex(e,f,0),p.endShape()},p.quad=function(a,b,c,d,e,f,g,h){p.beginShape(PConstants.QUADS),p.vertex(a,b,0),p.vertex(c,d,0),p.vertex(e,f,0),p.vertex(g,h,0),p.endShape()},p.rect=function(a,b,c,d){if(p.use3DContext){var e=new PMatrix3D;e.translate(a,b,0),e.scale(c,d,1),e.transpose();var f=new PMatrix3D;f.scale(1,-1,1),f.apply(modelView.array()),f.transpose();var g=new PMatrix3D;g.set(projection),g.transpose(),lineWidth>0&&doStroke&&(curContext.useProgram(programObject2D),uniformMatrix("model2d",programObject2D,"model",!1,e.array()),uniformMatrix("view2d",programObject2D,"view",!1,f.array()),uniformMatrix("projection2d",programObject2D,"projection",!1,g.array()),uniformf("color2d",programObject2D,"color",strokeStyle),uniformi("picktype2d",programObject2D,"picktype",0),vertexAttribPointer("vertex2d",programObject2D,"Vertex",3,rectBuffer),disableVertexAttribPointer("aTextureCoord2d",programObject2D,"aTextureCoord"),curContext.lineWidth(lineWidth),curContext.drawArrays(curContext.LINE_LOOP,0,rectVerts.length/3));if(doFill){curContext.useProgram(programObject3D),uniformMatrix("model3d",programObject3D,"model",!1,e.array()),uniformMatrix("view3d",programObject3D,"view",!1,f.array()),uniformMatrix("projection3d",programObject3D,"projection",!1,g.array()),curContext.enable(curContext.POLYGON_OFFSET_FILL),curContext.polygonOffset(1,1),uniformf("color3d",programObject3D,"color",fillStyle);var h=new PMatrix3D;h.set(f);var i=new PMatrix3D;i.set(e),h.mult(i);var j=new PMatrix3D;j.set(h),j.invert(),j.transpose(),uniformMatrix("normalTransform3d",programObject3D,"normalTransform",!1,j.array()),vertexAttribPointer("vertex3d",programObject3D,"Vertex",3,rectBuffer),vertexAttribPointer("normal3d",programObject3D,"Normal",3,rectNormBuffer),curContext.drawArrays(curContext.TRIANGLE_FAN,0,rectVerts.length/3),curContext.disable(curContext.POLYGON_OFFSET_FILL)}}else{if(!c&&!d)return;if(doStroke&&!doFill&&lineWidth<=1&&curSketch.options.crispLines){var k,l=a+c-1,m=b+d-1;for(k=0;k<c;++k)p.set(a+k,b,currentStrokeColor),p.set(a+k,m,currentStrokeColor);for(k=0;k<d;++k)p.set(a,b+k,currentStrokeColor),p.set(l,b+k,currentStrokeColor);return}curContext.beginPath();var n=0,o=0;curRectMode===PConstants.CORNERS&&(c-=a,d-=b),curRectMode===PConstants.RADIUS&&(c*=2,d*=2);if(curRectMode===PConstants.CENTER||curRectMode===PConstants.RADIUS)a-=c/2,b-=d/2;curContext.rect(Math.round(a)-n,Math.round(b)-n,Math.round(c)+o,Math.round(d)+o),executeContextFill(),executeContextStroke(),curContext.closePath()}},p.ellipse=function(a,b,c,d){a=a||0,b=b||0;if(!(c<=0&&d<=0)){curEllipseMode===PConstants.RADIUS&&(c*=2,d*=2),curEllipseMode===PConstants.CORNERS&&(c=c-a,d=d-b);if(curEllipseMode===PConstants.CORNER||curEllipseMode===PConstants.CORNERS)a+=c/2,b+=d/2;var e=0;if(!p.use3DContext&&c===d)curContext.beginPath(),curContext.arc(a-e,b-e,c/2,0,PConstants.TWO_PI,!1),executeContextFill(),executeContextStroke(),curContext.closePath();else{var f=c/2,g=d/2,h=.5522847498307933,i=h*f,j=h*g;if(!p.use3DContext)p.beginShape(),p.vertex(a+f,b),p.bezierVertex(a+f,b-j,a+i,b-g,a,b-g),p.bezierVertex(a-i,b-g,a-f,b-j,a-f,b),p.bezierVertex(a-f,b+j,a-i,b+g,a,b+g),p.bezierVertex(a+i,b+g,a+f,b+j,a+f,b),p.endShape();else{p.beginShape(),p.vertex(a+f,b),p.bezierVertex(a+f,b-j,0,a+i,b-g,0,a,b-g,0),p.bezierVertex(a-i,b-g,0,a-f,b-j,0,a-f,b,0),p.bezierVertex(a-f,b+j,0,a-i,b+g,0,a,b+g,0),p.bezierVertex(a+i,b+g,0,a+f,b+j,0,a+f,b,0),p.endShape();var k=0,l=0,m,n;for(m=0;m<vertArray.length;m++)k+=vertArray[m][0],l+=vertArray[m][1];k/=vertArray.length,l/=vertArray.length;var o=[],q=[],r=[];o[0]=k,o[1]=l,o[2]=0,o[3]=0,o[4]=0,o[5]=fillStyle[0],o[6]=fillStyle[1],o[7]=fillStyle[2],o[8]=fillStyle[3],o[9]=strokeStyle[0],o[10]=strokeStyle[1],o[11]=strokeStyle[2],o[12]=strokeStyle[3],o[13]=normalX,o[14]=normalY,o[15]=normalZ,vertArray.unshift(o);for(m=0;m<vertArray.length;m++){for(n=0;n<3;n++)q.push(vertArray[m][n]);for(n=5;n<9;n++)r.push(vertArray[m][n])}fill3D(q,"TRIANGLE_FAN",r)}}}},p.normal=function(a,b,c){if(arguments.length!==3||typeof a!="number"||typeof b!="number"||typeof c!="number")throw"normal() requires three numeric arguments.";normalX=a,normalY=b,normalZ=c,curShape!==0&&(normalMode===PConstants.NORMAL_MODE_AUTO?normalMode=PConstants.NORMAL_MODE_SHAPE:normalMode===PConstants.NORMAL_MODE_SHAPE&&(normalMode=PConstants.NORMAL_MODE_VERTEX))},p.save=function(a,b){return b!==undef?window.open(b.toDataURL(),"_blank"):window.open(p.externals.canvas.toDataURL(),"_blank")};var saveNumber=0;p.saveFrame=function(a){a===undef&&(a="screen-####.png");var b=a.replace(/#+/,function(a){var b=""+saveNumber++;while(b.length<a.length)b="0"+b;return b});p.save(b)};var utilityContext2d=document.createElement("canvas").getContext("2d"),canvasDataCache=[undef,undef,undef],PImage=function PImage(a,b,c){this.get=function(a,b,c,d){if(!arguments.length)return p.get(this);if(arguments.length===2)return p.get(a,b,this);if(arguments.length===4)return p.get(a,b,c,d,this)},this.set=function(a,b,c){p.set(a,b,c,this)},this.blend=function(a,b,c,d,e,f,g,h,i,j){arguments.length===9?p.blend(this,a,b,c,d,e,f,g,h,i,this):arguments.length===10&&p.blend(a,b,c,d,e,f,g,h,i,j,this),delete this.sourceImg},this.copy=function(a,b,c,d,e,f,g,h,i){arguments.length===8?p.blend(this,a,b,c,d,e,f,g,h,PConstants.REPLACE,this):arguments.length===9&&p.blend(a,b,c,d,e,f,g,h,i,PConstants.REPLACE,this),delete this.sourceImg},this.filter=function(a,b){arguments.length===2?p.filter(a,b,this):arguments.length===1&&p.filter(a,null,this),delete this.sourceImg},this.save=function(a){p.save(a,this)},this.resize=function(a,b){if(this.isRemote)throw"Image is loaded remotely. Cannot resize.";if(this.width!==0||this.height!==0){a===0&&b!==0?a=Math.floor(this.width/this.height*b):b===0&&a!==0&&(b=Math.floor(this.height/this.width*a));var c=getCanvasData(this.imageData).canvas,d=getCanvasData(c,a,b).context.getImageData(0,0,a,b);this.fromImageData(d)}},this.mask=function(a){this.__mask=undef;if(a.constructor.name==="PImage")if(a.width===this.width&&a.height===this.height)this.__mask=a;else throw"mask must have the same dimensions as PImage.";else if(typeof a=="object"&&a.constructor===Array)if(this.pixels.length===a.length)this.__mask=a;else throw"mask array must be the same length as PImage pixels array."},this.pixels={getLength:function(a){if(a.isRemote)throw"Image is loaded remotely. Cannot get length.";return function(){return a.imageData.data.length?a.imageData.data.length/4:0}}(this),getPixel:function(a){if(a.isRemote)throw"Image is loaded remotely. Cannot get pixels.";return function(b){var c=b*4;return p.color.toInt(a.imageData.data[c],a.imageData.data[c+1],a.imageData.data[c+2],a.imageData.data[c+3])}}(this),setPixel:function(a){if(a.isRemote)throw"Image is loaded remotely. Cannot set pixel.";return function(b,c){var d=b*4;a.imageData.data[d+0]=(c&PConstants.RED_MASK)>>>16,a.imageData.data[d+1]=(c&PConstants.GREEN_MASK)>>>8,a.imageData.data[d+2]=c&PConstants.BLUE_MASK,a.imageData.data[d+3]=(c&PConstants.ALPHA_MASK)>>>24}}(this),set:function(a){if(this.isRemote)throw"Image is loaded remotely. Cannot set pixels.";for(var b=0,c=a.length;b<c;b++)this.setPixel(b,a[b])}},this.loadPixels=function(){},this.updatePixels=function(){},this.toImageData=function(){if(this.isRemote)return this.sourceImg;var a=getCanvasData(this.imageData);return a.context.getImageData(0,0,this.width,this.height)},this.toDataURL=function(){if(this.isRemote)throw"Image is loaded remotely. Cannot create dataURI.";var a=getCanvasData(this.imageData);return a.canvas.toDataURL()},this.fromImageData=function(a){this.width=a.width,this.height=a.height,this.imageData=a,this.format=PConstants.ARGB},this.fromHTMLImageData=function(a){var b=getCanvasData(a);try{var c=b.context.getImageData(0,0,a.width,a.height);this.fromImageData(c)}catch(d){a.width&&a.height&&(this.isRemote=!0,this.width=a.width,this.height=a.height)}this.sourceImg=a},arguments.length===1?this.fromHTMLImageData(arguments[0]):arguments.length===2||arguments.length===3?(this.width=a||1,this.height=b||1,this.imageData=utilityContext2d.createImageData(this.width,this.height),this.format=c===PConstants.ARGB||c===PConstants.ALPHA?c:PConstants.RGB):(this.width=0,this.height=0,this.imageData=utilityContext2d.createImageData(1,1),this.format=PConstants.ARGB)};p.PImage=PImage,p.createImage=function(a,b,c){return new PImage(a,b,c)},p.loadImage=function(a,b,c){b&&(a=a+"."+b);if(curSketch.imageCache.images[a])return new PImage(curSketch.imageCache.images[a]);var d=new PImage,e=document.createElement("img");d.sourceImg=e,e.onload=function(a,b,c){var d=a,e=b,f=c;return function(){e.fromHTMLImageData(d),e.loaded=!0,f&&f()}}(e,d,c),e.src=a;return d},p.requestImage=p.loadImage,p.get=function(a,b,c,d,e){if(arguments.length===2)return get$2(a,b);if(arguments.length===0)return get$0();if(arguments.length===5)return get$5(a,b,c,d,e);if(arguments.length===4)return get$4(a,b,c,d);if(arguments.length===3)return get$3(a,b,c);if(arguments.length===1)return a},p.createGraphics=function(a,b,c){var d=document.createElement("canvas"),e=new Processing(d);e.size(a,b,c),e.canvas=d;return e},p.set=function(a,b,c,d){var e,f;arguments.length===3?typeof c=="number"?set$3(a,b,c):c instanceof PImage&&p.image(c,a,b):arguments.length===4&&set$4(a,b,c,d)},p.imageData={},p.pixels={getLength:function(){return p.imageData.data.length?p.imageData.data.length/4:0},getPixel:function(a){var b=a*4;return p.imageData.data[b+3]<<24&4278190080|p.imageData.data[b+0]<<16&16711680|p.imageData.data[b+1]<<8&65280|p.imageData.data[b+2]&255},setPixel:function(a,b){var c=a*4;p.imageData.data[c+0]=(b&16711680)>>>16,p.imageData.data[c+1]=(b&65280)>>>8,p.imageData.data[c+2]=b&255,p.imageData.data[c+3]=(b&4278190080)>>>24},set:function(a){for(var b=0,c=a.length;b<c;b++)this.setPixel(b,a[b])}},p.loadPixels=function(){p.imageData=curContext.getImageData(0,0,p.width,p.height)},p.updatePixels=function(){p.imageData&&curContext.putImageData(p.imageData,0,0)},p.hint=function(a){a===PConstants.DISABLE_DEPTH_TEST?(curContext.disable(curContext.DEPTH_TEST),curContext.depthMask(!1),curContext.clear(curContext.DEPTH_BUFFER_BIT)):a===PConstants.ENABLE_DEPTH_TEST&&(curContext.enable(curContext.DEPTH_TEST),curContext.depthMask(!0))},p.background=function(){var a,b,c;if(typeof arguments[0]=="number")a=p.color.apply(this,arguments),curSketch.options.isTransparent||(a=a|PConstants.ALPHA_MASK);else{if(!(arguments.length===1&&arguments[0]instanceof PImage))throw"Incorrect background parameters.";c=arguments[0];if(!c.pixels||c.width!==p.width||c.height!==p.height)throw"Background image must be the same dimensions as the canvas."}if(p.use3DContext)if(a!==undef){var d=p.color.toGLArray(a);refreshBackground=function(){curContext.clearColor(d[0],d[1],d[2],d[3]),curContext.clear(curContext.COLOR_BUFFER_BIT|curContext.DEPTH_BUFFER_BIT)}}else refreshBackground=function(){};else a!==undef?refreshBackground=function(){saveContext(),curContext.setTransform(1,0,0,1,0,0),curSketch.options.isTransparent&&curContext.clearRect(0,0,p.width,p.height),curContext.fillStyle=p.color.toString(a),curContext.fillRect(0,0,p.width,p.height),isFillDirty=!0,restoreContext()}:refreshBackground=function(){saveContext(),curContext.setTransform(1,0,0,1,0,0),p.image(c,0,0),restoreContext()};refreshBackground()},p.image=function(a,b,c,d,e){if(a.width>0){var f=d||a.width,g=e||a.height;if(p.use3DContext)p.beginShape(p.QUADS),p.texture(a.externals.canvas),p.vertex(b,c,0,0,0),p.vertex(b,c+g,0,0,g),p.vertex(b+f,c+g,0,f,g),p.vertex(b+f,c,0,f,0),p.endShape();else{var h=imageModeConvert(b||0,c||0,d||a.width,e||a.height,arguments.length<4),i=!!a.sourceImg&&curTint===null&&!a.__mask;if(i){var j=a.sourceImg;curContext.drawImage(j,0,0,j.width,j.height,h.x,h.y,h.w,h.h)}else{var k=a.toImageData();if(a.__mask){var l,m;if(a.__mask.constructor.name==="PImage"){var n=a.__mask.toImageData();for(l=2,m=a.width*a.height*4;l<m;l+=4)k.data[l+1]=n.data[l]}else for(l=0,m=a.__mask.length;l<m;++l)k.data[(l<<2)+3]=a.__mask[l]}curTint!==null&&curTint(k),curContext.drawImage(getCanvasData(k).canvas,0,0,a.width,a.height,h.x,h.y,h.w,h.h)}}}},p.clear=function(a,b,c,d){arguments.length===0?curContext.clearRect(0,0,p.width,p.height):curContext.clearRect(a,b,c,d)},p.tint=function(){var a=p.color.apply(this,arguments),b=p.red(a)/colorModeX,c=p.green(a)/colorModeY,d=p.blue(a)/colorModeZ,e=p.alpha(a)/colorModeA;curTint=function(a){var f=a.data,h=4*a.width*a.height;for(var i=0;i<h;)f[i++]*=b,f[i++]*=c,f[i++]*=d,f[i++]*=e}},p.noTint=function(){curTint=null},p.copy=function(a,b,c,d,e,f,g,h,i){arguments.length===8&&(i=h,h=g,g=f,f=e,e=d,d=c,c=b,b=a,a=p),p.blend(a,b,c,d,e,f,g,h,i,PConstants.REPLACE)},p.blend=function(a,b,c,d,e,f,g,h,i,j,k){arguments.length===9&&(j=i,i=h,h=g,g=f,f=e,e=d,d=c,c=b,b=a,a=p);var l=b+d,m=c+e,n=f+h,o=g+i,q;if(a.isRemote)throw"Image is loaded remotely. Cannot blend image.";arguments.length===10||arguments.length===9?(p.loadPixels(),q=p):arguments.length===11&&k&&k.imageData&&(q=k),a===p?p.intersect(b,c,l,m,f,g,n,o)?p.blit_resize(p.get(b,c,l-b,m-c),0,0,l-b-1,m-c-1,q.imageData.data,q.width,q.height,f,g,n,o,j):p.blit_resize(a,b,c,l,m,q.imageData.data,q.width,q.height,f,g,n,o,j):(a.loadPixels(),p.blit_resize(a,b,c,l,m,q.imageData.data,q.width,q.height,f,g,n,o,j)),arguments.length===10&&p.updatePixels()};var buildBlurKernel=function buildBlurKernel(a){var b=p.floor(a*3.5),c,d;b=b<1?1:b<248?b:248;if(p.shared.blurRadius!==b){p.shared.blurRadius=b,p.shared.blurKernelSize=1+(p.shared.blurRadius<<1),p.shared.blurKernel=Array(p.shared.blurKernelSize);for(c=0;c<p.shared.blurKernelSize;c++)p.shared.blurKernel[c]=0;for(c=1,d=b-1;c<b;c++)p.shared.blurKernel[b+c]=p.shared.blurKernel[d]=d*d;p.shared.blurKernel[b]=b*b}},blurARGB=function blurARGB(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=b.pixels.getLength(),q=Array(o),r=Array(o),s=Array(o),t=Array(o),u=0,v,w,x;buildBlurKernel(a);for(w=0;w<b.height;w++){for(v=0;v<b.width;v++){f=e=d=g=c=0,j=v-p.shared.blurRadius;if(j<0)n=-j,j=0;else{if(j>=b.width)break;n=0}for(x=n;x<p.shared.blurKernelSize;x++){if(j>=b.width)break;h=b.pixels.getPixel(j+u),i=p.shared.blurKernel[x],g+=i*((h&PConstants.ALPHA_MASK)>>>24),d+=i*((h&PConstants.RED_MASK)>>16),e+=i*((h&PConstants.GREEN_MASK)>>8),f+=i*(h&PConstants.BLUE_MASK),c+=i,j++}k=u+v,t[k]=g/c,q[k]=d/c,r[k]=e/c,s[k]=f/c}u+=b.width}u=0,l=-p.shared.blurRadius,m=l*b.width;for(w=0;w<b.height;w++){for(v=0;v<b.width;v++){f=e=d=g=c=0;if(l<0)n=k=-l,j=v;else{if(l>=b.height)break;n=0,k=l,j=v+m}for(x=n;x<p.shared.blurKernelSize;x++){if(k>=b.height)break;i=p.shared.blurKernel[x],g+=i*t[j],d+=i*q[j],e+=i*r[j],f+=i*s[j],c+=i,k++,j+=b.width}b.pixels.setPixel(v+u,g/c<<24|d/c<<16|e/c<<8|f/c)}u+=b.width,m+=b.width,l++}},dilate=function dilate(a,b){var c=0,d=b.pixels.getLength(),e=Array(d),f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;if(!a)while(c<d){f=c,g=c+b.width;while(c<g)h=i=b.pixels.getPixel(c),l=c-1,k=c+1,m=c-b.width,n=c+b.width,l<f&&(l=c),k>=g&&(k=c),m<0&&(m=0),n>=d&&(n=c),q=b.pixels.getPixel(m),p=b.pixels.getPixel(l),r=b.pixels.getPixel(n),o=b.pixels.getPixel(k),j=77*(h>>16&255)+151*(h>>8&255)+28*(h&255),t=77*(p>>16&255)+151*(p>>8&255)+28*(p&255),s=77*(o>>16&255)+151*(o>>8&255)+28*(o&255),u=77*(q>>16&255)+151*(q>>8&255)+28*(q&255),v=77*(r>>16&255)+151*(r>>8&255)+28*(r&255),t>j&&(i=p,j=t),s>j&&(i=o,j=s),u>j&&(i=q,j=u),v>j&&(i=r,j=v),e[c++]=i}else while(c<d){f=c,g=c+b.width;while(c<g)h=i=b.pixels.getPixel(c),l=c-1,k=c+1,m=c-b.width,n=c+b.width,l<f&&(l=c),k>=g&&(k=c),m<0&&(m=0),n>=d&&(n=c),q=b.pixels.getPixel(m),p=b.pixels.getPixel(l),r=b.pixels.getPixel(n),o=b.pixels.getPixel(k),j=77*(h>>16&255)+151*(h>>8&255)+28*(h&255),t=77*(p>>16&255)+151*(p>>8&255)+28*(p&255),s=77*(o>>16&255)+151*(o>>8&255)+28*(o&255),u=77*(q>>16&255)+151*(q>>8&255)+28*(q&255),v=77*(r>>16&255)+151*(r>>8&255)+28*(r&255),t<j&&(i=p,j=t),s<j&&(i=o,j=s),u<j&&(i=q,j=u),v<j&&(i=r,j=v),e[c++]=i}b.pixels.set(e)};p.filter=function(a,b,c){var d,e,f,g;arguments.length===3?(c.loadPixels(),d=c):(p.loadPixels(),d=p),b===undef&&(b=null);if(d.isRemote)throw"Image is loaded remotely. Cannot filter image.";var h=d.pixels.getLength();switch(a){case PConstants.BLUR:var i=b||1;blurARGB(i,d);break;case PConstants.GRAY:if(d.format===PConstants.ALPHA){for(g=0;g<h;g++)e=255-d.pixels.getPixel(g),d.pixels.setPixel(g,4278190080|e<<16|e<<8|e);d.format=PConstants.RGB}else for(g=0;g<h;g++)e=d.pixels.getPixel(g),f=77*(e>>16&255)+151*(e>>8&255)+28*(e&255)>>8,d.pixels.setPixel(g,e&PConstants.ALPHA_MASK|f<<16|f<<8|f);break;case PConstants.INVERT:for(g=0;g<h;g++)d.pixels.setPixel(g,d.pixels.getPixel(g)^16777215);break;case PConstants.POSTERIZE:if(b===null)throw"Use filter(POSTERIZE, int levels) instead of filter(POSTERIZE)";var j=p.floor(b);if(j<2||j>255)throw"Levels must be between 2 and 255 for filter(POSTERIZE, levels)";var k=j-1;for(g=0;g<h;g++){var l=d.pixels.getPixel(g)>>16&255,m=d.pixels.getPixel(g)>>8&255,n=d.pixels.getPixel(g)&255;l=(l*j>>8)*255/k,m=(m*j>>8)*255/k,n=(n*j>>8)*255/k,d.pixels.setPixel(g,4278190080&d.pixels.getPixel(g)|l<<16|m<<8|n)}break;case PConstants.OPAQUE:for(g=0;g<h;g++)d.pixels.setPixel(g,d.pixels.getPixel(g)|4278190080);d.format=PConstants.RGB;break;case PConstants.THRESHOLD:b===null&&(b=.5);if(b<0||b>1)throw"Level must be between 0 and 1 for filter(THRESHOLD, level)";var o=p.floor(b*255);for(g=0;g<h;g++){var q=p.max((d.pixels.getPixel(g)&PConstants.RED_MASK)>>16,p.max((d.pixels.getPixel(g)&PConstants.GREEN_MASK)>>8,d.pixels.getPixel(g)&PConstants.BLUE_MASK));d.pixels.setPixel(g,d.pixels.getPixel(g)&PConstants.ALPHA_MASK|(q<o?0:16777215))}break;case PConstants.ERODE:dilate(!0,d);break;case PConstants.DILATE:dilate(!1,d)}d.updatePixels()},p.shared={fracU:0,ifU:0,fracV:0,ifV:0,u1:0,u2:0,v1:0,v2:0,sX:0,sY:0,iw:0,iw1:0,ih1:0,ul:0,ll:0,ur:0,lr:0,cUL:0,cLL:0,cUR:0,cLR:0,srcXOffset:0,srcYOffset:0,r:0,g:0,b:0,a:0,srcBuffer:null,blurRadius:0,blurKernelSize:0,blurKernel:null},p.intersect=function(a,b,c,d,e,f,g,h){var i=c-a+1,j=d-b+1,k=g-e+1,l=h-f+1;if(e<a)k+=e-a,k>i&&(k=i);else{var m=i+a-e;k>m&&(k=m)}if(f<b)l+=f-b,l>j&&(l=j);else{var n=j+b-f;l>n&&(l=n)}return!(k<=0||l<=0)},p.filter_new_scanline=function(){p.shared.sX=p.shared.srcXOffset,p.shared.fracV=p.shared.srcYOffset&PConstants.PREC_MAXVAL,p.shared.ifV=PConstants.PREC_MAXVAL-p.shared.fracV,p.shared.v1=(p.shared.srcYOffset>>PConstants.PRECISIONB)*p.shared.iw,p.shared.v2=Math.min((p.shared.srcYOffset>>PConstants.PRECISIONB)+1,p.shared.ih1)*p.shared.iw},p.filter_bilinear=function(){p.shared.fracU=p.shared.sX&PConstants.PREC_MAXVAL,p.shared.ifU=PConstants.PREC_MAXVAL-p.shared.fracU,p.shared.ul=p.shared.ifU*p.shared.ifV>>PConstants.PRECISIONB,p.shared.ll=p.shared.ifU*p.shared.fracV>>PConstants.PRECISIONB,p.shared.ur=p.shared.fracU*p.shared.ifV>>PConstants.PRECISIONB,p.shared.lr=p.shared.fracU*p.shared.fracV>>PConstants.PRECISIONB,p.shared.u1=p.shared.sX>>PConstants.PRECISIONB,p.shared.u2=Math.min(p.shared.u1+1,p.shared.iw1);var a=(p.shared.v1+p.shared.u1)*4,b=(p.shared.v1+p.shared.u2)*4,c=(p.shared.v2+p.shared.u1)*4,d=(p.shared.v2+p.shared.u2)*4;p.shared.cUL=p.color.toInt(p.shared.srcBuffer[a],p.shared.srcBuffer[a+1],p.shared.srcBuffer[a+2],p.shared.srcBuffer[a+3]),p.shared.cUR=p.color.toInt(p.shared.srcBuffer[b],p.shared.srcBuffer[b+1],p.shared.srcBuffer[b+2],p.shared.srcBuffer[b+3]),p.shared.cLL=p.color.toInt(p.shared.srcBuffer[c],p.shared.srcBuffer[c+1],p.shared.srcBuffer[c+2],p.shared.srcBuffer[c+3]),p.shared.cLR=p.color.toInt(p.shared.srcBuffer[d],p.shared.srcBuffer[d+1],p.shared.srcBuffer[d+2],p.shared.srcBuffer[d+3]),p.shared.r=p.shared.ul*((p.shared.cUL&PConstants.RED_MASK)>>16)+p.shared.ll*((p.shared.cLL&PConstants.RED_MASK)>>16)+p.shared.ur*((p.shared.cUR&PConstants.RED_MASK)>>16)+p.shared.lr*((p.shared.cLR&PConstants.RED_MASK)>>16)<<PConstants.PREC_RED_SHIFT&PConstants.RED_MASK,p.shared.g=p.shared.ul*(p.shared.cUL&PConstants.GREEN_MASK)+p.shared.ll*(p.shared.cLL&PConstants.GREEN_MASK)+p.shared.ur*(p.shared.cUR&PConstants.GREEN_MASK)+p.shared.lr*(p.shared.cLR&PConstants.GREEN_MASK)>>>PConstants.PRECISIONB&PConstants.GREEN_MASK,p.shared.b=p.shared.ul*(p.shared.cUL&PConstants.BLUE_MASK)+p.shared.ll*(p.shared.cLL&PConstants.BLUE_MASK)+p.shared.ur*(p.shared.cUR&PConstants.BLUE_MASK)+p.shared.lr*(p.shared.cLR&PConstants.BLUE_MASK)>>>PConstants.PRECISIONB,p.shared.a=p.shared.ul*((p.shared.cUL&PConstants.ALPHA_MASK)>>>24)+p.shared.ll*((p.shared.cLL&PConstants.ALPHA_MASK)>>>24)+p.shared.ur*((p.shared.cUR&PConstants.ALPHA_MASK)>>>24)+p.shared.lr*((p.shared.cLR&PConstants.ALPHA_MASK)>>>24)<<PConstants.PREC_ALPHA_SHIFT&PConstants.ALPHA_MASK;return p.shared.a|p.shared.r|p.shared.g|p.shared.b},p.blit_resize=function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o;b<0&&(b=0),c<0&&(c=0),d>=a.width&&(d=a.width-1),e>=a.height&&(e=a.height-1);var q=d-b,r=e-c,s=k-i,t=l-j,u=!0;u||(q++,r++);if(!(s<=0||t<=0||q<=0||r<=0||i>=g||j>=h||b>=a.width||c>=a.height)){var v=Math.floor(q/s*PConstants.PRECISIONF),w=Math.floor(r/t*PConstants.PRECISIONF);p.shared.srcXOffset=Math.floor(i<0?-i*v:b*PConstants.PRECISIONF),p.shared.srcYOffset=Math.floor(j<0?-j*w:c*PConstants.PRECISIONF),i<0&&(s+=i,i=0),j<0&&(t+=j,j=0),s=Math.min(s,g-i),t=Math.min(t,h-j);var x=j*g+i,y;p.shared.srcBuffer=a.imageData.data;if(u){p.shared.iw=a.width,p.shared.iw1=a.width-1,p.shared.ih1=a.height-1;switch(m){case PConstants.BLEND:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.blend(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.ADD:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.add(y,p.filter_bilinear())),y=p.color.toArray(p.modes.add(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.SUBTRACT:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.subtract(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.LIGHTEST:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.lightest(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.DARKEST:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.darkest(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.REPLACE:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.filter_bilinear()),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.DIFFERENCE:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.difference(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.EXCLUSION:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.exclusion(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.MULTIPLY:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.multiply(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.SCREEN:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.screen(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.OVERLAY:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.overlay(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.HARD_LIGHT:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.hard_light(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.SOFT_LIGHT:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.soft_light(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.DODGE:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.dodge(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}break;case PConstants.BURN:for(o=0;o<t;o++){p.filter_new_scanline();for(n=0;n<s;n++)y=p.color.toInt(f[(x+n)*4],f[(x+n)*4+1],f[(x+n)*4+2],f[(x+n)*4+3]),y=p.color.toArray(p.modes.burn(y,p.filter_bilinear())),f[(x+n)*4]=y[0],f[(x+n)*4+1]=y[1],f[(x+n)*4+2]=y[2],f[(x+n)*4+3]=y[3],p.shared.sX+=v;x+=g,p.shared.srcYOffset+=w}}}}},PFont.prototype.width=function(a){return"measureText"in curContext?curContext.measureText(typeof a=="number"?String.fromCharCode(a):a).width/curTextSize:"mozMeasureText"in curContext?curContext.mozMeasureText(typeof a=="number"?String.fromCharCode(a):a)/curTextSize:0},PFont.list=function(){return["sans-serif","serif","monospace","fantasy","cursive"]},p.PFont=PFont,p.loadFont=function(a){if(a===undef||a.indexOf(".svg")===-1)return new PFont(a);var b=p.loadGlyphs(a);return{name:a,glyph:!0,units_per_em:b.units_per_em,horiz_adv_x:1/b.units_per_em*b.horiz_adv_x,ascent:b.ascent,descent:b.descent,width:function(b){var c=0,d=b.length;for(var e=0;e<d;e++)try{c+=parseFloat(p.glyphLook(p.glyphTable[a],b[e]).horiz_adv_x)}catch(f){Processing.debug(f)}return c/p.glyphTable[a].units_per_em}}},p.createFont=function(a,b,c,d){if(arguments.length===2){p.textSize(b);return p.loadFont(a)}if(arguments.length===3){p.textSize(b);return p.loadFont(a)}if(arguments.length===4){p.textSize(b);return p.loadFont(a)}throw"incorrent number of parameters for createFont"},p.textFont=function(a,b){curTextFont=a,b?p.textSize(b):curContext.font=curContext.mozTextStyle=curTextSize+"px "+curTextFont.name},p.textSize=function(a){a&&(curTextSize=a,curContext.font=curContext.mozTextStyle=curTextSize+"px "+curTextFont.name)},p.textAlign=function(){arguments.length===1?horizontalTextAlignment=arguments[0]:arguments.length===2&&(horizontalTextAlignment=arguments[0],verticalTextAlignment=arguments[1])},p.textWidth=function(a){if(p.use3DContext){textcanvas===undef&&(textcanvas=document.createElement("canvas"));var b=curContext;curContext=textcanvas.getContext("2d"),curContext.font=curContext.mozTextStyle=curTextSize+"px "+curTextFont.name,"fillText"in curContext?textcanvas.width=curContext.measureText(a).width:"mozDrawText"in curContext&&(textcanvas.width=curContext.mozMeasureText(a)),curContext=b;return textcanvas.width}curContext.font=curTextSize+"px "+curTextFont.name;if("fillText"in curContext)return curContext.measureText(a).width;if("mozDrawText"in curContext)return curContext.mozMeasureText(a)},p.textLeading=function(a){curTextLeading=a};var measureTextCanvas=function(a,b,c,d){this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",b+"px"),this.canvas.setAttribute("height",b+"px"),this.ctx=this.canvas.getContext("2d"),this.ctx.font=b+"pt "+a,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,b,b),this.ctx.fillStyle="white",this.ctx.fillText(d,0,c),this.imageData=this.ctx.getImageData(0,0,b,b),this.get=function(a,b){return this.imageData.data[b*this.imageData.width*4+a*4]}};p.textAscent=function(){var a=undef,b=undef,c=undef,d=undef;return function(){if(b!==curTextFont||a!==curTextSize){b=curTextFont,a=curTextSize;var e=!1,f="k",g=p.color(0),h=0,i=curTextSize,j=curTextSize/2;d=new measureTextCanvas(curTextFont.name,curTextSize,curTextSize,f);while(j!==i){for(var k=0;k<curTextSize;k++)d.get(k,j)!==g&&(e=!0,k=curTextSize);e?(i=j,e=!1):h=j,j=Math.ceil((i+h)/2)}c=curTextSize-1-j+1;return c}return c}}(),p.textDescent=function(){var a=undef,b=undef,c=undef,d=undef;return function(){if(b!==curTextFont||a!==curTextSize){b=curTextFont,a=curTextSize;var e=!1,f="p",g=p.color(0),h=0,i=curTextSize,j=curTextSize/2;d=new measureTextCanvas(curTextFont.name,curTextSize,0,f);while(j!==i){for(var k=0;k<curTextSize;k++)d.get(k,j)!==g&&(e=!0,k=curTextSize);e?(h=j,e=!1):i=j,j=Math.ceil((i+h)/2)}c=j+1;return c}return c}}(),p.glyphLook=function(a,b){try{switch(b){case"1":return a.one;case"2":return a.two;case"3":return a.three;case"4":return a.four;case"5":return a.five;case"6":return a.six;case"7":return a.seven;case"8":return a.eight;case"9":return a.nine;case"0":return a.zero;case" ":return a.space;case"$":return a.dollar;case"!":return a.exclam;case'"':return a.quotedbl;case"#":return a.numbersign;case"%":return a.percent;case"&":return a.ampersand;case"'":return a.quotesingle;case"(":return a.parenleft;case")":return a.parenright;case"*":return a.asterisk;case"+":return a.plus;case",":return a.comma;case"-":return a.hyphen;case".":return a.period;case"/":return a.slash;case"_":return a.underscore;case":":return a.colon;case";":return a.semicolon;case"<":return a.less;case"=":return a.equal;case">":return a.greater;case"?":return a.question;case"@":return a.at;case"[":return a.bracketleft;case"\\":return a.backslash;case"]":return a.bracketright;case"^":return a.asciicircum;case"`":return a.grave;case"{":return a.braceleft;case"|":return a.bar;case"}":return a.braceright;case"~":return a.asciitilde;default:return a[b]}}catch(c){Processing.debug(c)}},p.text=function(){if(tMode===PConstants.SCREEN){p.pushMatrix(),p.resetMatrix();var a=p.textAscent(),b=p.textDescent(),c=p.textWidth(arguments[0]),d=a+b,e=p.loadFont(curTextFont.origName),f=p.createGraphics(c,d);f.beginDraw(),f.fill(currentFillColor),f.opaque=!1,f.background(0,0,0,0),f.textFont(e),f.textSize(curTextSize),f.text(arguments[0],0,a),f.endDraw(),arguments.length===5||arguments.length===6?p.image(f,arguments[1],arguments[2]-a,arguments[3],arguments[4]):p.image(f,arguments[1],arguments[2]-a),p.popMatrix()}else tMode!==PConstants.SHAPE&&(arguments.length===3?text$4(toP5String(arguments[0]),arguments[1],arguments[2],0):arguments.length===4?text$4(toP5String(arguments[0]),arguments[1],arguments[2],arguments[3]):arguments.length===5?text$6(toP5String(arguments[0]),arguments[1],arguments[2],arguments[3],arguments[4],0):arguments.length===6&&text$6(toP5String(arguments[0]),arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]))},p.textMode=function(a){tMode=a},p.loadGlyphs=function(url){var x,y,cx,cy,nx,ny,d,a,lastCom,lenC,horiz_adv_x,getXY="[0-9\\-]+",path,regex=function regex(a,b){var c=0,d=[],e,f=new RegExp(a,"g");e=d[c]=f.exec(b);while(e)c++,e=d[c]=f.exec(b);return d},buildPath=function buildPath(b){var c=regex("[A-Za-z][0-9\\- ]+|Z",b);path="var path={draw:function(){saveContext();curContext.beginPath();",x=0,y=0,cx=0,cy=0,nx=0,ny=0,b=0,a=0,lastCom="",lenC=c.length-1;for(var d=0;d<lenC;d++){var e=c[d][0],f=regex(getXY,e);switch(e[0]){case"M":x=parseFloat(f[0][0]),y=parseFloat(f[1][0]),path+="curContext.moveTo("+x+","+ -y+");";break;case"L":x=parseFloat(f[0][0]),y=parseFloat(f[1][0]),path+="curContext.lineTo("+x+","+ -y+");";break;case"H":x=parseFloat(f[0][0]),path+="curContext.lineTo("+x+","+ -y+");";break;case"V":y=parseFloat(f[0][0]),path+="curContext.lineTo("+x+","+ -y+");";break;case"T":nx=parseFloat(f[0][0]),ny=parseFloat(f[1][0]),lastCom==="Q"||lastCom==="T"?(b=Math.sqrt(Math.pow(x-cx,2)+Math.pow(cy-y,2)),a=Math.PI+Math.atan2(cx-x,cy-y),cx=x+Math.sin(a)*b,cy=y+Math.cos(a)*b):(cx=x,cy=y),path+="curContext.quadraticCurveTo("+cx+","+ -cy+","+nx+","+ -ny+");",x=nx,y=ny;break;case"Q":cx=parseFloat(f[0][0]),cy=parseFloat(f[1][0]),nx=parseFloat(f[2][0]),ny=parseFloat(f[3][0]),path+="curContext.quadraticCurveTo("+cx+","+ -cy+","+nx+","+ -ny+");",x=nx,y=ny;break;case"Z":path+="curContext.closePath();"}lastCom=e[0]}path+="executeContextFill();executeContextStroke();",path+="restoreContext();",path+="curContext.translate("+horiz_adv_x+",0);",path+="}}";return path},parseSVGFont=function(svg){var font=svg.getElementsByTagName("font");p.glyphTable[url].horiz_adv_x=font[0].getAttribute("horiz-adv-x");var font_face=svg.getElementsByTagName("font-face")[0];p.glyphTable[url].units_per_em=parseFloat(font_face.getAttribute("units-per-em")),p.glyphTable[url].ascent=parseFloat(font_face.getAttribute("ascent")),p.glyphTable[url].descent=parseFloat(font_face.getAttribute("descent"));var glyph=svg.getElementsByTagName("glyph"),len=glyph.length;for(var i=0;i<len;i++){var unicode=glyph[i].getAttribute("unicode"),name=glyph[i].getAttribute("glyph-name");horiz_adv_x=glyph[i].getAttribute("horiz-adv-x"),horiz_adv_x===null&&(horiz_adv_x=p.glyphTable[url].horiz_adv_x),d=glyph[i].getAttribute("d"),d!==undef&&(path=buildPath(d),eval(path),p.glyphTable[url][name]={name:name,unicode:unicode,horiz_adv_x:horiz_adv_x,draw:path.draw})}},loadXML=function loadXML(){var a;try{a=document.implementation.createDocument("","",null)}catch(b){Processing.debug(b.message);return}try{a.async=!1,a.load(url),parseSVGFont(a.getElementsByTagName("svg")[0])}catch(c){Processing.debug(c);try{var d=new window.XMLHttpRequest;d.open("GET",url,!1),d.send(null),parseSVGFont(d.responseXML.documentElement)}catch(e){Processing.debug(c)}}};p.glyphTable[url]={},loadXML(url);return p.glyphTable[url]},p.extendClassChain=function(a){var b=[a];for(var c=a.$upcast;c;c=c.$upcast)extendClass(c,a),b.push(c),a=c;while(b.length>0)b.pop().$self=a},p.addMethod=function(a,b,c,d){if(a[b]){var e=c.length,f=a[b];a[b]=function(){return arguments.length===e?c.apply(this,arguments):f.apply(this,arguments)}}else a[b]=c},p.createJavaArray=function createJavaArray(a,b){var c=null;if(typeof b[0]=="number"){var d=0|b[0];if(b.length<=1){a==="int"?c=new Int32Array(d):a==="float"?c=new Float32Array(d):c=Array(d);for(var e=0;e<d;++e)c[e]=0}else{c=[];var f=b.slice(1);for(var g=0;g<d;++g)c.push(createJavaArray(a,f))}}return c},attach(curElement,"mousemove",function(a){var b=curElement,c=0,d=0;p.pmouseX=p.mouseX,p.pmouseY=p.mouseY,a.offsetX===undef&&(a.offsetX=a.layerX,a.offsetY=a.layerY),p.mouseX=a.offsetX,p.mouseY=a.offsetY,typeof p.mouseMoved=="function"&&!p.__mousePressed&&p.mouseMoved(),typeof p.mouseDragged=="function"&&p.__mousePressed&&(p.mouseDragged(),p.mouseDragging=!0)}),attach(curElement,"mouseout",function(a){}),attach(curElement,"mousedown",function(a){p.__mousePressed=!0,p.mouseDragging=!1;switch(a.which){case 1:p.mouseButton=PConstants.LEFT;break;case 2:p.mouseButton=PConstants.CENTER;break;case 3:p.mouseButton=PConstants.RIGHT}typeof p.mousePressed=="function"&&p.mousePressed()}),attach(curElement,"mouseup",function(a){p.__mousePressed=!1,typeof p.mouseClicked=="function"&&!p.mouseDragging&&p.mouseClicked(),typeof p.mouseReleased=="function"&&p.mouseReleased()});var mouseWheelHandler=function(a){var b=0;a.wheelDelta?(b=a.wheelDelta/120,window.opera&&(b=-b)):a.detail&&(b=-a.detail/3),p.mouseScroll=b,b&&typeof p.mouseScrolled=="function"&&p.mouseScrolled()};attach(document,"DOMMouseScroll",mouseWheelHandler),attach(document,"mousewheel",mouseWheelHandler),attach(document,"keydown",function(a){p.keyCode=a.keyCode,p.__keyPressed=!0,p.key=keyCodeMap(a.keyCode,a.shiftKey),p.key!==PConstants.CODED&&(p.key=charCodeMap(a.keyCode,a.shiftKey)),keyFunc(a,"keydown")}),attach(document,"keypress",function(a){keyFunc(a,"keypress")}),attach(document,"keyup",function(a){p.keyCode=a.keyCode,p.__keyPressed=!1,p.key=keyCodeMap(a.keyCode,a.shiftKey),p.key!==PConstants.CODED&&(p.key=charCodeMap(a.keyCode,a.shiftKey)),keyFunc(a,"keyup")}),Processing.debug=function(a){},typeof curElement=="string"&&(curElement=document.getElementById(curElement));if(aCode){aCode instanceof Processing.Sketch?curSketch=aCode:typeof aCode=="function"?curSketch=new Processing.Sketch(aCode):curSketch=Processing.compile(aCode),p.externals.sketch=curSketch,p.use3DContext=curSketch.use3DContext,"mozOpaque"in curElement&&(curElement.mozOpaque=!curSketch.options.isTransparent),curSketch.options.pauseOnBlur&&(p.externals.onfocus=function(){doLoop&&p.loop()},p.externals.onblur=function(){doLoop&&loopStarted&&(p.noLoop(),doLoop=!0)}),curSketch.use3DContext||(curContext=curElement.getContext("2d"),p.externals.context=curContext,modelView=new PMatrix2D,curContext.translate(.5,.5),curContext.lineCap="round",p.stroke(0),p.fill(255),p.noSmooth(),p.disableContextMenu());for(var i in Processing.lib)Processing.lib.hasOwnProperty(i)&&(Processing.lib[i].hasOwnProperty("attach")?Processing.lib[i].attach(p):Processing.lib[i]instanceof Function&&Processing.lib[i].call(this));var executeSketch=function(a){!curSketch.imageCache.pending&&curSketch.fonts.pending()?(curSketch.attach(a,defaultScope),a.setup&&(a.setup(),curSketch.use3DContext||curContext.setTransform(1,0,0,1,0,0)),resetContext(),a.draw&&(doLoop?a.loop():a.redraw())):window.setTimeout(function(){executeSketch(a)},10)};try{executeSketch(p)}catch(error){Processing.logger.log(error)}}else curSketch=new Processing.Sketch,curSketch.options.isTransparent=!0};Processing.prototype=defaultScope,Processing.compile=function(a){var b=new Processing.Sketch,c=preprocessCode(a,b),d=parseProcessing(c);b.sourceCode=d;return b},Error.prototype.printStackTrace=function(){return this.toString()};var tinylogLite=function(){"use strict";var a={},b="undefined",c="function",d=!1,e=!0,f=512,g="log";typeof tinylog!==b&&typeof tinylog[g]===c?a[g]=tinylog[g]:typeof document!==b&&!document.fake?function(){var b=document,c="div",h="style",i="title",j={zIndex:1e4,position:"fixed",bottom:"0px",width:"100%",height:"15%",fontFamily:"sans-serif",color:"#ccc",backgroundColor:"black"},k={position:"relative",fontFamily:"monospace",overflow:"auto",height:"100%",paddingTop:"5px"},l={height:"5px",marginTop:"-5px",cursor:"n-resize",backgroundColor:"darkgrey"},m={position:"absolute",top:"5px",right:"20px",color:"#111",MozBorderRadius:"4px",webkitBorderRadius:"4px",borderRadius:"4px",cursor:"pointer",fontWeight:"normal",textAlign:"center",padding:"3px 5px",backgroundColor:"#333",fontSize:"12px"},n={minHeight:"16px"},o={fontSize:"12px",margin:"0 8px 0 8px",maxWidth:"100%",whiteSpace:"pre-wrap",overflow:"auto"},p=b.defaultView,q=b.documentElement,r=q[h],s=function(){var a=arguments.length,b,c,d;while(a--){c=arguments[a--],b=arguments[a][h];for(d in c)c.hasOwnProperty(d)&&(b[d]=c[d])}},t=function(a,b,c){a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c);return[a,b,c]},u=function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c)},v=function(a){var b=a.childNodes,c=b.length;while(c--)a.removeChild(b.item(0))},w=function(a,b){return a.appendChild(b)},x=function(a){return b.createElement(a)},y=function(a){return b.createTextNode(a)},z=a[g]=function(A){var B,C=r.paddingBottom,D=x(c),E=D[h],F=w(D,x(c)),G=w(D,x(c)),H=w(D,x(c)),I=d,J=d,K=d,L=0,M=function(){r.paddingBottom=D.clientHeight+"px"},N=function(a){var b=p.innerHeight,c=F.clientHeight;a<0?a=0:a+c>b&&(a=b-c),E.height=a/b*100+"%",M()},O=[t(b,"mousemove",function(a){I&&(N(p.innerHeight-a.clientY),G.scrollTop=K)}),t(b,"mouseup",function(){I&&(I=K=d)}),t(F,"dblclick",function(a){a.preventDefault(),J?(N(J),J=d):(J=D.clientHeight,E.height="0px")}),t(F,"mousedown",function(a){a.preventDefault(),I=e,K=G.scrollTop}),t(F,"contextmenu",function(){I=d}),t(H,"click",function(){B()})];B=function(){var b=O.length;while(b--)u.apply(a,O[b]);q.removeChild(D),r.paddingBottom=C,v(G),v(D),a[g]=z},s(D,j,G,k,F,l,H,m),H[i]="Close Log",w(H,y("✖")),F[i]="Double-click to toggle log minimization",q.insertBefore(D,q.firstChild),a[g]=function(a){L===f?G.removeChild(G.firstChild):L++;var b=w(G,x(c)),d=w(b,x(c));b[i]=(new Date).toLocaleTimeString(),s(b,n,d,o),w(d,y(a)),G.scrollTop=G.scrollHeight},a[g](A)}}():typeof print===c&&(a[g]=print);return a}();Processing.logger=tinylogLite,Processing.version="1.0.0",Processing.lib={},Processing.registerLibrary=function(a,b){Processing.lib[a]=b,b.hasOwnProperty("init")&&b.init(defaultScope)},Processing.instances=[],Processing.instanceIds={},Processing.removeInstance=function(a){Processing.instances.splice(Processing.instanceIds[a],1),delete Processing.instanceIds[a]},Processing.addInstance=function(a){if(a.externals.canvas.id===undef||!a.externals.canvas.id.length)a.externals.canvas.id="__processing"+Processing.instances.length;Processing.instanceIds[a.externals.canvas.id]=Processing.instances.length,Processing.instances.push(a)},Processing.getInstanceById=function(a){return Processing.instances[Processing.instanceIds[a]]},Processing.Sketch=function(attachFunction){this.attachFunction=attachFunction,this.use3DContext=!1,this.options={isTransparent:!1,crispLines:!1,pauseOnBlur:!1},this.imageCache={pending:0,images:{},add:function(a){var b=new Image;b.onload=function(a){return function(){a.pending--}}(this),this.pending++,this.images[a]=b,b.src=a}},this.fonts={template:function(){var a=document.createElement("p");a.style.fontFamily="serif",a.style.fontSize="72px",a.style.visibility="hidden",a.innerHTML="abcmmmmmmmmmmlll",document.getElementsByTagName("body")[0].appendChild(a);return a}(),attempt:0,pending:function(){var a=!0;for(var b=0;b<this.fontList.length;b++)this.fontList[b].offsetWidth===this.template.offsetWidth&&this.fontList[b].offsetHeight===this.template.offsetHeight?(a=!1,this.attempt++):(document.getElementsByTagName("body")[0].removeChild(this.fontList[b]),this.fontList.splice(b--,1),this.attempt=0);if(this.attempt>=30){a=!0;for(var c=0;c<this.fontList.length;c++)document.getElementsByTagName("body")[0].removeChild(this.fontList[c]),this.fontList.splice(c--,1)}a&&document.getElementsByTagName("body")[0].removeChild(this.template);return a},fontList:[],fontFamily:"",style:document.createElement("style"),add:function(a){var b=typeof a=="object"?a.fontFace:a,c=typeof a=="object"?a.url:a;this.fontFamily+="@font-face{\n  font-family: '"+b+"';\n  src:  url('"+c+"');\n}\n",this.style.innerHTML=this.fontFamily,document.getElementsByTagName("head")[0].appendChild(this.style);var d=document.createElement("p");d.style.fontFamily="'"+b+"', serif",d.style.fontSize="72px",d.style.visibility="hidden",d.innerHTML="abcmmmmmmmmmmlll",document.getElementsByTagName("body")[0].appendChild(d),this.fontList.push(d)}},this.sourceCode=undefined,this.attach=function(processing){if(typeof this.attachFunction=="function")this.attachFunction(processing);else{if(!this.sourceCode)throw"Unable to attach sketch to the processing instance";var func=eval(this.sourceCode);func(processing),this.attachFunction=func}},this.toString=function(){return this.sourceCode||"[attach: "+this.attachFunction+"]"},this.onblur=function(){},this.onfocus=function(){}},window.addEventListener("blur",function(){for(var a=0;a<Processing.instances.length;a++)Processing.instances[a].externals.onblur()},!1),window.addEventListener("focus",function(){for(var a=0;a<Processing.instances.length;a++)Processing.instances[a].externals.onfocus()},!1),window.Processing=Processing}(window,document),function(){if(window.require)require.packaged=!0;else{var a=function(b,c,d){typeof b!="string"?a.original?a.original.apply(window,arguments):(console.error("dropping module because define wasn't a string."),console.trace()):(arguments.length==2&&(d=c),define.modules||(define.modules={}),define.modules[b]=d)};window.define&&(a.original=window.define),window.define=a;var b=function(a,d){if(Object.prototype.toString.call(a)==="[object Array]"){var e=[];for(var f=0,g=a.length;f<g;++f){var h=c(a[f]);if(!h&&b.original)return b.original.apply(window,arguments);e.push(h)}d&&d.apply(null,e)}else{if(typeof a=="string"){var i=c(a);if(!i&&b.original)return b.original.apply(window,arguments);d&&d();return i}if(b.original)return b.original.apply(window,arguments)}};window.require&&(b.original=window.require),window.require=b,require.packaged=!0;var c=function(a){var b=define.modules[a];if(b==null){console.error("Missing module: "+a);return null}if(typeof b=="function"){var c={};b(require,c,{id:a,uri:""}),define.modules[a]=c;return c}return b}}}(),define("pilot/fixoldbrowsers",["require","exports","module"],function(a,b,c){var d=Object.prototype.hasOwnProperty;Array.isArray||(Array.isArray=function(a){return Object.prototype.toString.call(a)=="[object Array]"}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c=+this.length;for(var d=0;d<c;d++)d in this&&a.call(b,this[d],d,this)}),Array.prototype.map||(Array.prototype.map=function(a){var b=+this.length;if(typeof a!="function")throw new TypeError;var c=Array(b),d=arguments[1];for(var e=0;e<b;e++)e in this&&(c[e]=a.call(d,this[e],e,this));return c}),Array.prototype.filter||(Array.prototype.filter=function(a){var b=[],c=arguments[1];for(var d=0;d<this.length;d++)a.call(c,this[d])&&b.push(this[d]);return b}),Array.prototype.every||(Array.prototype.every=function(a){var b=arguments[1];for(var c=0;c<this.length;c++)if(!a.call(b,this[c]))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(a){var b=arguments[1];for(var c=0;c<this.length;c++)if(a.call(b,this[c]))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(a){var b=+this.length;if(typeof a!="function")throw new TypeError;if(b==0&&arguments.length==1)throw new TypeError;var c=0;if(arguments.length>=2)var d=arguments[1];else for(;;){if(c in this){d=this[c++];break}if(++c>=b)throw new TypeError}for(;c<b;c++)c in this&&(d=a.call(null,d,this[c],c,this));return d}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(a){var b=+this.length;if(typeof a!="function")throw new TypeError;if(b==0&&arguments.length==1)throw new TypeError;var c=b-1;if(arguments.length>=2)var d=arguments[1];else for(;;){if(c in this){d=this[c--];break}if(--c<0)throw new TypeError}for(;c>=0;c--)c in this&&(d=a.call(null,d,this[c],c,this));return d}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length;if(!b)return-1;var c=arguments[1]||0;if(c>=b)return-1;c<0&&(c+=b);for(;c<b;c++){if(!d.call(this,c))continue;if(a===this[c])return c}return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){var b=this.length;if(!b)return-1;var c=arguments[1]||b;c<0&&(c+=b),c=Math.min(c,b-1);for(;c>=0;c--){if(!d.call(this,c))continue;if(a===this[c])return c}return-1}),Object.getPrototypeOf||(Object.getPrototypeOf=function(a){return a.__proto__||a.constructor.prototype}),Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(a,b){if(typeof a!="object"&&typeof a!="function"||a===null)throw new TypeError("Object.getOwnPropertyDescriptor called on a non-object");return d.call(a,b)?{value:a[b],enumerable:!0,configurable:!0,writeable:!0}:undefined}),Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(a){return Object.keys(a)}),Object.create||(Object.create=function(a,b){var c;if(a===null)c={__proto__:null};else{if(typeof a!="object")throw new TypeError("typeof prototype["+typeof a+"] != 'object'");var d=function(){};d.prototype=a,c=new d}typeof b!="undefined"&&Object.defineProperties(c,b);return c}),Object.defineProperty||(Object.defineProperty=function(a,b,c){if(typeof c=="object"&&a.__defineGetter__){if(d.call(c,"value")){!a.__lookupGetter__(b)&&!a.__lookupSetter__(b)&&(a[b]=c.value);if(d.call(c,"get")||d.call(c,"set"))throw new TypeError("Object doesn't support this action")}else typeof c.get=="function"&&a.__defineGetter__(b,c.get);typeof c.set=="function"&&a.__defineSetter__(b,c.set)}return a}),Object.defineProperties||(Object.defineProperties=function(a,b){for(var c in b)d.call(b,c)&&Object.defineProperty(a,c,b[c]);return a}),Object.seal||(Object.seal=function(a){return a}),Object.freeze||(Object.freeze=function(a){return a});try{Object.freeze(function(){})}catch(e){Object.freeze=function(a){return function(b){return typeof b=="function"?b:a(b)}}(Object.freeze)}Object.preventExtensions||(Object.preventExtensions=function(a){return a}),Object.isSealed||(Object.isSealed=function(a){return!1}),Object.isFrozen||(Object.isFrozen=function(a){return!1}),Object.isExtensible||(Object.isExtensible=function(a){return!0});if(!Object.keys){var f=!0,g=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=g.length;for(var i in{toString:null})f=!1;Object.keys=function(a){if(typeof a!="object"&&typeof a!="function"||a===null)throw new TypeError("Object.keys called on a non-object");var b=[];for(var c in a)d.call(a,c)&&b.push(c);if(f)for(var e=0,i=h;e<i;e++){var j=g[e];d.call(a,j)&&b.push(j)}return b}}Date.prototype.toISOString||(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+(this.getUTCMonth()+1)+"-"+this.getUTCDate()+"T"+this.getUTCHours()+":"+this.getUTCMinutes()+":"+this.getUTCSeconds()+"Z"}),Date.now||(Date.now=function(){return(new Date).getTime()}),Date.prototype.toJSON||(Date.prototype.toJSON=function(a){if(typeof this.toISOString!="function")throw new TypeError;return this.toISOString()}),isNaN(Date.parse("T00:00"))&&(Date=function(a){var b=function(c,d,e,f,g,h,i){var j=arguments.length;if(this instanceof a){var k=j===1&&String(c)===c?new a(b.parse(c)):j>=7?new a(c,d,e,f,g,h,i):j>=6?new a(c,d,e,f,g,h):j>=5?new a(c,d,e,f,g):j>=4?new a(c,d,e,f):j>=3?new a(c,d,e):j>=2?new a(c,d):j>=1?new a(c):new a;k.constructor=b;return k}return a.apply(this,arguments)},c=new RegExp("^(?:((?:[+-]\\d\\d)?\\d\\d\\d\\d)(?:-(\\d\\d)(?:-(\\d\\d))?)?)?(?:T(\\d\\d):(\\d\\d)(?::(\\d\\d)(?:\\.(\\d\\d\\d))?)?)?(?:Z|([+-])(\\d\\d):(\\d\\d))?$");for(var d in a)b[d]=a[d];b.now=a.now,b.UTC=a.UTC,b.prototype=a.prototype,b.prototype.constructor=b,b.parse=function(b){var d=c.exec(b);if(d){d.shift();var e=d[0]===undefined;for(var f=0;f<10;f++){if(f===7)continue;d[f]=+(d[f]||(f<3?1:0)),f===1&&d[f]--}if(e)return((d[3]*60+d[4])*60+d[5])*1e3+d[6];var g=(d[8]*60+d[9])*60*1e3;d[6]==="-"&&(g=-g);return a.UTC.apply(this,d.slice(0,7))+g}return a.parse.apply(this,arguments)};return b}(Date));var j=Array.prototype.slice;Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if(typeof b.apply!="function"||typeof b.call!="function")return new TypeError;var c=j.call(arguments),d=function(){if(this instanceof d){var a=Object.create(b.prototype);b.apply(a,c.concat(j.call(arguments)));return a}return b.call.apply(b,c.concat(j.call(arguments)))};d.bound=b,d.boundTo=a,d.boundArgs=c,d.length=typeof b=="function"?Math.max(b.length-c.length,0):0;return d});if(!String.prototype.trim){var k=/^\s\s*/,l=/\s\s*$/;String.prototype.trim=function(){return String(this).replace(k,"").replace(l,"")}}b.globalsLoaded=!0}),define("pilot/index",["require","exports","module","pilot/fixoldbrowsers","pilot/types/basic","pilot/types/command","pilot/types/settings","pilot/commands/settings","pilot/commands/basic","pilot/settings/canon","pilot/canon"],function(a,b,c){b.startup=function(b,c){a("pilot/fixoldbrowsers"),a("pilot/types/basic").startup(b,c),a("pilot/types/command").startup(b,c),a("pilot/types/settings").startup(b,c),a("pilot/commands/settings").startup(b,c),a("pilot/commands/basic").startup(b,c),a("pilot/settings/canon").startup(b,c),a("pilot/canon").startup(b,c)},b.shutdown=function(b,c){a("pilot/types/basic").shutdown(b,c),a("pilot/types/command").shutdown(b,c),a("pilot/types/settings").shutdown(b,c),a("pilot/commands/settings").shutdown(b,c),a("pilot/commands/basic").shutdown(b,c),a("pilot/settings/canon").shutdown(b,c),a("pilot/canon").shutdown(b,c)}}),define("pilot/types/basic",["require","exports","module","pilot/types"],function(a,b,c){function m(a){if(a instanceof e)this.subtype=a;else{if(typeof a!="string")throw new Error("Can' handle array subtype");this.subtype=d.getType(a);if(this.subtype==null)throw new Error("Unknown array subtype: "+a)}}function l(a){if(typeof a.defer!="function")throw new Error("Instances of DeferredType need typeSpec.defer to be a function that returns a type");Object.keys(a).forEach(function(b){this[b]=a[b]},this)}function j(a){if(!Array.isArray(a.data)&&typeof a.data!="function")throw new Error("instances of SelectionType need typeSpec.data to be an array or function that returns an array:"+JSON.stringify(a));Object.keys(a).forEach(function(b){this[b]=a[b]},this)}var d=a("pilot/types"),e=d.Type,f=d.Conversion,g=d.Status,h=new e;h.stringify=function(a){return a},h.parse=function(a){if(typeof a!="string")throw new Error("non-string passed to text.parse()");return new f(a)},h.name="text";var i=new e;i.stringify=function(a){if(!a)return null;return""+a},i.parse=function(a){if(typeof a!="string")throw new Error("non-string passed to number.parse()");if(a.replace(/\s/g,"").length===0)return new f(null,g.INCOMPLETE,"");var b=new f(parseInt(a,10));isNaN(b.value)&&(b.status=g.INVALID,b.message="Can't convert \""+a+'" to a number.');return b},i.decrement=function(a){return a-1},i.increment=function(a){return a+1},i.name="number",j.prototype=new e,j.prototype.stringify=function(a){return a},j.prototype.parse=function(a){if(typeof a!="string")throw new Error("non-string passed to parse()");if(!this.data)throw new Error("Missing data on selection type extension.");var b=typeof this.data=="function"?this.data():this.data,c=!1,d,e=[];b.forEach(function(b){a==b?(d=this.fromString(b),c=!0):b.indexOf(a)===0&&e.push(this.fromString(b))},this);if(c)return new f(d);this.noMatch&&this.noMatch();if(e.length>0){var h="Possibilities"+(a.length===0?"":" for '"+a+"'");return new f(null,g.INCOMPLETE,h,e)}var h="Can't use '"+a+"'.";return new f(null,g.INVALID,h,e)},j.prototype.fromString=function(a){return a},j.prototype.decrement=function(a){var b=typeof this.data=="function"?this.data():this.data,c;if(a==null)c=b.length-1;else{var d=this.stringify(a),c=b.indexOf(d);c=c===0?b.length-1:c-1}return this.fromString(b[c])},j.prototype.increment=function(a){var b=typeof this.data=="function"?this.data():this.data,c;if(a==null)c=0;else{var d=this.stringify(a),c=b.indexOf(d);c=c===b.length-1?0:c+1}return this.fromString(b[c])},j.prototype.name="selection",b.SelectionType=j;var k=new j({name:"bool",data:["true","false"],stringify:function(a){return""+a},fromString:function(a){return a==="true"?!0:!1}});l.prototype=new e,l.prototype.stringify=function(a){return this.defer().stringify(a)},l.prototype.parse=function(a){return this.defer().parse(a)},l.prototype.decrement=function(a){var b=this.defer();return b.decrement?b.decrement(a):undefined},l.prototype.increment=function(a){var b=this.defer();return b.increment?b.increment(a):undefined},l.prototype.name="deferred",b.DeferredType=l,m.prototype=new e,m.prototype.stringify=function(a){return a.join(" ")},m.prototype.parse=function(a){return this.defer().parse(a)},m.prototype.name="array";var n=!1;b.startup=function(){n||(n=!0,d.registerType(h),d.registerType(i),d.registerType(k),d.registerType(j),d.registerType(l),d.registerType(m))},b.shutdown=function(){n=!1,d.unregisterType(h),d.unregisterType(i),d.unregisterType(k),d.unregisterType(j),d.unregisterType(l),d.unregisterType(m)}}),define("pilot/types",["require","exports","module"],function(a,b,c){function i(a,b){if(a.substr(-2)==="[]"){var c=a.slice(0,-2);return new g.array(c)}var d=g[a];typeof d=="function"&&(d=new d(b));return d}function f(){}function e(a,b,c,e){this.value=a,this.status=b||d.VALID,this.message=c,this.predictions=e||[]}var d={VALID:{toString:function(){return"VALID"},valueOf:function(){return 0}},INCOMPLETE:{toString:function(){return"INCOMPLETE"},valueOf:function(){return 1}},INVALID:{toString:function(){return"INVALID"},valueOf:function(){return 2}},combine:function(a){var b=d.VALID;for(var c=0;c<a.length;c++)a[c].valueOf()>b.valueOf()&&(b=a[c]);return b}};b.Status=d,b.Conversion=e,f.prototype={stringify:function(a){throw new Error("not implemented")},parse:function(a){throw new Error("not implemented")},name:undefined,increment:function(a){return undefined},decrement:function(a){return undefined},getDefault:function(){return this.parse("")}},b.Type=f;var g={};b.registerType=function(a){if(typeof a=="object"){if(!(a instanceof f))throw new Error("Can't registerType using: "+a);if(!a.name)throw new Error("All registered types must have a name");g[a.name]=a}else{if(typeof a!="function")throw new Error("Unknown type: "+a);if(!a.prototype.name)throw new Error("All registered types must have a name");g[a.prototype.name]=a}},b.registerTypes=function(a){Object.keys(a).forEach(function(c){var d=a[c];d.name=c,b.registerType(d)})},b.deregisterType=function(a){delete g[a.name]},b.getType=function(a){if(typeof a=="string")return i(a);if(typeof a=="object"){if(!a.name)throw new Error("Missing 'name' member to typeSpec");return i(a.name,a)}throw new Error("Can't extract type from "+a)}}),define("pilot/types/command",["require","exports","module","pilot/canon","pilot/types/basic","pilot/types"],function(a,b,c){var d=a("pilot/canon"),e=a("pilot/types/basic").SelectionType,f=a("pilot/types"),g=new e({name:"command",data:function(){return d.getCommandNames()},stringify:function(a){return a.name},fromString:function(a){return d.getCommand(a)}});b.startup=function(){f.registerType(g)},b.shutdown=function(){f.unregisterType(g)}}),define("pilot/canon",["require","exports","module","pilot/console","pilot/stacktrace","pilot/oop","pilot/useragent","pilot/keys","pilot/event_emitter","pilot/typecheck","pilot/catalog","pilot/types","pilot/lang"],function(a,b,c){function J(a){a=a||{},this.command=a.command,this.args=a.args,this.typed=a.typed,this._begunOutput=!1,this.start=new Date,this.end=null,this.completed=!1,this.error=!1}function G(a,b,c,e,f){function h(){a.exec(b,g.args,g),!g.isAsync&&!g.isDone&&g.done()}typeof a=="string"&&(a=q[a]);if(!a)return!1;var g=new J({sender:c,command:a,args:e||{},typed:f});if(g.getStatus()==l.INVALID){d.error("Canon.exec: Invalid parameter(s) passed to "+a.name);return!1}if(g.getStatus()==l.INCOMPLETE){var i,j=b[c];if(!j||!j.getArgsProvider||!(i=j.getArgsProvider()))i=F;i(g,function(){g.getStatus()==l.VALID&&h()});return!0}h();return!0}function F(a,b){var c=a.args,d=a.command.params;for(var e=0;e<d.length;e++){var f=d[e];if(a.getParamStatus(f)!=l.VALID||f.defaultValue===null){var g=f.description;f.defaultValue===null&&(g+=" (optional)");var h=prompt(g,f.defaultValue||"");if(!h){b();return}c[f.name]=h}}b()}function E(){return z}function D(a){return q[a]}function C(a){var b=typeof a=="string"?a:a.name;delete q[b],n.arrayRemove(z,b)}function B(a,b){var c=b.type;b.type=m.getType(c);if(b.type==null)throw new Error("In "+a+"/"+b.name+": can't find type for: "+JSON.stringify(c))}function A(a){if(!a.name)throw new Error("All registered commands must have a name");a.params==null&&(a.params=[]);if(!Array.isArray(a.params))throw new Error("command.params must be an array in "+a.name);a.params.forEach(function(b){if(!b.name)throw new Error("In "+a.name+": all params must have a name");B(a.name,b)},this),q[a.name]=a,a.bindKey&&w(a),z.push(a.name),z.sort()}function y(a,b,c,d){var e=x(a,b,c,d);return e?G(e,a,b,{}):!1}function x(a,b,c,d){j.isNumber(d)&&(d=h.keyCodeToString(d));var e=(s[c]||{})[d]||[];for(var f=0;f<e.length;f++)if(e[f].sender(a,b,c,d))return e[f].command;var g=r[b];return g&&g[c]&&g[c][d]}function w(a){var b=a.bindKey,c=b[v],d=r,e=s;if(!b.sender)throw new Error("All key bindings must have a sender");if(!b.mac&&b.mac!==null)throw new Error("All key bindings must have a mac key binding");if(!b.win&&b.win!==null)throw new Error("All key bindings must have a windows key binding");if(!!b[v])if(typeof b.sender=="string"){var f=t(b.sender,"\\|",null,!0);f.forEach(function(b){d[b]||(d[b]={}),c.split("|").forEach(function(c){u(c,a,d[b])})})}else{if(!j.isFunction(b.sender))throw new Error("Key binding must have a sender that is a string or function");var g={command:a,sender:b.sender};keyData=u(c),e[keyData.hashId]||(e[keyData.hashId]={}),e[keyData.hashId][keyData.key]?e[keyData.hashId][keyData.key].push(g):e[keyData.hashId][keyData.key]=[g]}}function u(a,b,c){var d,e=0,f=t(a,"\\-",null,!0),g=0,i=f.length;for(;g<i;++g)h.KEY_MODS[f[g]]?e=e|h.KEY_MODS[f[g]]:d=f[g]||"-";if(c==null)return{key:d,hashId:e};(c[e]||(c[e]={}))[d]=b}function t(a,b,c,d){return(d&&a.toLowerCase()||a).replace(/(?:^\s+|\n|\s+$)/g,"").split(new RegExp("[\\s ]*"+b+"[\\s ]*","g"),c||999)}var d=a("pilot/console"),e=a("pilot/stacktrace").Trace,f=a("pilot/oop"),g=a("pilot/useragent"),h=a("pilot/keys"),i=a("pilot/event_emitter").EventEmitter,j=a("pilot/typecheck"),k=a("pilot/catalog"),l=a("pilot/types").Status,m=a("pilot/types"),n=a("pilot/lang"),o={name:"command",description:"A command is a bit of functionality with optional typed arguments which can do something small like moving the cursor around the screen, or large like cloning a project from VCS.",indexOn:"name"};b.startup=function(a,b){k.addExtensionSpec(o)},b.shutdown=function(a,b){k.removeExtensionSpec(o)};var p={name:"thing",description:"thing is an example command",params:[{name:"param1",description:"an example parameter",type:"text",defaultValue:null}],exec:function(a,b,c){thing()}},q={},r={},s={},v=g.isMac?"mac":"win",z=[];b.removeCommand=C,b.addCommand=A,b.getCommand=D,b.getCommandNames=E,b.findKeyCommand=x,b.exec=G,b.execKeyCommand=y,b.upgradeType=B,f.implement(b,i);var H=[],I=100;f.implement(J.prototype,i),J.prototype.getParamStatus=function(a){var b=this.args||{};if(a.name in b){if(b[a.name]==null)return a.defaultValue===null?l.VALID:l.INCOMPLETE;var c,d=b[a.name].toString();try{c=a.type.parse(d)}catch(e){return l.INVALID}if(c.status!=l.VALID)return c.status}else if(a.defaultValue===undefined)return l.INCOMPLETE;return l.VALID},J.prototype.getParamNameStatus=function(a){var b=this.command.params||[];for(var c=0;c<b.length;c++)if(b[c].name==a)return this.getParamStatus(b[c]);throw"Parameter '"+a+"' not defined on command '"+this.command.name+"'"},J.prototype.getStatus=function(){var a=this.args||{},b=this.command.params;if(!b||b.length==0)return l.VALID;var c=[];for(var d=0;d<b.length;d++)c.push(this.getParamStatus(b[d]));return l.combine(c)},J.prototype._beginOutput=function(){this._begunOutput=!0,this.outputs=[],H.push(this);while(H.length>I)H.shiftObject();b._dispatchEvent("output",{requests:H,request:this})},J.prototype.doneWithError=function(a){this.error=!0,this.done(a)},J.prototype.async=function(){this.isAsync=!0,this._begunOutput||this._beginOutput()},J.prototype.output=function(a){this._begunOutput||this._beginOutput(),typeof a!="string"&&!(a instanceof Node)&&(a=a.toString()),this.outputs.push(a),this.isDone=!0,this._dispatchEvent("output",{});return this},J.prototype.done=function(a){this.completed=!0,this.end=new Date,this.duration=this.end.getTime()-this.start.getTime(),a&&this.output(a),this.isDone||(this.isDone=!0,this._dispatchEvent("output",{}))},b.Request=J}),define("pilot/console",["require","exports","module"],function(a,b,c){var d=function(){},e=["assert","count","debug","dir","dirxml","error","group","groupEnd","info","log","profile","profileEnd","time","timeEnd","trace","warn"];typeof window=="undefined"?e.forEach(function(a){b[a]=function(){var b=Array.prototype.slice.call(arguments),c={op:"log",method:a,args:b};postMessage(JSON.stringify(c))}}):e.forEach(function(a){window.console&&window.console[a]?b[a]=Function.prototype.bind.call(window.console[a],window.console):b[a]=d})}),define("pilot/stacktrace",["require","exports","module","pilot/useragent","pilot/console"],function(a,b,c){function i(){}function g(a){for(var b=0;b<a.length;++b){var c=a[b];typeof c=="object"?a[b]="#object":typeof c=="function"?a[b]="#function":typeof c=="string"&&(a[b]='"'+c+'"')}return a.join(",")}var d=a("pilot/useragent"),e=a("pilot/console"),f=function(){return d.isGecko?"firefox":d.isOpera?"opera":"other"}(),h={chrome:function(a){var b=a.stack;if(!b){e.log(a);return[]}return b.replace(/^.*?\n/,"").replace(/^.*?\n/,"").replace(/^.*?\n/,"").replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@").split("\n")},firefox:function(a){var b=a.stack;if(!b){e.log(a);return[]}b=b.replace(/(?:\n@:0)?\s+$/m,""),b=b.replace(/^\(/gm,"{anonymous}(");return b.split("\n")},opera:function(a){var b=a.message.split("\n"),c="{anonymous}",d=/Line\s+(\d+).*?script\s+(http\S+)(?:.*?in\s+function\s+(\S+))?/i,e,f,g;for(e=4,f=0,g=b.length;e<g;e+=2)d.test(b[e])&&(b[f++]=(RegExp.$3?RegExp.$3+"()@"+RegExp.$2+RegExp.$1:c+"()@"+RegExp.$2+":"+RegExp.$1)+" -- "+b[e+1].replace(/^\s+/,""));b.splice(f,b.length-f);return b},other:function(a){var b="{anonymous}",c=/function\s*([\w\-$]+)?\s*\(/i,d=[],e=0,f,h,i=10;while(a&&d.length<i){f=c.test(a.toString())?RegExp.$1||b:b,h=Array.prototype.slice.call(a.arguments),d[e++]=f+"("+g(h)+")";if(a===a.caller&&window.opera)break;a=a.caller}return d}};i.prototype={sourceCache:{},ajax:function(a){var b=this.createXMLHTTPObject();if(!!b){b.open("GET",a,!1),b.setRequestHeader("User-Agent","XMLHTTP/1.0"),b.send("");return b.responseText}},createXMLHTTPObject:function(){var a,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var c=0;c<b.length;c++)try{a=b[c](),this.createXMLHTTPObject=b[c];return a}catch(d){}},getSource:function(a){a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n"));return this.sourceCache[a]},guessFunctions:function(a){for(var b=0;b<a.length;++b){var c=/{anonymous}\(.*\)@(\w+:\/\/([-\w\.]+)+(:\d+)?[^:]+):(\d+):?(\d+)?/,d=a[b],e=c.exec(d);if(e){var f=e[1],g=e[4];if(f&&g){var h=this.guessFunctionName(f,g);a[b]=d.replace("{anonymous}",h)}}}return a},guessFunctionName:function(a,b){try{return this.guessFunctionNameFromLines(b,this.getSource(a))}catch(c){return"getSource failed with url: "+a+", exception: "+c.toString()}},guessFunctionNameFromLines:function(a,b){var c=/function ([^(]*)\(([^)]*)\)/,d=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,e="",f=10;for(var g=0;g<f;++g){e=b[a-g]+e;if(e!==undefined){var h=d.exec(e);if(h)return h[1];h=c.exec(e);if(h&&h[1])return h[1]}}return"(?)"}};var j=new i,k=[/http:\/\/localhost:4020\/sproutcore.js:/];b.ignoreFramesMatching=function(a){k.push(a)},b.Trace=function(a,b){this._ex=a,this._stack=h[f](a),b&&(this._stack=j.guessFunctions(this._stack))},b.Trace.prototype.log=function(a){a<=0&&(a=999999999);var b=0;for(var c=0;c<this._stack.length&&b<a;c++){var d=this._stack[c],f=!0;k.forEach(function(a){a.test(d)&&(f=!1)}),f&&(e.debug(d),b++)}}}),define("pilot/useragent",["require","exports","module"],function(a,b,c){var d=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase(),e=navigator.userAgent,f=navigator.appVersion;b.isWin=d=="win",b.isMac=d=="mac",b.isLinux=d=="linux",b.isIE=!1,b.isGecko=b.isMozilla=window.controllers&&window.navigator.product==="Gecko",b.isOldGecko=b.isGecko&&/rv\:1/.test(navigator.userAgent),b.isOpera=window.opera&&Object.prototype.toString.call(window.opera)=="[object Opera]",b.isWebKit=parseFloat(e.split("WebKit/")[1])||undefined,b.isAIR=e.indexOf("AdobeAIR")>=0,b.isIPad=e.indexOf("iPad")>=0,b.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"},b.getOS=function(){return b.isMac?b.OS.MAC:b.isLinux?b.OS.LINUX:b.OS.WINDOWS}}),define("pilot/oop",["require","exports","module"],function(a,b,c){b.inherits=function(){var a=function(){};return function(b,c){a.prototype=c.prototype,b.super_=c.prototype,b.prototype=new a,b.prototype.constructor=b}}(),b.mixin=function(a,b){for(var c in b)a[c]=b[c]},b.implement=function(a,c){b.mixin(a,c)}}),define("pilot/keys",["require","exports","module","pilot/oop"],function(a,b,c){var d=a("pilot/oop"),e=function(){var a={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,meta:8,command:8},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'}};for(i in a.FUNCTION_KEYS){var b=a.FUNCTION_KEYS[i].toUpperCase();a[b]=parseInt(i,10)}d.mixin(a,a.MODIFIER_KEYS),d.mixin(a,a.PRINTABLE_KEYS),d.mixin(a,a.FUNCTION_KEYS);return a}();d.mixin(b,e),b.keyCodeToString=function(a){return(e[a]||String.fromCharCode(a)).toLowerCase()}}),define("pilot/event_emitter",["require","exports","module"],function(a,b,c){var d={};d._emit=d._dispatchEvent=function(a,b){this._eventRegistry=this._eventRegistry||{};var c=this._eventRegistry[a];if(!!c&&!!c.length){var b=b||{};b.type=a;for(var d=0;d<c.length;d++)c[d](b)}},d.on=d.addEventListener=function(a,b){this._eventRegistry=this._eventRegistry||{};var c=this._eventRegistry[a];if(!c)var c=this._eventRegistry[a]=[];c.indexOf(b)==-1&&c.push(b)},d.removeListener=d.removeEventListener=function(a,b){this._eventRegistry=this._eventRegistry||{};var c=this._eventRegistry[a];if(!!c){var d=c.indexOf(b);d!==-1&&c.splice(d,1)}},d.removeAllListeners=function(a){this._eventRegistry&&(this._eventRegistry[a]=[])},b.EventEmitter=d}),define("pilot/typecheck",["require","exports","module"],function(a,b,c){var d=Object.prototype.toString;b.isString=function(a){return a&&d.call(a)==="[object String]"},b.isBoolean=function(a){return a&&d.call(a)==="[object Boolean]"},b.isNumber=function(a){return a&&d.call(a)==="[object Number]"&&isFinite(a)},b.isObject=function(a){return a!==undefined&&(a===null||typeof a=="object"||Array.isArray(a)||b.isFunction(a))},b.isFunction=function(a){return a&&d.call(a)==="[object Function]"}}),define("pilot/catalog",["require","exports","module"],function(a,b,c){var d={};b.addExtensionSpec=function(a){d[a.name]=a},b.removeExtensionSpec=function(a){typeof a=="string"?delete d[a]:delete d[a.name]},b.getExtensionSpec=function(a){return d[a]},b.getExtensionSpecs=function(){return Object.keys(d)}}),define("pilot/lang",["require","exports","module"],function(a,b,c){b.stringReverse=function(a){return a.split("").reverse().join("")},b.stringRepeat=function(a,b){return Array(b+1).join(a)},b.copyObject=function(a){var b={};for(var c in a)b[c]=a[c];return b},b.arrayToMap=function(a){var b={};for(var c=0;c<a.length;c++)b[a[c]]=1;return b},b.arrayRemove=function(a,b){for(var c=0;c<=a.length;c++)b===a[c]&&a.splice(c,1)},b.escapeRegExp=function(a){return a.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")},b.deferredCall=function(a){var b=null,c=function(){b=null,a()},d=function(a){b||(b=setTimeout(c,a||0));return d};d.schedule=d,d.call=function(){this.cancel(),a();return d},d.cancel=function(){clearTimeout(b),b=null;return d};return d}}),define("pilot/types/settings",["require","exports","module","pilot/types/basic","pilot/types","pilot/settings"],function(a,b,c){var d=a("pilot/types/basic").SelectionType,e=a("pilot/types/basic").DeferredType,f=a("pilot/types"),g=a("pilot/settings").settings,h,i=new d({name:"setting",data:function(){return k.settings.getSettingNames()},stringify:function(a){h=a;return a.name},fromString:function(a){h=g.getSetting(a);return h},noMatch:function(){h=null}}),j=new e({name:"settingValue",defer:function(){return h?h.type:f.getType("text")},getDefault:function(){var a=this.parse("");if(h){var b=h.get();if(a.predictions.length===0)a.predictions.push(b);else{var c=!1;for(;;){var d=a.predictions.indexOf(b);if(d===-1)break;a.predictions.splice(d,1),c=!0}c&&a.predictions.push(b)}}return a}}),k;b.startup=function(a,b){k=a.env,f.registerType(i),f.registerType(j)},b.shutdown=function(a,b){f.unregisterType(i),f.unregisterType(j)}}),define("pilot/settings",["require","exports","module","pilot/console","pilot/oop","pilot/types","pilot/event_emitter","pilot/catalog"],function(a,b,c){function n(){}function k(a){this._deactivated={},this._settings={},this._settingNames=[],a&&this.setPersister(a)}function j(a,b){this._settings=b,Object.keys(a).forEach(function(b){this[b]=a[b]},this),this.type=f.getType(this.type);if(this.type==null)throw new Error("In "+this.name+": can't find type for: "+JSON.stringify(a.type));if(!this.name)throw new Error("Setting.name == undefined. Ignoring.",this);if(!this.defaultValue===undefined)throw new Error("Setting.defaultValue == undefined",this);this.onChange&&this.on("change",this.onChange.bind(this)),this.set(this.defaultValue)}var d=a("pilot/console"),e=a("pilot/oop"),f=a("pilot/types"),g=a("pilot/event_emitter").EventEmitter,h=a("pilot/catalog"),i={name:"setting",description:"A setting is something that the application offers as a way to customize how it works",register:"env.settings.addSetting",indexOn:"name"};b.startup=function(a,b){h.addExtensionSpec(i)},b.shutdown=function(a,b){h.removeExtensionSpec(i)},j.prototype={get:function(){return this.value},set:function(a){this.value!==a&&(this.value=a,this._settings.persister&&this._settings.persister.persistValue(this._settings,this.name,a),this._dispatchEvent("change",{setting:this,value:a}))},resetValue:function(){this.set(this.defaultValue)}},e.implement(j.prototype,g),k.prototype={addSetting:function(a){var b=new j(a,this);this._settings[b.name]=b,this._settingNames.push(b.name),this._settingNames.sort()},addSettings:function(a){Object.keys(a).forEach(function(b){var c=a[b];"name"in c||(c.name=b),this.addSetting(c)},this)},removeSetting:function(a){var b=typeof a=="string"?a:a.name;a=this._settings[b],delete this._settings[b],util.arrayRemove(this._settingNames,b),settings.removeAllListeners("change")},removeSettings:function(a){Object.keys(a).forEach(function(b){var c=a[b];"name"in c||(c.name=b),this.removeSettings(c)},this)},getSettingNames:function(){return this._settingNames},getSetting:function(a){return this._settings[a]},setPersister:function(a){this._persister=a,a&&a.loadInitialValues(this)},resetAll:function(){this.getSettingNames().forEach(function(a){this.resetValue(a)},this)},_list:function(){var a=[];this.getSettingNames().forEach(function(b){a.push({key:b,value:this.getSetting(b).get()})},this);return a},_loadDefaultValues:function(){this._loadFromObject(this._getDefaultValues())},_loadFromObject:function(a){for(var b in a)if(a.hasOwnProperty(b)){var c=this._settings[b];if(c){var d=c.type.parse(a[b]);this.set(b,d)}else this.set(b,a[b])}},_saveToObject:function(){return this.getSettingNames().map(function(a){return this._settings[a].type.stringify(this.get(a))}.bind(this))},_getDefaultValues:function(){return this.getSettingNames().map(function(a){return this._settings[a].spec.defaultValue}.bind(this))}},b.settings=new k,n.prototype={loadInitialValues:function(a){a._loadDefaultValues();var b=cookie.get("settings");a._loadFromObject(JSON.parse(b))},persistValue:function(a,b,c){try{var e=JSON.stringify(a._saveToObject());cookie.set("settings",e)}catch(f){d.error("Unable to JSONify the settings! "+f);return}}},b.CookiePersister=n}),define("pilot/commands/settings",["require","exports","module","pilot/canon"],function(a,b,c){var d={name:"set",params:[{name:"setting",type:"setting",description:"The name of the setting to display or alter",defaultValue:null},{name:"value",type:"settingValue",description:"The new value for the chosen setting",defaultValue:null}],description:"define and show settings",exec:function(a,b,c){var d;if(!b.setting){var e=a.settings.getSettingNames();d="",e.sort(function(a,b){return a.localeCompare(b)}),e.forEach(function(b){var c=a.settings.getSetting(b),e="https://wiki.mozilla.org/Labs/Skywriter/Settings#"+c.name;d+='<a class="setting" href="'+e+'" title="View external documentation on setting: '+c.name+'" target="_blank">'+c.name+"</a> = "+c.value+"<br/>"})}else b.value===undefined?d="<strong>"+setting.name+"</strong> = "+setting.get():(b.setting.set(b.value),d="Setting: <strong>"+b.setting.name+"</strong> = "+b.setting.get());c.done(d)}},e={name:"unset",params:[{name:"setting",type:"setting",description:"The name of the setting to return to defaults"}],description:"unset a setting entirely",exec:function(a,b,c){var d=a.settings.get(b.setting);d?(d.reset(),c.done("Reset "+d.name+" to default: "+a.settings.get(b.setting))):c.doneWithError("No setting with the name <strong>"+b.setting+"</strong>.")}},f=a("pilot/canon");b.startup=function(a,b){f.addCommand(d),f.addCommand(e)},b.shutdown=function(a,b){f.removeCommand(d),f.removeCommand(e)}}),define("pilot/commands/basic",["require","exports","module","pilot/typecheck","pilot/canon"],function(require,exports,module){var checks=require("pilot/typecheck"),canon=require("pilot/canon"),helpMessages={plainPrefix:'<h2>Welcome to Skywriter - Code in the Cloud</h2><ul><li><a href="http://labs.mozilla.com/projects/skywriter" target="_blank">Home Page</a></li><li><a href="https://wiki.mozilla.org/Labs/Skywriter" target="_blank">Wiki</a></li><li><a href="https://wiki.mozilla.org/Labs/Skywriter/UserGuide" target="_blank">User Guide</a></li><li><a href="https://wiki.mozilla.org/Labs/Skywriter/Tips" target="_blank">Tips and Tricks</a></li><li><a href="https://wiki.mozilla.org/Labs/Skywriter/FAQ" target="_blank">FAQ</a></li><li><a href="https://wiki.mozilla.org/Labs/Skywriter/DeveloperGuide" target="_blank">Developers Guide</a></li></ul>',plainSuffix:'For more information, see the <a href="https://wiki.mozilla.org/Labs/Skywriter">Skywriter Wiki</a>.'},helpCommandSpec={name:"help",params:[{name:"search",type:"text",description:"Search string to narrow the output.",defaultValue:null}],description:"Get help on the available commands.",exec:function(a,b,c){var d=[],e=canon.getCommand(b.search);if(e&&e.exec)d.push(e.description?e.description:"No description for "+b.search);else{var f=!1;!b.search&&helpMessages.plainPrefix&&d.push(helpMessages.plainPrefix),e?(d.push("<h2>Sub-Commands of "+e.name+"</h2>"),d.push("<p>"+e.description+"</p>")):b.search?(b.search=="hidden"&&(b.search="",f=!0),d.push("<h2>Commands starting with '"+b.search+"':</h2>")):d.push("<h2>Available Commands:</h2>");var g=canon.getCommandNames();g.sort(),d.push("<table>");for(var h=0;h<g.length;h++){e=canon.getCommand(g[h]);if(!f&&e.hidden)continue;if(e.description===undefined)continue;if(b.search&&e.name.indexOf(b.search)!==0)continue;if(!b.search&&e.name.indexOf(" ")!=-1)continue;if(e&&e.name==b.search)continue;d.push("<tr>"),d.push('<th class="right">'+e.name+"</th>"),d.push("<td>"+e.description+"</td>"),d.push("</tr>")}d.push("</table>"),!b.search&&helpMessages.plainSuffix&&d.push(helpMessages.plainSuffix)}c.done(d.join(""))}},evalCommandSpec={name:"eval",params:[{name:"javascript",type:"text",description:"The JavaScript to evaluate"}],description:"evals given js code and show the result",hidden:!0,exec:function(env,args,request){var result,javascript=args.javascript;try{result=eval(javascript)}catch(e){result="<b>Error: "+e.message+"</b>"}var msg="",type="",x;if(checks.isFunction(result))msg=(result+"").replace(/\n/g,"<br>").replace(/ /g,"&#160"),type="function";else if(checks.isObject(result)){Array.isArray(result)?type="array":type="object";var items=[],value;for(x in result)result.hasOwnProperty(x)&&(checks.isFunction(result[x])?value="[function]":checks.isObject(result[x])?value="[object]":value=result[x],items.push({name:x,value:value}));items.sort(function(a,b){return a.name.toLowerCase()<b.name.toLowerCase()?-1:1});for(x=0;x<items.length;x++)msg+="<b>"+items[x].name+"</b>: "+items[x].value+"<br>"}else msg=result,type=typeof result;request.done("Result for eval <b>'"+javascript+"'</b>"+" (type: "+type+"): <br><br>"+msg)}},versionCommandSpec={name:"version",description:"show the Skywriter version",hidden:!0,exec:function(a,b,c){var d="Skywriter "+skywriter.versionNumber+" ("+skywriter.versionCodename+")";c.done(d)}},skywriterCommandSpec={name:"skywriter",hidden:!0,exec:function(a,b,c){var d=Math.floor(Math.random()*messages.length);c.done("Skywriter "+messages[d])}},messages=["really wants you to trick it out in some way.","is your Web editor.","would love to be like Emacs on the Web.","is written on the Web platform, so you can tweak it."],canon=require("pilot/canon");exports.startup=function(a,b){canon.addCommand(helpCommandSpec),canon.addCommand(evalCommandSpec),canon.addCommand(skywriterCommandSpec)},exports.shutdown=function(a,b){canon.removeCommand(helpCommandSpec),canon.removeCommand(evalCommandSpec),canon.removeCommand(skywriterCommandSpec)}}),define("pilot/settings/canon",["require","exports","module"],function(a,b,c){var d={name:"historyLength",description:"How many typed commands do we recall for reference?",type:"number",defaultValue:50};b.startup=function(a,b){a.env.settings.addSetting(d)},b.shutdown=function(a,b){a.env.settings.removeSetting(d)}}),define("pilot/plugin_manager",["require","exports","module","pilot/promise"],function(a,b,c){var d=a("pilot/promise").Promise;b.REASONS={APP_STARTUP:1,APP_SHUTDOWN:2,PLUGIN_ENABLE:3,PLUGIN_DISABLE:4,PLUGIN_INSTALL:5,PLUGIN_UNINSTALL:6,PLUGIN_UPGRADE:7,PLUGIN_DOWNGRADE:8},b.Plugin=function(a){this.name=a,this.status=this.INSTALLED},b.Plugin.prototype={NEW:0,INSTALLED:1,REGISTERED:2,STARTED:3,UNREGISTERED:4,SHUTDOWN:5,install:function(b,c){var e=new d;if(this.status>this.NEW){e.resolve(this);return e}a([this.name],function(a){a.install&&a.install(b,c),this.status=this.INSTALLED,e.resolve(this)}.bind(this));return e},register:function(b,c){var e=new d;if(this.status!=this.INSTALLED){e.resolve(this);return e}a([this.name],function(a){a.register&&a.register(b,c),this.status=this.REGISTERED,e.resolve(this)}.bind(this));return e},startup:function(c,e){e=e||b.REASONS.APP_STARTUP;var f=new d;if(this.status!=this.REGISTERED){f.resolve(this);return f}a([this.name],function(a){a.startup&&a.startup(c,e),this.status=this.STARTED,f.resolve(this)}.bind(this));return f},shutdown:function(b,c){this.status==this.STARTED&&(pluginModule=a(this.name),pluginModule.shutdown&&pluginModule.shutdown(b,c))}},b.PluginCatalog=function(){this.plugins={}},b.PluginCatalog.prototype={registerPlugins:function(a,c,e){var f=[];a.forEach(function(a){var d=this.plugins[a];d===undefined&&(d=new b.Plugin(a),this.plugins[a]=d,f.push(d.register(c,e)))}.bind(this));return d.group(f)},startupPlugins:function(a,b){var c=[];for(var e in this.plugins){var f=this.plugins[e];c.push(f.startup(a,b))}return d.group(c)}},b.catalog=new b.PluginCatalog}),define("pilot/promise",["require","exports","module","pilot/console","pilot/stacktrace"],function(a,b,c){var d=a("pilot/console"),e=a("pilot/stacktrace").Trace,f=-1,g=0,h=1,i=0,j=!1,k=[],l=[];Promise=function(){this._status=g,this._value=undefined,this._onSuccessHandlers=[],this._onErrorHandlers=[],this._id=i++,k[this._id]=this},Promise.prototype.isPromise=!0,Promise.prototype.isComplete=function(){return this._status!=g},Promise.prototype.isResolved=function(){return this._status==h},Promise.prototype.isRejected=function(){return this._status==f},Promise.prototype.then=function(a,b){typeof a=="function"&&(this._status===h?a.call(null,this._value):this._status===g&&this._onSuccessHandlers.push(a)),typeof b=="function"&&(this._status===f?b.call(null,this._value):this._status===g&&this._onErrorHandlers.push(b));return this},Promise.prototype.chainPromise=function(a){var b=new Promise;b._chainedFrom=this,this.then(function(c){try{b.resolve(a(c))}catch(d){b.reject(d)}},function(a){b.reject(a)});return b},Promise.prototype.resolve=function(a){return this._complete(this._onSuccessHandlers,h,a,"resolve")},Promise.prototype.reject=function(a){return this._complete(this._onErrorHandlers,f,a,"reject")},Promise.prototype._complete=function(a,b,c,f){if(this._status!=g){d.group("Promise already closed"),d.error("Attempted "+f+"() with ",c),d.error("Previous status = ",this._status,", previous value = ",this._value),d.trace(),this._completeTrace&&(d.error("Trace of previous completion:"),this._completeTrace.log(5)),d.groupEnd();return this}j&&(this._completeTrace=new e(new Error)),this._status=b,this._value=c,a.forEach(function(a){a.call(null,this._value)},this),this._onSuccessHandlers.length=0,this._onErrorHandlers.length=0,delete k[this._id],l.push(this);while(l.length>20)l.shift();return this},Promise.group=function(a){a instanceof Array||(a=Array.prototype.slice.call(arguments));if(a.length===0)return(new Promise).resolve([]);var b=new Promise,c=[],d=0,e=function(e){return function(g){c[e]=g,d++,b._status!==f&&d===a.length&&b.resolve(c)}};a.forEach(function(a,c){var d=e(c),f=b.reject.bind(b);a.then(d,f)});return b},b.Promise=Promise,b._outstanding=k,b._recent=l}),define("pilot/environment",["require","exports","module","pilot/settings"],function(a,b,c){function e(){return{settings:d}}var d=a("pilot/settings").settings;b.create=e}),define("ace/editor",["require","exports","module","pilot/fixoldbrowsers","pilot/oop","pilot/event","pilot/lang","pilot/useragent","ace/keyboard/textinput","ace/mouse_handler","ace/keyboard/keybinding","ace/edit_session","ace/search","ace/background_tokenizer","ace/range","pilot/event_emitter"],function(a,b,c){a("pilot/fixoldbrowsers");var d=a("pilot/oop"),e=a("pilot/event"),f=a("pilot/lang"),g=a("pilot/useragent"),h=a("ace/keyboard/textinput").TextInput,i=a("ace/mouse_handler").MouseHandler,j=a("ace/keyboard/keybinding").KeyBinding,k=a("ace/edit_session").EditSession,l=a("ace/search").Search,m=a("ace/background_tokenizer").BackgroundTokenizer,n=a("ace/range").Range,o=a("pilot/event_emitter").EventEmitter,p=function(a,b){var c=a.getContainerElement();this.container=c,this.renderer=a,this.textInput=new h(a.getTextAreaContainer(),this),this.keyBinding=new j(this),g.isIPad||(this.$mouseHandler=new i(this)),this.$blockScrolling=0,this.$search=(new l).set({wrap:!0}),this.setSession(b||new k(""))};(function(){d.implement(this,o),this.$forwardEvents={gutterclick:1,gutterdblclick:1},this.$originalAddEventListener=this.addEventListener,this.$originalRemoveEventListener=this.removeEventListener,this.addEventListener=function(a,b){return this.$forwardEvents[a]?this.renderer.addEventListener(a,b):this.$originalAddEventListener(a,b)},this.removeEventListener=function(a,b){return this.$forwardEvents[a]?this.renderer.removeEventListener(a,b):this.$originalRemoveEventListener(a,b)},this.setKeyboardHandler=function(a){this.keyBinding.setKeyboardHandler(a)},this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()},this.setSession=function(a){if(this.session!=a){if(this.session){var b=this.session;this.session.removeEventListener("change",this.$onDocumentChange),this.session.removeEventListener("changeMode",this.$onChangeMode),this.session.removeEventListener("changeTabSize",this.$onChangeTabSize),this.session.removeEventListener("changeWrapLimit",this.$onChangeWrapLimit),this.session.removeEventListener("changeWrapMode",this.$onChangeWrapMode),this.session.removeEventListener("changeFrontMarker",this.$onChangeFrontMarker),this.session.removeEventListener("changeBackMarker",this.$onChangeBackMarker),this.session.removeEventListener("changeBreakpoint",this.$onChangeBreakpoint),this.session.removeEventListener("changeAnnotation",this.$onChangeAnnotation),this.session.removeEventListener("changeOverwrite",this.$onCursorChange);var c=this.session.getSelection();c.removeEventListener("changeCursor",this.$onCursorChange),c.removeEventListener("changeSelection",this.$onSelectionChange),this.session.setScrollTopRow(this.renderer.getScrollTopRow())}this.session=a,this.$onDocumentChange=this.onDocumentChange.bind(this),a.addEventListener("change",this.$onDocumentChange),this.renderer.setSession(a),this.$onChangeMode=this.onChangeMode.bind(this),a.addEventListener("changeMode",this.$onChangeMode),this.$onChangeTabSize=this.renderer.updateText.bind(this.renderer),a.addEventListener("changeTabSize",this.$onChangeTabSize),this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this),a.addEventListener("changeWrapLimit",this.$onChangeWrapLimit),this.$onChangeWrapMode=this.onChangeWrapMode.bind(this),a.addEventListener("changeWrapMode",this.$onChangeWrapMode),this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this),this.session.addEventListener("changeFrontMarker",this.$onChangeFrontMarker),this.$onChangeBackMarker=this.onChangeBackMarker.bind(this),this.session.addEventListener("changeBackMarker",this.$onChangeBackMarker),this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this),this.session.addEventListener("changeBreakpoint",this.$onChangeBreakpoint),this.$onChangeAnnotation=this.onChangeAnnotation.bind(this),this.session.addEventListener("changeAnnotation",this.$onChangeAnnotation),this.$onCursorChange=this.onCursorChange.bind(this),this.session.addEventListener("changeOverwrite",this.$onCursorChange),this.selection=a.getSelection(),this.selection.addEventListener("changeCursor",this.$onCursorChange),this.$onSelectionChange=this.onSelectionChange.bind(this),this.selection.addEventListener("changeSelection",this.$onSelectionChange),this.onChangeMode(),this.bgTokenizer.setDocument(a.getDocument()),this.bgTokenizer.start(0),this.onCursorChange(),this.onSelectionChange(),this.onChangeFrontMarker(),this.onChangeBackMarker(),this.onChangeBreakpoint(),this.onChangeAnnotation(),this.renderer.scrollToRow(a.getScrollTopRow()),this.renderer.updateFull(),this._dispatchEvent("changeSession",{session:a,oldSession:b})}},this.getSession=function(){return this.session},this.getSelection=function(){return this.selection},this.resize=function(){this.renderer.onResize()},this.setTheme=function(a){this.renderer.setTheme(a)},this.setStyle=function(a){this.renderer.setStyle(a)},this.unsetStyle=function(a){this.renderer.unsetStyle(a)},this.$highlightBrackets=function(){this.session.$bracketHighlight&&(this.session.removeMarker(this.session.$bracketHighlight),this.session.$bracketHighlight=null);if(!this.$highlightPending){var a=this;this.$highlightPending=!0,setTimeout(function(){a.$highlightPending=!1;var b=a.session.findMatchingBracket(a.getCursorPosition());if(b){var c=new n(b.row,b.column,b.row,b.column+1);a.session.$bracketHighlight=a.session.addMarker(c,"ace_bracket")}},10)}},this.focus=function(){var a=this;g.isIE||setTimeout(function(){a.textInput.focus()}),this.textInput.focus()},this.blur=function(){this.textInput.blur()},this.onFocus=function(){this.renderer.showCursor(),this.renderer.visualizeFocus(),this._dispatchEvent("focus")},this.onBlur=function(){this.renderer.hideCursor(),this.renderer.visualizeBlur(),this._dispatchEvent("blur")},this.onDocumentChange=function(a){var b=a.data,c=b.range;this.bgTokenizer.start(c.start.row);if(c.start.row==c.end.row&&b.action!="insertLines"&&b.action!="removeLines")var d=c.end.row;else d=Infinity;this.renderer.updateLines(c.start.row,d),this.renderer.updateCursor()},this.onTokenizerUpdate=function(a){var b=a.data;this.renderer.updateLines(b.first,b.last)},this.onCursorChange=function(a){this.renderer.updateCursor(),this.$blockScrolling||this.renderer.scrollCursorIntoView(),this.renderer.moveTextAreaToCursor(this.textInput.getElement()),this.$highlightBrackets(),this.$updateHighlightActiveLine()},this.$updateHighlightActiveLine=function(){var a=this.getSession();a.$highlightLineMarker&&a.removeMarker(a.$highlightLineMarker),a.$highlightLineMarker=null;if(this.getHighlightActiveLine()&&(this.getSelectionStyle()!="line"||!this.selection.isMultiLine())){var b=this.getCursorPosition(),c=new n(b.row,0,b.row+1,0);a.$highlightLineMarker=a.addMarker(c,"ace_active_line","line")}},this.onSelectionChange=function(a){var b=this.getSession();b.$selectionMarker&&b.removeMarker(b.$selectionMarker),b.$selectionMarker=null;if(!this.selection.isEmpty()){var c=this.selection.getRange(),d=this.getSelectionStyle();b.$selectionMarker=b.addMarker(c,"ace_selection",d)}this.onCursorChange(a),this.$highlightSelectedWord&&this.mode.highlightSelection(this)},this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()},this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()},this.onChangeBreakpoint=function(){this.renderer.setBreakpoints(this.session.getBreakpoints())},this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())},this.onChangeMode=function(){var a=this.session.getMode();if(this.mode!=a){this.mode=a;var b=a.getTokenizer();if(!this.bgTokenizer){var c=this.onTokenizerUpdate.bind(this);this.bgTokenizer=new m(b,this),this.bgTokenizer.addEventListener("update",c)}else this.bgTokenizer.setTokenizer(b);this.renderer.setTokenizer(this.bgTokenizer)}},this.onChangeWrapLimit=function(){this.renderer.updateFull()},this.onChangeWrapMode=function(){this.renderer.onResize(!0)},this.getCopyText=function(){return this.selection.isEmpty()?"":this.session.getTextRange(this.getSelectionRange())},this.onCut=function(){this.$readOnly||this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection())},this.insert=function(a){if(!this.$readOnly){var b=this.getCursorPosition();a=a.replace("\t",this.session.getTabString());if(!this.selection.isEmpty()){var b=this.session.remove(this.getSelectionRange());this.clearSelection()}else if(this.session.getOverwrite()){var c=new n.fromPoints(b,b);c.end.column+=a.length,this.session.remove(c)}this.clearSelection();var d=this.bgTokenizer.getState(b.row),e=this.mode.checkOutdent(d,this.session.getLine(b.row),a),f=this.session.getLine(b.row),g=this.mode.getNextLineIndent(d,f.slice(0,b.column),this.session.getTabString()),h=this.session.insert(b,a),d=this.bgTokenizer.getState(b.row);if(this.session.getDocument().isNewLine(a)){this.moveCursorTo(b.row+1,0);var i=this.session.getTabSize(),j=Number.MAX_VALUE;for(var k=b.row+1;k<=h.row;++k){var l=0;f=this.session.getLine(k);for(var m=0;m<f.length;++m)if(f.charAt(m)=="\t")l+=i;else if(f.charAt(m)==" ")l+=1;else break;/[^\s]/.test(f)&&(j=Math.min(l,j))}for(var k=b.row+1;k<=h.row;++k){var o=j;f=this.session.getLine(k);for(var m=0;m<f.length&&o>0;++m)f.charAt(m)=="\t"?o-=i:f.charAt(m)==" "&&(o-=1);this.session.remove(new n(k,0,k,m))}this.session.indentRows(b.row+1,h.row,g)}else e&&this.mode.autoOutdent(d,this.session,b.row)}},this.onTextInput=function(a){this.keyBinding.onTextInput(a)},this.onCommandKey=function(a,b,c){this.keyBinding.onCommandKey(a,b,c)},this.setOverwrite=function(a){this.session.setOverwrite()},this.getOverwrite=function(){return this.session.getOverwrite()},this.toggleOverwrite=function(){this.session.toggleOverwrite()},this.setScrollSpeed=function(a){this.$mouseHandler.setScrollSpeed(a)},this.getScrollSpeed=function(){return this.$mouseHandler.getScrollSpeed()},this.$selectionStyle="line",this.setSelectionStyle=function(a){this.$selectionStyle!=a&&(this.$selectionStyle=a,this.onSelectionChange(),this._dispatchEvent("changeSelectionStyle",{data:a}))},this.getSelectionStyle=function(){return this.$selectionStyle},this.$highlightActiveLine=!0,this.setHighlightActiveLine=function(a){this.$highlightActiveLine!=a&&(this.$highlightActiveLine=a,this.$updateHighlightActiveLine())},this.getHighlightActiveLine=function(){return this.$highlightActiveLine},this.$highlightSelectedWord=!0,this.setHighlightSelectedWord=function(a){this.$highlightSelectedWord!=a&&(this.$highlightSelectedWord=a,a?this.mode.highlightSelection(this):this.mode.clearSelectionHighlight(this))},this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord},this.setShowInvisibles=function(a){this.getShowInvisibles()!=a&&this.renderer.setShowInvisibles(a)},this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()},this.setShowPrintMargin=function(a){this.renderer.setShowPrintMargin(a)},this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()},this.setPrintMarginColumn=function(a){this.renderer.setPrintMarginColumn(a)},this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()},this.$readOnly=!1,this.setReadOnly=function(a){this.$readOnly=a},this.getReadOnly=function(){return this.$readOnly},this.removeRight=function(){this.$readOnly||(this.selection.isEmpty()&&this.selection.selectRight(),this.session.remove(this.getSelectionRange()),this.clearSelection())},this.removeLeft=function(){this.$readOnly||(this.selection.isEmpty()&&this.selection.selectLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection())},this.removeWordRight=function(){this.$readOnly||(this.selection.isEmpty()&&this.selection.selectWordRight(),this.session.remove(this.getSelectionRange()),this.clearSelection())},this.removeWordLeft=function(){this.$readOnly||(this.selection.isEmpty()&&this.selection.selectWordLeft(),this.session.remove(this.getSelectionRange()),this.clearSelection())},this.removeToLineStart=function(){this.$readOnly||(this.selection.isEmpty()&&this.selection.selectLineStart(),this.session.remove(this.getSelectionRange()),this.clearSelection())},this.removeToLineEnd=function(){this.$readOnly||(this.selection.isEmpty()&&this.selection.selectLineEnd(),this.session.remove(this.getSelectionRange()),this.clearSelection())},this.splitLine=function(){if(!this.$readOnly){this.selection.isEmpty()||(this.session.remove(this.getSelectionRange()),this.clearSelection());var a=this.getCursorPosition();this.insert("\n"),this.moveCursorToPosition(a)}},this.transposeLetters=function(){if(!this.$readOnly){if(!this.selection.isEmpty())return;var a=this.getCursorPosition(),b=a.column;if(b==0)return;var c=this.session.getLine(a.row);if(b<c.length)var d=c.charAt(b)+c.charAt(b-1),e=new n(a.row,b-1,a.row,b+1);else var d=c.charAt(b-1)+c.charAt(b-2),e=new n(a.row,b-2,a.row,b);this.session.replace(e,d)}},this.indent=function(){if(!this.$readOnly){var a=this.session,b=this.getSelectionRange();if(!(b.start.row<b.end.row||b.start.column<b.end.column)){var d;if(this.session.getUseSoftTabs()){var e=a.getTabSize(),g=this.getCursorPosition(),h=a.documentToScreenColumn(g.row,g.column),i=e-h%e;d=f.stringRepeat(" ",i)}else d="\t";return this.onTextInput(d)}var c=this.$getSelectedRows();a.indentRows(c.first,c.last,"\t")}},this.blockOutdent=function(){if(!this.$readOnly){var a=this.session.getSelection();this.session.outdentRows(a.getRange())}},this.toggleCommentLines=function(){if(!this.$readOnly){var a=this.bgTokenizer.getState(this.getCursorPosition().row),b=this.$getSelectedRows();this.mode.toggleCommentLines(a,this.session,b.first,b.last)}},this.removeLines=function(){if(!this.$readOnly){var a=this.$getSelectedRows();this.session.remove(new n(a.first,0,a.last+1,0)),this.clearSelection()}},this.moveLinesDown=function(){this.$readOnly||this.$moveLines(function(a,b){return this.session.moveLinesDown(a,b)})},this.moveLinesUp=function(){this.$readOnly||this.$moveLines(function(a,b){return this.session.moveLinesUp(a,b)})},this.moveText=function(a,b){if(this.$readOnly)return null;return this.session.moveText(a,b)},this.copyLinesUp=function(){this.$readOnly||this.$moveLines(function(a,b){this.session.duplicateLines(a,b);return 0})},this.copyLinesDown=function(){this.$readOnly||this.$moveLines(function(a,b){return this.session.duplicateLines(a,b)})},this.$moveLines=function(a){var b=this.$getSelectedRows(),c=a.call(this,b.first,b.last),d=this.selection;d.setSelectionAnchor(b.last+c+1,0),d.$moveSelection(function(){d.moveCursorTo(b.first+c,0)})},this.$getSelectedRows=function(){var a=this.getSelectionRange().collapseRows();return{first:a.start.row,last:a.end.row}},this.onCompositionStart=function(a){this.renderer.showComposition(this.getCursorPosition())},this.onCompositionUpdate=function(a){this.renderer.setCompositionText(a)},this.onCompositionEnd=function(){this.renderer.hideComposition()},this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()},this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()},this.isRowVisible=function(a){return a>=this.getFirstVisibleRow()&&a<=this.getLastVisibleRow()},this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1},this.$getPageDownRow=function(){return this.renderer.getScrollBottomRow()},this.$getPageUpRow=function(){var a=this.renderer.getScrollTopRow(),b=this.renderer.getScrollBottomRow();return a-(b-a)},this.selectPageDown=function(){var a=this.$getPageDownRow()+Math.floor(this.$getVisibleRowCount()/2);this.scrollPageDown();var b=this.getSelection(),c=this.session.documentToScreenPosition(b.getSelectionLead()),d=this.session.screenToDocumentPosition(a,c.column);b.selectTo(d.row,d.column)},this.selectPageUp=function(){var a=this.renderer.getScrollTopRow()-this.renderer.getScrollBottomRow(),b=this.$getPageUpRow()+Math.round(a/2);this.scrollPageUp();var c=this.getSelection(),d=this.session.documentToScreenPosition(c.getSelectionLead()),e=this.session.screenToDocumentPosition(b,d.column);c.selectTo(e.row,e.column)},this.gotoPageDown=function(){var a=this.$getPageDownRow(),b=this.getCursorPositionScreen().column;this.scrollToRow(a),this.getSelection().moveCursorToScreen(a,b)},this.gotoPageUp=function(){var a=this.$getPageUpRow(),b=this.getCursorPositionScreen().column;this.scrollToRow(a),this.getSelection().moveCursorToScreen(a,b)},this.scrollPageDown=function(){this.scrollToRow(this.$getPageDownRow())},this.scrollPageUp=function(){this.renderer.scrollToRow(this.$getPageUpRow())},this.scrollToRow=function(a){this.renderer.scrollToRow(a)},this.scrollToLine=function(a,b){this.renderer.scrollToLine(a,b)},this.centerSelection=function(){var a=this.getSelectionRange(),b=Math.floor(a.start.row+(a.end.row-a.start.row)/2);this.renderer.scrollToLine(b,!0)},this.getCursorPosition=function(){return this.selection.getCursor()},this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())},this.getSelectionRange=function(){return this.selection.getRange()},this.selectAll=function(){this.$blockScrolling+=1,this.selection.selectAll(),this.$blockScrolling-=1},this.clearSelection=function(){this.selection.clearSelection()},this.moveCursorTo=function(a,b){this.selection.moveCursorTo(a,b)},this.moveCursorToPosition=function(a){this.selection.moveCursorToPosition(a)},this.gotoLine=function(a,b){this.selection.clearSelection(),this.$blockScrolling+=1,this.moveCursorTo(a-1,b||0),this.$blockScrolling-=1,this.isRowVisible(this.getCursorPosition().row)||this.scrollToLine(a,!0)},this.navigateTo=function(a,b){this.clearSelection(),this.moveCursorTo(a,b)},this.navigateUp=function(a){this.selection.clearSelection(),a=a||1,this.selection.moveCursorBy(-a,0)},this.navigateDown=function(a){this.selection.clearSelection(),a=a||1,this.selection.moveCursorBy(a,0)},this.navigateLeft=function(a){if(!this.selection.isEmpty()){var b=this.getSelectionRange().start;this.moveCursorToPosition(b)}else{a=a||1;while(a--)this.selection.moveCursorLeft()}this.clearSelection()},this.navigateRight=function(a){if(!this.selection.isEmpty()){var b=this.getSelectionRange().end;this.moveCursorToPosition(b)}else{a=a||1;while(a--)this.selection.moveCursorRight()}this.clearSelection()},this.navigateLineStart=function(){this.selection.moveCursorLineStart(),this.clearSelection()},this.navigateLineEnd=function(){this.selection.moveCursorLineEnd(),this.clearSelection()},this.navigateFileEnd=function(){this.selection.moveCursorFileEnd(),this.clearSelection()},this.navigateFileStart=function(){this.selection.moveCursorFileStart(),this.clearSelection()},this.navigateWordRight=function(){this.selection.moveCursorWordRight(),this.clearSelection()},this.navigateWordLeft=function(){this.selection.moveCursorWordLeft(),this.clearSelection()},this.replace=function(a,b){b&&this.$search.set(b);var c=this.$search.find(this.session);this.$tryReplace(c,a),c!==null&&this.selection.setSelectionRange(c)},this.replaceAll=function(a,b){b&&this.$search.set(b);var c=this.$search.findAll(this.session);if(!!c.length){var d=this.getSelectionRange();this.clearSelection(),this.selection.moveCursorTo(0,0),this.$blockScrolling+=1;for(var e=c.length-1;e>=0;--e)this.$tryReplace(c[e],a);this.selection.setSelectionRange(d),this.$blockScrolling-=1}},this.$tryReplace=function(a,b){var c=this.session.getTextRange(a),b=this.$search.replace(c,b);if(b!==null){a.end=this.session.replace(a,b);return a}return null},this.getLastSearchOptions=function(){return this.$search.getOptions()},this.find=function(a,b){this.clearSelection(),b=b||{},b.needle=a,this.$search.set(b),this.$find()},this.findNext=function(a){a=a||{},typeof a.backwards=="undefined"&&(a.backwards=!1),this.$search.set(a),this.$find()},this.findPrevious=function(a){a=a||{},typeof a.backwards=="undefined"&&(a.backwards=!0),this.$search.set(a),this.$find()},this.$find=function(a){this.selection.isEmpty()||this.$search.set({needle:this.session.getTextRange(this.getSelectionRange())}),typeof a!="undefined"&&this.$search.set({backwards:a});var b=this.$search.find(this.session);b&&(this.gotoLine(b.end.row+1,b.end.column),this.selection.setSelectionRange(b))},this.undo=function(){this.session.getUndoManager().undo()},this.redo=function(){this.session.getUndoManager().redo()}}).call(p.prototype),b.Editor=p}),define("pilot/event",["require","exports","module","pilot/keys","pilot/useragent","pilot/dom"],function(a,b,c){function g(a,b,c){var f=0;e.isOpera&&e.isMac?f=0|(b.metaKey?1:0)|(b.altKey?2:0)|(b.shiftKey?4:0)|(b.ctrlKey?8:0):f=0|(b.ctrlKey?1:0)|(b.altKey?2:0)|(b.shiftKey?4:0)|(b.metaKey?8:0);if(c in d.MODIFIER_KEYS){switch(d.MODIFIER_KEYS[c]){case"Alt":f=2;break;case"Shift":f=4;break;case"Ctrl":f=1;break;default:f=8}c=0}f&8&&(c==91||c==93)&&(c=0);if(f==0&&!(c in d.FUNCTION_KEYS))return!1;return a(b,f,c)}var d=a("pilot/keys"),e=a("pilot/useragent"),f=a("pilot/dom");b.addListener=function(a,b,c){if(a.addEventListener)return a.addEventListener(b,c,!1);if(a.attachEvent){var d=function(){c(window.event)};c._wrapper=d,a.attachEvent("on"+b,d)}},b.removeListener=function(a,b,c){if(a.removeEventListener)return a.removeEventListener(b,c,!1);a.detachEvent&&a.detachEvent("on"+b,c._wrapper||c)},b.stopEvent=function(a){b.stopPropagation(a),b.preventDefault(a);return!1},b.stopPropagation=function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},b.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},b.getDocumentX=function(a){return a.clientX?a.clientX+f.getPageScrollLeft():a.pageX},b.getDocumentY=function(a){return a.clientY?a.clientY+f.getPageScrollTop():a.pageY},b.getButton=function(a){if(a.type=="dblclick")return 0;if(a.type=="contextmenu")return 2;return a.preventDefault?a.button:{1:0,2:2,4:1}[a.button]},document.documentElement.setCapture?b.capture=function(a,c,d){function f(e){c&&c(e),d&&d(),b.removeListener(a,"mousemove",c),b.removeListener(a,"mouseup",f),b.removeListener(a,"losecapture",f),a.releaseCapture()}function e(a){c(a);return b.stopPropagation(a)}b.addListener(a,"mousemove",c),b.addListener(a,"mouseup",f),b.addListener(a,"losecapture",f),a.setCapture()}:b.capture=function(a,b,c){function e(a){b&&b(a),c&&c(),document.removeEventListener("mousemove",d,!0),document.removeEventListener("mouseup",e,!0),a.stopPropagation()}function d(a){b(a),a.stopPropagation()}document.addEventListener("mousemove",d,!0),document.addEventListener("mouseup",e,!0)},b.addMouseWheelListener=function(a,c){var d=function(a){a.wheelDelta!==undefined?a.wheelDeltaX!==undefined?(a.wheelX=-a.wheelDeltaX/8,a.wheelY=-a.wheelDeltaY/8):(a.wheelX=0,a.wheelY=-a.wheelDelta/8):a.axis&&a.axis==a.HORIZONTAL_AXIS?(a.wheelX=(a.detail||0)*5,a.wheelY=0):(a.wheelX=0,a.wheelY=(a.detail||0)*5),c(a)};b.addListener(a,"DOMMouseScroll",d),b.addListener(a,"mousewheel",d)},b.addMultiMouseDownListener=function(a,c,d,f,g){var h=0,i,j,k=function(a){h+=1,h==1&&(i=a.clientX,j=a.clientY,setTimeout(function(){h=0},f||600));if(b.getButton(a)!=c||Math.abs(a.clientX-i)>5||Math.abs(a.clientY-j)>5)h=0;h==d&&(h=0,g(a));return b.preventDefault(a)};b.addListener(a,"mousedown",k),e.isIE&&b.addListener(a,"dblclick",k)},b.addCommandKeyListener=function(a,c){var d=b.addListener;if(e.isOldGecko){var f=null;d(a,"keydown",function(a){f=a.keyCode}),d(a,"keypress",function(a){return g(c,a,f)})}else{var h=null;d(a,"keydown",function(a){h=a.keyIdentifier||a.keyCode;return g(c,a,a.keyCode)}),e.isMac&&e.isOpera&&d(a,"keypress",function(a){var b=a.keyIdentifier||a.keyCode;if(h!==b)return g(c,a,a.keyCode);h=null})}}}),define("pilot/dom",["require","exports","module"],function(a,b,c){var d="http://www.w3.org/1999/xhtml";b.createElement=function(a,b){return document.createElementNS?document.createElementNS(b||d,a):document.createElement(a)},b.setText=function(a,b){a.innerText!==undefined&&(a.innerText=b),a.textContent!==undefined&&(a.textContent=b)},document.documentElement.classList?(b.hasCssClass=function(a,b){return a.classList.contains(b)},b.addCssClass=function(a,b){a.classList.add(b)},b.removeCssClass=function(a,b){a.classList.remove(b)},b.toggleCssClass=function(a,b){return a.classList.toggle(b)}):(b.hasCssClass=function(a,b){var c=a.className.split(/\s+/g);return c.indexOf(b)!==-1},b.addCssClass=function(a,c){b.hasCssClass(a,c)||(a.className+=" "+c)},b.removeCssClass=function(a,b){var c=a.className.split(/\s+/g);for(;;){var d=c.indexOf(b);if(d==-1)break;c.splice(d,1)}a.className=c.join(" ")},b.toggleCssClass=function(a,b){var c=a.className.split(/\s+/g),d=!0;for(;;){var e=c.indexOf(b);if(e==-1)break;d=!1,c.splice(e,1)}d&&c.push(b),a.className=c.join(" ");return d}),b.setCssClass=function(a,c,d){d?b.addCssClass(a,c):b.removeCssClass(a,c)},b.importCssString=function(a,b){b=b||document;if(b.createStyleSheet){var c=b.createStyleSheet();c.cssText=a}else{var e=b.createElementNS?b.createElementNS(d,"style"):b.createElement("style");e.appendChild(b.createTextNode(a));var f=b.getElementsByTagName("head")[0]||b.documentElement;f.appendChild(e)}},b.getInnerWidth=function(a){return parseInt(b.computedStyle(a,"paddingLeft"))+parseInt(b.computedStyle(a,"paddingRight"))+a.clientWidth},b.getInnerHeight=function(a){return parseInt(b.computedStyle(a,"paddingTop"))+parseInt(b.computedStyle(a,"paddingBottom"))+a.clientHeight},window.pageYOffset!==undefined?(b.getPageScrollTop=function(){return window.pageYOffset},b.getPageScrollLeft=function(){return window.pageXOffset}):(b.getPageScrollTop=function(){return document.body.scrollTop},b.getPageScrollLeft=function(){return document.body.scrollLeft}),b.computedStyle=function(a,b){return window.getComputedStyle?(window.getComputedStyle(a,"")||{})[b]||"":a.currentStyle[b]},b.scrollbarWidth=function(){var a=b.createElement("p");a.style.width="100%",a.style.height="200px";var c=b.createElement("div"),d=c.style;d.position="absolute",d.left="-10000px",d.overflow="hidden",d.width="200px",d.height="150px",c.appendChild(a);var e=document.body||document.documentElement;e.appendChild(c);var f=a.offsetWidth;d.overflow="scroll";var g=a.offsetWidth;f==g&&(g=c.clientWidth),e.removeChild(c);return f-g},b.setInnerHtml=function(a,b){var c=a.cloneNode(!1);c.innerHTML=b,a.parentNode.replaceChild(c,a);return c},b.setInnerText=function(a,b){document.body&&"textContent"in document.body?a.textContent=b:a.innerText=b},b.getInnerText=function(a){return document.body&&"textContent"in document.body?a.textContent:a.innerText||a.textContent||""},b.getParentWindow=function(a){return a.defaultView||a.parentWindow},b.getSelectionStart=function(a){var b;try{b=a.selectionStart||0}catch(c){b=0}return b},b.setSelectionStart=function(a,b){return a.selectionStart=b},b.getSelectionEnd=function(a){var b;try{b=a.selectionEnd||0}catch(c){b=0}return b},b.setSelectionEnd=function(a,b){return a.selectionEnd=b}}),define("ace/keyboard/textinput",["require","exports","module","pilot/event","pilot/useragent","pilot/dom"],function(a,b,c){var d=a("pilot/event"),e=a("pilot/useragent"),f=a("pilot/dom"),g=function(a,b){function k(a){if(!i){var d=a||c.value;d&&(d.charCodeAt(d.length-1)==g.charCodeAt(0)?(d=d.slice(0,-1),d&&b.onTextInput(d)):b.onTextInput(d))}i=!1,c.value=g,c.select()}var c=f.createElement("textarea");c.style.left="-10000px",a.appendChild(c);var g=String.fromCharCode(0);k();var h=!1,i=!1,j="",l=function(a){e.isIE&&c.value.charCodeAt(0)>128||setTimeout(function(){h||k()},0)},m=function(a){h=!0,e.isIE||(k(),c.value=""),b.onCompositionStart(),e.isGecko||setTimeout(n,0)},n=function(){!h||b.onCompositionUpdate(c.value)},o=function(){h=!1,b.onCompositionEnd(),setTimeout(function(){k()},0)},p=function(a){i=!0;var d=b.getCopyText();d?c.value=d:a.preventDefault(),c.select(),setTimeout(function(){k()},0)},q=function(a){i=!0;var d=b.getCopyText();d?(c.value=d,b.onCut()):a.preventDefault(),c.select(),setTimeout(function(){k()},0)};d.addCommandKeyListener(c,b.onCommandKey.bind(b)),d.addListener(c,"keypress",l);if(e.isIE){var r={13:1,27:1};d.addListener(c,"keyup",function(a){h&&(!c.value||r[a.keyCode])&&setTimeout(o,0);(c.value.charCodeAt(0)|0)<129||(h?n():m())})}d.addListener(c,"textInput",l),d.addListener(c,"paste",function(a){a.clipboardData&&a.clipboardData.getData?(k(a.clipboardData.getData("text/plain")),a.preventDefault()):l()}),e.isIE||d.addListener(c,"propertychange",l),e.isIE?(d.addListener(c,"beforecopy",function(a){var c=b.getCopyText();c?clipboardData.setData("Text",c):a.preventDefault()}),d.addListener(a,"keydown",function(a){if(a.ctrlKey&&a.keyCode==88){var c=b.getCopyText();c&&(clipboardData.setData("Text",c),b.onCut()),d.preventDefault(a)}})):(d.addListener(c,"copy",p),d.addListener(c,"cut",q)),d.addListener(c,"compositionstart",m),e.isGecko&&d.addListener(c,"text",n),e.isWebKit&&d.addListener(c,"keyup",n),d.addListener(c,"compositionend",o),d.addListener(c,"blur",function(){b.onBlur()}),d.addListener(c,"focus",function(){b.onFocus(),c.select()}),this.focus=function(){b.onFocus(),c.select(),c.focus()},this.blur=function(){c.blur()},this.getElement=function(){return c},this.onContextMenu=function(a,b){a&&(j||(j=c.style.cssText),c.style.cssText="position:fixed; z-index:1000;left:"+(a.x-2)+"px; top:"+(a.y-2)+"px;"),b&&(c.value="")},this.onContextMenuClose=function(){setTimeout(function(){j&&(c.style.cssText=j,j=""),k()},0)}};b.TextInput=g}),define("ace/mouse_handler",["require","exports","module","pilot/event","pilot/dom"],function(a,b,c){var d=a("pilot/event"),e=a("pilot/dom"),f=0,g=1,h=2,i=250,j=5,k=function(a){this.editor=a,d.addListener(a.container,"mousedown",function(b){a.focus();return d.preventDefault(b)}),d.addListener(a.container,"selectstart",function(a){return d.preventDefault(a)});var b=a.renderer.getMouseEventTarget();d.addListener(b,"mousedown",this.onMouseDown.bind(this)),d.addMultiMouseDownListener(b,0,2,500,this.onMouseDoubleClick.bind(this)),d.addMultiMouseDownListener(b,0,3,600,this.onMouseTripleClick.bind(this)),d.addMultiMouseDownListener(b,0,4,600,this.onMouseQuadClick.bind(this)),d.addMouseWheelListener(b,this.onMouseWheel.bind(this))};(function(){this.$scrollSpeed=1,this.setScrollSpeed=function(a){this.$scrollSpeed=a},this.getScrollSpeed=function(){return this.$scrollSpeed},this.$getEventPosition=function(a){var b=d.getDocumentX(a),c=d.getDocumentY(a),e=this.editor.renderer.screenToTextCoordinates(b,c);e.row=Math.max(0,Math.min(e.row,this.editor.session.getLength()-1));return e},this.$distance=function(a,b,c,d){return Math.sqrt(Math.pow(c-a,2)+Math.pow(d-b,2))},this.onMouseDown=function(a){function C(b){a.shiftKey?l.selection.selectToPosition(b):m.$clickSelection||(l.moveCursorToPosition(b),l.selection.clearSelection(b.row,b.column)),p=g}var b=d.getDocumentX(a),c=d.getDocumentY(a),k=this.$getEventPosition(a),l=this.editor,m=this,n=l.getSelectionRange(),o=n.isEmpty(),p=f,q=!1,r=d.getButton(a);if(r!==0)o&&l.moveCursorToPosition(k),r==2&&(l.textInput.onContextMenu({x:b,y:c},o),d.capture(l.container,function(){},l.textInput.onContextMenuClose));else{q=!l.getReadOnly()&&!o&&n.contains(k.row,k.column),q||C(k),l.renderer.scrollCursorIntoView();var s,t,u=l.getOverwrite(),v=(new Date).getTime(),w,x,y=function(a){s=d.getDocumentX(a),t=d.getDocumentY(a)},z=function(){clearInterval(F),p==f?C(k):p==h&&A(),m.$clickSelection=null,p=f},A=function(){e.removeCssClass(l.container,"ace_dragging"),l.session.removeMarker(dragSelectionMarker),m.$clickSelection||w||(l.moveCursorToPosition(k),l.selection.clearSelection(k.row,k.column));if(!!w){if(x.contains(w.row,w.column)){w=null;return}l.clearSelection();var a=l.moveText(x,w);if(!a){w=null;return}l.selection.setSelectionRange(a)}},B=function(){if(s!==undefined&&t!==undefined){if(p==f){var a=m.$distance(b,c,s,t),d=(new Date).getTime();if(a>j){p=g;var k=l.renderer.screenToTextCoordinates(s,t);k.row=Math.max(0,Math.min(k.row,l.session.getLength()-1)),C(k)}else if(d-v>i){p=h,x=l.getSelectionRange();var n=l.getSelectionStyle();dragSelectionMarker=l.session.addMarker(x,"ace_selection",n),l.clearSelection(),e.addCssClass(l.container,"ace_dragging")}}p==h?E():p==g&&D()}},D=function(){var a=l.renderer.screenToTextCoordinates(s,t);a.row=Math.max(0,Math.min(a.row,l.session.getLength()-1));if(m.$clickSelection)if(m.$clickSelection.contains(a.row,a.column))l.selection.setSelectionRange(m.$clickSelection);else{if(m.$clickSelection.compare(a.row,a.column)==-1)var b=m.$clickSelection.end;else var b=m.$clickSelection.start;l.selection.setSelectionAnchor(b.row,b.column),l.selection.selectToPosition(a)}else l.selection.selectToPosition(a);l.renderer.scrollCursorIntoView()},E=function(){w=l.renderer.screenToTextCoordinates(s,t),w.row=Math.max(0,Math.min(w.row,l.session.getLength()-1)),l.moveCursorToPosition(w)};d.capture(l.container,y,z);var F=setInterval(B,20);return d.preventDefault(a)}},this.onMouseDoubleClick=function(a){var b=this.$getEventPosition(a);this.editor.moveCursorToPosition(b),this.editor.selection.selectWord(),this.$clickSelection=this.editor.getSelectionRange()},this.onMouseTripleClick=function(a){var b=this.$getEventPosition(a);this.editor.moveCursorToPosition(b),this.editor.selection.selectLine(),this.$clickSelection=this.editor.getSelectionRange()},this.onMouseQuadClick=function(a){this.editor.selectAll(),this.$clickSelection=this.editor.getSelectionRange()},this.onMouseWheel=function(a){var b=this.$scrollSpeed*2;this.editor.renderer.scrollBy(a.wheelX*b,a.wheelY*b);return d.preventDefault(a)}}).call(k.prototype),b.MouseHandler=k}),define("ace/keyboard/keybinding",["require","exports","module","pilot/useragent","pilot/keys","pilot/event","pilot/settings","pilot/canon","ace/commands/default_commands"],function(a,b,c){var d=a("pilot/useragent"),e=a("pilot/keys"),f=a("pilot/event"),g=a("pilot/settings").settings,h=a("pilot/canon");a("ace/commands/default_commands");var i=function(a){this.$editor=a,this.$data={},this.$keyboardHandler=null};(function(){this.setKeyboardHandler=function(a){this.$keyboardHandler!=a&&(this.$data={},this.$keyboardHandler=a)},this.getKeyboardHandler=function(){return this.$keyboardHandler},this.$callKeyboardHandler=function(a,b,c,d){var e={editor:this.$editor},g;this.$keyboardHandler&&(g=this.$keyboardHandler.handleKeyboard(this.$data,b,c,d,a));if(!g||!g.command)b!=0||d!=0?g={command:h.findKeyCommand(e,"editor",b,c)}:g={command:"inserttext",args:{text:c}};if(g){var i=h.exec(g.command,e,"editor",g.args);if(i)return f.stopEvent(a)}},this.onCommandKey=function(a,b,c){var d=e.keyCodeToString(c);this.$callKeyboardHandler(a,b,d,c)},this.onTextInput=function(a){this.$callKeyboardHandler({},0,a,0)}}).call(i.prototype),b.KeyBinding=i}),define("ace/commands/default_commands",["require","exports","module","pilot/lang","pilot/canon"],function(a,b,c){function f(a,b){return{win:a,mac:b,sender:"editor"}}var d=a("pilot/lang"),e=a("pilot/canon");e.addCommand({name:"null",exec:function(a,b,c){}}),e.addCommand({name:"selectall",bindKey:f("Ctrl-A","Command-A"),exec:function(a,b,c){a.editor.selectAll()}}),e.addCommand({name:"removeline",bindKey:f("Ctrl-D","Command-D"),exec:function(a,b,c){a.editor.removeLines()}}),e.addCommand({name:"gotoline",bindKey:f("Ctrl-L","Command-L"),exec:function(a,b,c){var d=parseInt(prompt("Enter line number:"));isNaN(d)||a.editor.gotoLine(d)}}),e.addCommand({name:"togglecomment",bindKey:f("Ctrl-7","Command-7"),exec:function(a,b,c){a.editor.toggleCommentLines()}}),e.addCommand({name:"findnext",bindKey:f("Ctrl-K","Command-G"),exec:function(a,b,c){a.editor.findNext()}}),e.addCommand({name:"findprevious",bindKey:f("Ctrl-Shift-K","Command-Shift-G"),exec:function(a,b,c){a.editor.findPrevious()}}),e.addCommand({name:"find",bindKey:f("Ctrl-F","Command-F"),exec:function(a,b,c){var d=prompt("Find:");a.editor.find(d)}}),e.addCommand({name:"replace",bindKey:f("Ctrl-R","Command-Option-F"),exec:function(a,b,c){var d=prompt("Find:");if(!!d){var e=prompt("Replacement:");if(!e)return;a.editor.replace(e,{needle:d})}}}),e.addCommand({name:"replaceall",bindKey:f("Ctrl-Shift-R","Command-Shift-Option-F"),exec:function(a,b,c){var d=prompt("Find:");if(!!d){var e=prompt("Replacement:");if(!e)return;a.editor.replaceAll(e,{needle:d})}}}),e.addCommand({name:"undo",bindKey:f("Ctrl-Z","Command-Z"),exec:function(a,b,c){a.editor.undo()}}),e.addCommand({name:"redo",bindKey:f("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(a,b,c){a.editor.redo()}}),e.addCommand({name:"overwrite",bindKey:f("Insert","Insert"),exec:function(a,b,c){a.editor.toggleOverwrite()}}),e.addCommand({name:"copylinesup",bindKey:f("Ctrl-Alt-Up","Command-Option-Up"),exec:function(a,b,c){a.editor.copyLinesUp()}}),e.addCommand({name:"movelinesup",bindKey:f("Alt-Up","Option-Up"),exec:function(a,b,c){a.editor.moveLinesUp()}}),e.addCommand({name:"selecttostart",bindKey:f("Alt-Shift-Up","Command-Shift-Up"),exec:function(a,b,c){a.editor.getSelection().selectFileStart()}}),e.addCommand({name:"gotostart",bindKey:f("Ctrl-Home|Ctrl-Up","Command-Home|Command-Up"),exec:function(a,b,c){a.editor.navigateFileStart()}}),e.addCommand({name:"selectup",bindKey:f("Shift-Up","Shift-Up"),exec:function(a,b,c){a.editor.getSelection().selectUp()}}),e.addCommand({name:"golineup",bindKey:f("Up","Up|Ctrl-P"),exec:function(a,b,c){a.editor.navigateUp(b.times)}}),e.addCommand({name:"copylinesdown",bindKey:f("Ctrl-Alt-Down","Command-Option-Down"),exec:function(a,b,c){a.editor.copyLinesDown()}}),e.addCommand({name:"movelinesdown",bindKey:f("Alt-Down","Option-Down"),exec:function(a,b,c){a.editor.moveLinesDown()}}),e.addCommand({name:"selecttoend",bindKey:f("Alt-Shift-Down","Command-Shift-Down"),exec:function(a,b,c){a.editor.getSelection().selectFileEnd()}}),e.addCommand({name:"gotoend",bindKey:f("Ctrl-End|Ctrl-Down","Command-End|Command-Down"),exec:function(a,b,c){a.editor.navigateFileEnd()}}),e.addCommand({name:"selectdown",bindKey:f("Shift-Down","Shift-Down"),exec:function(a,b,c){a.editor.getSelection().selectDown()}}),e.addCommand({name:"golinedown",bindKey:f("Down","Down|Ctrl-N"),exec:function(a,b,c){a.editor.navigateDown(b.times)}}),e.addCommand({name:"selectwordleft",bindKey:f("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(a,b,c){a.editor.getSelection().selectWordLeft()}}),e.addCommand({name:"gotowordleft",bindKey:f("Ctrl-Left","Option-Left"),exec:function(a,b,c){a.editor.navigateWordLeft()}}),e.addCommand({name:"selecttolinestart",bindKey:f("Alt-Shift-Left","Command-Shift-Left"),exec:function(a,b,c){a.editor.getSelection().selectLineStart()}}),e.addCommand({name:"gotolinestart",bindKey:f("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(a,b,c){a.editor.navigateLineStart()}}),e.addCommand({name:"selectleft",bindKey:f("Shift-Left","Shift-Left"),exec:function(a,b,c){a.editor.getSelection().selectLeft()}}),e.addCommand({name:"gotoleft",bindKey:f("Left","Left|Ctrl-B"),exec:function(a,b,c){a.editor.navigateLeft(b.times)}}),e.addCommand({name:"selectwordright",bindKey:f("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(a,b,c){a.editor.getSelection().selectWordRight()}}),e.addCommand({name:"gotowordright",bindKey:f("Ctrl-Right","Option-Right"),exec:function(a,b,c){a.editor.navigateWordRight()}}),e.addCommand({name:"selecttolineend",bindKey:f("Alt-Shift-Right","Command-Shift-Right"),exec:function(a,b,c){a.editor.getSelection().selectLineEnd()}}),e.addCommand({name:"gotolineend",bindKey:f("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(a,b,c){a.editor.navigateLineEnd()}}),e.addCommand({name:"selectright",bindKey:f("Shift-Right","Shift-Right"),exec:function(a,b,c){a.editor.getSelection().selectRight()}}),e.addCommand({name:"gotoright",bindKey:f("Right","Right|Ctrl-F"),exec:function(a,b,c){a.editor.navigateRight(b.times)}}),e.addCommand({name:"selectpagedown",bindKey:f("Shift-PageDown","Shift-PageDown"),exec:function(a,b,c){a.editor.selectPageDown()}}),e.addCommand({name:"pagedown",bindKey:f(null,"PageDown"),exec:function(a,b,c){a.editor.scrollPageDown()}}),e.addCommand({name:"gotopagedown",bindKey:f("PageDown","Option-PageDown|Ctrl-V"),exec:function(a,b,c){a.editor.gotoPageDown()}}),e.addCommand({name:"selectpageup",bindKey:f("Shift-PageUp","Shift-PageUp"),exec:function(a,b,c){a.editor.selectPageUp()}}),e.addCommand({name:"pageup",bindKey:f(null,"PageUp"),exec:function(a,b,c){a.editor.scrollPageUp()}}),e.addCommand({name:"gotopageup",bindKey:f("PageUp","Option-PageUp"),exec:function(a,b,c){a.editor.gotoPageUp()}}),e.addCommand({name:"selectlinestart",bindKey:f("Shift-Home","Shift-Home"),exec:function(a,b,c){a.editor.getSelection().selectLineStart()}}),e.addCommand({name:"selectlineend",bindKey:f("Shift-End","Shift-End"),exec:function(a,b,c){a.editor.getSelection().selectLineEnd()}}),e.addCommand({name:"del",bindKey:f("Delete","Delete|Ctrl-D"),exec:function(a,b,c){a.editor.removeRight()}}),e.addCommand({name:"backspace",bindKey:f("Ctrl-Backspace|Command-Backspace|Option-Backspace|Shift-Backspace|Backspace","Ctrl-Backspace|Command-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(a,b,c){a.editor.removeLeft()}}),e.addCommand({name:"removetolinestart",bindKey:f(null,"Option-Backspace"),exec:function(a,b,c){a.editor.removeToLineStart()}}),e.addCommand({name:"removetolineend",bindKey:f(null,"Ctrl-K"),exec:function(a,b,c){a.editor.removeToLineEnd()}}),e.addCommand({name:"removewordleft",bindKey:f(null,"Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(a,b,c){a.editor.removeWordLeft()}}),e.addCommand({name:"removewordright",bindKey:f(null,"Alt-Delete"),exec:function(a,b,c){a.editor.removeWordRight()}}),e.addCommand({name:"outdent",bindKey:f("Shift-Tab","Shift-Tab"),exec:function(a,b,c){a.editor.blockOutdent()}}),e.addCommand({name:"indent",bindKey:f("Tab","Tab"),exec:function(a,b,c){a.editor.indent()}}),e.addCommand({name:"inserttext",exec:function(a,b,c){a.editor.insert(d.stringRepeat(b.text||"",b.times||1))}}),e.addCommand({name:"centerselection",bindKey:f("Ctrl-L","Ctrl-L"),exec:function(a,b,c){a.editor.centerSelection()}}),e.addCommand({name:"splitline",bindKey:f(null,"Ctrl-O"),exec:function(a,b,c){a.editor.splitLine()}}),e.addCommand({name:"transposeletters",bindKey:f("Ctrl-T","Ctrl-T"),exec:function(a,b,c){a.editor.transposeLetters()}})}),define("ace/edit_session",["require","exports","module","pilot/oop","pilot/lang","pilot/event_emitter","ace/selection","ace/mode/text","ace/range","ace/document"],function(a,b,c){var d=a("pilot/oop"),e=a("pilot/lang"),f=a("pilot/event_emitter").EventEmitter,g=a("ace/selection").Selection,h=a("ace/mode/text").Mode,j=a("ace/range").Range,k=a("ace/document").Document,l=function(a,b){this.$modified=!0,this.$breakpoints=[],this.$frontMarkers={},this.$backMarkers={},this.$markerId=1,this.$wrapData=[],a instanceof k?this.setDocument(a):this.setDocument(new k(a)),this.selection=new g(this),b&&this.setMode(b)};(function(){d.implement(this,f),this.setDocument=function(a){if(this.doc)throw new Error("Document is already set");this.doc=a,a.on("change",this.onChange.bind(this))},this.getDocument=function(){return this.doc},this.onChange=function(a){var b=a.data;this.$modified=!0,!this.$fromUndo&&this.$undoManager&&!b.ignore&&(this.$deltas.push(b),this.$informUndoManager.schedule()),this.$updateWrapDataOnChange(a),this._dispatchEvent("change",a)},this.setValue=function(a){this.doc.setValue(a),this.$deltas=[],this.getUndoManager().reset()},this.getValue=this.toString=function(){return this.doc.getValue()},this.getSelection=function(){return this.selection},this.setUndoManager=function(a){this.$undoManager=a,this.$deltas=[],this.$informUndoManager&&this.$informUndoManager.cancel();if(a){var b=this;this.$informUndoManager=e.deferredCall(function(){b.$deltas.length>0&&a.execute({action:"aceupdate",args:[b.$deltas,b]}),b.$deltas=[]})}},this.$defaultUndoManager={undo:function(){},redo:function(){},reset:function(){}},this.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager},this.getTabString=function(){return this.getUseSoftTabs()?e.stringRepeat(" ",this.getTabSize()):"\t"},this.$useSoftTabs=!0,this.setUseSoftTabs=function(a){this.$useSoftTabs!==a&&(this.$useSoftTabs=a)},this.getUseSoftTabs=function(){return this.$useSoftTabs},this.$tabSize=4,this.setTabSize=function(a){!isNaN(a)&&this.$tabSize!==a&&(this.$modified=!0,this.$tabSize=a,this._dispatchEvent("changeTabSize"))},this.getTabSize=function(){return this.$tabSize},this.isTabStop=function(a){return this.$useSoftTabs&&a.column%this.$tabSize==0},this.$overwrite=!1,this.setOverwrite=function(a){this.$overwrite!=a&&(this.$overwrite=a,this._dispatchEvent("changeOverwrite"))},this.getOverwrite=function(){return this.$overwrite},this.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)},this.getBreakpoints=function(){return this.$breakpoints},this.setBreakpoints=function(a){this.$breakpoints=[];for(var b=0;b<a.length;b++)this.$breakpoints[a[b]]=!0;this._dispatchEvent("changeBreakpoint",{})},this.clearBreakpoints=function(){this.$breakpoints=[],this._dispatchEvent("changeBreakpoint",{})},this.setBreakpoint=function(a){this.$breakpoints[a]=!0,this._dispatchEvent("changeBreakpoint",{})},this.clearBreakpoint=function(a){delete this.$breakpoints[a],this._dispatchEvent("changeBreakpoint",{})},this.getBreakpoints=function(){return this.$breakpoints},this.addMarker=function(a,b,c,d){var e=this.$markerId++,f={range:a,type:c||"line",renderer:typeof c=="function"?c:null,clazz:b,inFront:!!d};d?(this.$frontMarkers[e]=f,this._dispatchEvent("changeFrontMarker")):(this.$backMarkers[e]=f,this._dispatchEvent("changeBackMarker"));return e},this.removeMarker=function(a){var b=this.$frontMarkers[a]||this.$backMarkers[a];if(!!b){var c=b.inFront?this.$frontMarkers:this.$backMarkers;b&&(delete c[a],this._dispatchEvent(b.inFront?"changeFrontMarker":"changeBackMarker"))}},this.getMarkers=function(a){return a?this.$frontMarkers:this.$backMarkers},this.setAnnotations=function(a){this.$annotations={};for(var b=0;b<a.length;b++){var c=a[b],d=c.row;this.$annotations[d]?this.$annotations[d].push(c):this.$annotations[d]=[c]}this._dispatchEvent("changeAnnotation",{})},this.getAnnotations=function(){return this.$annotations},this.clearAnnotations=function(){this.$annotations={},this._dispatchEvent("changeAnnotation",{})},this.$detectNewLine=function(a){var b=a.match(/^.*?(\r?\n)/m);b?this.$autoNewLine=b[1]:this.$autoNewLine="\n"},this.tokenRe=/^[\w\d]+/g,this.nonTokenRe=/^(?:[^\w\d]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\u4E00-\u9FFF\uF900-\uFAFF\u3400-\u4DBF])+/g,this.getWordRange=function(a,b){var c=this.getLine(a),d=!1;b>0&&(d=!!c.charAt(b-1).match(this.tokenRe)),d||(d=!!c.charAt(b).match(this.tokenRe));var e=d?this.tokenRe:this.nonTokenRe,f=b;if(f>0){do f--;while(f>=0&&c.charAt(f).match(e));f++}var g=b;while(g<c.length&&c.charAt(g).match(e))g++;return new j(a,f,a,g)},this.setNewLineMode=function(a){this.doc.setNewLineMode(a)},this.getNewLineMode=function(){return this.doc.getNewLineMode()},this.$useWorker=!0,this.setUseWorker=function(a){this.$useWorker!=a&&(a&&!this.$worker&&window.Worker&&(this.$worker=mode.createWorker(this)),!a&&this.$worker&&(this.$worker.terminate(),this.$worker=null))},this.getUseWorker=function(){return this.$useWorker},this.$mode=null,this.setMode=function(b){this.$mode!==b&&(this.$worker&&this.$worker.terminate(),this.$useWorker&&window.Worker&&!a.noWorker?this.$worker=b.createWorker(this):this.$worker=null,this.$mode=b,this._dispatchEvent("changeMode"))},this.getMode=function(){this.$mode||(this.$mode=new h);return this.$mode},this.$scrollTop=0,this.setScrollTopRow=function(a){this.$scrollTop!==a&&(this.$scrollTop=a,this._dispatchEvent("changeScrollTop"))},this.getScrollTopRow=function(){return this.$scrollTop},this.getWidth=function(){this.$computeWidth();return this.width},this.getScreenWidth=function(){this.$computeWidth();return this.screenWidth},this.$computeWidth=function(a){if(this.$modified||a){this.$modified=!1;var b=this.doc.getAllLines(),c=0,d=0,e=this.getTabSize();for(var f=0;f<b.length;f++){var g=b[f].length;c=Math.max(c,g),b[f].replace(/\t/g,function(a){g+=e-1;return a}),d=Math.max(d,g)}this.width=c,this.$useWrapMode?this.screenWidth=this.$wrapLimit:this.screenWidth=d}},this.getLine=function(a){return this.doc.getLine(a)},this.getDisplayLine=function(a){var b=Array(this.getTabSize()+1).join(" ");return this.doc.getLine(a).replace(/\t/g,b)},this.getLines=function(a,b){return this.doc.getLines(a,b)},this.getLength=function(){return this.doc.getLength()},this.getTextRange=function(a){return this.doc.getTextRange(a)},this.findMatchingBracket=function(a){if(a.column==0)return null;var b=this.getLine(a.row).charAt(a.column-1);if(b=="")return null;var c=b.match(/([\(\[\{])|([\)\]\}])/);if(!c)return null;return c[1]?this.$findClosingBracket(c[1],a):this.$findOpeningBracket(c[2],a)},this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{"},this.$findOpeningBracket=function(a,b){var c=this.$brackets[a],d=b.column-2,e=b.row,f=1,g=this.getLine(e);for(;;){while(d>=0){var h=g.charAt(d);if(h==c){f-=1;if(f==0)return{row:e,column:d}}else h==a&&(f+=1);d-=1}e-=1;if(e<0)break;var g=this.getLine(e),d=g.length-1}return null},this.$findClosingBracket=function(a,b){var c=this.$brackets[a],d=b.column,e=b.row,f=1,g=this.getLine(e),h=this.getLength();for(;;){while(d<g.length){var i=g.charAt(d);if(i==c){f-=1;if(f==0)return{row:e,column:d}}else i==a&&(f+=1);d+=1}e+=1;if(e>=h)break;var g=this.getLine(e),d=0}return null},this.insert=function(a,b){return this.doc.insert(a,b)},this.remove=function(a){return this.doc.remove(a)},this.undoChanges=function(a){!a.length||(this.$fromUndo=!0,this.doc.revertDeltas(a),this.$fromUndo=!1,this.$setUndoSelection(a,!0))},this.redoChanges=function(a){!a.length||(this.$fromUndo=!0,this.doc.applyDeltas(a),this.$fromUndo=!1,this.$setUndoSelection(a,!1))},this.$setUndoSelection=function(a,b){b&&(a=a.map(function(a){var b={range:a.range};a.action=="insertText"||a.action=="insertLines"?b.action="removeText":b.action="insertText";return b}).reverse());var c=[{}];for(var d=0;d<a.length;d++){var e=a[d],f=e.action=="insertText"||e.action=="insertLines",g=c[c.length-1];g.isInsert!==f?c.push({isInsert:f,start:f?e.range.start:e.range.end,end:f?e.range.end:e.range.start}):f?g.end=e.range.end:g.start=e.range.start}this.selection.clearSelection();var g=c[c.length-1];g.isInsert?this.selection.setSelectionRange(j.fromPoints(g.start,g.end)):this.selection.moveCursorToPosition(g.end)},this.replace=function(a,b){return this.doc.replace(a,b)},this.moveText=function(a,b){var c=this.getTextRange(a);this.remove(a);var d=b.row,e=b.column;!a.isMultiLine()&&a.start.row==d&&a.end.column<e&&(e-=c.length);if(a.isMultiLine()&&a.end.row<d){var f=this.doc.$split(c);d-=f.length-1}var g=d+a.end.row-a.start.row,h=a.isMultiLine()?a.end.column:e+a.end.column-a.start.column,i=new j(d,e,g,h);this.insert(i.start,c);return i},this.indentRows=function(a,b,c){c=c.replace(/\t/g,this.getTabString());for(var d=a;d<=b;d++)this.insert({row:d,column:0},c)},this.outdentRows=function(a){var b=a.collapseRows(),c=new j(0,0,0,0),d=this.getTabSize();for(var e=b.start.row;e<=b.end.row;++e){var f=this.getLine(e);c.start.row=e,c.end.row=e;for(var g=0;g<d;++g)if(f.charAt(g)!=" ")break;g<d&&f.charAt(g)=="\t"?(c.start.column=g,c.end.column=g+1):(c.start.column=0,c.end.column=g),this.remove(c)}},this.moveLinesUp=function(a,b){if(a<=0)return 0;var c=this.doc.removeLines(a,b);this.doc.insertLines(a-1,c);return-1},this.moveLinesDown=function(a,b){if(b>=this.doc.getLength()-1)return 0;var c=this.doc.removeLines(a,b);this.doc.insertLines(a+1,c);return 1},this.duplicateLines=function(a,b){var a=this.$clipRowToDocument(a),b=this.$clipRowToDocument(b),c=this.getLines(a,b);this.doc.insertLines(a,c);var d=b-a+1;return d},this.$clipRowToDocument=function(a){return Math.max(0,Math.min(a,this.doc.getLength()-1))},this.$wrapLimit=80,this.$useWrapMode=!1,this.$wrapLimitRange={min:null,max:null},this.setUseWrapMode=function(a){if(a!=this.$useWrapMode){this.$useWrapMode=a,this.$modified=!0;if(a){var b=this.getLength();this.$wrapData=[];for(i=0;i<b;i++)this.$wrapData.push([]);this.$updateWrapData(0,b-1)}this._dispatchEvent("changeWrapMode")}},this.getUseWrapMode=function(){return this.$useWrapMode},this.setWrapLimitRange=function(a,b){if(this.$wrapLimitRange.min!==a||this.$wrapLimitRange.max!==b)this.$wrapLimitRange.min=a,this.$wrapLimitRange.max=b,this.$modified=!0,this._dispatchEvent("changeWrapMode")},this.adjustWrapLimit=function(a){var b=this.$constrainWrapLimit(a);if(b!=this.$wrapLimit&&b>0){this.$wrapLimit=b,this.$modified=!0,this.$useWrapMode&&(this.$updateWrapData(0,this.getLength()-1),this._dispatchEvent("changeWrapLimit"));return!0}return!1},this.$constrainWrapLimit=function(a){var b=this.$wrapLimitRange.min;b&&(a=Math.max(b,a));var c=this.$wrapLimitRange.max;c&&(a=Math.min(c,a));return Math.max(1,a)},this.getWrapLimit=function(){return this.$wrapLimit},this.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}},this.$updateWrapDataOnChange=function(a){if(!!this.$useWrapMode){var b,c=a.data.action,d=a.data.range.start.row,e=a.data.range.end.row;c.indexOf("Lines")!=-1?(c=="insertLines"?e=d+a.data.lines.length:e=d,b=a.data.lines.length):b=e-d;if(b!=0)if(c.indexOf("remove")!=-1)this.$wrapData.splice(d,b),e=d;else{var f=[d,0];for(var g=0;g<b;g++)f.push([]);this.$wrapData.splice.apply(this.$wrapData,f)}this.$wrapData.length!=this.doc.$lines.length&&console.error("The length of doc.$lines and $wrapData have to be the same!"),this.$updateWrapData(d,e)}},this.$updateWrapData=function(a,b){var c=this.doc.getAllLines(),d=this.getTabSize(),e=this.$wrapData,f=this.$wrapLimit;for(var g=a;g<=b;g++)e[g]=this.$computeWrapSplits(c[g],f,d)};var b=1,c=2,g=3,k=4,l=5;this.$computeWrapSplits=function(a,b,c){function j(a){var b=e.slice(h,a),f=b.length;b.join("").replace(/4/g,function(a){f-=c-1}).replace(/2/g,function(a){f-=1}),i+=f,d.push(i),h=a}a=a.trimRight();if(a.length==0)return[];var c=this.getTabSize(),d=[],e=this.$getDisplayTokens(a),f=e.length,h=0,i=0;while(f-h>b){var k=h+b;if(e[k]>=g){while(e[k]>=g)k++;j(k)}else{for(k;k!=h-1;k--)if(e[k]>=g){k++;break}k>h?j(k):j(h+b)}}return d},this.$getDisplayTokens=function(a){var d=[],e=this.getTabSize();for(var f=0;f<a.length;f++){var h=a.charCodeAt(f);if(h==9){d.push(k);for(var i=1;i<e;i++)d.push(l)}else h==32?d.push(g):h>=12352&&h<=12447||h>=12448&&h<=12543||h>=19968&&h<=40959||h>=63744&&h<=64255||h>=13312&&h<=19903?d.push(b,c):d.push(b)}return d},this.$getStringScreenWidth=function(a){var b=0,c=this.getTabSize();for(var d=0;d<a.length;d++){var e=a.charCodeAt(d);e==9?b+=c:e>=12352&&e<=12447||e>=12448&&e<=12543||e>=19968&&e<=40959||e>=63744&&e<=64255||e>=13312&&e<=19903?b+=2:b+=1}return b},this.getRowHeight=function(a,b){var c;!this.$useWrapMode||!this.$wrapData[b]?c=1:c=this.$wrapData[b].length+1;return c*a.lineHeight},this.getScreenLastRowColumn=function(a,b){if(!this.$useWrapMode)return this.$getStringScreenWidth(this.getLine(a));var c=this.$screenToDocumentRow(a),d=c[0],e=c[1],f,g;this.$wrapData[d][e]?(f=this.$wrapData[d][e-1]||0,g=this.$wrapData[d][e],b&&g--):(g=this.getLine(d).length,f=this.$wrapData[d][e-1]||0);return b?g:this.$getStringScreenWidth(this.getLine(d).substring(f,g))},this.getDocumentLastRowColumn=function(a,b){if(!this.$useWrapMode)return this.getLine(a).length;var c=this.documentToScreenRow(a,b);return this.getScreenLastRowColumn(c,!0)},this.getScreenFirstRowColumn=function(a){if(!this.$useWrapMode)return 0;var b=this.$screenToDocumentRow(a),c=b[0],d=b[1];return this.$wrapData[c][d-1]||0},this.getRowSplitData=function(a){return this.$useWrapMode?this.$wrapData[a]:undefined},this.$screenToDocumentRow=function(a){if(!this.$useWrapMode)return[a,0];var b=this.$wrapData,c=this.getLength(),d=0;while(d<c&&a>=b[d].length+1)a-=b[d].length+1,d++;return[d,a]},this.screenToDocumentRow=function(a){return this.$screenToDocumentRow(a)[0]},this.screenToDocumentColumn=function(a,b){return this.screenToDocumentPosition(a,b).column},this.screenToDocumentPosition=function(a,b){var c,d,e,f=b,g=this.getLength();if(!this.$useWrapMode)d=a>=g?g-1:a<0?0:a,a=0,e=0,c=this.getLine(d);else{var h=this.$wrapData,d=0;while(d<g&&a>=h[d].length+1)a-=h[d].length+1,d++;d>=g&&(d=g-1,a=h[d].length),e=h[d][a-1]||0,c=this.getLine(d).substring(e)}var i=this.getTabSize();for(var j=0;j<c.length;j++){var k=c.charCodeAt(j);if(f>0)e+=1,k==9?f>=i?f-=i:(f=0,e-=1):k>=12352&&k<=12447||k>=12448&&k<=12543||k>=19968&&k<=40959||k>=63744&&k<=64255||k>=13312&&k<=19903?f>=2?f-=2:(f=0,e-=1):f-=1;else break}this.$useWrapMode?(b=h[d][a],e>=b&&(e=b-1)):c&&(e=Math.min(e,c.length));return{row:d,column:e}},this.documentToScreenColumn=function(a,b){return this.documentToScreenPosition(a,b).column},this.$documentToScreenRow=function(a,b){if(!this.$useWrapMode)return[a,0];var c=this.$wrapData,d=0;if(a>c.length-1)return[this.getScreenLength(),c.length==0?0:c[c.length-1].length-1];for(var e=0;e<a;e++)d+=c[e].length+1;var f=0;while(b>=c[a][f])d++,f++;return[d,f]},this.documentToScreenRow=function(a,b){return this.$documentToScreenRow(a,b)[0]},this.documentToScreenPosition=function(a,b){var c,d=this.getTabSize(),e;b!=null?e=a:(e=a.row,b=a.column);if(!this.$useWrapMode){c=this.getLine(e).substring(0,b),b=this.$getStringScreenWidth(c);return{row:e,column:b}}var f=this.$documentToScreenRow(e,b),g=f[0];if(e>=this.getLength())return{row:g,column:0};var h,i=this.$wrapData[e],j,k=f[1];c=this.getLine(e).substring(i[k-1]||0,b),j=this.$getStringScreenWidth(c);return{row:g,column:j}},this.getScreenLength=function(){if(!this.$useWrapMode)return this.getLength();var a=0;for(var b=0;b<this.$wrapData.length;b++)a+=this.$wrapData[b].length+1;return a}}).call(l.prototype),b.EditSession=l}),define("ace/selection",["require","exports","module","pilot/oop","pilot/lang","pilot/event_emitter","ace/range"],function(a,b,c){var d=a("pilot/oop"),e=a("pilot/lang"),f=a("pilot/event_emitter").EventEmitter,g=a("ace/range").Range,h=function(a){this.session=a,this.doc=a.getDocument(),this.clearSelection(),this.selectionLead=this.doc.createAnchor(0,0),this.selectionAnchor=this.doc.createAnchor(0,0);var b=this;this.selectionLead.on("change",function(a){b._dispatchEvent("changeCursor"),b.$isEmpty||b._dispatchEvent("changeSelection"),a.old.row==a.value.row&&b.$updateDesiredColumn()}),this.selectionAnchor.on("change",function(){b.$isEmpty||b._dispatchEvent("changeSelection")})};(function(){d.implement(this,f),this.isEmpty=function(){return this.$isEmpty||this.selectionAnchor.row==this.selectionLead.row&&this.selectionAnchor.column==this.selectionLead.column},this.isMultiLine=function(){if(this.isEmpty())return!1;return this.getRange().isMultiLine()},this.getCursor=function(){return this.selectionLead.getPosition()},this.setSelectionAnchor=function(a,b){this.selectionAnchor.setPosition(a,b),this.$isEmpty&&(this.$isEmpty=!1,this._dispatchEvent("changeSelection"))},this.getSelectionAnchor=function(){return this.$isEmpty?this.getSelectionLead():this.selectionAnchor.getPosition()},this.getSelectionLead=function(){return this.selectionLead.getPosition()},this.shiftSelection=function(a){if(this.$isEmpty)this.moveCursorTo(this.selectionLead.row,this.selectionLead.column+a);else{var b=this.getSelectionAnchor(),c=this.getSelectionLead(),d=this.isBackwards();(!d||b.column!==0)&&this.setSelectionAnchor(b.row,b.column+a),(d||c.column!==0)&&this.$moveSelection(function(){this.moveCursorTo(c.row,c.column+a)})}},this.isBackwards=function(){var a=this.selectionAnchor,b=this.selectionLead;return a.row>b.row||a.row==b.row&&a.column>b.column},this.getRange=function(){var a=this.selectionAnchor,b=this.selectionLead;if(this.isEmpty())return g.fromPoints(b,b);return this.isBackwards()?g.fromPoints(b,a):g.fromPoints(a,b)},this.clearSelection=function(){this.$isEmpty||(this.$isEmpty=!0,this._dispatchEvent("changeSelection"))},this.selectAll=function(){var a=this.doc.getLength()-1;this.setSelectionAnchor(a,this.doc.getLine(a).length),this.moveCursorTo(0,0)},this.setSelectionRange=function(a,b){b?(this.setSelectionAnchor(a.end.row,a.end.column),this.selectTo(a.start.row,a.start.column)):(this.setSelectionAnchor(a.start.row,a.start.column),this.selectTo(a.end.row,a.end.column)),this.$updateDesiredColumn()},this.$updateDesiredColumn=function(){var a=this.getCursor();this.$desiredColumn=this.session.documentToScreenColumn(a.row,a.column)},this.$moveSelection=function(a){var b=this.selectionLead;this.$isEmpty&&this.setSelectionAnchor(b.row,b.column),a.call(this)},this.selectTo=function(a,b){this.$moveSelection(function(){this.moveCursorTo(a,b)})},this.selectToPosition=function(a){this.$moveSelection(function(){this.moveCursorToPosition(a)})},this.selectUp=function(){this.$moveSelection(this.moveCursorUp)},this.selectDown=function(){this.$moveSelection(this.moveCursorDown)},this.selectRight=function(){this.$moveSelection(this.moveCursorRight)},this.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)},this.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)},this.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)},this.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)},this.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)},this.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)},this.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)},this.selectWord=function(){var a=this.getCursor(),b=this.session.getWordRange(a.row,a.column);this.setSelectionRange(b)},this.selectLine=function(){this.setSelectionAnchor(this.selectionLead.row,0),this.$moveSelection(function(){this.moveCursorTo(this.selectionLead.row+1,0)})},this.moveCursorUp=function(){this.moveCursorBy(-1,0)},this.moveCursorDown=function(){this.moveCursorBy(1,0)},this.moveCursorLeft=function(){var a=this.selectionLead.getPosition();if(a.column==0)a.row>0&&this.moveCursorTo(a.row-1,this.doc.getLine(a.row-1).length);else{var b=this.session.getTabSize();this.session.isTabStop(a)&&this.doc.getLine(a.row).slice(a.column-b,a.column).split(" ").length-1==b?this.moveCursorBy(0,-b):this.moveCursorBy(0,-1)}},this.moveCursorRight=function(){if(this.selectionLead.column==this.doc.getLine(this.selectionLead.row).length)this.selectionLead.row<this.doc.getLength()-1&&this.moveCursorTo(this.selectionLead.row+1,0);else{var a=this.session.getTabSize(),b=this.selectionLead;this.session.isTabStop(b)&&this.doc.getLine(b.row).slice(b.column,b.column+a).split(" ").length-1==a?this.moveCursorBy(0,a):this.moveCursorBy(0,1)}},this.moveCursorLineStart=function(){var a=this.selectionLead.row,b=this.selectionLead.column,c=this.session.documentToScreenRow(a,b),d=this.session.getScreenFirstRowColumn(c),e=this.doc.getLine(a).slice(d,b),f=e.match(/^\s*/);if(f[0].length==0){var g=this.session.getDocumentLastRowColumn(a,b);f=this.doc.getLine(a).substring(d,g).match(/^\s*/),this.moveCursorTo(a,d+f[0].length)}else f[0].length>=b?this.moveCursorTo(a,d):this.moveCursorTo(a,d+f[0].length)},this.moveCursorLineEnd=function(){var a=this.selectionLead;this.moveCursorTo(a.row,this.session.getDocumentLastRowColumn(a.row,a.column))},this.moveCursorFileEnd=function(){var a=this.doc.getLength()-1,b=this.doc.getLine(a).length;this.moveCursorTo(a,b)},this.moveCursorFileStart=function(){this.moveCursorTo(0,0)},this.moveCursorWordRight=function(){var a=this.selectionLead.row,b=this.selectionLead.column,c=this.doc.getLine(a),d=c.substring(b),e;this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0;if(b==c.length)this.moveCursorRight();else{if(e=this.session.nonTokenRe.exec(d))b+=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0;else if(e=this.session.tokenRe.exec(d))b+=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0;this.moveCursorTo(a,b)}},this.moveCursorWordLeft=function(){var a=this.selectionLead.row,b=this.selectionLead.column,c=this.doc.getLine(a),d=e.stringReverse(c.substring(0,b)),f;this.session.nonTokenRe.lastIndex=0,this.session.tokenRe.lastIndex=0;if(b==0)this.moveCursorLeft();else{if(f=this.session.nonTokenRe.exec(d))b-=this.session.nonTokenRe.lastIndex,this.session.nonTokenRe.lastIndex=0;else if(f=this.session.tokenRe.exec(d))b-=this.session.tokenRe.lastIndex,this.session.tokenRe.lastIndex=0;this.moveCursorTo(a,b)}},this.moveCursorBy=function(a,b){if(this.session.getUseWrapMode()){var c=this.session.documentToScreenPosition(this.selectionLead.row,this.selectionLead.column),d=b==0&&this.$desiredColumn||c.column,e=this.session.screenToDocumentPosition(c.row+a,d);this.moveCursorTo(e.row,e.column+b,b==0)}else{var f=b==0&&this.$desiredColumn||this.selectionLead.column;this.moveCursorTo(this.selectionLead.row+a,f+b,b==0)}},this.moveCursorToPosition=function(a){this.moveCursorTo(a.row,a.column)},this.moveCursorTo=function(a,b,c){this.selectionLead.setPosition(a,b),c||this.$updateDesiredColumn(this.selectionLead.column)},this.moveCursorToScreen=function(a,b,c){if(this.session.getUseWrapMode()){var d=this.session.screenToDocumentPosition(a,b);a=d.row,b=d.column}this.moveCursorTo(a,b,c)}}).call(h.prototype),b.Selection=h}),define("ace/range",["require","exports","module"],function(a,b,c){var d=function(a,b,c,d){this.start={row:a,column:b},this.end={row:c,column:d}};(function(){this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},this.contains=function(a,b){return this.compare(a,b)==0},this.compare=function(a,b){if(!this.isMultiLine()&&a===this.start.row)return b<this.start.column?-1:b>this.end.column?1:0;if(a<this.start.row)return-1;if(a>this.end.row)return 1;if(this.start.row===a)return b>=this.start.column?0:-1;if(this.end.row===a)return b<=this.end.column?0:1;return 0},this.clipRows=function(a,b){if(this.end.row>b)var c={row:b+1,column:0};if(this.start.row>b)var e={row:b+1,column:0};if(this.start.row<a)var e={row:a,column:0};if(this.end.row<a)var c={row:a,column:0};return d.fromPoints(e||this.start,c||this.end)},this.extend=function(a,b){var c=this.compare(a,b);if(c==0)return this;if(c==-1)var e={row:a,column:b};else var f={row:a,column:b};return d.fromPoints(e||this.start,f||this.end)},this.isEmpty=function(){return this.start.row==this.end.row&&this.start.column==this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return d.fromPoints(this.start,this.end)},this.collapseRows=function(){return this.end.column==0?new d(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new d(this.start.row,0,this.end.row,0)},this.toScreenRange=function(a){var b=a.documentToScreenPosition(this.start),c=a.documentToScreenPosition(this.end);return new d(b.row,b.column,c.row,c.column)}}).call(d.prototype),d.fromPoints=function(a,b){return new d(a.row,a.column,b.row,b.column)},b.Range=d}),define("ace/mode/text",["require","exports","module","ace/tokenizer","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("ace/tokenizer").Tokenizer,e=a("ace/mode/text_highlight_rules").TextHighlightRules,f=function(){this.$tokenizer=new d((new e).getRules())};(function(){this.getTokenizer=function(){return this.$tokenizer},this.toggleCommentLines=function(a,b,c,d){},this.getNextLineIndent=function(a,b,c){return""},this.checkOutdent=function(a,b,c){return!1},this.autoOutdent=function(a,b,c){},this.$getIndent=function(a){var b=a.match(/^(\s+)/);if(b)return b[1];return""},this.createWorker=function(a){return null},this.highlightSelection=function(a){var b=a.session;b.$selectionOccurrences||(b.$selectionOccurrences=[]),b.$selectionOccurrences.length&&this.clearSelectionHighlight(a);var c=a.getSelectionRange();if(!c.isEmpty()&&!c.isMultiLine()){var d=c.start.column-1,e=c.end.column+1,f=b.getLine(c.start.row),g=f.length,h=f.substring(Math.max(d,0),Math.min(e,g));if(d>=0&&/^[\w\d]/.test(h)||e<=g&&/[\w\d]$/.test(h))return;h=f.substring(c.start.column,c.end.column);if(!/^[\w\d]+$/.test(h))return;var i=a.getCursorPosition(),j={wrap:!0,wholeWord:!0,caseSensitive:!0,needle:h},k=a.$search.getOptions();a.$search.set(j);var l=a.$search.findAll(b);l.forEach(function(a){if(!a.contains(i.row,i.column)){var c=b.addMarker(a,"ace_selected_word");b.$selectionOccurrences.push(c)}}),a.$search.set(k)}},this.clearSelectionHighlight=function(a){!a.session.$selectionOccurrences||(a.session.$selectionOccurrences.forEach(function(b){a.session.removeMarker(b)}),a.session.$selectionOccurrences=[])}}).call(f.prototype),b.Mode=f}),define("ace/tokenizer",["require","exports","module"],function(a,b,c){var d=function(a){this.rules=a,this.regExps={};for(var b in this.rules){var c=this.rules[b],d=c,e=[];for(var f=0;f<d.length;f++)e.push(d[f].regex);this.regExps[b]=new RegExp("(?:("+e.join(")|(")+")|(.))","g")}};(function(){this.getLineTokens=function(a,b){var c=b,d=this.rules[c],e=this.regExps[c];e.lastIndex=0;var f,g=[],h=0,i={type:null,value:""};while(f=e.exec(a)){var j="text",k=f[0];for(var l=0;l<d.length;l++)if(f[l+1]){var m=d[l];typeof m.token=="function"?j=m.token(f[0]):j=m.token,m.next&&m.next!==c&&(c=m.next,d=this.rules[c],h=e.lastIndex,e=this.regExps[c],e.lastIndex=h);break}i.type!==j?(i.type&&g.push(i),i={type:j,value:k}):i.value+=k;if(h==a.length)break;h=e.lastIndex}i.type&&g.push(i);return{tokens:g,state:c}}}).call(d.prototype),b.Tokenizer=d}),define("ace/mode/text_highlight_rules",["require","exports","module"],function(a,b,c){var d=function(){this.$rules={start:[{token:"empty_line",regex:"^$"},{token:"text",regex:".+"}]}};(function(){this.addRules=function(a,b){for(var c in a){var d=a[c];for(var e=0;e<d.length;e++){var f=d[e];f.next?f.next=b+f.next:f.next=b+c}this.$rules[b+c]=d}},this.getRules=function(){return this.$rules}}).call(d.prototype),b.TextHighlightRules=d}),define("ace/document",["require","exports","module","pilot/oop","pilot/event_emitter","ace/range","ace/anchor"],function(a,b,c){var d=a("pilot/oop"),e=a("pilot/event_emitter").EventEmitter,f=a("ace/range").Range,g=a("ace/anchor").Anchor,h=function(a){this.$lines=[],Array.isArray(a)?this.insertLines(0,a):a.length==0?this.$lines=[""]:this.insert({row:0,column:0},a)};(function(){d.implement(this,e),this.setValue=function(a){var b=this.getLength();this.remove(new f(0,0,b,this.getLine(b-1).length)),this.insert({row:0,column:0},a)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(a,b){return new g(this,a,b)},"aaa".split(/a/).length==0?this.$split=function(a){return a.replace(/\r\n|\r/g,"\n").split("\n")}:this.$split=function(a){return a.split(/\r\n|\r|\n/)},this.$detectNewLine=function(a){var b=a.match(/^.*?(\r?\n)/m);b?this.$autoNewLine=b[1]:this.$autoNewLine="\n"},this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\r\n";case"unix":return"\n";case"auto":return this.$autoNewLine}},this.$autoNewLine="\n",this.$newLineMode="auto",this.setNewLineMode=function(a){this.$newLineMode!==a&&(this.$newLineMode=a)},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(a){return a=="\r\n"||a=="\r"||a=="\n"},this.getLine=function(a){return this.getLines(a,a+1)[0]||""},this.getLines=function(a,b){return this.$lines.slice(a,b+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(a){if(a.start.row==a.end.row)return this.$lines[a.start.row].substring(a.start.column,a.end.column);var b=[];b.push(this.$lines[a.start.row].substring(a.start.column)),b.push.apply(b,this.getLines(a.start.row+1,a.end.row-1)),b.push(this.$lines[a.end.row].substring(0,a.end.column));return b.join(this.getNewLineCharacter())},this.$clipPosition=function(a){var b=this.getLength();a.row>=b&&(a.row=Math.max(0,b-1),a.column=this.getLine(b-1).length);return a},this.insert=function(a,b){if(b.length==0)return a;a=this.$clipPosition(a),this.getLength()<=1&&this.$detectNewLine(b);var c=this.$split(b),d=c.splice(0,1)[0],e=c.length==0?null:c.splice(c.length-1,1)[0];a=this.insertInLine(a,d),e!==null&&(a=this.insertNewLine(a),a=this.insertLines(a.row,c),a=this.insertInLine(a,e||""));return a},this.insertLines=function(a,b){if(b.length==0)return{row:a,column:0};var c=[a,0];c.push.apply(c,b),this.$lines.splice.apply(this.$lines,c);var d=new f(a,0,a+b.length,0),e={action:"insertLines",range:d,lines:b};this._dispatchEvent("change",{data:e});return d.end},this.insertNewLine=function(a){a=this.$clipPosition(a);var b=this.$lines[a.row]||"";this.$lines[a.row]=b.substring(0,a.column),this.$lines.splice(a.row+1,0,b.substring(a.column,b.length));var c={row:a.row+1,column:0},d={action:"insertText",range:f.fromPoints(a,c),text:this.getNewLineCharacter()};this._dispatchEvent("change",{data:d});return c},this.insertInLine=function(a,b){if(b.length==0)return a;var c=this.$lines[a.row]||"";this.$lines[a.row]=c.substring(0,a.column)+b+c.substring(a.column);var d={row:a.row,column:a.column+b.length},e={action:"insertText",range:f.fromPoints(a,d),text:b};this._dispatchEvent("change",{data:e});return d},this.remove=function(a){a.start=this.$clipPosition(a.start),a.end=this.$clipPosition(a.end);if(a.isEmpty())return a.start;var b=a.start.row,c=a.end.row;if(a.isMultiLine()){var d=a.start.column==0?b:b+1,e=c-1;a.end.column>0&&this.removeInLine(c,0,a.end.column),e>=d&&this.removeLines(d,e),d!=b&&(this.removeInLine(b,a.start.column,this.getLine(b).length),this.removeNewLine(a.start.row))}else this.removeInLine(b,a.start.column,a.end.column);return a.start},this.removeInLine=function(a,b,c){if(b!=c){var d=new f(a,b,a,c),e=this.getLine(a),g=e.substring(b,c),h=e.substring(0,b)+e.substring(c,e.length);this.$lines.splice(a,1,h);var i={action:"removeText",range:d,text:g};this._dispatchEvent("change",{data:i});return d.start}},this.removeLines=function(a,b){var c=new f(a,0,b+1,0),d=this.$lines.splice(a,b-a+1),e={action:"removeLines",range:c,nl:this.getNewLineCharacter(),lines:d};this._dispatchEvent("change",{data:e});return d},this.removeNewLine=function(a){var b=this.getLine(a),c=this.getLine(a+1),d=new f(a,b.length,a+1,0),e=b+c;this.$lines.splice(a,2,e);var g={action:"removeText",range:d,text:this.getNewLineCharacter()};this._dispatchEvent("change",{data:g})},this.replace=function(a,b){if(b.length==0&&a.isEmpty())return a.start;if(b==this.getTextRange(a))return a.end;this.remove(a);if(b)var c=this.insert(a.start,b);else c=a.start;return c},this.applyDeltas=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=f.fromPoints(c.range.start,c.range.end);c.action=="insertLines"?this.insertLines(d.start.row,c.lines):c.action=="insertText"?this.insert(d.start,c.text):c.action=="removeLines"?this.removeLines(d.start.row,d.end.row-1):c.action=="removeText"&&this.remove(d)}},this.revertDeltas=function(a){for(var b=a.length-1;b>=0;b--){var c=a[b],d=f.fromPoints(c.range.start,c.range.end);c.action=="insertLines"?this.removeLines(d.start.row,d.end.row-1):c.action=="insertText"?this.remove(d):c.action=="removeLines"?this.insertLines(d.start.row,c.lines):c.action=="removeText"&&this.insert(d.start,c.text)}}}).call(h.prototype),b.Document=h}),define("ace/anchor",["require","exports","module","pilot/oop","pilot/event_emitter"],function(a,b,c){var d=a("pilot/oop"),e=a("pilot/event_emitter").EventEmitter,f=b.Anchor=function(a,b,c){this.document=a,typeof c=="undefined"?this.setPosition(b.row,b.column):this.setPosition(b,c),this.$onChange=this.onChange.bind(this),a.on("change",this.$onChange)};(function(){d.implement(this,e),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.onChange=function(a){var b=a.data,c=b.range;if(c.start.row!=c.end.row||c.start.row==this.row){if(c.start.row>this.row)return;if(c.start.row==this.row&&c.start.column>this.column)return;var d=this.row,e=this.column;b.action==="insertText"?c.start.row===d&&c.start.column<=e?c.start.row===c.end.row?e+=c.end.column-c.start.column:(e-=c.start.column,d+=c.end.row-c.start.row):c.start.row!==c.end.row&&c.start.row<d&&(d+=c.end.row-c.start.row):b.action==="insertLines"?c.start.row<=d&&(d+=c.end.row-c.start.row):b.action=="removeText"?c.start.row==d&&c.start.column<e?c.end.column>=e?e=c.start.column:e=Math.max(0,e-(c.end.column-c.start.column)):c.start.row!==c.end.row&&c.start.row<d?(c.end.row==d&&(e=Math.max(0,e-c.end.column)+c.start.column),d-=c.end.row-c.start.row):c.end.row==d&&(d-=c.end.row-c.start.row,e=Math.max(0,e-c.end.column)+c.start.column):b.action=="removeLines"&&c.start.row<=d&&(c.end.row<=d?d-=c.end.row-c.start.row:(d=c.start.row,e=0)),this.setPosition(d,e,!0)}},this.setPosition=function(a,b,c){c?pos={row:a,column:b}:pos=this.$clipPositionToDocument(a,b);if(this.row!=pos.row||this.column!=pos.column){var d={row:this.row,column:this.column};this.row=pos.row,this.column=pos.column,this._dispatchEvent("change",{old:d,value:pos})}},this.detach=function(){this.document.removeEventListener("change",this.$onChange)},this.$clipPositionToDocument=function(a,b){var c={};a>=this.document.getLength()?(c.row=Math.max(0,this.document.getLength()-1),c.column=this.document.getLine(c.row).length):a<0?(c.row=0,c.column=0):(c.row=a,c.column=Math.min(this.document.getLine(c.row).length,Math.max(0,b))),b<0&&(c.column=0);return c}}).call(f.prototype)}),define("ace/search",["require","exports","module","pilot/lang","pilot/oop","ace/range"],function(a,b,c){var d=a("pilot/lang"),e=a("pilot/oop"),f=a("ace/range").Range,g=function(){this.$options={needle:"",backwards:!1,wrap:!1,caseSensitive:!1,wholeWord:!1,scope:g.ALL,regExp:!1}};g.ALL=1,g.SELECTION=2,function(){this.set=function(a){e.mixin(this.$options,a);return this},this.getOptions=function(){return d.copyObject(this.$options)},this.find=function(a){if(!this.$options.needle)return null;if(this.$options.backwards)var b=this.$backwardMatchIterator(a);else b=this.$forwardMatchIterator(a);var c=null;b.forEach(function(a){c=a;return!0});return c},this.findAll=function(a){if(!this.$options.needle)return[];if(this.$options.backwards)var b=this.$backwardMatchIterator(a);else b=this.$forwardMatchIterator(a);var c=[];b.forEach(function(a){c.push(a)});return c},this.replace=function(a,b){var c=this.$assembleRegExp(),d=c.exec(a);return d&&d[0].length==a.length?this.$options.regExp?a.replace(c,b):b:null},this.$forwardMatchIterator=function(a){var b=this.$assembleRegExp(),c=this;return{forEach:function(d){c.$forwardLineIterator(a).forEach(function(a,e,f){e&&(a=a.substring(e));var g=[];a.replace(b,function(a){var b=arguments[arguments.length-2];g.push({str:a,offset:e+b});return a});for(var h=0;h<g.length;h++){var i=g[h],j=c.$rangeFromMatch(f,i.offset,i.str.length);if(d(j))return!0}})}}},this.$backwardMatchIterator=function(a){var b=this.$assembleRegExp(),c=this;return{forEach:function(d){c.$backwardLineIterator(a).forEach(function(a,e,f){e&&(a=a.substring(e));var g=[];a.replace(b,function(a,b){g.push({str:a,offset:e+b});return a});for(var h=g.length-1;h>=0;h--){var i=g[h],j=c.$rangeFromMatch(f,i.offset,i.str.length);if(d(j))return!0}})}}},this.$rangeFromMatch=function(a,b,c){return new f(a,b,a,b+c)},this.$assembleRegExp=function(){if(this.$options.regExp)var a=this.$options.needle;else a=d.escapeRegExp(this.$options.needle);this.$options.wholeWord&&(a="\\b"+a+"\\b");var b="g";this.$options.caseSensitive||(b+="i");var c=new RegExp(a,b);return c},this.$forwardLineIterator=function(a){function k(e){var f=a.getLine(e);b&&e==c.end.row&&(f=f.substring(0,c.end.column)),j&&e==d.row&&(f=f.substring(0,d.column));return f}var b=this.$options.scope==g.SELECTION,c=a.getSelection().getRange(),d=a.getSelection().getCursor(),e=b?c.start.row:0,f=b?c.start.column:0,h=b?c.end.row:a.getLength()-1,i=this.$options.wrap,j=!1;return{forEach:function(a){var b=d.row,c=k(b),g=d.column,l=!1;j=!1;while(!a(c,g,b)){if(l)return;b++,g=0;if(b>h)if(i)b=e,g=f,j=!0;else return;b==d.row&&(l=!0),c=k(b)}}}},this.$backwardLineIterator=function(a){var b=this.$options.scope==g.SELECTION,c=a.getSelection().getRange(),d=b?c.end:c.start,e=b?c.start.row:0,f=b?c.start.column:0,h=b?c.end.row:a.getLength()-1,i=this.$options.wrap;return{forEach:function(g){var j=d.row,k=a.getLine(j).substring(0,d.column),l=0,m=!1,n=!1;while(!g(k,l,j)){if(m)return;j--,l=0;if(j<e)if(i)j=h,n=!0;else return;j==d.row&&(m=!0),k=a.getLine(j),b&&(j==e?l=f:j==h&&(k=k.substring(0,c.end.column))),n&&j==d.row&&(l=d.column)}}}}}.call(g.prototype),b.Search=g}),define("ace/background_tokenizer",["require","exports","module","pilot/oop","pilot/event_emitter"],function(a,b,c){var d=a("pilot/oop"),e=a("pilot/event_emitter").EventEmitter,f=function(a,b){this.running=!1,this.lines=[],this.currentLine=0,this.tokenizer=a;var c=this;this.$worker=function(){if(!!c.running){var a=new Date,d=c.currentLine,e=c.doc,f=0,g=b.getLastVisibleRow(),h=e.getLength();while(c.currentLine<h){c.lines[c.currentLine]=c.$tokenizeRows(c.currentLine,c.currentLine)[0],c.currentLine++,f+=1;if(f%5==0&&new Date-a>20){c.fireUpdateEvent(d,c.currentLine-1);var i=c.currentLine<g?20:100;c.running=setTimeout(c.$worker,i);return}}c.running=!1,c.fireUpdateEvent(d,h-1)}}};(function(){d.implement(this,e),this.setTokenizer=function(a){this.tokenizer=a,this.lines=[],this.start(0)},this.setDocument=function(a){this.doc=a,this.lines=[],this.stop()},this.fireUpdateEvent=function(a,b){var c={first:a,last:b};this._dispatchEvent("update",{data:c})},this.start=function(a){this.currentLine=Math.min(a||0,this.currentLine,this.doc.getLength()),this.lines.splice(this.currentLine,this.lines.length),this.stop(),this.running=setTimeout(this.$worker,700)},this.stop=function(){this.running&&clearTimeout(this.running),this.running=!1},this.getTokens=function(a,b){return this.$tokenizeRows(a,b)},this.getState=function(a){return this.$tokenizeRows(a,a)[0].state},this.$tokenizeRows=function(a,b){if(!this.doc)return[];var c=[],d="start",e=!1;a>0&&this.lines[a-1]&&(d=this.lines[a-1].state,e=!0);var f=this.doc.getLines(a,b);for(var g=a;g<=b;g++)if(!this.lines[g]){var h=this.tokenizer.getLineTokens(f[g-a]||"",d),d=h.state;c.push(h),e&&(this.lines[g]=h)}else{var h=this.lines[g];d=h.state,c.push(h)}return c}}).call(f.prototype),b.BackgroundTokenizer=f}),define("ace/undomanager",["require","exports","module"],function(a,b,c){var d=function(){this.reset()};(function(){this.execute=function(a){var b=a.args[0];this.$doc=a.args[1],this.$undoStack.push(b)},this.undo=function(){var a=this.$undoStack.pop();a&&(this.$doc.undoChanges(a),this.$redoStack.push(a))},this.redo=function(){var a=this.$redoStack.pop();a&&(this.$doc.redoChanges(a),this.$undoStack.push(a))},this.reset=function(){this.$undoStack=[],this.$redoStack=[]},this.hasUndo=function(){return this.$undoStack.length>0},this.hasRedo=function(){return this.$redoStack.length>0}}).call(d.prototype),b.UndoManager=d}),define("ace/theme/textmate",["require","exports","module","pilot/dom"],function(a,b,c){var d=a("pilot/dom"),e=".ace-tm .ace_editor {\n  border: 2px solid rgb(159, 159, 159);\n}\n\n.ace-tm .ace_editor.ace_focus {\n  border: 2px solid #327fbd;\n}\n\n.ace-tm .ace_gutter {\n  width: 50px;\n  background: #e8e8e8;\n  color: #333;\n  overflow : hidden;\n}\n\n.ace-tm .ace_gutter-layer {\n  width: 100%;\n  text-align: right;\n}\n\n.ace-tm .ace_gutter-layer .ace_gutter-cell {\n  padding-right: 6px;\n}\n\n.ace-tm .ace_print_margin {\n  width: 1px;\n  background: #e8e8e8;\n}\n\n.ace-tm .ace_text-layer {\n  cursor: text;\n}\n\n.ace-tm .ace_cursor {\n  border-left: 2px solid black;\n}\n\n.ace-tm .ace_cursor.ace_overwrite {\n  border-left: 0px;\n  border-bottom: 1px solid black;\n}\n        \n.ace-tm .ace_line .ace_invisible {\n  color: rgb(191, 191, 191);\n}\n\n.ace-tm .ace_line .ace_keyword {\n  color: blue;\n}\n\n.ace-tm .ace_line .ace_constant.ace_buildin {\n  color: rgb(88, 72, 246);\n}\n\n.ace-tm .ace_line .ace_constant.ace_language {\n  color: rgb(88, 92, 246);\n}\n\n.ace-tm .ace_line .ace_constant.ace_library {\n  color: rgb(6, 150, 14);\n}\n\n.ace-tm .ace_line .ace_invalid {\n  background-color: rgb(153, 0, 0);\n  color: white;\n}\n\n.ace-tm .ace_line .ace_support.ace_function {\n  color: rgb(60, 76, 114);\n}\n\n.ace-tm .ace_line .ace_support.ace_constant {\n  color: rgb(6, 150, 14);\n}\n\n.ace-tm .ace_line .ace_support.ace_type,\n.ace-tm .ace_line .ace_support.ace_class {\n  color: rgb(109, 121, 222);\n}\n\n.ace-tm .ace_line .ace_keyword.ace_operator {\n  color: rgb(104, 118, 135);\n}\n\n.ace-tm .ace_line .ace_string {\n  color: rgb(3, 106, 7);\n}\n\n.ace-tm .ace_line .ace_comment {\n  color: rgb(76, 136, 107);\n}\n\n.ace-tm .ace_line .ace_comment.ace_doc {\n  color: rgb(0, 102, 255);\n}\n\n.ace-tm .ace_line .ace_comment.ace_doc.ace_tag {\n  color: rgb(128, 159, 191);\n}\n\n.ace-tm .ace_line .ace_constant.ace_numeric {\n  color: rgb(0, 0, 205);\n}\n\n.ace-tm .ace_line .ace_variable {\n  color: rgb(49, 132, 149);\n}\n\n.ace-tm .ace_line .ace_xml_pe {\n  color: rgb(104, 104, 91);\n}\n\n.ace-tm .ace_marker-layer .ace_selection {\n  background: rgb(181, 213, 255);\n}\n\n.ace-tm .ace_marker-layer .ace_step {\n  background: rgb(252, 255, 0);\n}\n\n.ace-tm .ace_marker-layer .ace_stack {\n  background: rgb(164, 229, 101);\n}\n\n.ace-tm .ace_marker-layer .ace_bracket {\n  margin: -1px 0 0 -1px;\n  border: 1px solid rgb(192, 192, 192);\n}\n\n.ace-tm .ace_marker-layer .ace_active_line {\n  background: rgb(232, 242, 254);\n}\n\n.ace-tm .ace_marker-layer .ace_selected_word {\n  background: rgb(250, 250, 255);\n  border: 1px solid rgb(200, 200, 250);\n}\n\n.ace-tm .ace_string.ace_regex {\n  color: rgb(255, 0, 0)\n}";d.importCssString(e),b.cssClass="ace-tm"}),define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"],function(a,b,c){var d=a("ace/range").Range,e=function(){};(function(){this.checkOutdent=function(a,b){if(!/^\s+$/.test(a))return!1;return/^\s*\}/.test(b)},this.autoOutdent=function(a,b){var c=a.getLine(b),e=c.match(/^(\s*\})/);if(!e)return 0;var f=e[1].length,g=a.findMatchingBracket({row:b,column:f});if(!g||g.row==b)return 0;var h=this.$getIndent(a.getLine(g.row));a.replace(new d(b,0,b,f-1),h)},this.$getIndent=function(a){var b=a.match(/^(\s+)/);if(b)return b[1];return""}}).call(e.prototype),b.MatchingBraceOutdent=e}),define("ace/virtual_renderer",["require","exports","module","pilot/oop","pilot/dom","pilot/event","pilot/useragent","ace/layer/gutter","ace/layer/marker","ace/layer/text","ace/layer/cursor","ace/scrollbar","ace/renderloop","pilot/event_emitter","text/ace/css/editor.css"],function(a,b,c){var d=a("pilot/oop"),e=a("pilot/dom"),f=a("pilot/event"),g=a("pilot/useragent"),h=a("ace/layer/gutter").Gutter,i=a("ace/layer/marker").Marker,j=a("ace/layer/text").Text,k=a("ace/layer/cursor").Cursor,l=a("ace/scrollbar").ScrollBar,m=a("ace/renderloop").RenderLoop,n=a("pilot/event_emitter").EventEmitter,o=a("text/ace/css/editor.css");e.importCssString(o);var p=function(a,b){this.container=a,e.addCssClass(this.container,"ace_editor"),this.setTheme(b),this.$gutter=e.createElement("div"),this.$gutter.className="ace_gutter",this.container.appendChild(this.$gutter),this.scroller=e.createElement("div"),this.scroller.className="ace_scroller",this.container.appendChild(this.scroller),this.content=e.createElement("div"),this.content.className="ace_content",this.scroller.appendChild(this.content),this.$gutterLayer=new h(this.$gutter),this.$markerBack=new i(this.content);var c=this.$textLayer=new j(this.content);this.canvas=c.element,this.$markerFront=new i(this.content),this.characterWidth=c.getCharacterWidth(),this.lineHeight=c.getLineHeight(),this.$cursorLayer=new k(this.content),this.$cursorPadding=8,this.$horizScroll=!0,this.$horizScrollAlwaysVisible=!0,this.scrollBar=new l(a),this.scrollBar.addEventListener("scroll",this.onScroll.bind(this)),this.scrollTop=0,this.cursorPos={row:0,column:0};var d=this;this.$textLayer.addEventListener("changeCharaterSize",function(){d.characterWidth=c.getCharacterWidth(),d.lineHeight=c.getLineHeight(),d.$updatePrintMargin(),d.onResize(!0),d.$loop.schedule(d.CHANGE_FULL)}),f.addListener(this.$gutter,"click",this.$onGutterClick.bind(this)),f.addListener(this.$gutter,"dblclick",this.$onGutterClick.bind(this)),this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0},this.$loop=new m(this.$renderChanges.bind(this)),this.$loop.schedule(this.CHANGE_FULL),this.setPadding(2),this.$updatePrintMargin()};(function(){this.showGutter=!0,this.CHANGE_CURSOR=1,this.CHANGE_MARKER=2,this.CHANGE_GUTTER=4,this.CHANGE_SCROLL=8,this.CHANGE_LINES=16,this.CHANGE_TEXT=32,this.CHANGE_SIZE=64,this.CHANGE_MARKER_BACK=128,this.CHANGE_MARKER_FRONT=256,this.CHANGE_FULL=512,d.implement(this,n),this.setSession=function(a){this.session=a,this.$cursorLayer.setSession(a),this.$markerBack.setSession(a),this.$markerFront.setSession(a),this.$gutterLayer.setSession(a),this.$textLayer.setSession(a),this.$loop.schedule(this.CHANGE_FULL)},this.updateLines=function(a,b){b===undefined&&(b=Infinity),this.$changedLines?(this.$changedLines.firstRow>a&&(this.$changedLines.firstRow=a),this.$changedLines.lastRow<b&&(this.$changedLines.lastRow=b)):this.$changedLines={firstRow:a,lastRow:b},this.$loop.schedule(this.CHANGE_LINES)},this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)},this.updateFull=function(){this.$loop.schedule(this.CHANGE_FULL)},this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()},this.onResize=function(a){var b=this.CHANGE_SIZE,c=e.getInnerHeight(this.container);if(a||this.$size.height!=c)this.$size.height=c,this.scroller.style.height=c+"px",this.scrollBar.setHeight(this.scroller.clientHeight),this.session&&(this.scrollToY(this.getScrollTop()),b=b|this.CHANGE_FULL);var d=e.getInnerWidth(this.container);if(a||this.$size.width!=d){this.$size.width=d;var f=this.showGutter?this.$gutter.offsetWidth:0;this.scroller.style.left=f+"px",this.scroller.style.width=Math.max(0,d-f-this.scrollBar.getWidth())+"px";if(this.session.getUseWrapMode()){var g=this.scroller.clientWidth-this.$padding*2,h=Math.floor(g/this.characterWidth)-1;if(this.session.adjustWrapLimit(h)||a)b=b|this.CHANGE_FULL}}this.$size.scrollerWidth=this.scroller.clientWidth,this.$size.scrollerHeight=this.scroller.clientHeight,this.$loop.schedule(b)},this.setTokenizer=function(a){this.$tokenizer=a,this.$textLayer.setTokenizer(a),this.$loop.schedule(this.CHANGE_TEXT)},this.$onGutterClick=function(a){var b=f.getDocumentX(a),c=f.getDocumentY(a);this._dispatchEvent("gutter"+a.type,{row:this.screenToTextCoordinates(b,c).row,htmlEvent:a})},this.setShowInvisibles=function(a){this.$textLayer.setShowInvisibles(a)&&this.$loop.schedule(this.CHANGE_TEXT)},this.getShowInvisibles=function(){return this.$textLayer.showInvisibles},this.$showPrintMargin=!0,this.setShowPrintMargin=function(a){this.$showPrintMargin=a,this.$updatePrintMargin()},this.getShowPrintMargin=function(){return this.$showPrintMargin},this.$printMarginColumn=80,this.setPrintMarginColumn=function(a){this.$printMarginColumn=a,this.$updatePrintMargin()},this.getPrintMarginColumn=function(){return this.$printMarginColumn},this.getShowGutter=function(){return this.showGutter},this.setShowGutter=function(a){this.showGutter!==a&&(this.$gutter.style.display=a?"block":"none",this.showGutter=a,this.onResize(!0))},this.$updatePrintMargin=function(){var a;if(!!this.$showPrintMargin||!!this.$printMarginEl){this.$printMarginEl||(a=e.createElement("div"),a.className="ace_print_margin_layer",this.$printMarginEl=e.createElement("div"),this.$printMarginEl.className="ace_print_margin",a.appendChild(this.$printMarginEl),this.content.insertBefore(a,this.$textLayer.element));var b=this.$printMarginEl.style;b.left=this.characterWidth*this.$printMarginColumn+this.$padding*2+"px",b.visibility=this.$showPrintMargin?"visible":"hidden"}},this.getContainerElement=function(){return this.container},this.getMouseEventTarget=function(){return this.content},this.getTextAreaContainer=function(){return this.container},this.moveTextAreaToCursor=function(a){if(!g.isIE){var b=this.$cursorLayer.getPixelPosition();if(!b)return;var c=this.content.getBoundingClientRect(),d=this.layerConfig&&this.layerConfig.offset||0;a.style.left=c.left+b.left+this.$padding+"px",a.style.top=c.top+b.top-this.scrollTop+d+"px"}},this.getFirstVisibleRow=function(){return(this.layerConfig||{}).firstRow||0},this.getFirstFullyVisibleRow=function(){if(!this.layerConfig)return 0;return this.layerConfig.firstRow+(this.layerConfig.offset==0?0:1)},this.getLastFullyVisibleRow=function(){if(!this.layerConfig)return 0;var a=Math.floor((this.layerConfig.height+this.layerConfig.offset)/this.layerConfig.lineHeight);return this.layerConfig.firstRow-1+a},this.getLastVisibleRow=function(){return(this.layerConfig||{}).lastRow||0},this.$padding=null,this.setPadding=function(a){this.$padding=a,this.content.style.padding="0 "+a+"px",this.$loop.schedule(this.CHANGE_FULL),this.$updatePrintMargin()},this.getHScrollBarAlwaysVisible=function(){return this.$horizScrollAlwaysVisible},this.setHScrollBarAlwaysVisible=function(a){this.$horizScrollAlwaysVisible!=a&&(this.$horizScrollAlwaysVisible=a,(!this.$horizScrollAlwaysVisible||!this.$horizScroll)&&this.$loop.schedule(this.CHANGE_SCROLL))},this.onScroll=function(a){this.scrollToY(a.data)},this.$updateScrollBar=function(){this.scrollBar.setInnerHeight(this.session.getScreenLength()*this.lineHeight),this.scrollBar.setScrollTop(this.scrollTop)},this.$renderChanges=function(a){if(!(!a||!this.session||!this.$tokenizer)){(!this.layerConfig||a&this.CHANGE_FULL||a&this.CHANGE_SIZE||a&this.CHANGE_TEXT||a&this.CHANGE_LINES||a&this.CHANGE_SCROLL)&&this.$computeLayerConfig();if(a&this.CHANGE_FULL){this.$textLayer.update(this.layerConfig),this.showGutter&&this.$gutterLayer.update(this.layerConfig),this.$markerBack.update(this.layerConfig),this.$markerFront.update(this.layerConfig),this.$cursorLayer.update(this.layerConfig),this.$updateScrollBar(),this.scrollCursorIntoView();return}if(a&this.CHANGE_SCROLL){a&this.CHANGE_TEXT||a&this.CHANGE_LINES?this.$textLayer.update(this.layerConfig):this.$textLayer.scrollLines(this.layerConfig),this.showGutter&&this.$gutterLayer.update(this.layerConfig),this.$markerBack.update(this.layerConfig),this.$markerFront.update(this.layerConfig),this.$cursorLayer.update(this.layerConfig),this.$updateScrollBar();return}a&this.CHANGE_TEXT?(this.$textLayer.update(this.layerConfig),this.showGutter&&this.$gutterLayer.update(this.layerConfig)):a&this.CHANGE_LINES?(this.$updateLines(),this.$updateScrollBar(),this.showGutter&&this.$gutterLayer.update(this.layerConfig)):a&this.CHANGE_GUTTER&&this.showGutter&&this.$gutterLayer.update(this.layerConfig),a&this.CHANGE_CURSOR&&this.$cursorLayer.update(this.layerConfig),a&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)&&this.$markerFront.update(this.layerConfig),a&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)&&this.$markerBack.update(this.layerConfig),a&this.CHANGE_SIZE&&this.$updateScrollBar()}},this.$computeLayerConfig=function(){var a=this.session,b=this.scrollTop%this.lineHeight,c=this.$size.scrollerHeight+this.lineHeight,d=this.$getLongestLine(),e=this.layerConfig?this.layerConfig.width!=d:!0,f=this.$horizScrollAlwaysVisible||this.$size.scrollerWidth-d<0,g=this.$horizScroll!==f;this.$horizScroll=f,g&&(this.scroller.style.overflowX=f?"scroll":"hidden");var h=Math.ceil(c/this.lineHeight)-1,i=Math.max(0,Math.round((this.scrollTop-b)/this.lineHeight)),j=i+h,k,l,m={lineHeight:this.lineHeight};i=a.screenToDocumentRow(i),k=a.documentToScreenRow(i),l=a.getRowHeight(m,i),j=Math.min(a.screenToDocumentRow(j),a.getLength()-1),c=this.$size.scrollerHeight+a.getRowHeight(m,j)+l,b=this.scrollTop-k*this.lineHeight;var n=this.layerConfig={width:d,padding:this.$padding,firstRow:i,firstRowScreen:k,lastRow:j,lineHeight:this.lineHeight,characterWidth:this.characterWidth,minHeight:c,offset:b,height:this.$size.scrollerHeight};this.$gutterLayer.element.style.marginTop=-b+"px",this.content.style.marginTop=-b+"px",this.content.style.width=d+"px",this.content.style.height=c+"px",g&&this.onResize(!0)},this.$updateLines=function(){var a=this.$changedLines.firstRow,b=this.$changedLines.lastRow;this.$changedLines=null;var c=this.layerConfig;if(c.width!=this.$getLongestLine())return this.$textLayer.update(c);if(!(a>c.lastRow+1)){if(b<c.firstRow)return;if(b===Infinity){this.showGutter&&this.$gutterLayer.update(c),this.$textLayer.update(c);return}this.$textLayer.updateLines(c,a,b)}},this.$getLongestLine=function(){var a=this.session.getScreenWidth()+1;this.$textLayer.showInvisibles&&(a+=1);return Math.max(this.$size.scrollerWidth-this.$padding*2,Math.round(a*this.characterWidth))},this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(!0)),this.$loop.schedule(this.CHANGE_MARKER_FRONT)},this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers()),this.$loop.schedule(this.CHANGE_MARKER_BACK)},this.addGutterDecoration=function(a,b){this.$gutterLayer.addGutterDecoration(a,b),this.$loop.schedule(this.CHANGE_GUTTER)},this.removeGutterDecoration=function(a,b){this.$gutterLayer.removeGutterDecoration(a,b),this.$loop.schedule(this.CHANGE_GUTTER)},this.setBreakpoints=function(a){this.$gutterLayer.setBreakpoints(a),this.$loop.schedule(this.CHANGE_GUTTER)},this.setAnnotations=function(a){this.$gutterLayer.setAnnotations(a),this.$loop.schedule(this.CHANGE_GUTTER)},this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)},this.hideCursor=function(){this.$cursorLayer.hideCursor()},this.showCursor=function(){this.$cursorLayer.showCursor()},this.scrollCursorIntoView=function(){if(this.$size.scrollerHeight!==0){var a=this.$cursorLayer.getPixelPosition(),b=a.left+this.$padding,c=a.top;this.getScrollTop()>c&&this.scrollToY(c),this.getScrollTop()+this.$size.scrollerHeight<c+this.lineHeight&&this.scrollToY(c+this.lineHeight-this.$size.scrollerHeight),this.scroller.scrollLeft>b&&this.scrollToX(b),this.scroller.scrollLeft+this.$size.scrollerWidth<b+this.characterWidth&&(b+this.characterWidth>this.scroller.scrollWidth&&this.$renderChanges(this.CHANGE_SIZE),this.scrollToX(Math.round(b+this.characterWidth-this.$size.scrollerWidth)))}},this.getScrollTop=function(){return this.scrollTop},this.getScrollLeft=function(){return this.scroller.scrollLeft},this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight},this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)},this.scrollToRow=function(a){this.scrollToY(a*this.lineHeight)},this.scrollToLine=function(a,b){var c={lineHeight:this.lineHeight},d=0;for(var e=1;e<a;e++)d+=this.session.getRowHeight(c,e-1);b&&(d-=this.$size.scrollerHeight/2),this.scrollToY(d)},this.scrollToY=function(a){var b=this.session.getScreenLength()*this.lineHeight-this.$size.scrollerHeight,a=Math.max(0,Math.min(b,a));this.scrollTop!==a&&(this.scrollTop=a,this.$loop.schedule(this.CHANGE_SCROLL))},this.scrollToX=function(a){a<=this.$padding&&(a=0),this.scroller.scrollLeft=a},this.scrollBy=function(a,b){b&&this.scrollToY(this.scrollTop+b),a&&this.scrollToX(this.scroller.scrollLeft+a)},this.screenToTextCoordinates=function(a,b){var c=this.scroller.getBoundingClientRect(),d=Math.round((a+this.scroller.scrollLeft-c.left-this.$padding-e.getPageScrollLeft())/this.characterWidth),f=Math.floor((b+this.scrollTop-c.top-e.getPageScrollTop())/this.lineHeight);return this.session.screenToDocumentPosition(f,Math.max(d,0))},this.textToScreenCoordinates=function(a,b){var c=this.scroller.getBoundingClientRect(),d=this.session.documentToScreenPosition(a,b),e=this.$padding+Math.round(d.column*this.characterWidth),f=d.row*this.lineHeight;return{pageX:c.left+e-this.getScrollLeft(),pageY:c.top+f-this.getScrollTop()}},this.visualizeFocus=function(){e.addCssClass(this.container,"ace_focus")},this.visualizeBlur=function(){e.removeCssClass(this.container,"ace_focus")},this.showComposition=function(a){this.$composition||(this.$composition=e.createElement("div"),this.$composition.className="ace_composition",this.content.appendChild(this.$composition)),this.$composition.innerHTML="&#160;";var b=this.$cursorLayer.getPixelPosition(),c=this.$composition.style;c.top=b.top+"px",c.left=b.left+this.$padding+"px",c.height=this.lineHeight+"px",this.hideCursor()},this.setCompositionText=function(a){e.setInnerText(this.$composition,a)},this.hideComposition=function(){this.showCursor();if(!!this.$composition){var a=this.$composition.style;a.top="-10000px",a.left="-10000px"}},this.setTheme=function(b){function d(a){c.$theme&&e.removeCssClass(c.container,c.$theme),c.$theme=a?a.cssClass:null,c.$theme&&e.addCssClass(c.container,c.$theme),c.$size&&(c.$size.width=0,c.onResize())}var c=this;!b||typeof b=="string"?(b=b||"ace/theme/textmate",a([b],function(a){d(a)})):d(b);var c=this},this.setStyle=function(a){e.addCssClass(this.container,a)},this.unsetStyle=function(a){e.removeCssClass(this.container,a)}}).call(p.prototype),b.VirtualRenderer=p}),define("ace/layer/gutter",["require","exports","module","pilot/dom"],function(a,b,c){var d=a("pilot/dom"),e=function(a){this.element=d.createElement("div"),this.element.className="ace_layer ace_gutter-layer",a.appendChild(this.element),this.$breakpoints=[],this.$annotations=[],this.$decorations=[]};(function(){this.setSession=function(a){this.session=a},this.addGutterDecoration=function(a,b){this.$decorations[a]||(this.$decorations[a]=""),this.$decorations[a]+=" ace_"+b},this.removeGutterDecoration=function(a,b){this.$decorations[a]=this.$decorations[a].replace(" ace_"+b,"")},this.setBreakpoints=function(a){this.$breakpoints=a.concat()},this.setAnnotations=function(a){this.$annotations=[];for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];if(!c)continue;var d=this.$annotations[b]={text:[]};for(var e=0;e<c.length;e++){var f=c[e];d.text.push(f.text.replace(/"/g,"&quot;").replace(/'/g,"&#8217;").replace(/</,"&lt;"));var g=f.type;g=="error"?d.className="ace_error":g=="warning"&&d.className!="ace_error"?d.className="ace_warning":g=="info"&&!d.className&&(d.className="ace_info")}}},this.update=function(a){this.$config=a;var b=[];for(var c=a.firstRow;c<=a.lastRow;c++){var e=this.$annotations[c]||{className:"",text:[]};b.push("<div class='ace_gutter-cell",this.$decorations[c]||"",this.$breakpoints[c]?" ace_breakpoint ":" ",e.className,"' title='",e.text.join("\n"),"' style='height:",this.session.getRowHeight(a,c),"px;'>",c+1,"</div>")}this.element=d.setInnerHtml(this.element,b.join("")),this.element.style.height=a.minHeight+"px"}}).call(e.prototype),b.Gutter=e}),define("ace/layer/marker",["require","exports","module","ace/range","pilot/dom"],function(a,b,c){var d=a("ace/range").Range,e=a("pilot/dom"),f=function(a){this.element=e.createElement("div"),this.element.className="ace_layer ace_marker-layer",a.appendChild(this.element)};(function(){this.setSession=function(a){this.session=a},this.setMarkers=function(a){this.markers=a},this.update=function(a){var a=a||this.config;if(!!a){this.config=a;var b=[];for(var c in this.markers){var d=this.markers[c],f=d.range.clipRows(a.firstRow,a.lastRow);if(f.isEmpty())continue;f=f.toScreenRange(this.session);if(d.renderer){var g=this.$getTop(f.start.row,a),h=Math.round(f.start.column*a.characterWidth);d.renderer(b,f,h,g,a)}else f.isMultiLine()?d.type=="text"?this.drawTextMarker(b,f,d.clazz,a):this.drawMultiLineMarker(b,f,d.clazz,a):this.drawSingleLineMarker(b,f,d.clazz,a)}this.element=e.setInnerHtml(this.element,b.join(""))}},this.$getTop=function(a,b){return(a-b.firstRowScreen)*b.lineHeight},this.drawTextMarker=function(a,b,c,e){var f=b.start.row,g=new d(f,b.start.column,f,this.session.getScreenLastRowColumn(f));this.drawSingleLineMarker(a,g,c,e,1);var f=b.end.row,g=new d(f,0,f,b.end.column);this.drawSingleLineMarker(a,g,c,e);for(var f=b.start.row+1;f<b.end.row;f++)g.start.row=f,g.end.row=f,g.end.column=this.session.getScreenLastRowColumn(f),this.drawSingleLineMarker(a,g,c,e,1)},this.drawMultiLineMarker=function(a,b,c,d){var e=d.lineHeight,f=Math.round(d.width-b.start.column*d.characterWidth),g=this.$getTop(b.start.row,d),h=Math.round(b.start.column*d.characterWidth);a.push("<div class='",c,"' style='","height:",e,"px;","width:",f,"px;","top:",g,"px;","left:",h,"px;'></div>");var g=this.$getTop(b.end.row,d),f=Math.round(b.end.column*d.characterWidth);a.push("<div class='",c,"' style='","height:",e,"px;","top:",g,"px;","width:",f,"px;'></div>");var e=(b.end.row-b.start.row-1)*d.lineHeight;if(!(e<0)){var g=this.$getTop(b.start.row+1,d);a.push("<div class='",c,"' style='","height:",e,"px;","width:",d.width,"px;","top:",g,"px;'></div>")}},this.drawSingleLineMarker=function(a,b,c,d,e){var f=d.lineHeight,g=Math.round((b.end.column+(e||0)-b.start.column)*d.characterWidth),h=this.$getTop(b.start.row,d),i=Math.round(b.start.column*d.characterWidth);a.push("<div class='",c,"' style='","height:",f,"px;","width:",g,"px;","top:",h,"px;","left:",i,"px;'></div>")}}).call(f.prototype),b.Marker=f}),define("ace/layer/text",["require","exports","module","pilot/oop","pilot/dom","pilot/lang","pilot/event_emitter"],function(a,b,c){var d=a("pilot/oop"),e=a("pilot/dom"),f=a("pilot/lang"),g=a("pilot/event_emitter").EventEmitter,h=function(a){this.element=e.createElement("div"),this.element.className="ace_layer ace_text-layer",a.appendChild(this.element),this.$characterSize=this.$measureSizes()||{width:0,height:0},this.$pollSizeChanges()};(function(){d.implement(this,g),this.EOF_CHAR="&para;",this.EOL_CHAR="&not;",this.TAB_CHAR="&rarr;",this.SPACE_CHAR="&middot;",this.setTokenizer=function(a){this.tokenizer=a},this.getLineHeight=function(){return this.$characterSize.height||1},this.getCharacterWidth=function(){return this.$characterSize.width||1},this.checkForSizeChanges=function(){var a=this.$measureSizes();a&&(this.$characterSize.width!==a.width||this.$characterSize.height!==a.height)&&(this.$characterSize=a,this._dispatchEvent("changeCharaterSize",{data:a}))},this.$pollSizeChanges=function(){var a=this;setInterval(function(){a.checkForSizeChanges()},500)},this.$fontStyles={fontFamily:1,fontSize:1,fontWeight:1,fontStyle:1,lineHeight:1},this.$measureSizes=function(){var a=1e3;if(!this.$measureNode){var b=this.$measureNode=e.createElement("div"),c=b.style;c.width=c.height="auto",c.left=c.top=-a*40+"px",c.visibility="hidden",c.position="absolute",c.overflow="visible",c.whiteSpace="nowrap",b.innerHTML=f.stringRepeat("Xy",a);if(document.body)document.body.appendChild(b);else{var d=this.element.parentNode;while(!e.hasCssClass(d,"ace_editor"))d=d.parentNode;d.appendChild(b)}}var c=this.$measureNode.style;for(var g in this.$fontStyles){var h=e.computedStyle(this.element,g);c[g]=h}var i={height:this.$measureNode.offsetHeight,width:this.$measureNode.offsetWidth/(a*2)};if(i.width==0&&i.height==0)return null;return i},this.setSession=function(a){this.session=a},this.showInvisibles=!1,this.setShowInvisibles=function(a){if(this.showInvisibles==a)return!1;this.showInvisibles=a;return!0},this.$computeTabString=function(){var a=this.session.getTabSize();if(this.showInvisibles){var b=a/2;this.$tabString="<span class='ace_invisible'>"+Array(Math.floor(b)).join("&#160;")+this.TAB_CHAR+Array(Math.ceil(b)+1).join("&#160;")+"</span>"}else this.$tabString=Array(a+1).join("&#160;")},this.updateLines=function(a,b,c){this.$computeTabString(),(this.config.lastRow!=a.lastRow||this.config.firstRow!=a.firstRow)&&this.scrollLines(a),this.config=a;var d=Math.max(b,a.firstRow),f=Math.min(c,a.lastRow),g=this.element.childNodes,h=this.tokenizer.getTokens(d,f);for(var i=d;i<=f;i++){var j=g[i-a.firstRow];if(!j)continue;var k=[];this.$renderLine(k,i,h[i-d].tokens),j=e.setInnerHtml(j,k.join("")),j.style.height=this.session.getRowHeight(a,i)+"px"}},this.scrollLines=function(a){this.$computeTabString();var b=this.config;this.config=a;if(!b||b.lastRow<a.firstRow)return this.update(a);if(a.lastRow<b.firstRow)return this.update(a);var c=this.element;if(b.firstRow<a.firstRow)for(var d=b.firstRow;d<a.firstRow;d++)c.removeChild(c.firstChild);if(b.lastRow>a.lastRow)for(var d=a.lastRow+1;d<=b.lastRow;d++)c.removeChild(c.lastChild);if(a.firstRow<b.firstRow){var e=this.$renderLinesFragment(a,a.firstRow,b.firstRow-1);c.firstChild?c.insertBefore(e,c.firstChild):c.appendChild(e)}if(a.lastRow>b.lastRow){var e=this.$renderLinesFragment(a,b.lastRow+1,a.lastRow);c.appendChild(e)}},this.$renderLinesFragment=function(a,b,c){var d=document.createDocumentFragment(),f=this.tokenizer.getTokens(b,c);for(var g=b;g<=c;g++){var h=e.createElement("div");h.className="ace_line";var i=h.style;i.height=this.session.getRowHeight(a,g)+"px",i.width=a.width+"px";var j=[];f.length>g-b&&this.$renderLine(j,g,f[g-b].tokens),h.innerHTML=j.join(""),d.appendChild(h)}return d},this.update=function(a){this.$computeTabString(),this.config=a;var b=[],c=this.tokenizer.getTokens(a.firstRow,a.lastRow),d=this.$renderLinesFragment(a,a.firstRow,a.lastRow);this.element.innerHTML="",this.element.appendChild(d)},this.$textToken={text:!0,rparen:!0,lparen:!0},this.$renderLine=function(a,b,c){function i(b,c){var d=c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(e,f).replace(/\t/g,g.$tabString).replace(/[\u3040-\u309F]|[\u30A0-\u30FF]|[\u4E00-\u9FFF\uF900-\uFAFF\u3400-\u4DBF]/g,function(a){return"<span class='ace_cjk' style='width:"+h*2+"px'>"+a+"</span>"});if(!g.$textToken[b.type]){var i="ace_"+b.type.replace(/\./g," ace_");a.push("<span class='",i,"'>",d,"</span>")}else a.push(d)}if(this.showInvisibles)var d=this,e=/( +)|([\v\f \u00a0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000])/g,f=function(a){if(a.charCodeAt(0)==32)return Array(a.length+1).join("&#160;");var a=Array(a.length+1).join(d.SPACE_CHAR);return"<span class='ace_invisible'>"+a+"</span>"};else var e=/[\v\f \u00a0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000]/g,f="&#160;";var g=this,h=this.config.characterWidth,j=this.session.getRowSplitData(b),k=0,l=0,m;!j||j.length==0?m=Number.MAX_VALUE:m=j[0],a.push("<div style='height:",this.config.lineHeight,"px","'>");for(var n=0;n<c.length;n++){var o=c[n],p=o.value;if(k+p.length<m)i(o,p),k+=p.length;else{while(k+p.length>=m)i(o,p.substring(0,m-k)),p=p.substring(m-k),k=m,a.push("</div>","<div style='height:",this.config.lineHeight,"px","'>"),l++,m=j[l]||Number.MAX_VALUE;p.length!=0&&(k+=p.length,i(o,p))}}this.showInvisibles&&(b!==this.session.getLength()-1?a.push("<span class='ace_invisible'>"+this.EOL_CHAR+"</span>"):a.push("<span class='ace_invisible'>"+this.EOF_CHAR+"</span>")),a.push("</div>")}}).call(h.prototype),b.Text=h}),define("ace/layer/cursor",["require","exports","module","pilot/dom"],function(a,b,c){var d=a("pilot/dom"),e=function(a){this.element=d.createElement("div"),this.element.className="ace_layer ace_cursor-layer",a.appendChild(this.element),this.cursor=d.createElement("div"),this.cursor.className="ace_cursor",this.isVisible=!1};(function(){this.setSession=function(a){this.session=a},this.hideCursor=function(){this.isVisible=!1,this.cursor.parentNode&&this.cursor.parentNode.removeChild(this.cursor),clearInterval(this.blinkId)},this.showCursor=function(){this.isVisible=!0,this.element.appendChild(this.cursor);var a=this.cursor;a.style.visibility="visible",this.restartTimer()},this.restartTimer=function(){clearInterval(this.blinkId);if(!!this.isVisible){var a=this.cursor;this.blinkId=setInterval(function(){a.style.visibility="hidden",setTimeout(function(){a.style.visibility="visible"},400)},1e3)}},this.getPixelPosition=function(a){if(!this.config||!this.session)return{left:0,top:0};var b=this.session.selection.getCursor(),c=this.session.documentToScreenPosition(b),d=Math.round(c.column*this.config.characterWidth),e=(c.row-(a?this.config.firstRowScreen:0))*this.config.lineHeight;return{left:d,top:e}},this.update=function(a){this.config=a,this.pixelPos=this.getPixelPosition(!0),this.cursor.style.left=this.pixelPos.left+"px",this.cursor.style.top=this.pixelPos.top+"px",this.cursor.style.width=a.characterWidth+"px",this.cursor.style.height=a.lineHeight+"px",this.isVisible&&this.element.appendChild(this.cursor),this.session.getOverwrite()?d.addCssClass(this.cursor,"ace_overwrite"):d.removeCssClass(this.cursor,"ace_overwrite"),this.restartTimer()}}).call(e.prototype),b.Cursor=e}),define("ace/scrollbar",["require","exports","module","pilot/oop","pilot/dom","pilot/event","pilot/event_emitter"],function(a,b,c){var d=a("pilot/oop"),e=a("pilot/dom"),f=a("pilot/event"),g=a("pilot/event_emitter").EventEmitter,h=function(a){this.element=e.createElement("div"),this.element.className="ace_sb",this.inner=e.createElement("div"),this.element.appendChild(this.inner),a.appendChild(this.element),this.width=e.scrollbarWidth(),this.element.style.width=this.width+"px",f.addListener(this.element,"scroll",this.onScroll.bind(this))};(function(){d.implement(this,g),this.onScroll=function(){this._dispatchEvent("scroll",{data:this.element.scrollTop})},this.getWidth=function(){return this.width},this.setHeight=function(a){this.element.style.height=a+"px"},this.setInnerHeight=function(a){this.inner.style.height=a+"px"},this.setScrollTop=function(a){this.element.scrollTop=a}}).call(h.prototype),b.ScrollBar=h}),define("ace/renderloop",["require","exports","module","pilot/event"],function(a,b,c){var d=a("pilot/event"),e=function(a){this.onRender=a,this.pending=!1,this.changes=0};(function(){this.schedule=function(a){this.changes=this.changes|a;if(!this.pending){this.pending=!0;var b=this;this.setTimeoutZero(function(){b.pending=!1;var a=b.changes;b.changes=0,b.onRender(a)})}},window.postMessage?(this.messageName="zero-timeout-message",this.setTimeoutZero=function(a){if(!this.attached){var b=this;d.addListener(window,"message",function(a){b.callback&&a.data==b.messageName&&(d.stopPropagation(a),b.callback())}),this.attached=!0}this.callback=a,window.postMessage(this.messageName,"*")}):this.setTimeoutZero=function(a){setTimeout(a,0)}}).call(e.prototype),b.RenderLoop=e}),define("text/ace/css/editor.css",[],'.ace_editor {    position: relative;    overflow: hidden;    font-family: "Menlo", "Monaco", "Courier New", monospace;    font-size: 12px;  }.ace_scroller {    position: absolute;    overflow-x: scroll;    overflow-y: hidden;     }.ace_content {    position: absolute;    box-sizing: border-box;    -moz-box-sizing: border-box;    -webkit-box-sizing: border-box;}.ace_composition {    position: absolute;    background: #555;    color: #DDD;    z-index: 4;}.ace_gutter {    position: absolute;    overflow-x: hidden;    overflow-y: hidden;    height: 100%;}.ace_gutter-cell.ace_error {    background-image: url("data:image/gif,GIF89a%10%00%10%00%D5%00%00%F5or%F5%87%88%F5nr%F4ns%EBmq%F5z%7F%DDJT%DEKS%DFOW%F1Yc%F2ah%CE(7%CE)8%D18E%DD%40M%F2KZ%EBU%60%F4%60m%DCir%C8%16(%C8%19*%CE%255%F1%3FR%F1%3FS%E6%AB%B5%CA%5DI%CEn%5E%F7%A2%9A%C9G%3E%E0a%5B%F7%89%85%F5yy%F6%82%80%ED%82%80%FF%BF%BF%E3%C4%C4%FF%FF%FF%FF%FF%FF%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00!%F9%04%01%00%00%25%00%2C%00%00%00%00%10%00%10%00%00%06p%C0%92pH%2C%1A%8F%C8%D2H%93%E1d4%23%E4%88%D3%09mB%1DN%B48%F5%90%40%60%92G%5B%94%20%3E%22%D2%87%24%FA%20%24%C5%06A%00%20%B1%07%02B%A38%89X.v%17%82%11%13q%10%0Fi%24%0F%8B%10%7BD%12%0Ei%09%92%09%0EpD%18%15%24%0A%9Ci%05%0C%18F%18%0B%07%04%01%04%06%A0H%18%12%0D%14%0D%12%A1I%B3%B4%B5IA%00%3B");    background-repeat: no-repeat;    background-position: 4px center;}.ace_gutter-cell.ace_warning {    background-image: url("data:image/gif,GIF89a%10%00%10%00%D5%00%00%FF%DBr%FF%DE%81%FF%E2%8D%FF%E2%8F%FF%E4%96%FF%E3%97%FF%E5%9D%FF%E6%9E%FF%EE%C1%FF%C8Z%FF%CDk%FF%D0s%FF%D4%81%FF%D5%82%FF%D5%83%FF%DC%97%FF%DE%9D%FF%E7%B8%FF%CCl%7BQ%13%80U%15%82W%16%81U%16%89%5B%18%87%5B%18%8C%5E%1A%94d%1D%C5%83-%C9%87%2F%C6%84.%C6%85.%CD%8B2%C9%871%CB%8A3%CD%8B5%DC%98%3F%DF%9BB%E0%9CC%E1%A5U%CB%871%CF%8B5%D1%8D6%DB%97%40%DF%9AB%DD%99B%E3%B0p%E7%CC%AE%FF%FF%FF%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00!%F9%04%01%00%00%2F%00%2C%00%00%00%00%10%00%10%00%00%06a%C0%97pH%2C%1A%8FH%A1%ABTr%25%87%2B%04%82%F4%7C%B9X%91%08%CB%99%1C!%26%13%84*iJ9(%15G%CA%84%14%01%1A%97%0C%03%80%3A%9A%3E%81%84%3E%11%08%B1%8B%20%02%12%0F%18%1A%0F%0A%03\'F%1C%04%0B%10%16%18%10%0B%05%1CF%1D-%06%07%9A%9A-%1EG%1B%A0%A1%A0U%A4%A5%A6BA%00%3B");    background-repeat: no-repeat;    background-position: 4px center;}.ace_editor .ace_sb {    position: absolute;    overflow-x: hidden;    overflow-y: scroll;    right: 0;}.ace_editor .ace_sb div {    position: absolute;    width: 1px;    left: 0;}.ace_editor .ace_print_margin_layer {    z-index: 0;    position: absolute;    overflow: hidden;    margin: 0;    left: 0;    height: 100%;    width: 100%;}.ace_editor .ace_print_margin {    position: absolute;    height: 100%;}.ace_editor textarea {    position: fixed;    z-index: -1;    width: 10px;    height: 30px;    opacity: 0;    background: transparent;    appearance: none;    border: none;    resize: none;    outline: none;    overflow: hidden;}.ace_layer {    z-index: 1;    position: absolute;    overflow: hidden;      white-space: nowrap;    height: 100%;    width: 100%;}.ace_text-layer {    font-family: Monaco, "Courier New", monospace;    color: black;}.ace_cjk {    display: inline-block;    text-align: center;}.ace_cursor-layer {    z-index: 4;    cursor: text;    pointer-events: none;}.ace_cursor {    z-index: 4;    position: absolute;}.ace_line {    white-space: nowrap;}.ace_marker-layer {    cursor: text;}.ace_marker-layer .ace_step {    position: absolute;    z-index: 3;}.ace_marker-layer .ace_selection {    position: absolute;    z-index: 4;}.ace_marker-layer .ace_bracket {    position: absolute;    z-index: 5;}.ace_marker-layer .ace_active_line {    position: absolute;    z-index: 2;}.ace_marker-layer .ace_selected_word {    position: absolute;    z-index: 6;    box-sizing: border-box;    -moz-box-sizing: border-box;    -webkit-box-sizing: border-box;}.ace_dragging .ace_marker-layer, .ace_dragging .ace_text-layer {  cursor: move;}');var deps=["pilot/fixoldbrowsers","pilot/index","pilot/plugin_manager","pilot/environment","ace/editor","ace/edit_session","ace/virtual_renderer","ace/undomanager","ace/theme/textmate"];require(deps,function(){var a=require("pilot/plugin_manager").catalog;a.registerPlugins(["pilot/index"]);var b=require("pilot/dom"),c=require("pilot/event"),d=require("ace/editor").Editor,e=require("ace/edit_session").EditSession,f=require("ace/undomanager").UndoManager,g=require("ace/virtual_renderer").VirtualRenderer;window.ace={edit:function(h){typeof h=="string"&&(h=document.getElementById(h));var i=new e(b.getInnerText(h));i.setUndoManager(new f),h.innerHTML="";var j=new d(new g(h,"ace/theme/textmate"));j.setSession(i);var k=require("pilot/environment").create();a.startupPlugins({env:k}).then(function(){k.document=i,k.editor=j,j.resize(),c.addListener(window,"resize",function(){j.resize()}),h.env=k}),j.env=k;return j}}}),define("ace/mode/processingjs",["require","exports","module","pilot/oop","ace/mode/text","ace/tokenizer","ace/mode/processingjs_highlight_rules","ace/mode/matching_brace_outdent","ace/range"],function(a,b,c){var d=a("pilot/oop"),e=a("ace/mode/text").Mode,f=a("ace/tokenizer").Tokenizer,g=a("ace/mode/processingjs_highlight_rules").ProcessingJSHighlightRules,h=a("ace/mode/matching_brace_outdent").MatchingBraceOutdent,i=a("ace/range").Range,j=function(){this.$tokenizer=new f((new g).getRules()),this.$outdent=new h};d.inherits(j,e),function(){this.toggleCommentLines=function(a,b,c,d){var e=!0,f=[],g=/^(\s*)\/\//;for(var h=c;h<=d;h++)if(!g.test(b.getLine(h))){e=!1;break}if(e){var j=new i(0,0,0,0);for(var h=c;h<=d;h++){var k=b.getLine(h),l=k.match(g);j.start.row=h,j.end.row=h,j.end.column=l[0].length,b.replace(j,l[1])}}else b.indentRows(c,d,"//")},this.getNextLineIndent=function(a,b,c){var d=this.$getIndent(b),e=this.$tokenizer.getLineTokens(b,a),f=e.tokens,g=e.state;if(f.length&&f[f.length-1].type=="comment")return d;if(a=="start"){var h=b.match(/^.*[\{\(\[]\s*$/);h&&(d+=c)}else if(a=="doc-start"){if(g=="start")return"";var h=b.match(/^\s*(\/?)\*/);h&&(h[1]&&(d+=" "),d+="* ")}return d},this.checkOutdent=function(a,b,c){return this.$outdent.checkOutdent(b,c)},this.autoOutdent=function(a,b,c){this.$outdent.autoOutdent(b,c)}}.call(j.prototype),b.Mode=j}),define("ace/mode/processingjs_highlight_rules",["require","exports","module","pilot/oop","pilot/lang","ace/mode/doc_comment_highlight_rules","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("pilot/oop"),e=a("pilot/lang"),f=a("ace/mode/doc_comment_highlight_rules").DocCommentHighlightRules,g=a("ace/mode/text_highlight_rules").TextHighlightRules,h=function(){var a=new f,b=e.arrayToMap("break|case|catch|continue|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|throw|try|typeof|while|with|void|class|extends|interface|implements".split("|")),c=e.arrayToMap("PVector|PMatrix2D|PFont|PMatrix3D|split|void|draw|setup|splitTokens|append|concat|sort|splice|subset|join|shorten|expand|arrayCopy|ArrayList|reverse|HashMap|mix|peg|modes|color|red|green|blue|alpha|lerpColor|defaultColor|colorMode|blendColor|printMatrix|translate|scale|pushMatrix|popMatrix|resetMatrix|applyMatrix|rotateX|rotateZ|rotateY|rotate|pushStyle|popStyle|year|month|day|hour|minute|second|millis|noLoop|redraw|loop|frameRate|exit|cursor|noCursor|link|beginDraw|endDraw|Import|disableContextMenu|enableContextMenu|binary|unbinary|nfs|nfp|nfc|hex|unhex|loadStrings|loadBytes|nf|matchAll|match|console|println|print|str|trim|abs|ceil|constrain|dist|exp|floor|lerp|log|mag|map|max|min|norm|pow|round|sq|sqrt|acos|asin|atan|atan2|cos|degrees|radians|sin|tan|Random|random|randomSeed|noise|noiseSeed|size|ambientLight|directionalLight|lightFalloff|lightSpecular|lights|pointLight|noLights|spotLight|beginCamera|endCamera|camera|perspective|frustum|ortho|printProjection|printCamera|box|sphereDetail|sphere|modelX|modelY|modelZ|ambient|emissive|shininess|specular|fill|noFill|stroke|noStroke|strokeWeight|strokeCap|strokeJoin|smooth|noSmooth|Point|point|beginShape|endShape|vertex|curveVertex|curveVertexSegment|curve|curveTightness|curveDetail|bezierVertex|rectMode|imageMode|ellipseMode|arc|line|bezier|bezierPoint|bezierTangent|curvePoint|curveTangent|triangle|quad|rect|ellipse|normal|save|PImage|createImage|loadImage|requestImage|get|createGraphics|set|loadPixels|updatePixels|background|image|clear|tint|noTint|copy|blend|shared|intersect|loadFont|createFont|textFont|textSize|textAlign|glyphLook|text|loadGlyphs|extendClass|addMethod|init|pushStyle|popStyle".split("|")),d=e.arrayToMap("boolean|byte|char|color|double|float|int|long|Array|ArrayList|HashMap|Object|String|XMLElement".split("|")),g=e.arrayToMap("use3DContext|canvas|name|PI|TWO_PI|HALF_PI|SINCOS_LENGTH|MAX_FLOAT|MIN_FLOAT|MAX_INT|MIN_INT|CORNER|RADIUS|CENTER_RADIUS|CENTER|POLYGON|QUADS|TRIANGLES|POINTS|LINES|TRIANGLE_STRIP|TRIANGLE_FAN|QUAD_STRIP|CORNERS|CLOSE|RGB|ARGB|HSB|ALPHA|CMYK|OPENGL|P3D|FRAME_RATE|focused|ARROW|CROSS|HAND|MOVE|TEXT|WAIT|NOCURSOR|ALPHA_MASK|RED_MASK|GREEN_MASK|BLUE_MASK|REPLACE|BLEND|ADD|SUBTRACT|LIGHTEST|DARKEST|DIFFERENCE|EXCLUSION|MULTIPLY|SCREEN|OVERLAY|HARD_LIGHT|SOFT_LIGHT|DODGE|BURN|PRECISIONB|PRECISIONF|PREC_MAXVAL|PREC_ALPHA_SHIFT|PREC_RED_SHIFT|ROUND|SQUARE|PROJECT|MITER|BEVEL|CENTER|NORMAL_MODE_AUTO|NORMAL_MODE_SHAPE|NORMAL_MODE_VERTEX|MAX_LIGHTS|BACKSPACE|TAB|ENTER|RETURN|ESC|DELETE|CODED|SHIFT|CONTROL|ALT|UP|RIGHT|DOWN|LEFT|glyphTable|pmouseX|pmouseY|mouseX|mouseY|mouseButton|mouseDown|mouseScroll|mouseClicked|mouseDragged|mouseMoved|mousePressed|mouseReleased|mouseScrolled|keyPressed|keyReleased|draw|setup|width|height|frameCount|key".split("|")),h=e.arrayToMap("null|Infinity|NaN|undefined".split("|")),i=e.arrayToMap("class|enum|extends|super|const|export|import|implements|let|private|public|yield|interface|package|protected|static".split("|"));this.$rules={start:[{token:"comment",regex:"\\/\\/.*$"},a.getStartRule("doc-start"),{token:"comment",regex:"\\/\\*",next:"comment"},{token:"string.regexp",regex:"[/](?:(?:\\[(?:\\\\]|[^\\]])+\\])|(?:\\\\/|[^\\]/]))*[/]\\w*\\s*(?=[).,;]|$)"},{token:"string",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]'},{token:"string",regex:'["].*\\\\$',next:"qqstring"},{token:"string",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"string",regex:"['].*\\\\$",next:"qstring"},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:function(a){return a=="this"?"variable.language":b.hasOwnProperty(a)?"keyword":d.hasOwnProperty(a)?"keyword":c.hasOwnProperty(a)?"pjsfunction":g.hasOwnProperty(a)?"pjsconstant":"identifier"},regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"!|\\$|%|&|\\*|\\-\\-|\\-|\\+\\+|\\+|~|===|==|=|!=|!==|<=|>=|<<=|>>=|>>>=|<>|<|>|!|&&|\\|\\||\\?\\:|\\*=|%=|\\+=|\\-=|&=|\\^=|\\b(?:in|instanceof|new|delete|typeof)"},{token:"lparen",regex:"[[({]"},{token:"rparen",regex:"[\\])}]"},{token:"comment",regex:"^#!.*$"},{token:"text",regex:"\\s+"}],comment:[{token:"comment",regex:".*?\\*\\/",next:"start"},{token:"comment",regex:".+"}],qqstring:[{token:"string",regex:'(?:(?:\\\\.)|(?:[^"\\\\]))*?"',next:"start"},{token:"string",regex:".+"}],qstring:[{token:"string",regex:"(?:(?:\\\\.)|(?:[^'\\\\]))*?'",next:"start"},{token:"string",regex:".+"}]},this.addRules(a.getRules(),"doc-"),this.$rules["doc-start"][0].next="start"};d.inherits(h,g),b.ProcessingJSHighlightRules=h}),define("ace/mode/doc_comment_highlight_rules",["require","exports","module","pilot/oop","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("pilot/oop"),e=a("ace/mode/text_highlight_rules").TextHighlightRules,f=function(){this.$rules={start:[{token:"comment.doc",regex:"\\*\\/",next:"start"},{token:"comment.doc.tag",regex:"@[\\w\\d_]+"},{token:"comment.doc",regex:"s+"},{token:"comment.doc",regex:"TODO"},{token:"comment.doc",regex:"[^@\\*]+"},{token:"comment.doc",regex:"."}]}};d.inherits(f,e),function(){this.getStartRule=function(a){return{token:"comment.doc",regex:"\\/\\*(?=\\*)",next:a}}}.call(f.prototype),b.DocCommentHighlightRules=f}),define("ace/mode/markdown",["require","exports","module","pilot/oop","ace/mode/text","ace/tokenizer","ace/mode/processingjs","ace/mode/markdown_highlight_rules","ace/mode/matching_brace_outdent","ace/range"],function(a,b,c){var d=a("pilot/oop"),e=a("ace/mode/text").Mode,f=a("ace/tokenizer").Tokenizer,g=a("ace/mode/processingjs").Mode,h=a("ace/mode/markdown_highlight_rules").MarkdownHighlightRules,i=a("ace/mode/matching_brace_outdent").MatchingBraceOutdent,j=a("ace/range").Range,k=function(){this.$tokenizer=new f((new h).getRules()),this.$outdent=new i,this.$pjs=new g};d.inherits(k,e),function(){this.toggleCommentLines=function(a,b,c,d){this.$delegate("toggleCommentLines",arguments,function(){return 0})},this.getNextLineIndent=function(a,b,c){if(a=="intag")return c;var d=this;return this.$delegate("getNextLineIndent",arguments,function(){return d.$getIndent(b)})},this.checkOutdent=function(a,b,c){return this.$delegate("checkOutdent",arguments,function(){return!1})},this.autoOutdent=function(a,b,c){this.$delegate("autoOutdent",arguments)},this.$delegate=function(a,b,c){var d=b[0],e=d.split("pjs-");if(!e[0]&&e[1]){b[0]=e[1];return this.$pjs[a].apply(this.$pjs,b)}return c?c():undefined}}.call(k.prototype),b.Mode=k}),define("ace/mode/processingjs",["require","exports","module","pilot/oop","ace/mode/text","ace/tokenizer","ace/mode/processingjs_highlight_rules","ace/mode/matching_brace_outdent","ace/range"],function(a,b,c){var d=a("pilot/oop"),e=a("ace/mode/text").Mode,f=a("ace/tokenizer").Tokenizer,g=a("ace/mode/processingjs_highlight_rules").ProcessingJSHighlightRules,h=a("ace/mode/matching_brace_outdent").MatchingBraceOutdent,i=a("ace/range").Range,j=function(){this.$tokenizer=new f((new g).getRules()),this.$outdent=new h};d.inherits(j,e),function(){this.toggleCommentLines=function(a,b,c,d){var e=!0,f=[],g=/^(\s*)\/\//;for(var h=c;h<=d;h++)if(!g.test(b.getLine(h))){e=!1;break}if(e){var j=new i(0,0,0,0);for(var h=c;h<=d;h++){var k=b.getLine(h),l=k.match(g);j.start.row=h,j.end.row=h,j.end.column=l[0].length,b.replace(j,l[1])}}else b.indentRows(c,d,"//")},this.getNextLineIndent=function(a,b,c){var d=this.$getIndent(b),e=this.$tokenizer.getLineTokens(b,a),f=e.tokens,g=e.state;if(f.length&&f[f.length-1].type=="comment")return d;if(a=="start"){var h=b.match(/^.*[\{\(\[]\s*$/);h&&(d+=c)}else if(a=="doc-start"){if(g=="start")return"";var h=b.match(/^\s*(\/?)\*/);h&&(h[1]&&(d+=" "),d+="* ")}return d},this.checkOutdent=function(a,b,c){return this.$outdent.checkOutdent(b,c)},this.autoOutdent=function(a,b,c){this.$outdent.autoOutdent(b,c)}}.call(j.prototype),b.Mode=j}),define("ace/mode/processingjs_highlight_rules",["require","exports","module","pilot/oop","pilot/lang","ace/mode/doc_comment_highlight_rules","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("pilot/oop"),e=a("pilot/lang"),f=a("ace/mode/doc_comment_highlight_rules").DocCommentHighlightRules,g=a("ace/mode/text_highlight_rules").TextHighlightRules,h=function(){var a=new f,b=e.arrayToMap("break|case|catch|continue|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|throw|try|typeof|while|with|void|class|extends|interface|implements".split("|")),c=e.arrayToMap("PVector|PMatrix2D|PFont|PMatrix3D|split|void|draw|setup|splitTokens|append|concat|sort|splice|subset|join|shorten|expand|arrayCopy|ArrayList|reverse|HashMap|mix|peg|modes|color|red|green|blue|alpha|lerpColor|defaultColor|colorMode|blendColor|printMatrix|translate|scale|pushMatrix|popMatrix|resetMatrix|applyMatrix|rotateX|rotateZ|rotateY|rotate|pushStyle|popStyle|year|month|day|hour|minute|second|millis|noLoop|redraw|loop|frameRate|exit|cursor|noCursor|link|beginDraw|endDraw|Import|disableContextMenu|enableContextMenu|binary|unbinary|nfs|nfp|nfc|hex|unhex|loadStrings|loadBytes|nf|matchAll|match|console|println|print|str|trim|abs|ceil|constrain|dist|exp|floor|lerp|log|mag|map|max|min|norm|pow|round|sq|sqrt|acos|asin|atan|atan2|cos|degrees|radians|sin|tan|Random|random|randomSeed|noise|noiseSeed|size|ambientLight|directionalLight|lightFalloff|lightSpecular|lights|pointLight|noLights|spotLight|beginCamera|endCamera|camera|perspective|frustum|ortho|printProjection|printCamera|box|sphereDetail|sphere|modelX|modelY|modelZ|ambient|emissive|shininess|specular|fill|noFill|stroke|noStroke|strokeWeight|strokeCap|strokeJoin|smooth|noSmooth|Point|point|beginShape|endShape|vertex|curveVertex|curveVertexSegment|curve|curveTightness|curveDetail|bezierVertex|rectMode|imageMode|ellipseMode|arc|line|bezier|bezierPoint|bezierTangent|curvePoint|curveTangent|triangle|quad|rect|ellipse|normal|save|PImage|createImage|loadImage|requestImage|get|createGraphics|set|loadPixels|updatePixels|background|image|clear|tint|noTint|copy|blend|shared|intersect|loadFont|createFont|textFont|textSize|textAlign|glyphLook|text|loadGlyphs|extendClass|addMethod|init|pushStyle|popStyle".split("|")),d=e.arrayToMap("boolean|byte|char|color|double|float|int|long|Array|ArrayList|HashMap|Object|String|XMLElement".split("|")),g=e.arrayToMap("use3DContext|canvas|name|PI|TWO_PI|HALF_PI|SINCOS_LENGTH|MAX_FLOAT|MIN_FLOAT|MAX_INT|MIN_INT|CORNER|RADIUS|CENTER_RADIUS|CENTER|POLYGON|QUADS|TRIANGLES|POINTS|LINES|TRIANGLE_STRIP|TRIANGLE_FAN|QUAD_STRIP|CORNERS|CLOSE|RGB|ARGB|HSB|ALPHA|CMYK|OPENGL|P3D|FRAME_RATE|focused|ARROW|CROSS|HAND|MOVE|TEXT|WAIT|NOCURSOR|ALPHA_MASK|RED_MASK|GREEN_MASK|BLUE_MASK|REPLACE|BLEND|ADD|SUBTRACT|LIGHTEST|DARKEST|DIFFERENCE|EXCLUSION|MULTIPLY|SCREEN|OVERLAY|HARD_LIGHT|SOFT_LIGHT|DODGE|BURN|PRECISIONB|PRECISIONF|PREC_MAXVAL|PREC_ALPHA_SHIFT|PREC_RED_SHIFT|ROUND|SQUARE|PROJECT|MITER|BEVEL|CENTER|NORMAL_MODE_AUTO|NORMAL_MODE_SHAPE|NORMAL_MODE_VERTEX|MAX_LIGHTS|BACKSPACE|TAB|ENTER|RETURN|ESC|DELETE|CODED|SHIFT|CONTROL|ALT|UP|RIGHT|DOWN|LEFT|glyphTable|pmouseX|pmouseY|mouseX|mouseY|mouseButton|mouseDown|mouseScroll|mouseClicked|mouseDragged|mouseMoved|mousePressed|mouseReleased|mouseScrolled|keyPressed|keyReleased|draw|setup|width|height|frameCount|key".split("|")),h=e.arrayToMap("null|Infinity|NaN|undefined".split("|")),i=e.arrayToMap("class|enum|extends|super|const|export|import|implements|let|private|public|yield|interface|package|protected|static".split("|"));this.$rules={start:[{token:"comment",regex:"\\/\\/.*$"},a.getStartRule("doc-start"),{token:"comment",regex:"\\/\\*",next:"comment"},{token:"string.regexp",regex:"[/](?:(?:\\[(?:\\\\]|[^\\]])+\\])|(?:\\\\/|[^\\]/]))*[/]\\w*\\s*(?=[).,;]|$)"},{token:"string",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]'},{token:"string",regex:'["].*\\\\$',next:"qqstring"},{token:"string",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"string",regex:"['].*\\\\$",next:"qstring"},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:function(a){return a=="this"?"variable.language":b.hasOwnProperty(a)?"keyword":d.hasOwnProperty(a)?"keyword":c.hasOwnProperty(a)?"pjsfunction":g.hasOwnProperty(a)?"pjsconstant":"identifier"},regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"!|\\$|%|&|\\*|\\-\\-|\\-|\\+\\+|\\+|~|===|==|=|!=|!==|<=|>=|<<=|>>=|>>>=|<>|<|>|!|&&|\\|\\||\\?\\:|\\*=|%=|\\+=|\\-=|&=|\\^=|\\b(?:in|instanceof|new|delete|typeof)"},{token:"lparen",regex:"[[({]"},{token:"rparen",regex:"[\\])}]"},{token:"comment",regex:"^#!.*$"},{token:"text",regex:"\\s+"}],comment:[{token:"comment",regex:".*?\\*\\/",next:"start"},{token:"comment",regex:".+"}],qqstring:[{token:"string",regex:'(?:(?:\\\\.)|(?:[^"\\\\]))*?"',next:"start"},{token:"string",regex:".+"}],qstring:[{token:"string",regex:"(?:(?:\\\\.)|(?:[^'\\\\]))*?'",next:"start"},{token:"string",regex:".+"}]},this.addRules(a.getRules(),"doc-"),this.$rules["doc-start"][0].next="start"};d.inherits(h,g),b.ProcessingJSHighlightRules=h}),define("ace/mode/doc_comment_highlight_rules",["require","exports","module","pilot/oop","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("pilot/oop"),e=a("ace/mode/text_highlight_rules").TextHighlightRules,f=function(){this.$rules={start:[{token:"comment.doc",regex:"\\*\\/",next:"start"},{token:"comment.doc.tag",regex:"@[\\w\\d_]+"},{token:"comment.doc",regex:"s+"},{token:"comment.doc",regex:"TODO"},{token:"comment.doc",regex:"[^@\\*]+"},{token:"comment.doc",regex:"."}]}};d.inherits(f,e),function(){this.getStartRule=function(a){return{token:"comment.doc",regex:"\\/\\*(?=\\*)",next:a}}}.call(f.prototype),b.DocCommentHighlightRules=f}),define("ace/mode/markdown_highlight_rules",["require","exports","module","pilot/oop","ace/mode/processingjs_highlight_rules","ace/mode/text_highlight_rules"],function(a,b,c){var d=a("pilot/oop"),e=a("ace/mode/processingjs_highlight_rules").ProcessingJSHighlightRules,f=a("ace/mode/text_highlight_rules").TextHighlightRules,g=function(){this.$rules={start:[{token:"keyword.list.unnumbered.markdown",regex:"^\\s*[+\\-]+.*$"},{token:"keyword.list.numbered.markdown",regex:"^\\s*[0-9]+\\..*$"},{token:"keyword.heading.markdown",regex:"^[#]{1,6}.*$"},{token:"string.bold.markdown",regex:"\\*\\*.*\\*\\*|\\*.*\\*|__.*__|_.*_"},{token:"string.code.markdown",regex:"^~~~",next:"pjs-start"}]};var a=(new e).getRules();this.addRules(a,"pjs-"),this.$rules["pjs-start"].unshift({token:"string.code.markdown",regex:"~~~",next:"start"})};d.inherits(g,f),b.MarkdownHighlightRules=g}),define("ace/theme/peep",["require","exports","module"],function(a,b,c){var d=a("pilot/dom"),e=".ace-processing .ace_editor {\n  border: 2px solid rgb(159, 159, 159);\n}\n\n.ace-processing .ace_editor.ace_focus {\n  border: 2px solid #327fbd;\n}\n\n.ace-processing .ace_gutter {\n  width: 30px;\n  background: #b8c2cd;\n  color: #5d6671;\n  overflow : hidden;\n}\n\n.ace-processing .ace_gutter-layer {\n  width: 100%;\n  text-align: right;\n}\n\n.ace-processing .ace_gutter-layer .ace_gutter-cell {\n  padding-right: 6px;\n}\n\n.ace-processing .ace_scroller {\n  background-color: #FFFFFF;\n}\n\n.ace-processing .ace_text-layer {\n  cursor: text;\n  color: #000000;\n}\n\n.ace-processing .ace_cursor {\n  border-left: 2px solid #000000;\n}\n\n.ace-processing .ace_cursor.ace_overwrite {\n  border-left: 0px;\n  border-bottom: 1px solid #000000;\n}\n \n.ace-processing .ace_marker-layer .ace_selection {\n  background: #BDD5FC;\n}\n\n.ace-processing .ace_marker-layer .ace_step {\n  background: rgb(198, 219, 174);\n}\n\n.ace-processing .ace_marker-layer .ace_bracket {\n  margin: -1px 0 0 -1px;\n  border: 1px solid #BFBFBF;\n}\n\n.ace-processing .ace_marker-layer .ace_active_line {\n  background: #FFFBD1;\n}\n\n       \n.ace-processing .ace_invisible {\n  color: #BFBFBF;\n}\n\n.ace-processing .ace_keyword {\n  color:#42A8ED;\n}\n\n.ace-processing .ace_keyword.ace_operator {\n  color:#000000;\n}\n\n.ace-processing .ace_constant {\n  \n}\n\n.ace-processing .ace_constant.ace_language {\n  color:#39946A;\n}\n\n.ace-processing .ace_constant.ace_boolean {\n  color:#42A8ED;\n}\n\n.ace-processing .ace_constant.ace_library {\n  \n}\n\n.ace-processing .ace_constant.ace_numeric {\n  /*color:#46A609;*/\n}\n\n.ace-processing .ace_invalid {\n  /*background-color:#FF002A;*/\n}\n\n.ace-processing .ace_invalid.ace_illegal {\n  \n}\n\n.ace-processing .ace_invalid.ace_deprecated {\n  \n}\n\n.ace-processing .ace_support {\n  \n}\n\n.ace-processing .ace_support.ace_function {\n  /*color:#C52727;*/\n}\n\n.ace-processing .ace_function.ace_buildin {\n  \n}\n\n.ace-processing .ace_string {\n  color:#006699;\n}\n\n.ace-processing .ace_string.ace_regexp {\n  \n}\n\n.ace-processing .ace_comment {\n  color:#7E7E7E;\n}\n\n.ace-processing .ace_comment.ace_doc {\n  \n}\n\n.ace-processing .ace_comment.ace_doc.ace_tag {\n  \n}\n\n.ace-processing .ace_variable {\n  \n}\n\n.ace-processing .ace_variable.ace_language {\n  \n}\n\n.ace-processing .ace_xml_pe {\n  \n}\n\n.ace-processing .ace_pjsconstant {\n  color:#006699\n}\n\n.ace-processing .ace_pjsfunction {\n  color:#CC6600\n}";d.importCssString(e),b.cssClass="ace-processing"}),function(a){a.fn.noisy=function(b){b=a.extend({},a.fn.noisy.defaults,b);var c,d=document.createElement("canvas");if(!d.getContext)c=b.fallback;else{d.width=d.height=b.size;var e=d.getContext("2d"),f=e.createImageData(d.width,d.height),g=b.intensity*Math.pow(b.size,2),h=255*b.opacity;while(g--){var i=~~(Math.random()*d.width),j=~~(Math.random()*d.height),k=(i+j*f.width)*4,l=g%255;f.data[k]=l,f.data[k+1]=b.monochrome?l:~~(Math.random()*255),f.data[k+2]=b.monochrome?l:~~(Math.random()*255),f.data[k+3]=~~(Math.random()*h)}e.putImageData(f,0,0),c=d.toDataURL("image/png")}return this.each(function(){a(this).data("original-css")==undefined&&a(this).data("original-css",a(this).css("background-image")),a(this).css("background-image","url("+c+"),"+a(this).data("original-css"))})},a.fn.noisy.defaults={intensity:.9,size:200,opacity:.08,fallback:"",monochrome:!1}}(jQuery),jQuery.template("pagination.default.container",'<div class="pagination ${pagination_class}">    <ol class="pages">        {{each pages}}{{tmpl($value) "pagination.default.page"}}{{/each}}    </ol>    <div style="clear:both;"></div></div>'),jQuery.template("pagination.default.page",'<li class="page page_${page_number} ${page_class}">    <a href="${page_link}">${page_title}</a></li>'),window.console||(window.console={log:function(){},error:function(){}}),function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;Object.subClass=function(c){function g(){!a&&this.init&&this.init.apply(this,arguments)}var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]=typeof c[f]=="function"&&typeof d[f]=="function"&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);this._super=c;return e}}(f,c[f]):c[f];g.prototype=e,g.constructor=g,g.subClass=arguments.callee;return g}}(),function(a,b,c){function d(){return function(a){if(this instanceof arguments.callee)typeof this.init=="function"&&(a!==c?this.init.apply(this,a.callee?a:arguments):this.init.call(this));else return new arguments.callee(arguments)}}a.makeClass=d}(window,document),window.peep={dialog:{},editor:{toolbar:{buttons:{}}},model:{},runtime:{processingjs:{buttons:{}}},util:{},controller:{wizards:{}},view:{}},function(a,b,c){var d=a.jQuery,e=a.peep.util.Pagination=Object.subClass({init:function(a){this.container="pagination.default.container",this.page="pagination.default.page",this.data=null,this.currentPage=0,this.paginationClass="default",d.extend(!0,this,a),this.$content=[this.build()]},build:function(){var a=[];d.each(this.data,d.proxy(function(b,c){a.push({page_number:b,page_class:this.data[b].page_class,page_path:this.data[b].page_path,page_title:this.data[b].page_title})},this));var b=d.tmpl("pagination.default.container",{pagination_class:this.paginationClass,pages:a});b.find("li").eq(this.currentPage).addClass("active");return b},getContent:function(){return this.$content[0]},duplicateContent:function(){this.$content.push(this.$content[0].clone());return this.$content[this.$content.length-1]},changePage:function(a){for(var b=0;b<this.$content.length;b++)this.$content[b].find("li").removeClass("active").eq(a).addClass("active")}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.model,f=e.User=Object.subClass({init:function(a){a=a===c?{}:a,typeof a=="number"?this.load(a).success(d.proxy(this.loadSketches,this)):(this.id=null,this.first=null,this.last=null,this.username=null,this.sketches=[],d.extend(!0,this,a))},load:function(a){var b="/user/"+a;return d.getJSON(b,d.proxy(function(a){d.extend(!0,this,a)},this))},loadSketches:function(){var b="/user/"+this.id+"/sketches";return d.getJSON(b,d.proxy(function(b){this.sketches=d.map(b,function(b){return new a.peep.model.Sketch(b)})},this))},getSketches:function(){return this.sketches},getName:function(){return this.first+" "+this.last}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.model.Revision=Object.subClass({init:function(a){if(typeof a=="number")this.load(a);else{this.id=null,this.code="",this.tag=null;var b=new Date;this.timestamp=b.getTime()/1e3,d.extend(!0,this,a)}},load:function(a){return d.get("/revision/"+a,d.proxy(function(a){d.extend(!0,this,a)},this))},isSaved:function(){return this.id!==null},getCode:function(){return this.code},getTag:function(){return this.tag},setCode:function(a){this.code=a},setId:function(a){this.id=a},toJSON:function(){return{id:this.id,code:this.code,tag:this.tag}}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.model.Sketch=Object.subClass({init:function(b){if(typeof b=="number")this.load(b).success(d.proxy(this.loadRevisions,this));else{this.permissions={save:!1,open:!1,fork:!1},this.id=null,this.title=null;var c=a.peep.model.Revision;this.revisions=[new c({code:"",tag:"Start"})],d.extend(!0,this,b)}},load:function(a){var b="/sketch/"+a;return d.getJSON(b,d.proxy(function(a){d.extend(!0,this,a)},this))},hasPermission:function(a){return this.permissions[a]},getRevision:function(a){return this.revisions[a]},setRevision:function(a,b){this.revisions[a]=b},addRevision:function(a){this.setRevision(this.revisions.length,a)},lastRevision:function(){return this.getRevision(this.revisions.length-1)},numRevisions:function(){return this.revisions.length},loadRevisions:function(){var b="/sketch/"+this.id+"/revisions";return d.getJSON(b,d.proxy(function(b){this.revisions=d.map(b,function(b){return new a.peep.model.Revision(b)})},this))},getRevisions:function(){return this.revisions},getTitle:function(){return this.title},setTitle:function(a){this.title=a},isSaved:function(){return this.id!==null},save:function(){var a=d.map(this.revisions,function(a){return a.isSaved()?null:a});return d.post("/sketch/"+this.id+"/edit",{title:this.title,revisions:JSON.stringify(d.map(a,function(a){return a.toJSON()}))},d.proxy(function(b){if(b.status)for(var c=0;c<a.length;c++)a[c].setId(b.saved_revisions[c].id)},this),"json")},create:function(){return d.post("/sketch/create",{title:this.title,content:this.revisions[0].getCode()},d.proxy(function(a){a.status&&(this.id=a.sketch.sketch.id,this.revisions[0].setId(a.sketch.revision.id))},this),"json")}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.model,f=e.Poll=Object.subClass({init:function(a){a=a===c?{}:a,typeof a=="number"?this.load(a):(this.id=null,this.question=null,this.options=[],d.extend(!0,this,a))},load:function(a){var b="/poll/"+a;return d.getJSON(b,d.proxy(function(a){d.extend(!0,this,a)},this))},getOptions:function(){return this.options},getQuestion:function(){return this.question},setQuestion:function(a){this.question=a},addOption:function(a){this.options.push({option:a,score:0})},create:function(){var a=d.post("/poll/create",{question:this.question,options:d.map(this.options,function(a){return a.option})},d.proxy(function(a){a.status&&(this.id=a.poll_id)},this),"json");return a},toMarkdown:function(){var a="**"+this.question+"**"+"\n\n";for(var b in this.options){b=this.options[b];var c="/poll/"+this.id+"/answer/"+b.id;a+="* ([Vote]("+c+")) "+b.option+"\n"}return a}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.dialog.Dialog=Object.subClass({init:function(a){this.title="",this.elemClass="peep peep_dialog",this.ok="Ok",this.cancel="Cancel",this.$content=null,d.extend(!0,this,a),this.$content=d(this.$content),this.deferred=new d.Deferred},run:function(){d.alerts.dialogClass=this.elemClass,d.alerts.okButton=this.ok,d.alerts.cancelButton=this.cancel,d.alerts.alert("",this.title,d.proxy(function(){this.deferred.isResolved()||this.deferred.reject()},this)),d("#popup_message").append(this.$content),d.alerts._reposition();return this.deferred.promise()}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.dialog.Message=Object.subClass({init:function(a){this.title="Message",this.message="Something happened.",this.elemClass="peep peep_message",this.ok="&nbsp;OK&nbsp;",this.cancel="&nbsp;Cancel&nbsp;",d.extend(!0,this,a)},run:function(){var a=new d.Deferred;d.alerts.dialogClass=this.elemClass,d.alerts.okButton=this.ok,d.alerts.cancelButton=this.cancel,d.alerts.alert(this.message,this.title,a.resolve);return a.promise()}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.dialog.Prompt=Object.subClass({init:function(a){this.title="User input",this.message="Please fill in the field",this.value="",this.elemClass="peep peep_prompt",this.ok="&nbsp;OK&nbsp;",this.cancel="&nbsp;Cancel&nbsp;",d.extend(!0,this,a)},run:function(){var a=new d.Deferred;d.alerts.dialogClass=this.elemClass,d.alerts.okButton=this.ok,d.alerts.cancelButton=this.cancel;var b=d.proxy(function(b){b?a.resolve({input:b}):a.reject({input:b})},this);d.alerts.prompt(this.message,this.value,this.title,b);return a.promise()}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.dialog.SketchList=Object.subClass({init:function(a,b){this.title=a,this.elemClass="peep peep_filelist",this.ok="Close",this.cancel="Close",this.sketches=b,this.deferred=new d.Deferred,this.$content=this.buildContent(b)},run:function(){d.alerts.dialogClass=this.elemClass,d.alerts.okButton=this.ok,d.alerts.cancelButton=this.cancel,d.alerts.alert("",this.title,d.proxy(function(){this.deferred.isResolved()||this.deferred.reject()},this)),d("#popup_message").append(this.$content),d.alerts._reposition();return this.deferred.promise()},buildContent:function(a){var b=d("<ul>").addClass("sketches").addClass("standard_list"),c=this.deferred;d.each(a,function(a,e){var f=d("<li>").addClass("sketch").addClass("standard_item").text(e.getTitle());f.click(function(){c.resolve(e),d("#popup_ok").click()}),b.append(f)});return b}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.dialog.Confirm=Object.subClass({init:function(a){this.title="Confirm",this.message="Please confirm your action.",this.elemClass="peep peep_confirm",this.ok="&nbsp;OK&nbsp;",this.cancel="&nbsp;Cancel&nbsp;",d.extend(!0,this,a)},run:function(){var a=new d.Deferred;d.alerts.dialogClass=this.elemClass,d.alerts.okButton=this.ok,d.alerts.cancelButton=this.cancel;var b=d.proxy(function(b){b?a.resolve():a.reject()},this);d.alerts.confirm(this.message,this.title,b);return a.promise()}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.runtime.processingjs.buttons,f=e.Button=Object.subClass({init:function(a,b){this.name=a,this.text=b,this.$element=d("<li>").addClass("button").addClass(a).text(b)},getElement:function(){return this.$element},click:function(a,b){},getName:function(){return this.name}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.runtime.processingjs.buttons,f=e.Reset=e.Button.subClass({init:function(){this._super("reset","Reset")},getElement:function(){return this.$element},click:function(b,c,d){c.reset(),b.stopPropagation();for(var e=0;e<d.length;e++)if(d[e].getName()==="toggle_playback"){var f=d[e].getElement(),g=a.peep.runtime.processingjs.buttons;d[e]=new g.TogglePlayback,f.replaceWith(d[e].getElement())}}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.runtime.processingjs.buttons,f=e.TogglePlayback=e.Button.subClass({init:function(){this._super("toggle_playback","Toggle Playback"),this.playing=!0,this.$element.addClass("pause")},getElement:function(){return this.$element},click:function(a,b,c){this.playing=this.playing?!1:!0;var d=this.playing?"play":"pause";b[d].call(b),this.$element.toggleClass("play"),this.$element.toggleClass("pause"),a.stopPropagation()}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.runtime.processingjs.buttons,f=e.Screenshot=e.Button.subClass({init:function(){this._super("screenshot","Screenshot")},getElement:function(){return this.$element},click:function(b,c,e){var f=c.getCanvas().get(0).toDataURL("image/jpeg"),g="/portfolios/entry/"+a.entry_id+"/gallery/image/screenshot",h=d.post(g,{image_data:f},function(){},"json"),i=new a.peep.dialog.Message({title:"Sorry",message:"There was a problem saving the picture, please try again. If the problem persists, please contact the administrators."});h.success(d.proxy(function(a){if(a.status){var b=d("div.gallery");b.find("p.none").size()===1&&(b.empty(),b.append(d("<ul>").addClass("gallery"))),b.find(".gallery").append(a.gallery_item_html)}else i.run()},this)),h.error(function(){i.run()})}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.runtime.processingjs,f=e.ProcessingJS=Object.subClass({init:function(a){this.$canvas=null,this.code=null,this.instance=null,this.deferred=null,d.extend(!0,this,a),this.dimensions=this.getDimensions()},run:function(){try{this.instance=new a.Processing(this.$canvas.get(0),this.code),a.Processing.addInstance(this.instance),this.deferred=new d.Deferred;return this.deferred.promise()}catch(b){a.Processing.logger.log(b),this.deferred.reject(b)}},stop:function(){this.instance.exit(),a.Processing.removeInstance(this.instance),this.deferred.resolve()},play:function(){this.instance.loop()},pause:function(){this.instance.noLoop()},reset:function(){this.instance.exit(),a.Processing.removeInstance(this.instance),this.instance=new a.Processing(this.$canvas.get(0),this.code),a.Processing.addInstance(this.instance)},getInstance:function(){return this.instance},getCanvas:function(){return this.$canvas},isStatic:function(){if(this.instance===null)return null;return this.instance.draw===c},getDimensions:function(){var b=this.code,c=b.replace(/("(?:[^"\\\n]|\\.)*")|('(?:[^'\\\n]|\\.)*')|(([\[\(=|&!\^:?]\s*)(\/(?![*\/])(?:[^\/\\\n]|\\.)*\/[gim]*)\b)|(\/\/[^\n]*\n)|(\/\*(?:(?!\*\/)(?:.|\n))*\*\/)/g,""),d=""+c.match(/\bsize\s*\((.+),(.+)(?:,(.+))?\)\s*;/),e=d.match(/[0-9]+/g);if(e)return{width:e[0],height:e[1]};var f="No size() call found defaulting to size(200, 200)";a.Processing.logger.log(f);return{width:"200",height:"200"}},createControls:function(b){b=b||[];var c=d("<ul>").addClass("controls"),e=a.peep.runtime.processingjs.buttons;b.unshift(new e.Reset),this.isStatic()||b.unshift(new e.TogglePlayback),d.each(b,d.proxy(function(a,b){c.append(b.getElement())},this)),c.click(d.proxy(function(a){var d=c.find("li").index(a.target);b[d].click(a,this,b)},this)),this.$controls=c;return c}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.runtime.processingjs,f=e.PJSLightbox=e.ProcessingJS.subClass({init:function(a){this._super({code:a}),this.$canvas=this.createCanvas()},createCanvas:function(){return $canvas=d('<canvas class="pjs_lightbox"></canvas>').css({width:this.dimensions.width,height:this.dimensions.height,left:d(a).width()/2-this.dimensions.width/2,top:d(a).height()/2-this.dimensions.height/2,"z-index":10})},run:function(){d("body").append(this.$canvas);var a=this._super();d(b).keydown(d.proxy(this.escHandler,this)),d(b).click(d.proxy(this.clickHandler,this));return a},stop:function(){this._super(),d(b).unbind("keydown",this.escHandler),d(b).unbind("click",this.clickHandler),this.$canvas.fadeOut(200,function(){d(this).remove()}),this.$controls.fadeOut(200,function(){d(this).remove()})},escHandler:function(a){a.keyCode===27&&(this.stop(),a.preventDefault())},clickHandler:function(a){a.target!==this.$canvas.get(0)&&this.stop()},createControls:function(a){var b=this._super(a);b.addClass("controls_lightbox");var c=parseInt(this.$canvas.css("top"),10),d=parseInt(this.$canvas.css("left"),10)+parseInt(this.dimensions.width,10)+10;b.css({top:c,left:d}),this.$controls=b;return b}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.runtime.processingjs,f=e.PJSEmbedded=e.ProcessingJS.subClass({init:function(a){this.$container=d(a),this.$pre=this.$container.children("pre"),this._super({code:this.$pre.text()}),this.buildCanvas(),this.$container.find(".action_toggle_code").click(d.proxy(this.toggleCode,this))},buildCanvas:function(a){this.$canvas=d('<canvas class="pjs_embedded"></canvas>').css({width:this.dimensions.width,height:this.dimensions.height}),this.$container.append(this.$canvas)},toggleCode:function(a){this.$container.toggleClass("sketch"),this.$container.toggleClass("sketchcode");var b=d(a.target);b.text(b.text()==="Show Code"?"Show Sketch":"Show Code")},getContainer:function(){return this.$container}})}(window,document),function(a,b,c){var d=a.jQuery,e=Object.subClass({init:function(a,b){this.name=a,this.text=b,this.$element=d("<li>").addClass("button").addClass(a).text(b),this.$element.mouseenter(d.proxy(this.mouseenter,this)),this.$element.mouseleave(d.proxy(this.mouseleave,this))},mouseenter:function(a){this.$element.siblings(".tooltip").text(this.text)},mouseleave:function(a){this.$element.siblings(".tooltip").text("")},getElement:function(){return this.$element},click:function(a,b){},update:function(a){},hide:function(){this.$element.hide()},show:function(){this.$element.show()}});a.peep.editor.toolbar.buttons.Button=e}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons,f=e.Tooltip=e.Button.subClass({init:function(){this._super("tooltip",""),this.$element.unbind("mouseenter"),this.$element.unbind("mouseleave")}});a.peep.editor.toolbar.buttons.Tooltip=f}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons,f=e.Fork=e.Button.subClass({init:function(){this._super("fork","Fork")},click:function(b,c){var d=c.getEditor(),e=new a.peep.dialog.Prompt({title:"Sketch Name",message:"What do you want to call your forked sketch?",ok:"Fork",cancel:"Cancel"});e.run().done(function(b){var c=new a.peep.model.Sketch({permissions:{save:!0,open:!0,fork:!0},title:b.input});c.getRevision(0).setCode(d.getContents()),c.create().success(function(){d.loadSketch(c)}).error(function(){var b=new a.peep.dialog.Message({title:"Error",message:"There was a problem forking the sketch. The sketch has not been forked."});b.run()})}).fail(function(b){if(b.input!==null){var c=new a.peep.dialog.Message({title:"Sorry",message:"You have to name the sketch, try to make it meaningful."});c.run()}})},update:function(b){var c=b.getEditor().getSketch();a.user_id!=="0"?this.show():this.hide()}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons,f=e.New=e.Button.subClass({init:function(){this._super("new","New")},click:function(b,c){var e=new a.peep.dialog.Prompt({title:"Sketch Name",message:"What do you want to call your sketch?"});this.toolbar=c,e.run().done(d.proxy(this.createSketch,this)).fail(d.proxy(this.promptFail,this))},createSketch:function(b){var c=new a.peep.model.Sketch({title:b.input}),d=c.create(),e=this.toolbar.getEditor();d.success(function(){e.loadSketch(c)}),delete this.toolbar},promptFail:function(b){if(b.input!==null){var c=new a.peep.dialog.Message({title:"Problem",message:"You can't choose a blank name for your sketch."});c.run()}},update:function(b){a.user_id!=="0"?this.show():this.hide()}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons,f=e.Open=e.Button.subClass({init:function(){this._super("open","Open")},click:function(b,c){var d=new a.peep.model.User,e=d.load(parseInt(a.user_id)),f=this;e.success(function(){var b=d.loadSketches().success(function(){var b=d.getSketches(),e=d.getName()+"'s sketches",g=new a.peep.dialog.SketchList(e,b);g.run().done(function(a){f.openSketch(a,c.getEditor())})})}),e.error(function(){var b=new a.peep.dialog.message({title:"Not logged in",message:"You can't open your sketchbook because youaren't logged in."});b.run()})},openSketch:function(a,b){a.loadRevisions().success(function(){b.loadSketch(a)})},update:function(b){a.user_id!=="0"?this.show():this.hide()}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons.Button,f=e.subClass({init:function(){this._super("preview","Preview")},click:function(a,b){console.log(b.editor.session.getValue())}});a.peep.editor.toolbar.buttons.Preview=f}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons,f=e.Revision=e.Button.subClass({init:function(a){var b=a.getTag();this._super("revision",b===null?"":b),this.revision=a,b!==null&&this.$element.addClass("tagged")},mouseenter:function(a){if(this.$element.hasClass("tagged")){var b=d(a.target).parents(".timeline_wrap"),c=b.data("jsp").getContentPositionX(),e=d(a.target),f=d('<span class="tooltip"></span>');f.text(e.text()),b.parent().append(f);var g=f.outerWidth(),h=f.outerHeight(),i=e.position().left+e.outerWidth()/2,j=e.position().top+e.outerHeight()/2,k=j-9-h+b.position().top,l=i-g/2+b.position().left-c;f.css("top",k),f.css("left",l)}},mouseleave:function(a){if(this.$element.hasClass("tagged")){var b=d(a.target).parents(".timeline_wrap");b.parent().find("span.tooltip").remove()}},click:function(a,b){var c=b.getEditor();c.session.setValue(this.revision.getCode()),c.setModified(!1),b.setRevision(this.revision)},hover:function(a,b){this.isTagged&&console.log(this.revision.getTag())},isTagged:function(){return this.revision.getTag()!==null}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons,f=e.Run=e.Button.subClass({init:function(){this._super("run","Run")},click:function(b,c){var e=c.getEditor(),f=a.peep.runtime.processingjs,g=e.getContents(),h=new f.PJSLightbox(g);h.run();var i=h.createControls();d("body").append(i),e.getSketch()!==null&&e.isModified()&&this.createRevision(e),b.stopPropagation()},createRevision:function(b){var c=new a.peep.model.Revision({code:b.getContents()}),d=b.getSketch();d.addRevision(c),d.save().success(function(){b.update(),b.setModified(!1)})}});a.peep.editor.toolbar.buttons.Run=f}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons,f=e.Save=e.Button.subClass({init:function(){this._super("save","Save")},click:function(a,b){var c=b.getEditor();console.log(c.getSketch()),c.getSketch()!==null?this.saveRevision(c):this.saveFirst(c)},saveFirst:function(b){var c=new a.peep.dialog.Prompt({title:"Sketch Name",message:"What do you want to call your sketch?",ok:"Save",cancel:"Cancel"});c.run().done(function(c){var d=new a.peep.model.Sketch({permissions:{save:!0,open:!0,fork:!0},title:c.input});d.getRevision(0).setCode(b.getContents()),d.create().success(function(){b.loadSketch(d)}).error(function(){var b=new a.peep.dialog.Message({title:"Error",message:"There was a problem saving your sketch. Your changes have not been saved."});b.run()})}).fail(function(b){if(b.input!==null){var c=new a.peep.dialog.Message({title:"Sorry",message:"You have to name your sketch, try to make it meaningful."});c.run()}})},saveRevision:function(b){var c=new a.peep.dialog.Prompt({title:"Tag this save",message:"What has changed?",ok:"Save",cancel:"Cancel"});c.run().done(function(c){var d=new a.peep.model.Revision({code:b.getContents(),tag:c.input}),e=b.getSketch();e.addRevision(d),e.save().success(function(){b.update(),b.setModified(!1)}).error(function(){var b=new a.peep.dialog.Message({title:"Error",message:"There was an error saving the sketch. Your changes have not been saved."}),c=e.getRevisions();delete c[c.lenth-1],b.run()})}).fail(function(b){if(b.input!==null){var c=new a.peep.dialog.Message({title:"Sorry",message:"You have to tag your save, try to make it meaningful."});c.run()}})},update:function(a){var b=a.getEditor().getSketch();this.isVisible(a.getEditor().getSketch())?this.show():this.hide()},isVisible:function(a,b){if(b===0)return!1;if(a)return a.hasPermission("save");return!0}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons,f=e.Title=e.Button.subClass({init:function(){this._super("title","")},click:function(b,c){var d=c.getEditor().getSketch(),e=new a.peep.dialog.Prompt({title:"Change Title",message:"What do you want to call your sketch?",value:d===null?"":d.getTitle(),ok:"Change"});e.run().done(function(a){d.setTitle(a.input),d.save().success(function(){c.getEditor().update()})}).fail(function(b){if(b.input===""){var c=new a.peep.dialog.Message({title:"Sorry",message:"Your sketch has to have a name"});c.run()}})},update:function(b){this._super(b);var c=b.getEditor().getSketch();c&&this.$element.text(c.getTitle()),a.user_id!=="0"?c?c.hasPermission("save")?this.show():this.hide():this.hide():this.hide()}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons,f=e.Toggle=e.Button.subClass({init:function(){this._super("toggle expand","Expand"),this.$element.unbind("mouseenter"),this.$element.unbind("mouseleave")},click:function(a,b){this.$element.hasClass("expand")?(b.getEditor().getElement().css("display","block"),b.getEditor().getElement().parents(".editor_wrap").css({height:"auto"}),b.getEditor().getElement().parents(".collapsible").css({height:"auto"})):(b.getEditor().getElement().css("display","none"),b.getEditor().getElement().parents(".editor_wrap").css({height:35}),b.getEditor().getElement().parents(".collapsible").css({height:35})),this.$element.toggleClass("expand"),this.$element.toggleClass("collapse"),b.getEditor().editor.resize()},update:function(a){this._super(a),a.getEditor().getElement().parents(".collapsible").size()?this.show():this.hide()}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.buttons,f=e.Poll=e.Button.subClass({init:function(){this._super("poll","Insert Poll")},click:function(b,c){var e=new a.peep.model.Poll,f=new a.peep.dialog.Prompt({title:"Ask your question",message:"What would you like your poll to ask?",ok:"Create",cancel:"Cancel"}),g=function(){var b=new a.peep.dialog.Prompt({title:"Possible Answer",message:"Please fill in an answer to the poll question",ok:"Create Answer",cancel:"Finished"});b.run().done(d.proxy(function(a){e.addOption(a.input),g.call(this)},this)).fail(d.proxy(function(){this.finishWizard(e,c)},this))};f.run().done(d.proxy(function(a){e.setQuestion(a.input),g.call(this)},this))},finishWizard:function(b,c){b.create().success(function(d){if(d.status){b.options=d.poll.options,b.id=d.poll.id,markdown=b.toMarkdown();var e=c.getEditor();e.setContents(e.getContents()+markdown)}else var f=new a.peep.dialog.Message({title:"Sorry",message:d.message})})}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar.Toolbar=Object.subClass({init:function(a,b){this.editor=a,this.buttons=[],this.$element=d("<div>").addClass("toolbar"),this.$buttonList=d("<ul>").addClass("items"),this.$element.append(this.$buttonList),d.each(b,d.proxy(function(a,b){this.addButton(b)},this)),this.$element.bind("click",d.proxy(this.click,this))},addButton:function(a){this.buttons.push(a),this.$buttonList.append(a.getElement())},getElement:function(){return this.$element},click:function(a){var b=this.$buttonList.find(".button"),c=b.index(a.target);c!==-1&&this.buttons[c].click(a,this)},getEditor:function(){return this.editor},update:function(){for(var a in this.buttons)this.buttons[a].update(this)}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.toolbar,f=e.Timeline=e.Toolbar.subClass({init:function(b,c){var e=a.peep.editor.toolbar.buttons;c=d.map(c,function(a){return new e.Revision(a)}),this.width=c.length*19,this._super(b,c),this.$element.removeClass("toolbar").addClass("timeline_wrap"),this.$element.find(".items").removeClass("items").addClass("timeline").css("width",this.width),this.$pointer=d("<span>").addClass("pointer"),this.$element.append(this.$pointer),this.setRevision(b.getSketch().lastRevision())},setRevision:function(a){var b=this.editor.getSketch().getRevisions(),c=d.inArray(a,b);c!==-1&&this.$pointer.css("left",19*c+7)},initialiseJSP:function(){this.scroller=this.$element.jScrollPane({stickToRight:!0,enableKeyboardNavigation:!1}).data("jsp"),this.scroller.scrollToPercentX(100)},addRevision:function(b){var c=new a.peep.editor.toolbar.buttons.Revision(b);this.addButton(c),this.width+=19,this.$element.find(".timeline").css("width",this.width),this.scroller.reinitialise(),this.scroller.scrollToPercentX(100),this.setRevision(b)},update:function(){this._super();var a=this.$buttonList.find("li").size();d.each(this.editor.getSketch().getRevisions(),d.proxy(function(b,c){b>=a&&this.addRevision(c)},this))}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor.Editor=Object.subClass({init:function(b){var c={mode:"ace/mode/text",theme:"ace/theme/peep",buttons:[],aceOptions:{setHighlightActiveLine:!1,setShowPrintMargin:!1,renderer:{setShowGutter:!1},setTabSize:2,setUseSoftTabs:!0,setUseWrapMode:!0}};a.jQuery.extend(!0,c,b),this.mode=c.mode,this.theme=c.theme,this.buttons=c.buttons,this.$element=d(c.element),this.aceOptions=c.aceOptions,this.editorId=c.editorId,this.initEditor(),this.toolbars={};if(this.buttons.length){var e=a.peep.editor.toolbar,f=new e.Toolbar(this,this.buttons);this.addToolbar("main",f)}this.modified=!1,this.update()},initEditor:function(){this.editor=a.ace.edit(this.$element.get(0)),this.$element.resize(function(a){this.editor.resize()}),this.session=this.editor.getSession(),this.editor.setTheme(this.theme);var b=require(this.mode).Mode;this.session.setMode(new b),this.editor.setHighlightActiveLine(this.aceOptions.setHighlightActiveLine),this.editor.setShowPrintMargin(this.aceOptions.setShowPrintMargin),this.editor.renderer.setShowGutter(this.aceOptions.renderer.setShowGutter),this.session.setTabSize(this.aceOptions.setTabSize),this.session.setUseSoftTabs(this.aceOptions.setUseSoftTabs),this.session.setUseWrapMode(this.aceOptions.setUseWrapMode);var c=d("<div>").addClass("editor_wrap");this.$element.wrap(c);var e=d("<div>").addClass("toolbar_wrap");this.$element.before(e),this.session.on("change",d.proxy(this.textChanged,this))},textChanged:function(){this.modified=!0},addToolbar:function(a,b){var c=b.getElement();this.$element.parent().children(".toolbar_wrap").append(c),this.toolbars[a]=b},getContents:function(){return this.session.getValue()},setContents:function(a){this.session.setValue(a)},getElement:function(){return this.$element},update:function(){for(var a in this.toolbars)this.toolbars[a].update()},isModified:function(){return this.modified},setModified:function(a){this.modified=a}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor,f=e.CodeEditor=e.Editor.subClass({init:function(b,c){var d=a.peep.editor.toolbar.buttons;this._super({mode:"ace/mode/processingjs",element:b,buttons:[new d.Run,new d.New,new d.Open,new d.Save,new d.Fork,new d.Tooltip,new d.Toggle,new d.Title],aceOptions:{setUseWrapMode:!1,renderer:{setShowGutter:!0}},editorId:c}),this.sketch=null,this.$element.parent().addClass("code_editor")},loadSketch:function(b){this.sketch=b;var c=this.sketch.lastRevision().getCode();this.session.setValue(c),this.setModified(!1),this.toolbars.hasOwnProperty("timeline")&&(this.toolbars.timeline.getElement().remove(),delete this.toolbars.timeline);var d=a.peep.editor.toolbar,e=new d.Timeline(this,b.getRevisions());this.addToolbar("timeline",e),e.initialiseJSP(),this.update()},getSketch:function(){return this.sketch},textChanged:function(){this._super();if(a.sessionStorage){var b={user_id:a.user_id,code:this.session.getValue(),editorId:this.editorId};a.sessionStorage.setItem("sketchCache_"+a.location.pathname,a.JSON.stringify(b))}},setModified:function(a){this._super(a),a||this.clearCache()},clearCache:function(){if(a.sessionStorage){var b="sketchCache_"+a.location.pathname;a.sessionStorage.removeItem(b)}}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.editor,f=e.MarkdownEditor=e.Editor.subClass({init:function(b,c){var d=a.peep.editor.toolbar.buttons;this._super({mode:"ace/mode/markdown",element:b,buttons:[new d.Poll,new d.Tooltip],editorId:c})}});a.MarkdownEditor=f}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.controller.Tutorial=Object.subClass({init:function(a){this.$container=null,this.$pages=null,this.currentPage=null,this.editor=null,this.$pagination=null,this.fadeSPeed=250,this.$container=d(a),this.$pages=this.findPages(),this.currentPage=this.visiblePageIndex(),this.pagination=this.buildPagination()},findPages:function(){return this.$container.find(".tutorial_chapter")},visiblePageIndex:function(){return this.$pages.index(this.$pages.filter(":visible"))},buildPagination:function(){var b=[];this.$pages.each(function(a,c){b.push({page_class:"tutorial_page",page_path:"page/"+a,page_title:d(c).children("h1").text()})});var c=new a.peep.util.Pagination({data:b}),e=c.getContent(),f=c.duplicateContent();this.$container.append(e),this.$container.children(".title").after(f),this.$container.find("ol.pages").click(d.proxy(function(a){var b=d(a.target);if(b.parent().hasClass("tutorial_page")){var c=b.parents("ol.pages").find("li a").index(b);this.changePage(c),a.preventDefault()}},this));return c},changePage:function(a){this.$pages.eq(this.currentPage).fadeOut(this.fadeSpeed,d.proxy(function(){this.currentPage=a,this.pagination.changePage(a),this.$pages.eq(this.currentPage).fadeIn(this.fadeSpeed);var b=this.$pages.eq(this.currentPage).find("div.code_example.sketch, div.code_example.sketchcode");b.each(function(a,b){d(b).is(":visible")&&d(b).data("runtime").run()})},this))}})}(window,document),function(a,b,c){var d=a.jQuery,e=a.peep.controller.wizards.EntryImage=Object.subClass({init:function(a){this.entry_id=a},start:function(){var b=d('<form method="POST" enctype="multipart/form-data" accept-charset="utf-8" action="/portfolios/entry/'+this.entry_id+'/gallery/image/new"></form>').addClass("standard_form upload_entry_picture"),c=d("<h2>").addClass("legend").text("Upload picture"),e=d("<dl>").addClass("fieldlist"),f=d("<dt>").append(d("<label>").attr("for","portfolio_entry_picture_input").text("Choose a file")),g=d("<dd>").addClass("explanation").text("Choose a picture to upload to the gallery. The maximum size is 4MB, and it has to be a PNG or JPG file."),h=d("<dd>").addClass("user_input").attr("id","portfolio_entry_picture").append(d("<input>").attr("type","file").attr("name","picture").attr("id","portfolio_entry_picture_input")),i=d("<dd>").addClass("user_submit").attr("id","portfolio_entry_submit").append(d('<button type="submit"></button>').append(d("<span>").text("Upload a picture")));b.append(c).append(e.append(f).append(g).append(h).append(i));var j=new a.peep.dialog.Dialog({title:"Upload a file...",$content:b});j.run()}})}(window,document),function(a,b,c){var d=a.$,e=makeClass();e.prototype.init=function(a){this.entry_id=a},a.EntryImageWizard=e}(window,document),function(a,b,c){function g(b){var c=b.attr("data-processing-sources"),d="";if(c){c=c.split(/\s+/);var e=function e(a){var b=new XMLHttpRequest;b.open("GET",a,!1),b.setRequestHeader("If-Modified-Since","Fri, 01 Jan 1960 00:00:00 GMT"),b.send(null);if(b.status!==200&&b.status!==0)throw"XMLHttpRequest failed, status code "+b.status;return b.responseText};for(var f=0,g=c.length;f<g;f++)if(c[f]){var h=e(c[f]);h!==!1&&(d+=";\n"+h)}}else d=b.text();var i=new a.Processing(b.get(0),d);Processing.addInstance(i);return i}function f(b){var c;typeof b.scrollable=="function"?c=b.scrollable.call():c=d(b.scrollable);var c=b.scrollable;if(c)var e=b.top_buffer;typeof e=="function"&&(e=e.call());var g=b.bottom_buffer;typeof g=="function"&&(g=g.call());var h=b.top_limit;typeof h=="function"&&(h=h.call());var i=b.bottom_limit;typeof i=="function"&&(i=i.call());var j=d(a).scrollTop(),k=j+d(a).height(),l=c.offset().top,m=l+c.outerHeight(),n="travelling";j+e<=h&&l<=h?n="top":k-g>=i&&m>=i&&j+e>=l&&(n="bottom");switch(n){case"top":c.css({position:"absolute",top:70+d("div.pagination").outerHeight(!0),right:25,left:"auto",bottom:"auto"});break;case"travelling":var o=c.offset().left;c.css({position:"fixed",top:e,right:"auto",left:o,bottom:"auto"});break;case"bottom":c.css({position:"absolute",top:"auto",left:"auto",right:25,bottom:25+d("div.pagination").outerHeight(!0)})}a.setTimeout(function(){f(b)},10)}function e(a){var b=d("#forum_post_code_hidden, #forum_thread_code_hidden"),c=d("dd#forum_post_content .editor, dd#forum_thread_content .editor").data("codeEditor").getContents();b.val(c)}var d=a.$;d(b).ready(function(){var b=a.codeEditors=[],h=d(".editor");h.each(function(e,f){b.push(new a.peep.editor.CodeEditor(f,e));var g=d(f).attr("data-sketch_id");d(f).data("codeEditor",b[e]);if(g!==c&&g!==!1){var h=new a.peep.model.Sketch;h.load(parseInt(g)).success(function(){h.loadRevisions().success(function(){b[e].loadSketch(h)})})}});if(a.sessionStorage){var i=sessionStorage.getItem("sketchCache_"+a.location.pathname);if(i===null)sessionStorage.removeItem("sketchCache_"+a.location.pathname);else try{i=a.JSON.parse(i);if(i.user_id===a.user_id&&a.codeEditors[i.editorId]!==c){var j=new a.peep.dialog.Confirm({title:"Found an unsaved sketch",message:"We found an unsaved sketch, would you like to restore it?",ok:"Yes",cancel:"No"});j.run().done(function(){var b=a.codeEditors[i.editorId];b.session.setValue(i.code),b.setModified(!1)}).fail(function(){a.sessionStorage.removeItem("sketchCache_"+a.location.pathname)})}}catch(k){console.log(k)}}var l=d("canvas#frontpage");l.size()>0&&(g(l),d(a).resize(function(){Processing.getInstanceById("frontpage").size(d(a).width(),414)}));var m=a.peep.runtime.processingjs.PJSEmbedded,n=a.peep.runtime.processingjs,o=d("div.code_example.sketch, div.code_example.sketchcode");o.each(function(b,c){var e=new m(d(c)),f=[];if(d(c).parents(".portfolio_entry.entry_view").size()>0){var g=a.peep.runtime.processingjs.buttons;f.push(new g.Screenshot)}var h=e.createControls(f),i=e.getContainer();i.append(h),i.data("runtime",e),i.is(":visible")&&e.run()}),d("#forum_post").bind("submit",e),d("#forum_thread").bind("submit",e),d("div.tutorial_view").size()===1&&f({scrollable:d("div.tutorial_editor_wrap"),top_buffer:25,bottom_buffer:25,top_limit:function(){return d(".tutorial_chapter:visible").offset().top},bottom_limit:function(){return d(".tutorial_chapter:visible").offset().top+d(".tutorial_chapter:visible").outerHeight()}}),d("div.tutorial_view").each(function(b,c){var d=a.peep.controller,e=new d.Tutorial(c)}),d("div.portfolio_entry.entry_view .action_upload_image").bind("click",function(b){var c=a.peep.controller.wizards,d=new c.EntryImage(a.entry_id);d.start(),b.preventDefault()}),a.markdownEditors=[],d(".markdown_editor").each(function(b,c){var e=d(c),f=e.parents("form"),g=e.html(),h=d("<div>").addClass("bootedMarkdownEditor").html(g).insertAfter(e),i=e.attr("name");e.remove();var j=a.peep.editor,k=new j.MarkdownEditor(h.get(0),b);a.markdownEditors.push(k),h.data("markdownEditor",k),f.bind("submit",function(){var b=d("<input />");b.attr("name",i),b.attr("type","hidden");if(a.sessionStorage){var c="sketchCache_"+a.location.pathname;a.sessionStorage.removeItem(c)}b.val(k.session.getValue()),f.append(b)})}),d("div#content_wrap").noisy({monochrome:!0,size:50,opacity:.06,intensity:1}),d("div.gallery").noisy({monochrome:!0,color:"rgb(170,170,170)",size:200,opacity:.07,intensity:1})})}(window,document)
